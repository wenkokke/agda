<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-cse #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.Interaction.InteractionTop</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html"><span class="hs-identifier">Agda.Interaction.InteractionTop</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TChan</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fail</span></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadFail</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runStateT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.STM</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCM</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#initState"><span class="hs-identifier">initState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier">setCommandLineOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCM</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCP</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier">checkExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier">isType_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Errors.html"><span class="hs-identifier">Agda.TypeChecking.Errors</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#runPM"><span class="hs-identifier">runPM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html"><span class="hs-identifier">Agda.Syntax.Fixity</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html"><span class="hs-identifier">Agda.Syntax.Parser</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Glyph.html"><span class="hs-identifier">Agda.Syntax.Concrete.Glyph</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pretty.html"><span class="hs-identifier">Agda.Syntax.Abstract.Pretty</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#mkDefInfo"><span class="hs-identifier">mkDefInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.ConcreteToAbstract</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.AbstractToConcrete.html"><span class="hs-identifier">Agda.Syntax.Translation.AbstractToConcrete</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Translation.AbstractToConcrete.html#withScope"><span class="hs-identifier">withScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html"><span class="hs-identifier">Agda.Interaction.Base</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html"><span class="hs-identifier">Agda.Interaction.ExitCode</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html"><span class="hs-identifier">Agda.Interaction.FindFile</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html"><span class="hs-identifier">Agda.Interaction.Options.Lenses</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lenses</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html"><span class="hs-identifier">Agda.Interaction.MakeCase</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.SearchAbout.html"><span class="hs-identifier">Agda.Interaction.SearchAbout</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Function"><span class="hs-identifier">Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#ExtendedLambda"><span class="hs-identifier">ExtendedLambda</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html"><span class="hs-identifier">Agda.Interaction.BasicOps</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Precise</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Aspect.html#Error"><span class="hs-identifier">Error</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Aspect.html#Postulate"><span class="hs-identifier">Postulate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html"><span class="hs-identifier">Agda.Interaction.Imports</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier">Mode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier">ScopeCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier">TypeCheck</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html"><span class="hs-identifier">Agda.Interaction.Imports</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Imp</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.html"><span class="hs-identifier">Agda.Compiler.Backend</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Mimer.Mimer.html"><span class="hs-identifier">Agda.Mimer.Mimer</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mimer</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeepSeq</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html"><span class="hs-identifier">Agda.Utils.FileName</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html"><span class="hs-identifier">Agda.Utils.Hash</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.Strict.html"><span class="hs-identifier">Agda.Utils.Maybe.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Mode</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.ProfileOptions.html"><span class="hs-identifier">Agda.Utils.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.String.html"><span class="hs-identifier">Agda.Utils.String</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Time.html"><span class="hs-identifier">Agda.Utils.Time</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html"><span class="hs-identifier">Agda.Utils.WithDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier">lensCollapseDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier">lensKeepDefault</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- The CommandM monad</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">type</span><span> </span><span id="CommandM"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-var">CommandM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandState"><span class="hs-identifier hs-type">CommandState</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- | Restore both 'TCState' and 'CommandState'.</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621681667100"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#localStateCommandM"><span class="hs-identifier hs-type">localStateCommandM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667100"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-104"></span><span id="localStateCommandM"><span class="annot"><span class="annottext">localStateCommandM :: forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#localStateCommandM"><span class="hs-identifier hs-var hs-var">localStateCommandM</span></a></span></span><span> </span><span id="local-6989586621681668277"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668277"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621681668278"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668278"><span class="hs-identifier hs-var">cSt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621681668280"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668280"><span class="hs-identifier hs-var">tcSt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621681668282"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668282"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668277"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="annottext">TCState -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668280"><span class="hs-identifier hs-var">tcSt</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">CommandState -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668278"><span class="hs-identifier hs-var">cSt</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; CommandM a
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668282"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="annot"><span class="hs-comment">-- | Restore 'TCState', do not touch 'CommandState'.</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span id="local-6989586621681667108"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667108"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-115"></span><span id="liftLocalState"><span class="annot"><span class="annottext">liftLocalState :: forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var hs-var">liftLocalState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; StateT CommandState TCM a)
-&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; StateT CommandState TCM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCM a
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localTCState"><span class="hs-identifier hs-var">localTCState</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | Build an opposite action to 'lift' for state monads.</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621681667117"><span id="local-6989586621681667118"><span id="local-6989586621681667120"><span id="local-6989586621681667122"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#revLift"><span class="hs-identifier hs-type">revLift</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621681667117"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667118"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667119"><span class="annot"><a href="#local-6989586621681667119"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621681667118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667119"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667117"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667120"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681667119"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681667117"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ run</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667121"><span class="annot"><a href="#local-6989586621681667121"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621681667120"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667121"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667121"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ lift</span></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667123"><span class="annot"><a href="#local-6989586621681667123"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681667118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667122"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667120"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667123"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667120"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667123"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667122"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ reverse lift in double negative position</span></span><span>
</span><span id="line-124"></span><span id="revLift"><span class="annot"><span class="annottext">revLift :: forall st (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadState st m =&gt;
(forall c. m c -&gt; st -&gt; k (c, st))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.InteractionTop.html#revLift"><span class="hs-identifier hs-var hs-var">revLift</span></a></span></span><span> </span><span id="local-6989586621681668300"><span class="annot"><span class="annottext">forall c. m c -&gt; st -&gt; k (c, st)
</span><a href="#local-6989586621681668300"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span id="local-6989586621681668301"><span class="annot"><span class="annottext">forall b. k b -&gt; m b
</span><a href="#local-6989586621681668301"><span class="hs-identifier hs-var">lift'</span></a></span></span><span> </span><span id="local-6989586621681668302"><span class="annot"><span class="annottext">forall x. (m a -&gt; k x) -&gt; k x
</span><a href="#local-6989586621681668302"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621681668303"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621681668303"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m st
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681668304"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668304"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668305"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621681668305"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">k (a, st) -&gt; m (a, st)
forall b. k b -&gt; m b
</span><a href="#local-6989586621681668301"><span class="hs-identifier hs-var">lift'</span></a></span><span> </span><span class="annot"><span class="annottext">(k (a, st) -&gt; m (a, st)) -&gt; k (a, st) -&gt; m (a, st)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; k (a, st)) -&gt; k (a, st)
forall x. (m a -&gt; k x) -&gt; k x
</span><a href="#local-6989586621681668302"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m a -&gt; st -&gt; k (a, st)
forall c. m c -&gt; st -&gt; k (c, st)
</span><a href="#local-6989586621681668300"><span class="hs-operator hs-var">`run`</span></a></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621681668303"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">st -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621681668305"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668304"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span id="local-6989586621681667132"><span id="local-6989586621681667134"><span id="local-6989586621681667136"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#revLiftTC"><span class="hs-identifier hs-type">revLiftTC</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667132"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667133"><span class="annot"><a href="#local-6989586621681667133"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621681667132"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667133"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667134"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681667133"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ run</span></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667135"><span class="annot"><a href="#local-6989586621681667135"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621681667134"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667135"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667132"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667135"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ lift</span></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667137"><span class="annot"><a href="#local-6989586621681667137"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681667132"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667136"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667134"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667137"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667134"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667137"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667132"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667136"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ reverse lift in double negative position</span></span><span>
</span><span id="line-135"></span><span id="revLiftTC"><span class="annot"><span class="annottext">revLiftTC :: forall (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadTCState m =&gt;
(forall c. m c -&gt; TCState -&gt; k (c, TCState))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.InteractionTop.html#revLiftTC"><span class="hs-identifier hs-var hs-var">revLiftTC</span></a></span></span><span> </span><span id="local-6989586621681668316"><span class="annot"><span class="annottext">forall c. m c -&gt; TCState -&gt; k (c, TCState)
</span><a href="#local-6989586621681668316"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span id="local-6989586621681668317"><span class="annot"><span class="annottext">forall b. k b -&gt; m b
</span><a href="#local-6989586621681668317"><span class="hs-identifier hs-var">lift'</span></a></span></span><span> </span><span id="local-6989586621681668318"><span class="annot"><span class="annottext">forall x. (m a -&gt; k x) -&gt; k x
</span><a href="#local-6989586621681668318"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621681668319"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668319"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681668320"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668320"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668321"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668321"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">k (a, TCState) -&gt; m (a, TCState)
forall b. k b -&gt; m b
</span><a href="#local-6989586621681668317"><span class="hs-identifier hs-var">lift'</span></a></span><span> </span><span class="annot"><span class="annottext">(k (a, TCState) -&gt; m (a, TCState))
-&gt; k (a, TCState) -&gt; m (a, TCState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; k (a, TCState)) -&gt; k (a, TCState)
forall x. (m a -&gt; k x) -&gt; k x
</span><a href="#local-6989586621681668318"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m a -&gt; TCState -&gt; k (a, TCState)
forall c. m c -&gt; TCState -&gt; k (c, TCState)
</span><a href="#local-6989586621681668316"><span class="hs-operator hs-var">`run`</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668319"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">TCState -&gt; m ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668321"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668320"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Opposite of 'liftIO' for 'CommandM'.</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- This function should only be applied to computations that are</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- guaranteed not to raise any errors (except for 'IOException's).</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="local-6989586621681667141"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-type">commandMToIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681667142"><span class="annot"><a href="#local-6989586621681667142"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667141"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681667142"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681667142"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667141"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-147"></span><span id="commandMToIO"><span class="annot"><span class="annottext">commandMToIO :: forall a. (forall x. (CommandM a -&gt; IO x) -&gt; IO x) -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-var hs-var">commandMToIO</span></a></span></span><span> </span><span id="local-6989586621681668326"><span class="annot"><span class="annottext">forall x. (CommandM a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621681668326"><span class="hs-identifier hs-var">ci_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall c.
 StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState))
-&gt; (forall a. TCM a -&gt; CommandM a)
-&gt; (forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; CommandM a
forall st (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadState st m =&gt;
(forall c. m c -&gt; st -&gt; k (c, st))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.InteractionTop.html#revLift"><span class="hs-identifier hs-var">revLift</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall c.
StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">TCM b -&gt; StateT CommandState TCM b
forall a. TCM a -&gt; CommandM a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">((forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a)
-&gt; (forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681668330"><span class="annot"><span class="annottext">CommandM a -&gt; TCM x
</span><a href="#local-6989586621681668330"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall c. TCM c -&gt; TCState -&gt; IO (c, TCState))
-&gt; (forall b. IO b -&gt; TCM b)
-&gt; (forall {x}. (TCM x -&gt; IO x) -&gt; IO x)
-&gt; TCM x
forall (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadTCState m =&gt;
(forall c. m c -&gt; TCState -&gt; k (c, TCState))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.InteractionTop.html#revLiftTC"><span class="hs-identifier hs-var">revLiftTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCM c -&gt; TCState -&gt; IO (c, TCState)
forall c. TCM c -&gt; TCState -&gt; IO (c, TCState)
</span><a href="Agda.TypeChecking.Monad.Base.html#runSafeTCM"><span class="hs-identifier hs-var">runSafeTCM</span></a></span><span> </span><span class="annot"><span class="annottext">IO b -&gt; TCM b
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">((forall {x}. (TCM x -&gt; IO x) -&gt; IO x) -&gt; TCM x)
-&gt; (forall {x}. (TCM x -&gt; IO x) -&gt; IO x) -&gt; TCM x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; IO x) -&gt; IO x
forall x. (CommandM a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621681668326"><span class="hs-identifier hs-var">ci_i</span></a></span><span> </span><span class="annot"><span class="annottext">((CommandM a -&gt; IO x) -&gt; IO x)
-&gt; ((TCM x -&gt; IO x) -&gt; CommandM a -&gt; IO x)
-&gt; (TCM x -&gt; IO x)
-&gt; IO x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCM x -&gt; IO x) -&gt; (CommandM a -&gt; TCM x) -&gt; CommandM a -&gt; IO x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; TCM x
</span><a href="#local-6989586621681668330"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Lift a TCM action transformer to a CommandM action transformer.</span></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621681667157"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-type">liftCommandMT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681668334"><span class="annot"><a href="#local-6989586621681668334"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668334"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668334"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667157"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667157"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-152"></span><span id="liftCommandMT"><span class="annot"><span class="annottext">liftCommandMT :: forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var hs-var">liftCommandMT</span></a></span></span><span> </span><span id="local-6989586621681668336"><span class="annot"><span class="annottext">forall a. TCM a -&gt; TCM a
</span><a href="#local-6989586621681668336"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681668337"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668337"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall c.
 StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState))
-&gt; (forall a. TCM a -&gt; CommandM a)
-&gt; (forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; CommandM a
forall st (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadState st m =&gt;
(forall c. m c -&gt; st -&gt; k (c, st))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.InteractionTop.html#revLift"><span class="hs-identifier hs-var">revLift</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall c.
StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">TCM b -&gt; StateT CommandState TCM b
forall a. TCM a -&gt; CommandM a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">((forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a)
-&gt; (forall {x}. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall a. TCM a -&gt; TCM a
</span><a href="#local-6989586621681668336"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM x -&gt; TCM x)
-&gt; ((CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; (CommandM a -&gt; TCM x)
-&gt; TCM x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CommandM a -&gt; TCM x) -&gt; CommandM a -&gt; TCM x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668337"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-comment">-- | Ditto, but restore state.</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621681668340"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMTLocalState"><span class="hs-identifier hs-type">liftCommandMTLocalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681668342"><span class="annot"><a href="#local-6989586621681668342"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668342"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668342"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668340"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668340"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-157"></span><span id="liftCommandMTLocalState"><span class="annot"><span class="annottext">liftCommandMTLocalState :: forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMTLocalState"><span class="hs-identifier hs-var hs-var">liftCommandMTLocalState</span></a></span></span><span> </span><span id="local-6989586621681668343"><span class="annot"><span class="annottext">forall a. TCM a -&gt; TCM a
</span><a href="#local-6989586621681668343"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall a. TCM a -&gt; TCM a
</span><a href="#local-6989586621681668343"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; CommandM a)
-&gt; (CommandM a -&gt; CommandM a) -&gt; CommandM a -&gt; CommandM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#localStateCommandM"><span class="hs-identifier hs-var">localStateCommandM</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- | Put a response by the callback function given by 'stInteractionOutputCallback'.</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span id="putResponse"><span class="annot"><span class="annottext">putResponse :: Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var hs-var">putResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; (Response -&gt; TCM ()) -&gt; Response -&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#appInteractionOutputCallback"><span class="hs-identifier hs-var">appInteractionOutputCallback</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | A Lens for 'theInteractionPoints'.</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-type">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span id="modifyTheInteractionPoints"><span class="annot"><span class="annottext">modifyTheInteractionPoints :: ([InteractionId] -&gt; [InteractionId]) -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var hs-var">modifyTheInteractionPoints</span></a></span></span><span> </span><span id="local-6989586621681668349"><span class="annot"><span class="annottext">[InteractionId] -&gt; [InteractionId]
</span><a href="#local-6989586621681668349"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ())
-&gt; (CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668350"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668350"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668350"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681668349"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668350"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- * Operations for manipulating 'oldInteractionScopes'.</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="annot"><span class="hs-comment">-- | A Lens for 'oldInteractionScopes'.</span></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-type">modifyOldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#OldInteractionScopes"><span class="hs-identifier hs-type">OldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#OldInteractionScopes"><span class="hs-identifier hs-type">OldInteractionScopes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="modifyOldInteractionScopes"><span class="annot"><span class="annottext">modifyOldInteractionScopes :: (OldInteractionScopes -&gt; OldInteractionScopes)
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var hs-var">modifyOldInteractionScopes</span></a></span></span><span> </span><span id="local-6989586621681668353"><span class="annot"><span class="annottext">OldInteractionScopes -&gt; OldInteractionScopes
</span><a href="#local-6989586621681668353"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ())
-&gt; (CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668354"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668354"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668354"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681668353"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668354"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-type">insertOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span id="insertOldInteractionScope"><span class="annot"><span class="annottext">insertOldInteractionScope :: InteractionId -&gt; ScopeInfo -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var hs-var">insertOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621681668356"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668356"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668357"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668357"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inserting old interaction scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668356"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; OldInteractionScopes)
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var">modifyOldInteractionScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((OldInteractionScopes -&gt; OldInteractionScopes)
 -&gt; StateT CommandState TCM ())
-&gt; (OldInteractionScopes -&gt; OldInteractionScopes)
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; ScopeInfo -&gt; OldInteractionScopes -&gt; OldInteractionScopes
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668356"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668357"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-type">removeOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span id="removeOldInteractionScope"><span class="annot"><span class="annottext">removeOldInteractionScope :: InteractionId -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-var hs-var">removeOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621681668362"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668362"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removing old interaction scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668362"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; OldInteractionScopes)
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var">modifyOldInteractionScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((OldInteractionScopes -&gt; OldInteractionScopes)
 -&gt; StateT CommandState TCM ())
-&gt; (OldInteractionScopes -&gt; OldInteractionScopes)
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; OldInteractionScopes -&gt; OldInteractionScopes
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668362"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-type">getOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span>
</span><span id="line-190"></span><span id="getOldInteractionScope"><span class="annot"><span class="annottext">getOldInteractionScope :: InteractionId -&gt; CommandM ScopeInfo
</span><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-var hs-var">getOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621681668365"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668365"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621681668366"><span class="annot"><span class="annottext">Maybe ScopeInfo
</span><a href="#local-6989586621681668366"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe ScopeInfo)
-&gt; StateT CommandState TCM (Maybe ScopeInfo)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; Maybe ScopeInfo)
 -&gt; StateT CommandState TCM (Maybe ScopeInfo))
-&gt; (CommandState -&gt; Maybe ScopeInfo)
-&gt; StateT CommandState TCM (Maybe ScopeInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; OldInteractionScopes -&gt; Maybe ScopeInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668365"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; Maybe ScopeInfo)
-&gt; (CommandState -&gt; OldInteractionScopes)
-&gt; CommandState
-&gt; Maybe ScopeInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; OldInteractionScopes
</span><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ScopeInfo
</span><a href="#local-6989586621681668366"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">Maybe ScopeInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; CommandM ScopeInfo
forall a. String -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CommandM ScopeInfo) -&gt; String -&gt; CommandM ScopeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not an old interaction point: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668365"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668368"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668368"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; CommandM ScopeInfo
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668368"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><span class="hs-comment">-- | Do setup and error handling for a command.</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#handleCommand_"><span class="hs-identifier hs-type">handleCommand_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span id="handleCommand_"><span class="annot"><span class="annottext">handleCommand_ :: StateT CommandState TCM () -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand_"><span class="hs-identifier hs-var hs-var">handleCommand_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. CommandM a -&gt; CommandM a)
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var">handleCommand</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. a -&gt; a
forall a. CommandM a -&gt; CommandM a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-type">handleCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681668372"><span class="annot"><a href="#local-6989586621681668372"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668372"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668372"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="handleCommand"><span class="annot"><span class="annottext">handleCommand :: (forall a. CommandM a -&gt; CommandM a)
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var hs-var">handleCommand</span></a></span></span><span> </span><span id="local-6989586621681668373"><span class="annot"><span class="annottext">forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621681668373"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621681668374"><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668374"><span class="hs-identifier hs-var">onFail</span></a></span></span><span> </span><span id="local-6989586621681668375"><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668375"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668376"><span class="hs-identifier hs-var">handleNastyErrors</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621681668373"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621681668377"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668377"><span class="hs-identifier hs-var">oldState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- -- Andreas, 2016-11-18 OLD CODE:</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- -- onFail and handleErr are executed in &quot;new&quot; command state (not TCState).</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- -- But it seems that if an exception is raised, it is identical to the old state,</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- -- see code for catchErr.</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- res &lt;- (`catchErr` (return . Just)) $ Nothing &lt;$ cmd</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- maybe (return ()) (\ e -&gt; onFail &gt;&gt; handleErr e) res</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-11-18 NEW CODE: execute onFail and handleErr in handler</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- which means (looking at catchErr) they run in state s rathern than s'.</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- Yet, it looks like s == s' in case the command failed.</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668375"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
-&gt; (TCErr -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; (TCErr -&gt; CommandM a) -&gt; CommandM a
</span><a href="#local-6989586621681668378"><span class="hs-operator hs-var">`catchErr`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668379"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668379"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668374"><span class="hs-identifier hs-var">onFail</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="annottext">Maybe HighlightingMethod -&gt; TCErr -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668380"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingMethod
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668379"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-comment">-- Andreas, 2016-11-18, issue #2174</span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-comment">-- Reset TCState after error is handled, to get rid of metas created during failed command</span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621681668381"><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681668381"><span class="hs-identifier hs-var">newPersistentState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PersistentTCState -&gt; TCMT IO PersistentTCState
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.State.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668377"><span class="hs-identifier hs-var">oldState</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.State.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PersistentTCState -&gt; PersistentTCState -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681668381"><span class="hs-identifier hs-var">newPersistentState</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- Preserves state so we can do unsolved meta highlighting</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621681667187"><span class="annot"><a href="#local-6989586621681668378"><span class="hs-identifier hs-type">catchErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667187"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667187"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667187"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621681668378"><span class="annot"><span class="annottext">catchErr :: forall a. CommandM a -&gt; (TCErr -&gt; CommandM a) -&gt; CommandM a
</span><a href="#local-6989586621681668378"><span class="hs-identifier hs-var hs-var">catchErr</span></a></span></span><span> </span><span id="local-6989586621681668397"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668397"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681668398"><span class="annot"><span class="annottext">TCErr -&gt; CommandM a
</span><a href="#local-6989586621681668398"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>      </span><span id="local-6989586621681668399"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668399"><span class="hs-identifier hs-var">s</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681668400"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668400"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668401"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668401"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (a, CommandState) -&gt; StateT CommandState TCM (a, CommandState)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (a, CommandState)
 -&gt; StateT CommandState TCM (a, CommandState))
-&gt; TCM (a, CommandState)
-&gt; StateT CommandState TCM (a, CommandState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandState -&gt; TCM (a, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681668397"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668399"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-231"></span><span>         </span><span class="annot"><span class="annottext">TCM (a, CommandState)
-&gt; (TCErr -&gt; TCM (a, CommandState)) -&gt; TCM (a, CommandState)
forall a. TCM a -&gt; (TCErr -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Base.html#catchError_"><span class="hs-operator hs-var">`catchError_`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668403"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668403"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>           </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandState -&gt; TCM (a, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCErr -&gt; CommandM a
</span><a href="#local-6989586621681668398"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668403"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668399"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">CommandState -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668401"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; CommandM a
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668400"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- Handle every possible kind of error (#637), except for</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- AsyncCancelled, which is used to abort Agda.</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621681668376"><span class="hs-identifier hs-type">handleNastyErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621681668376"><span class="annot"><span class="annottext">handleNastyErrors :: StateT CommandState TCM () -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668376"><span class="hs-identifier hs-var hs-var">handleNastyErrors</span></a></span></span><span> </span><span id="local-6989586621681668404"><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668404"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. (StateT CommandState TCM () -&gt; IO x) -&gt; IO x)
-&gt; StateT CommandState TCM ()
forall a. (forall x. (CommandM a -&gt; IO x) -&gt; IO x) -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-var">commandMToIO</span></a></span><span> </span><span class="annot"><span class="annottext">((forall x. (StateT CommandState TCM () -&gt; IO x) -&gt; IO x)
 -&gt; StateT CommandState TCM ())
-&gt; (forall x. (StateT CommandState TCM () -&gt; IO x) -&gt; IO x)
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668416"><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; IO x
</span><a href="#local-6989586621681668416"><span class="hs-identifier hs-var">toIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668417"><span class="annot"><span class="annottext">handle :: SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621681668417"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621681668418"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681668418"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><span class="annottext">x -&gt; Either AsyncCancelled x
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; Either AsyncCancelled x)
-&gt; IO x -&gt; IO (Either AsyncCancelled x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-242"></span><span>              </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; IO x
</span><a href="#local-6989586621681668416"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HighlightingMethod -&gt; TCErr -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668380"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingMethod -&gt; Maybe HighlightingMethod
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.html#Direct"><span class="hs-identifier hs-var">Direct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCErr -&gt; StateT CommandState TCM ())
-&gt; TCErr -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-243"></span><span>                        </span><span class="annot"><span class="annottext">Range -&gt; Doc -&gt; TCErr
</span><a href="Agda.TypeChecking.Monad.Base.html#Exception"><span class="hs-identifier hs-var">Exception</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCErr) -&gt; Doc -&gt; TCErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
forall a. String -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Doc) -&gt; String -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><span class="hs-identifier hs-var">E.displayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681668418"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>          </span><span id="local-6989586621681668433"><span class="annot"><span class="annottext">asyncHandler :: AsyncCancelled -&gt; m (Either AsyncCancelled b)
</span><a href="#local-6989586621681668433"><span class="hs-identifier hs-var hs-var">asyncHandler</span></a></span></span><span> </span><span id="local-6989586621681668434"><span class="annot"><span class="annottext">e :: AsyncCancelled
</span><a href="#local-6989586621681668434"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">AsyncCancelled
</span><span class="hs-identifier hs-var">AsyncCancelled</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either AsyncCancelled b -&gt; m (Either AsyncCancelled b)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsyncCancelled -&gt; Either AsyncCancelled b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621681668434"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>          </span><span id="local-6989586621681668436"><span class="annot"><span class="annottext">generalHandler :: SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621681668436"><span class="hs-identifier hs-var hs-var">generalHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681668437"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681668437"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621681668417"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681668437"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621681668438"><span class="annot"><span class="annottext">Either AsyncCancelled x
</span><a href="#local-6989586621681668438"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; Either AsyncCancelled x
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; Either AsyncCancelled x)
-&gt; IO x -&gt; IO (Either AsyncCancelled x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; IO x
</span><a href="#local-6989586621681668416"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668404"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either AsyncCancelled x)
-&gt; (AsyncCancelled -&gt; IO (Either AsyncCancelled x))
-&gt; IO (Either AsyncCancelled x)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled -&gt; IO (Either AsyncCancelled x)
forall {m :: * -&gt; *} {b}.
Monad m =&gt;
AsyncCancelled -&gt; m (Either AsyncCancelled b)
</span><a href="#local-6989586621681668433"><span class="hs-identifier hs-var">asyncHandler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>             </span><span class="annot"><span class="annottext">IO (Either AsyncCancelled x)
-&gt; (SomeException -&gt; IO (Either AsyncCancelled x))
-&gt; IO (Either AsyncCancelled x)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621681668436"><span class="hs-identifier hs-var">generalHandler</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either AsyncCancelled x
</span><a href="#local-6989586621681668438"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681668440"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621681668440"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; IO x
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621681668440"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681668441"><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621681668441"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AsyncCancelled -&gt; IO x
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621681668441"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- Displays an error and instructs Emacs to jump to the site of the</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-comment">-- error. Because this function may switch the focus to another file</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- the status information is also updated.</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621681668380"><span class="annot"><span class="annottext">handleErr :: Maybe HighlightingMethod -&gt; TCErr -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668380"><span class="hs-identifier hs-var hs-var">handleErr</span></a></span></span><span> </span><span id="local-6989586621681668494"><span class="annot"><span class="annottext">Maybe HighlightingMethod
</span><a href="#local-6989586621681668494"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621681668495"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668495"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621681668496"><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621681668496"><span class="hs-identifier hs-var">unsolved</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO HighlightingInfoBuilder
-&gt; StateT CommandState TCM HighlightingInfoBuilder
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO HighlightingInfoBuilder
 -&gt; StateT CommandState TCM HighlightingInfoBuilder)
-&gt; TCMT IO HighlightingInfoBuilder
-&gt; StateT CommandState TCM HighlightingInfoBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO HighlightingInfoBuilder
</span><a href="Agda.Interaction.Highlighting.Generate.html#computeUnsolvedInfo"><span class="hs-identifier hs-var">computeUnsolvedInfo</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621681668498"><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621681668498"><span class="hs-identifier hs-var">err</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO HighlightingInfoBuilder
-&gt; StateT CommandState TCM HighlightingInfoBuilder
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO HighlightingInfoBuilder
 -&gt; StateT CommandState TCM HighlightingInfoBuilder)
-&gt; TCMT IO HighlightingInfoBuilder
-&gt; StateT CommandState TCM HighlightingInfoBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO HighlightingInfoBuilder
</span><a href="Agda.Interaction.Highlighting.Generate.html#errorHighlighting"><span class="hs-identifier hs-var">errorHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668495"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621681668500"><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681668500"><span class="hs-identifier hs-var">modFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ModuleToSource -&gt; StateT CommandState TCM ModuleToSource
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO ModuleToSource -&gt; StateT CommandState TCM ModuleToSource)
-&gt; TCMT IO ModuleToSource -&gt; StateT CommandState TCM ModuleToSource
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState ModuleToSource -&gt; TCMT IO ModuleToSource
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleToSource -&gt; f ModuleToSource) -&gt; TCState -&gt; f TCState
Lens' TCState ModuleToSource
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621681668504"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668504"><span class="hs-identifier hs-var">method</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingMethod
</span><a href="#local-6989586621681668494"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">Maybe HighlightingMethod
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO HighlightingMethod
-&gt; StateT CommandState TCM HighlightingMethod
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO HighlightingMethod
 -&gt; StateT CommandState TCM HighlightingMethod)
-&gt; TCMT IO HighlightingMethod
-&gt; StateT CommandState TCM HighlightingMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv HighlightingMethod -&gt; TCMT IO HighlightingMethod
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingMethod -&gt; f HighlightingMethod) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.html#eHighlightingMethod"><span class="hs-identifier hs-var">eHighlightingMethod</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668509"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668509"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighlightingMethod -&gt; StateT CommandState TCM HighlightingMethod
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668509"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668510"><span class="annot"><span class="annottext">info :: HighlightingInfo
</span><a href="#local-6989586621681668510"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. Convert a b =&gt; a -&gt; b
</span><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfoBuilder -&gt; HighlightingInfo)
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621681668498"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfoBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621681668496"><span class="hs-identifier hs-var">unsolved</span></a></span><span>
</span><span id="line-266"></span><span>                     </span><span class="hs-comment">-- Errors take precedence over unsolved things.</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-comment">-- TODO: make a better predicate for this</span><span>
</span><span id="line-269"></span><span>        </span><span id="local-6989586621681668512"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668512"><span class="hs-identifier hs-var">noError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; TCMT IO String -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO String
forall (tcm :: * -&gt; *). MonadTCM tcm =&gt; TCErr -&gt; tcm String
</span><a href="Agda.TypeChecking.Errors.html#renderError"><span class="hs-identifier hs-var">renderError</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668495"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>        </span><span id="local-6989586621681668515"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668515"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optShowImplicit"><span class="hs-identifier hs-var">optShowImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span id="local-6989586621681668520"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668520"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optShowIrrelevant"><span class="hs-identifier hs-var">optShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668512"><span class="hs-identifier hs-var">noError</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; [Response] -&gt; StateT CommandState TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">([Response] -&gt; StateT CommandState TCM ())
-&gt; [Response] -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-275"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DisplayInfo"><span class="hs-identifier hs-var">Resp_DisplayInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; Response)
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Info_Error_boot tcErr tcWarning
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-var">Info_Error</span></a></span><span> </span><span class="annot"><span class="annottext">(Info_Error
 -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; Info_Error
forall tcErr tcWarning. tcErr -&gt; Info_Error_boot tcErr tcWarning
</span><a href="Agda.Interaction.Response.Base.html#Info_GenericError"><span class="hs-identifier hs-var">Info_GenericError</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668495"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Response] -&gt; [Response] -&gt; [Response]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><span class="annottext">Range -&gt; [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-var">tellEmacsToJumpToError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCErr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681668495"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Response] -&gt; [Response] -&gt; [Response]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_HighlightingInfo"><span class="hs-identifier hs-var">Resp_HighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681668510"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span>
</span><span id="line-278"></span><span>                                    </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668504"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681668500"><span class="hs-identifier hs-var">modFile</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Response] -&gt; [Response] -&gt; [Response]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Status -&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_Status"><span class="hs-identifier hs-var">Resp_Status</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; Response) -&gt; Status -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sChecked :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sChecked"><span class="hs-identifier hs-var">sChecked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-280"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sShowImplicitArguments :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sShowImplicitArguments"><span class="hs-identifier hs-var">sShowImplicitArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668515"><span class="hs-identifier hs-var">showImpl</span></a></span><span>
</span><span id="line-281"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sShowIrrelevantArguments :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sShowIrrelevantArguments"><span class="hs-identifier hs-var">sShowIrrelevantArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668520"><span class="hs-identifier hs-var">showIrr</span></a></span><span>
</span><span id="line-282"></span><span>                                   </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><span class="annottext">StateT CommandState TCM Bool
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optExitOnError"><span class="hs-identifier hs-var">optExitOnError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool)
-&gt; StateT CommandState TCM CommandLineOptions
-&gt; StateT CommandState TCM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; StateT CommandState TCM ()
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; StateT CommandState TCM ())
-&gt; IO () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AgdaError -&gt; IO ()
forall a. AgdaError -&gt; IO a
</span><a href="Agda.Interaction.ExitCode.html#exitAgdaWith"><span class="hs-identifier hs-var">exitAgdaWith</span></a></span><span> </span><span class="annot"><span class="annottext">AgdaError
</span><a href="Agda.Interaction.ExitCode.html#TCMError"><span class="hs-identifier hs-var">TCMError</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | Run an 'IOTCM' value, catch the exceptions, emit output</span><span>
</span><span id="line-287"></span><span class="hs-comment">--</span><span>
</span><span id="line-288"></span><span class="hs-comment">--   If an error happens the state of 'CommandM' does not change,</span><span>
</span><span id="line-289"></span><span class="hs-comment">--   but stPersistent may change (which contains successfully</span><span>
</span><span id="line-290"></span><span class="hs-comment">--   loaded interfaces for example).</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#runInteraction"><span class="hs-identifier hs-type">runInteraction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="runInteraction"><span class="annot"><span class="annottext">runInteraction :: IOTCM -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#runInteraction"><span class="hs-identifier hs-var hs-var">runInteraction</span></a></span></span><span> </span><span id="local-6989586621681668545"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668545"><span class="hs-identifier hs-var">iotcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">(forall a. CommandM a -&gt; CommandM a)
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var">handleCommand</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621681668546"><span class="hs-identifier hs-var">inEmacs</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="#local-6989586621681668547"><span class="hs-identifier hs-var">onFail</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621681668548"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681668548"><span class="hs-identifier hs-var">currentAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath)
-&gt; IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668550"><span class="hs-identifier hs-var">current</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621681668551"><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681668551"><span class="hs-identifier hs-var">cf</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621681668553"><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668553"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668555"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM (Interaction' Range)
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668555"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe AbsolutePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681668548"><span class="hs-identifier hs-var">currentAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AbsolutePath -&gt; Maybe AbsolutePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(CurrentFile -&gt; AbsolutePath)
-&gt; Maybe CurrentFile -&gt; Maybe AbsolutePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681668551"><span class="hs-identifier hs-var">cf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668559"><span class="annot"><span class="annottext">mode :: Mode
</span><a href="#local-6989586621681668559"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668550"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681668559"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; StateT CommandState TCM ())
 -&gt; StateT CommandState TCM ())
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CheckResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>      </span><span id="local-6989586621681668561"><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681668561"><span class="hs-identifier hs-var">cf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; Maybe CurrentFile -&gt; CurrentFile
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">CurrentFile
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CurrentFile -&gt; CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
-&gt; StateT CommandState TCM CurrentFile
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM (Interaction' Range)
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range
 -&gt; StateT CommandState TCM (Interaction' Range))
-&gt; Interaction' Range
-&gt; StateT CommandState TCM (Interaction' Range)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668545"><span class="hs-identifier hs-var">iotcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681668561"><span class="hs-identifier hs-var">cf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681668565"><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668565"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668565"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-var">withCurrentFile</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668553"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621681668568"><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681668568"><span class="hs-identifier hs-var">cf'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668553"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-310"></span><span>          </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe AbsolutePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681668548"><span class="hs-identifier hs-var">currentAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AbsolutePath -&gt; Maybe AbsolutePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(CurrentFile -&gt; AbsolutePath)
-&gt; Maybe CurrentFile -&gt; Maybe AbsolutePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681668568"><span class="hs-identifier hs-var">cf'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; ([InteractionId] -&gt; Response)
-&gt; [InteractionId]
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
[InteractionId]
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_InteractionPoints"><span class="hs-identifier hs-var">Resp_InteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([InteractionId] -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM [InteractionId]
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; [InteractionId])
-&gt; StateT CommandState TCM [InteractionId]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; [InteractionId]
</span><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- The ranges in cmd might be incorrect because of the use of</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- Nothing here. That is taken care of above.</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span id="local-6989586621681668550"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668550"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span id="local-6989586621681668573"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668573"><span class="hs-identifier hs-var">highlighting</span></a></span></span><span> </span><span id="local-6989586621681668574"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668574"><span class="hs-identifier hs-var">highlightingMethod</span></a></span></span><span> </span><span id="local-6989586621681668555"><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668555"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668545"><span class="hs-identifier hs-var">iotcm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="#local-6989586621681668546"><span class="hs-identifier hs-type">inEmacs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681668575"><span class="annot"><a href="#local-6989586621681668575"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668575"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621681668546"><span class="annot"><span class="annottext">inEmacs :: forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621681668546"><span class="hs-identifier hs-var hs-var">inEmacs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">((forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a)
-&gt; (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; TCEnv -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCMT IO x -&gt; TCMT IO x)
-&gt; TCEnv -&gt; TCMT IO x -&gt; TCMT IO x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#initEnv"><span class="hs-identifier hs-var">initEnv</span></a></span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681668573"><span class="hs-identifier hs-type">highlighting</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingMethod"><span class="hs-identifier hs-var">envHighlightingMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681668574"><span class="hs-identifier hs-type">highlightingMethod</span></a></span><span>
</span><span id="line-322"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- If an independent command fails we should reset theCurrentFile (Issue853).</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621681668547"><span class="annot"><span class="annottext">onFail :: StateT CommandState TCM ()
</span><a href="#local-6989586621681668547"><span class="hs-identifier hs-var hs-var">onFail</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621681668555"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ())
-&gt; (CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668581"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668581"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668581"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- Command queues</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | If the next command from the command queue is anything but an</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- actual command, then the command is returned.</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- If the command is an 'IOTCM' command, then the following happens:</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- The given computation is applied to the command and executed. If an</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- abort command is encountered (and acted upon), then the computation</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- is interrupted, the persistent state and all options are restored,</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- and some commands are sent to the frontend. If the computation was</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- not interrupted, then its result is returned.</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- TODO: It might be nice if some of the changes to the persistent</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- state inflicted by the interrupted computation were preserved.</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="local-6989586621681667281"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeAbort"><span class="hs-identifier hs-type">maybeAbort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Command%27"><span class="hs-identifier hs-type">Command'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621681667281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-345"></span><span id="maybeAbort"><span class="annot"><span class="annottext">maybeAbort :: forall a. (IOTCM -&gt; CommandM a) -&gt; CommandM (Command' (Maybe a))
</span><a href="Agda.Interaction.InteractionTop.html#maybeAbort"><span class="hs-identifier hs-var hs-var">maybeAbort</span></a></span></span><span> </span><span id="local-6989586621681668625"><span class="annot"><span class="annottext">IOTCM -&gt; CommandM a
</span><a href="#local-6989586621681668625"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621681668626"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668626"><span class="hs-identifier hs-var">commandState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668627"><span class="annot"><span class="annottext">q :: CommandQueue
</span><a href="#local-6989586621681668627"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; CommandQueue
</span><a href="Agda.Interaction.Base.html#commandQueue"><span class="hs-identifier hs-var">commandQueue</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668626"><span class="hs-identifier hs-var">commandState</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681668629"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668629"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668630"><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668630"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Integer, Command) -&gt; StateT CommandState TCM (Integer, Command)
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Integer, Command)
 -&gt; StateT CommandState TCM (Integer, Command))
-&gt; IO (Integer, Command)
-&gt; StateT CommandState TCM (Integer, Command)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM (Integer, Command) -&gt; IO (Integer, Command)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (Integer, Command) -&gt; IO (Integer, Command))
-&gt; STM (Integer, Command) -&gt; IO (Integer, Command)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; STM (Integer, Command)
forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TChan (Integer, Command)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668627"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668630"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">Command
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; CommandM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a)
forall a. Command' a
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621681668636"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668636"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; CommandM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Command' (Maybe a)
forall a. String -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668636"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span id="local-6989586621681668638"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668638"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>      </span><span id="local-6989586621681668639"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668639"><span class="hs-identifier hs-var">tcState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span id="local-6989586621681668640"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681668640"><span class="hs-identifier hs-var">tcEnv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCEnv
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#askTC"><span class="hs-identifier hs-var">askTC</span></a></span><span>
</span><span id="line-355"></span><span>      </span><span id="local-6989586621681668642"><span class="annot"><span class="annottext">Either ((a, CommandState), TCState) Integer
</span><a href="#local-6989586621681668642"><span class="hs-identifier hs-var">result</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either ((a, CommandState), TCState) Integer)
-&gt; StateT
     CommandState TCM (Either ((a, CommandState), TCState) Integer)
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either ((a, CommandState), TCState) Integer)
 -&gt; StateT
      CommandState TCM (Either ((a, CommandState), TCState) Integer))
-&gt; IO (Either ((a, CommandState), TCState) Integer)
-&gt; StateT
     CommandState TCM (Either ((a, CommandState), TCState) Integer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ((a, CommandState), TCState)
-&gt; IO Integer -&gt; IO (Either ((a, CommandState), TCState) Integer)
forall a b. IO a -&gt; IO b -&gt; IO (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span>
</span><span id="line-356"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCEnv
-&gt; TCState
-&gt; TCMT IO (a, CommandState)
-&gt; IO ((a, CommandState), TCState)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TCEnv -&gt; TCState -&gt; TCMT m a -&gt; m (a, TCState)
</span><a href="Agda.TypeChecking.Monad.Base.html#runTCM"><span class="hs-identifier hs-var">runTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681668640"><span class="hs-identifier hs-var">tcEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668639"><span class="hs-identifier hs-var">tcState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (a, CommandState) -&gt; IO ((a, CommandState), TCState))
-&gt; TCMT IO (a, CommandState) -&gt; IO ((a, CommandState), TCState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>                    </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandState -&gt; TCMT IO (a, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOTCM -&gt; CommandM a
</span><a href="#local-6989586621681668625"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668638"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668626"><span class="hs-identifier hs-var">commandState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; CommandQueue -&gt; IO Integer
</span><a href="#local-6989586621681668645"><span class="hs-identifier hs-var">waitForAbort</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668629"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668627"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ((a, CommandState), TCState) Integer
</span><a href="#local-6989586621681668642"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681668646"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668646"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668647"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668647"><span class="hs-identifier hs-var">commandState'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668648"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668648"><span class="hs-identifier hs-var">tcState'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">TCState -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668648"><span class="hs-identifier hs-var">tcState'</span></a></span><span>
</span><span id="line-362"></span><span>          </span><span class="annot"><span class="annottext">CommandState -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668647"><span class="hs-identifier hs-var">commandState'</span></a></span><span>
</span><span id="line-363"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668638"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>            </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-var">Cmd_exit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>              </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DoneExiting"><span class="hs-identifier hs-var">Resp_DoneExiting</span></a></span><span>
</span><span id="line-366"></span><span>              </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; CommandM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a)
forall a. Command' a
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><span class="annottext">IOTCM' Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; CommandM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; Command' (Maybe a)
forall a. a -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-var">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681668646"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681668651"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668651"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; StateT CommandState TCM ()
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; StateT CommandState TCM ())
-&gt; IO () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandQueue -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621681668652"><span class="hs-identifier hs-var">popAbortedCommands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668627"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668651"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><span class="annottext">TCState -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; StateT CommandState TCM ())
-&gt; TCState -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#initState"><span class="hs-identifier hs-var">initState</span></a></span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668639"><span class="hs-identifier hs-type">tcState</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPreScopeState"><span class="hs-identifier hs-var">stPreScopeState</span></a></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPreScopeState"><span class="hs-identifier hs-var">stPreScopeState</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#initState"><span class="hs-identifier hs-type">initState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPrePragmaOptions"><span class="hs-identifier hs-var">stPrePragmaOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-375"></span><span>                      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPrePragmaOptions"><span class="hs-identifier hs-var">stPrePragmaOptions</span></a></span><span>
</span><span id="line-376"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPreScopeState"><span class="hs-identifier hs-var">stPreScopeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668639"><span class="hs-identifier hs-type">tcState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>          </span><span class="annot"><span class="annottext">CommandState -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; StateT CommandState TCM ())
-&gt; CommandState -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; CommandState
</span><a href="Agda.Interaction.Base.html#initCommandState"><span class="hs-identifier hs-var">initCommandState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandState -&gt; CommandQueue
</span><a href="Agda.Interaction.Base.html#commandQueue"><span class="hs-identifier hs-var">commandQueue</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668626"><span class="hs-identifier hs-var">commandState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681668626"><span class="hs-identifier hs-type">commandState</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DoneAborting"><span class="hs-identifier hs-var">Resp_DoneAborting</span></a></span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; CommandM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; Command' (Maybe a)
forall a. a -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-var">Command</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- Returns if the currently executing command should be aborted.</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- The &quot;abort number&quot; is returned.</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><a href="#local-6989586621681668645"><span class="hs-identifier hs-type">waitForAbort</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>       </span><span class="hs-comment">-- The number of the currently executing command.</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span>  </span><span class="hs-comment">-- The command queue.</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-394"></span><span>  </span><span id="local-6989586621681668645"><span class="annot"><span class="annottext">waitForAbort :: Integer -&gt; CommandQueue -&gt; IO Integer
</span><a href="#local-6989586621681668645"><span class="hs-identifier hs-var hs-var">waitForAbort</span></a></span></span><span> </span><span id="local-6989586621681668660"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668660"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681668661"><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668661"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="annottext">STM Integer -&gt; IO Integer
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Integer -&gt; IO Integer) -&gt; STM Integer -&gt; IO Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>      </span><span id="local-6989586621681668662"><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621681668662"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer) -&gt; STM (Maybe Integer)
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TVar (Maybe Integer)
</span><a href="Agda.Interaction.Base.html#abort"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668661"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621681668662"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668665"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668665"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668660"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668665"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; STM Integer
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668665"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-399"></span><span>        </span><span class="annot"><span class="annottext">Maybe Integer
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM Integer
forall a. STM a
</span><span class="hs-identifier hs-var">retry</span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-comment">-- Removes every command for which the command number is at most</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-comment">-- the given number (the &quot;abort number&quot;) from the command queue.</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-comment">-- New commands could be added to the end of the queue while this</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-comment">-- computation is running. This does not lead to a race condition,</span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-comment">-- because those commands have higher command numbers, so they will</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-comment">-- not be removed.</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><a href="#local-6989586621681668652"><span class="hs-identifier hs-type">popAbortedCommands</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>  </span><span id="local-6989586621681668652"><span class="annot"><span class="annottext">popAbortedCommands :: CommandQueue -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621681668652"><span class="hs-identifier hs-var hs-var">popAbortedCommands</span></a></span></span><span> </span><span id="local-6989586621681668668"><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668668"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681668669"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668669"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>    </span><span id="local-6989586621681668670"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668670"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM Bool -&gt; IO Bool
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Bool -&gt; IO Bool) -&gt; STM Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-412"></span><span>      </span><span id="local-6989586621681668671"><span class="annot"><span class="annottext">Maybe (Integer, Command)
</span><a href="#local-6989586621681668671"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; STM (Maybe (Integer, Command))
forall a. TChan a -&gt; STM (Maybe a)
</span><span class="hs-identifier hs-var">tryReadTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TChan (Integer, Command)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668668"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Integer, Command)
</span><a href="#local-6989586621681668671"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Integer, Command)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668673"><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621681668673"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Integer, Command) -&gt; Integer
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621681668673"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668669"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-418"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; (Integer, Command) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">unGetTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TChan (Integer, Command)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668668"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621681668673"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-420"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668670"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><span class="annottext">CommandQueue -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621681668652"><span class="hs-identifier hs-var">popAbortedCommands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621681668668"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668669"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | Creates a command queue, and forks a thread that writes commands</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- to the queue. The queue is returned.</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#initialiseCommandQueue"><span class="hs-identifier hs-type">initialiseCommandQueue</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-429"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Returns the next command.</span></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span>
</span><span id="line-431"></span><span id="initialiseCommandQueue"><span class="annot"><span class="annottext">initialiseCommandQueue :: IO Command -&gt; IO CommandQueue
</span><a href="Agda.Interaction.InteractionTop.html#initialiseCommandQueue"><span class="hs-identifier hs-var hs-var">initialiseCommandQueue</span></a></span></span><span> </span><span id="local-6989586621681668677"><span class="annot"><span class="annottext">IO Command
</span><a href="#local-6989586621681668677"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>  </span><span id="local-6989586621681668678"><span class="annot"><span class="annottext">TChan (Integer, Command)
</span><a href="#local-6989586621681668678"><span class="hs-identifier hs-var">commands</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan (Integer, Command))
forall a. IO (TChan a)
</span><span class="hs-identifier hs-var">newTChanIO</span></span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621681668680"><span class="annot"><span class="annottext">TVar (Maybe Integer)
</span><a href="#local-6989586621681668680"><span class="hs-identifier hs-var">abort</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Integer -&gt; IO (TVar (Maybe Integer))
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Read commands. The argument is the number of the previous</span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-comment">-- command (other than abort commands) that was read, if any.</span><span>
</span><span id="line-437"></span><span>      </span><span id="local-6989586621681668682"><span class="annot"><span class="annottext">readCommands :: Integer -&gt; IO ()
</span><a href="#local-6989586621681668682"><span class="hs-identifier hs-var hs-var">readCommands</span></a></span></span><span> </span><span id="local-6989586621681668683"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668683"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>        </span><span id="local-6989586621681668684"><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668684"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Command
</span><a href="#local-6989586621681668677"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668684"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span id="local-6989586621681668685"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668685"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-var">Cmd_abort</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621681668685"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer) -&gt; Maybe Integer -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer)
</span><a href="#local-6989586621681668680"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668683"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; IO ()
</span><a href="#local-6989586621681668682"><span class="hs-identifier hs-var">readCommands</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668683"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><span class="annottext">Command
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668688"><span class="annot"><span class="annottext">n' :: Integer
</span><a href="#local-6989586621681668688"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668683"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>            </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; (Integer, Command) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command)
</span><a href="#local-6989586621681668678"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668688"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668684"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621681668684"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-447"></span><span>              </span><span class="annot"><span class="annottext">Command
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>              </span><span class="annot"><span class="annottext">Command
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; IO ()
</span><a href="#local-6989586621681668682"><span class="hs-identifier hs-var">readCommands</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681668688"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="annottext">ThreadId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; IO ()
</span><a href="#local-6989586621681668682"><span class="hs-identifier hs-var">readCommands</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="annottext">CommandQueue -&gt; IO CommandQueue
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer)
TChan (Integer, Command)
commands :: TChan (Integer, Command)
abort :: TVar (Maybe Integer)
commands :: TChan (Integer, Command)
abort :: TVar (Maybe Integer)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">---------------------------------------------------------</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">-- | Can the command run even if the relevant file has not been loaded</span><span>
</span><span id="line-457"></span><span class="hs-comment">--   into the state?</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-type">independent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-460"></span><span id="independent"><span class="annot"><span class="annottext">independent :: Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var hs-var">independent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-461"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-462"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-463"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-var">Cmd_show_version</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-465"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><span class="hs-identifier">_</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">-- | Should 'Resp_InteractionPoints' be issued after the command has</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- run?</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-type">updateInteractionPointsAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-471"></span><span id="updateInteractionPointsAfter"><span class="annot"><span class="annottext">updateInteractionPointsAfter :: Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var hs-var">updateInteractionPointsAfter</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-472"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-473"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_constraints"><span class="hs-identifier hs-type">Cmd_constraints</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-474"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-type">Cmd_metas</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-475"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_no_metas"><span class="hs-identifier hs-type">Cmd_no_metas</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-476"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents_toplevel"><span class="hs-identifier hs-type">Cmd_show_module_contents_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-477"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_search_about_toplevel"><span class="hs-identifier hs-type">Cmd_search_about_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-478"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveAll"><span class="hs-identifier hs-type">Cmd_solveAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-479"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveOne"><span class="hs-identifier hs-type">Cmd_solveOne</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-480"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer_toplevel"><span class="hs-identifier hs-type">Cmd_infer_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-481"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute_toplevel"><span class="hs-identifier hs-type">Cmd_compute_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-482"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-483"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-484"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_highlight"><span class="hs-identifier hs-type">Cmd_highlight</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-485"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ShowImplicitArgs"><span class="hs-identifier hs-type">ShowImplicitArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-486"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ToggleImplicitArgs"><span class="hs-identifier hs-type">ToggleImplicitArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-487"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ShowIrrelevantArgs"><span class="hs-identifier hs-type">ShowIrrelevantArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-488"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ToggleIrrelevantArgs"><span class="hs-identifier hs-type">ToggleIrrelevantArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-489"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_give"><span class="hs-identifier hs-type">Cmd_give</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-490"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-type">Cmd_refine</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-491"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-type">Cmd_intro</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-492"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine_or_intro"><span class="hs-identifier hs-type">Cmd_refine_or_intro</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-493"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoOne"><span class="hs-identifier hs-type">Cmd_autoOne</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-494"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoAll"><span class="hs-identifier hs-type">Cmd_autoAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-495"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_context"><span class="hs-identifier hs-type">Cmd_context</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-496"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_helper_function"><span class="hs-identifier hs-type">Cmd_helper_function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-497"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer"><span class="hs-identifier hs-type">Cmd_infer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-498"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type"><span class="hs-identifier hs-type">Cmd_goal_type</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-499"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_elaborate_give"><span class="hs-identifier hs-type">Cmd_elaborate_give</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-500"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context"><span class="hs-identifier hs-type">Cmd_goal_type_context</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-501"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_infer"><span class="hs-identifier hs-type">Cmd_goal_type_context_infer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-502"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_check"><span class="hs-identifier hs-type">Cmd_goal_type_context_check</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-503"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents"><span class="hs-identifier hs-type">Cmd_show_module_contents</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-504"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_make_case"><span class="hs-identifier hs-type">Cmd_make_case</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute"><span class="hs-identifier hs-type">Cmd_compute</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-506"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope"><span class="hs-identifier hs-type">Cmd_why_in_scope</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-507"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope_toplevel"><span class="hs-identifier hs-type">Cmd_why_in_scope_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-508"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-type">Cmd_show_version</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-509"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-type">Cmd_abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-510"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-type">Cmd_exit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="annot"><span class="hs-comment">-- | Interpret an interaction</span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-type">interpret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span id="interpret"><span class="annot"><span class="annottext">interpret :: Interaction' Range -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var hs-var">interpret</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span> </span><span id="local-6989586621681668732"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668732"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681668733"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668733"><span class="hs-identifier hs-var">argv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668732"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668733"><span class="hs-identifier hs-var">argv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681668734"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; StateT CommandState TCM ())
 -&gt; StateT CommandState TCM ())
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CheckResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range -&gt; StateT CommandState TCM ())
-&gt; Interaction' Range -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Interaction' Range
forall range. Rewrite -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-var">Cmd_metas</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621681668734"><span class="annot"><span class="annottext">mode :: Mode
</span><a href="#local-6989586621681668734"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span> </span><span id="local-6989586621681668736"><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621681668736"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621681668737"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668737"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681668738"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668738"><span class="hs-identifier hs-var">argv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-522"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668737"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668738"><span class="hs-identifier hs-var">argv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668739"><span class="hs-identifier hs-var">allowUnsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681668740"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; StateT CommandState TCM ())
 -&gt; StateT CommandState TCM ())
-&gt; (CheckResult -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668741"><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621681668742"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681668742"><span class="hs-identifier hs-var">mw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [TCWarning] -&gt; StateT CommandState TCM [TCWarning]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [TCWarning] -&gt; StateT CommandState TCM [TCWarning])
-&gt; TCM [TCWarning] -&gt; StateT CommandState TCM [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; TCM [TCWarning]
forall (m :: * -&gt; *). HasOptions m =&gt; [TCWarning] -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#applyFlagsToTCWarnings"><span class="hs-identifier hs-var">applyFlagsToTCWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; TCM [TCWarning]) -&gt; [TCWarning] -&gt; TCM [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CheckResult -&gt; [TCWarning]
</span><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier hs-var">crWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681668742"><span class="hs-identifier hs-var">mw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>        </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621681668736"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#LaTeX"><span class="hs-identifier hs-var">LaTeX</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IsMain -&gt; CheckResult -&gt; TCM ()
</span><a href="Agda.Compiler.Backend.html#callBackend"><span class="hs-identifier hs-var">callBackend</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LaTeX&quot;</span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-var">IsMain</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-528"></span><span>          </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IsMain -&gt; CheckResult -&gt; TCM ()
</span><a href="Agda.Compiler.Backend.html#callBackend"><span class="hs-identifier hs-var">callBackend</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LaTeX&quot;</span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-var">IsMain</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-529"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Base.html#OtherBackend"><span class="hs-identifier hs-type">OtherBackend</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHCNoMain&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IsMain -&gt; CheckResult -&gt; TCM ()
</span><a href="Agda.Compiler.Backend.html#callBackend"><span class="hs-identifier hs-var">callBackend</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC&quot;</span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#NotMain"><span class="hs-identifier hs-var">NotMain</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span><span>   </span><span class="hs-comment">-- for backwards compatibility</span><span>
</span><span id="line-530"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Base.html#OtherBackend"><span class="hs-identifier hs-type">OtherBackend</span></a></span><span> </span><span id="local-6989586621681668751"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668751"><span class="hs-identifier hs-var">b</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IsMain -&gt; CheckResult -&gt; TCM ()
</span><a href="Agda.Compiler.Backend.html#callBackend"><span class="hs-identifier hs-var">callBackend</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668751"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-var">IsMain</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681668741"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; (WarningsAndNonFatalErrors
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
-&gt; WarningsAndNonFatalErrors
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CompilerBackend
-&gt; warningsAndNonFatalErrors
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_CompilationOk"><span class="hs-identifier hs-var">Info_CompilationOk</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621681668736"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningsAndNonFatalErrors -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
</span><a href="Agda.Interaction.BasicOps.html#getWarningsAndNonFatalErrors"><span class="hs-identifier hs-var">B.getWarningsAndNonFatalErrors</span></a></span><span>
</span><span id="line-532"></span><span>      </span><span id="local-6989586621681668755"><span class="annot"><span class="annottext">w :: [TCWarning]
</span><a href="#local-6989586621681668755"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCWarning
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCWarning]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Info_Error_boot tcErr tcWarning
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-var">Info_Error</span></a></span><span> </span><span class="annot"><span class="annottext">(Info_Error
 -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; Info_Error
forall tcErr tcWarning.
[tcWarning] -&gt; Info_Error_boot tcErr tcWarning
</span><a href="Agda.Interaction.Response.Base.html#Info_CompilationError"><span class="hs-identifier hs-var">Info_CompilationError</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681668755"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621681668739"><span class="annot"><span class="annottext">allowUnsolved :: Bool
</span><a href="#local-6989586621681668739"><span class="hs-identifier hs-var hs-var">allowUnsolved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621681668736"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend -&gt; [CompilerBackend] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#LaTeX"><span class="hs-identifier hs-var">LaTeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>  </span><span id="local-6989586621681668740"><span class="annot"><span class="annottext">mode :: Mode
</span><a href="#local-6989586621681668740"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621681668736"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>
</span><span id="line-536"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_constraints"><span class="hs-identifier hs-var">Cmd_constraints</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; ([OutputForm_boot TCErr Expr Expr]
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[OutputForm_boot TCErr Expr Expr]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[OutputForm_boot tcErr Expr Expr]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Constraints"><span class="hs-identifier hs-var">Info_Constraints</span></a></span><span> </span><span class="annot"><span class="annottext">([OutputForm_boot TCErr Expr Expr] -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM [OutputForm_boot TCErr Expr Expr]
</span><a href="Agda.Interaction.BasicOps.html#getConstraints"><span class="hs-identifier hs-var">B.getConstraints</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-type">Cmd_metas</span></a></span><span> </span><span id="local-6989586621681668760"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668760"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>  </span><span id="local-6989586621681668761"><span class="annot"><span class="annottext">Goals
</span><a href="#local-6989586621681668761"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Goals -&gt; StateT CommandState TCM Goals
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Goals -&gt; StateT CommandState TCM Goals)
-&gt; TCMT IO Goals -&gt; StateT CommandState TCM Goals
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Rewrite -&gt; TCMT IO Goals
</span><a href="Agda.Interaction.BasicOps.html#getGoals%27"><span class="hs-identifier hs-var">B.getGoals'</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668760"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; Rewrite -&gt; Rewrite
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668760"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; (WarningsAndNonFatalErrors
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Goals
-&gt; WarningsAndNonFatalErrors
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Goals_boot tcErr
-&gt; warningsAndNonFatalErrors
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_AllGoalsWarnings"><span class="hs-identifier hs-var">Info_AllGoalsWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Goals
</span><a href="#local-6989586621681668761"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningsAndNonFatalErrors -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
</span><a href="Agda.Interaction.BasicOps.html#getWarningsAndNonFatalErrors"><span class="hs-identifier hs-var">B.getWarningsAndNonFatalErrors</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_no_metas"><span class="hs-identifier hs-var">Cmd_no_metas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621681668766"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621681668766"><span class="hs-identifier hs-var">metas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [MetaId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [MetaId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getOpenMetas"><span class="hs-identifier hs-var">getOpenMetas</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621681668766"><span class="hs-identifier hs-var">metas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><span class="annottext">TypeError -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; StateT CommandState TCM ())
-&gt; TypeError -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#GenericError"><span class="hs-identifier hs-var">GenericError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsolved meta-variables&quot;</span></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents_toplevel"><span class="hs-identifier hs-type">Cmd_show_module_contents_toplevel</span></a></span><span> </span><span id="local-6989586621681668770"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668770"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681668771"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668771"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-551"></span><span>  </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-var">showModuleContents</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668770"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668771"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_search_about_toplevel"><span class="hs-identifier hs-type">Cmd_search_about_toplevel</span></a></span><span> </span><span id="local-6989586621681668774"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668774"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681668775"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668775"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-var">searchAbout</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668774"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668775"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveAll"><span class="hs-identifier hs-type">Cmd_solveAll</span></a></span><span> </span><span id="local-6989586621681668777"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668777"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Maybe InteractionId -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var">solveInstantiatedGoals</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668777"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InteractionId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-557"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveOne"><span class="hs-identifier hs-type">Cmd_solveOne</span></a></span><span> </span><span id="local-6989586621681668779"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668779"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681668780"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668780"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Maybe InteractionId -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var">solveInstantiatedGoals</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668781"><span class="hs-identifier hs-var">norm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; Maybe InteractionId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668780"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-comment">-- `solveOne` is called via `agda2-maybe-normalised` which does not use</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-comment">-- AsIs &lt; Simplified &lt; Normalised but rather Simplified &lt; Instantiated &lt; Normalised</span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-comment">-- So we remap the Rewrite modifiers to match solveAll's behaviour.</span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-comment">-- NB: instantiate is called in getSolvedInteractionPoints no matter what.</span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681668781"><span class="annot"><span class="annottext">norm' :: Rewrite
</span><a href="#local-6989586621681668781"><span class="hs-identifier hs-var hs-var">norm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668779"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-563"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span>
</span><span id="line-564"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Instantiated"><span class="hs-identifier hs-var">Instantiated</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span>
</span><span id="line-565"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668779"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer_toplevel"><span class="hs-identifier hs-type">Cmd_infer_toplevel</span></a></span><span> </span><span id="local-6989586621681668783"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668783"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681668784"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668784"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681668785"><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668785"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668786"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668786"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM Expr) -&gt; String -&gt; CommandM (Maybe CPUTime, Expr)
forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var">parseAndDoAtToplevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#typeInCurrent"><span class="hs-identifier hs-var">B.typeInCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668783"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668784"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621681668789"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668789"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandState
-&gt; Maybe CPUTime
-&gt; Expr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CommandState
-&gt; Maybe CPUTime
-&gt; Expr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_InferredType"><span class="hs-identifier hs-var">Info_InferredType</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668789"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668785"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668786"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute_toplevel"><span class="hs-identifier hs-type">Cmd_compute_toplevel</span></a></span><span> </span><span id="local-6989586621681668791"><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681668791"><span class="hs-identifier hs-var">cmode</span></a></span></span><span> </span><span id="local-6989586621681668792"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668792"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681668793"><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668793"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668794"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668794"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM Expr) -&gt; String -&gt; CommandM (Maybe CPUTime, Expr)
forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var">parseAndDoAtToplevel</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Expr
</span><a href="#local-6989586621681668795"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeMode -&gt; String -&gt; String
</span><a href="Agda.Interaction.BasicOps.html#computeWrapInput"><span class="hs-identifier hs-var">B.computeWrapInput</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681668791"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668792"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>  </span><span id="local-6989586621681668797"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668797"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-575"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandState
-&gt; ComputeMode
-&gt; Maybe CPUTime
-&gt; Expr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CommandState
-&gt; ComputeMode
-&gt; Maybe CPUTime
-&gt; Expr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_NormalForm"><span class="hs-identifier hs-var">Info_NormalForm</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681668797"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681668791"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668793"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668794"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>    </span><span id="local-6989586621681668795"><span class="annot"><span class="annottext">action :: Expr -&gt; TCM Expr
</span><a href="#local-6989586621681668795"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#allowNonTerminatingReductions"><span class="hs-identifier hs-var">allowNonTerminatingReductions</span></a></span><span>
</span><span id="line-578"></span><span>           </span><span class="annot"><span class="annottext">(TCM Expr -&gt; TCM Expr) -&gt; (Expr -&gt; TCM Expr) -&gt; Expr -&gt; TCM Expr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ComputeMode -&gt; Bool
</span><a href="Agda.Interaction.BasicOps.html#computeIgnoreAbstract"><span class="hs-identifier hs-var">B.computeIgnoreAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681668791"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#ignoreAbstractMode"><span class="hs-identifier hs-var">ignoreAbstractMode</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteMode"><span class="hs-identifier hs-var">inConcreteMode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>           </span><span class="annot"><span class="annottext">(TCM Expr -&gt; TCM Expr) -&gt; (Expr -&gt; TCM Expr) -&gt; Expr -&gt; TCM Expr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ComputeMode -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#evalInCurrent"><span class="hs-identifier hs-var">B.evalInCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681668791"><span class="hs-identifier hs-var">cmode</span></a></span><span>
</span><span id="line-580"></span><span class="hs-comment">-- interpret (Cmd_compute_toplevel cmode s) =</span><span>
</span><span id="line-581"></span><span class="hs-comment">--   parseAndDoAtToplevel action Info_NormalForm $ computeWrapInput cmode s</span><span>
</span><span id="line-582"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-583"></span><span class="hs-comment">--   action = allowNonTerminatingReductions</span><span>
</span><span id="line-584"></span><span class="hs-comment">--          . (if computeIgnoreAbstract cmode then ignoreAbstractMode else inConcreteMode)</span><span>
</span><span id="line-585"></span><span class="hs-comment">--          . (B.showComputed cmode &lt;=&lt; B.evalInCurrent)</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#ShowImplicitArgs"><span class="hs-identifier hs-type">ShowImplicitArgs</span></a></span><span> </span><span id="local-6989586621681668804"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668804"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621681668805"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668805"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; StateT CommandState TCM ())
-&gt; CommandLineOptions -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><span class="annottext">Lens' CommandLineOptions Bool -&gt; LensSet CommandLineOptions Bool
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions)
-&gt; CommandLineOptions -&gt; f CommandLineOptions
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' CommandLineOptions PragmaOptions
</span><a href="Agda.Interaction.Options.Lenses.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">((PragmaOptions -&gt; f PragmaOptions)
 -&gt; CommandLineOptions -&gt; f CommandLineOptions)
-&gt; ((Bool -&gt; f Bool) -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; (Bool -&gt; f Bool)
-&gt; CommandLineOptions
-&gt; f CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptShowImplicit"><span class="hs-identifier hs-var">lensOptShowImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, Eq a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-var">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668804"><span class="hs-identifier hs-var">showImpl</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668805"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#ToggleImplicitArgs"><span class="hs-identifier hs-var">ToggleImplicitArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621681668822"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668822"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-595"></span><span>  </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; StateT CommandState TCM ())
-&gt; CommandLineOptions -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-596"></span><span>    </span><span class="annot"><span class="annottext">Lens' CommandLineOptions Bool -&gt; LensMap CommandLineOptions Bool
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions)
-&gt; CommandLineOptions -&gt; f CommandLineOptions
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' CommandLineOptions PragmaOptions
</span><a href="Agda.Interaction.Options.Lenses.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">((PragmaOptions -&gt; f PragmaOptions)
 -&gt; CommandLineOptions -&gt; f CommandLineOptions)
-&gt; ((Bool -&gt; f Bool) -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; (Bool -&gt; f Bool)
-&gt; CommandLineOptions
-&gt; f CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptShowImplicit"><span class="hs-identifier hs-var">lensOptShowImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier hs-var">lensCollapseDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668822"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#ShowIrrelevantArgs"><span class="hs-identifier hs-type">ShowIrrelevantArgs</span></a></span><span> </span><span id="local-6989586621681668832"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668832"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>  </span><span id="local-6989586621681668833"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668833"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-600"></span><span>  </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; StateT CommandState TCM ())
-&gt; CommandLineOptions -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><span class="annottext">Lens' CommandLineOptions Bool -&gt; LensSet CommandLineOptions Bool
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions)
-&gt; CommandLineOptions -&gt; f CommandLineOptions
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' CommandLineOptions PragmaOptions
</span><a href="Agda.Interaction.Options.Lenses.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">((PragmaOptions -&gt; f PragmaOptions)
 -&gt; CommandLineOptions -&gt; f CommandLineOptions)
-&gt; ((Bool -&gt; f Bool) -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; (Bool -&gt; f Bool)
-&gt; CommandLineOptions
-&gt; f CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptShowIrrelevant"><span class="hs-identifier hs-var">lensOptShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, Eq a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-var">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668832"><span class="hs-identifier hs-var">showIrr</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668833"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#ToggleIrrelevantArgs"><span class="hs-identifier hs-var">ToggleIrrelevantArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>  </span><span id="local-6989586621681668843"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668843"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; StateT CommandState TCM ())
-&gt; CommandLineOptions -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="annottext">Lens' CommandLineOptions Bool -&gt; LensMap CommandLineOptions Bool
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions)
-&gt; CommandLineOptions -&gt; f CommandLineOptions
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' CommandLineOptions PragmaOptions
</span><a href="Agda.Interaction.Options.Lenses.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">((PragmaOptions -&gt; f PragmaOptions)
 -&gt; CommandLineOptions -&gt; f CommandLineOptions)
-&gt; ((Bool -&gt; f Bool) -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; (Bool -&gt; f Bool)
-&gt; CommandLineOptions
-&gt; f CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptShowIrrelevant"><span class="hs-identifier hs-var">lensOptShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier hs-var">lensCollapseDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681668843"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span> </span><span id="local-6989586621681668851"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668851"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621681668852"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668852"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668852"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; HighlightingLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#None"><span class="hs-identifier hs-var">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-comment">-- Make sure that the include directories have</span><span>
</span><span id="line-612"></span><span>    </span><span class="hs-comment">-- been set.</span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM CommandLineOptions
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span id="local-6989586621681668855"><span class="annot"><span class="annottext">[Response]
</span><a href="#local-6989586621681668855"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [Response] -&gt; StateT CommandState TCM [Response]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [Response] -&gt; StateT CommandState TCM [Response])
-&gt; TCM [Response] -&gt; StateT CommandState TCM [Response]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO [Response] -&gt; TCM [Response]
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [Response] -&gt; TCM [Response])
-&gt; (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
    -&gt; IO [Response])
-&gt; Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCM [Response]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; IO [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-var">tellToUpdateHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
 -&gt; TCM [Response])
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
-&gt; TCM [Response]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>      </span><span id="local-6989586621681668857"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668857"><span class="hs-identifier hs-var">ex</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; TCMT IO Bool
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; TCMT IO Bool) -&gt; IO Bool -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668851"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span id="local-6989586621681668859"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681668859"><span class="hs-identifier hs-var">absSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SourceFile -&gt; TCMT IO SourceFile
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SourceFile -&gt; TCMT IO SourceFile)
-&gt; IO SourceFile -&gt; TCMT IO SourceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; SourceFile
</span><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-var">SourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; SourceFile) -&gt; IO AbsolutePath -&gt; IO SourceFile
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668851"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-617"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668857"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-619"></span><span>           </span><span class="hs-keyword">do</span><span>
</span><span id="line-620"></span><span>              </span><span id="local-6989586621681668861"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681668861"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var">Imp.parseSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681668859"><span class="hs-identifier hs-var">absSource</span></a></span><span>
</span><span id="line-621"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668863"><span class="annot"><span class="annottext">m :: TopLevelModuleName
</span><a href="#local-6989586621681668863"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681668861"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-622"></span><span>              </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; Maybe TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.Interaction.FindFile.html#checkModuleName"><span class="hs-identifier hs-var">checkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681668863"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681668859"><span class="hs-identifier hs-var">absSource</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-623"></span><span>              </span><span id="local-6989586621681668866"><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><a href="#local-6989586621681668866"><span class="hs-identifier hs-var">mmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO (Maybe ModuleInfo)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
TopLevelModuleName -&gt; m (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-var">getVisitedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681668863"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-624"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><a href="#local-6989586621681668866"><span class="hs-identifier hs-var">mmi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-625"></span><span>                </span><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-626"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668868"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681668868"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-627"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">Imp.srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681668861"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681668868"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-629"></span><span>                      </span><span id="local-6989586621681668873"><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681668873"><span class="hs-identifier hs-var">modFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState ModuleToSource -&gt; TCMT IO ModuleToSource
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleToSource -&gt; f ModuleToSource) -&gt; TCState -&gt; f TCState
Lens' TCState ModuleToSource
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-630"></span><span>                      </span><span id="local-6989586621681668876"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668876"><span class="hs-identifier hs-var">method</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv HighlightingMethod -&gt; TCMT IO HighlightingMethod
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingMethod -&gt; f HighlightingMethod) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.html#eHighlightingMethod"><span class="hs-identifier hs-var">eHighlightingMethod</span></a></span><span>
</span><span id="line-631"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
 -&gt; TCMT
      IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)))
-&gt; Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; HighlightingInfo) -&gt; Interface -&gt; HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681668868"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681668876"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681668873"><span class="hs-identifier hs-var">modFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-633"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-634"></span><span>            </span><span class="annot"><span class="annottext">TCMT
  IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
-&gt; (TCErr
    -&gt; TCMT
         IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)))
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. TCM a -&gt; (TCErr -&gt; TCM a) -&gt; TCM a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-636"></span><span>          </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; [Response] -&gt; StateT CommandState TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">[Response]
</span><a href="#local-6989586621681668855"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span> </span><span id="local-6989586621681668881"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668881"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681668882"><span class="annot"><span class="annottext">Remove
</span><a href="#local-6989586621681668882"><span class="hs-identifier hs-var">remove</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>  </span><span id="local-6989586621681668883"><span class="annot"><span class="annottext">Maybe HighlightingInfo
</span><a href="#local-6989586621681668883"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681668884"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668884"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-641"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668884"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; HighlightingLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#None"><span class="hs-identifier hs-var">None</span></a></span><span>
</span><span id="line-642"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
-&gt; StateT CommandState TCM (Maybe HighlightingInfo)
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-643"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>                 </span><span id="local-6989586621681668885"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681668885"><span class="hs-identifier hs-var">source'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668881"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>                 </span><span class="annot"><span class="annottext">TCM (Maybe HighlightingInfo)
-&gt; StateT CommandState TCM (Maybe HighlightingInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe HighlightingInfo)
 -&gt; StateT CommandState TCM (Maybe HighlightingInfo))
-&gt; TCM (Maybe HighlightingInfo)
-&gt; StateT CommandState TCM (Maybe HighlightingInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingInfo -&gt; Maybe HighlightingInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; Maybe HighlightingInfo)
-&gt; TCMT IO HighlightingInfo -&gt; TCM (Maybe HighlightingInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TCMT IO HighlightingInfo
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfo"><span class="hs-identifier hs-var">generateTokenInfo</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681668885"><span class="hs-identifier hs-var">source'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                           </span><span class="annot"><span class="annottext">TCM (Maybe HighlightingInfo)
-&gt; (TCErr -&gt; TCM (Maybe HighlightingInfo))
-&gt; TCM (Maybe HighlightingInfo)
forall a. TCM a -&gt; (TCErr -&gt; TCM a) -&gt; TCM a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-647"></span><span>                        </span><span class="annot"><span class="annottext">Maybe HighlightingInfo -&gt; TCM (Maybe HighlightingInfo)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-648"></span><span>      </span><span class="annot"><span class="annottext">StateT CommandState TCM (Maybe HighlightingInfo)
-&gt; StateT CommandState TCM ()
-&gt; StateT CommandState TCM (Maybe HighlightingInfo)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m () -&gt; m a
</span><a href="Agda.Utils.Monad.html#finally"><span class="hs-operator hs-var">`finally`</span></a></span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Remove
</span><a href="#local-6989586621681668882"><span class="hs-identifier hs-var">remove</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-650"></span><span>      </span><span class="annot"><span class="annottext">Remove
</span><a href="Agda.Interaction.Base.html#Remove"><span class="hs-identifier hs-var">Remove</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; StateT CommandState TCM ()
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; StateT CommandState TCM ())
-&gt; IO () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">removeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668881"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-651"></span><span>      </span><span class="annot"><span class="annottext">Remove
</span><a href="Agda.Interaction.Base.html#Keep"><span class="hs-identifier hs-var">Keep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
</span><a href="#local-6989586621681668883"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681668891"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681668891"><span class="hs-identifier hs-var">info'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#RemoveHighlighting"><span class="hs-identifier hs-var">RemoveHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681668891"><span class="hs-identifier hs-var">info'</span></a></span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_highlight"><span class="hs-identifier hs-type">Cmd_highlight</span></a></span><span> </span><span id="local-6989586621681668894"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668894"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668895"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668895"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681668896"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668896"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>  </span><span id="local-6989586621681668897"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668897"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681668897"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; HighlightingLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#None"><span class="hs-identifier hs-var">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621681668898"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668898"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
</span><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-var">getOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668894"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">InteractionId -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-var">removeOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668894"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">ExceptT Info_Error TCM () -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668899"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT Info_Error TCM () -&gt; StateT CommandState TCM ())
-&gt; ExceptT Info_Error TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>      </span><span id="local-6989586621681668900"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668900"><span class="hs-identifier hs-var">parsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Info_Error -&gt; TCM Expr -&gt; ExceptT Info_Error TCM Expr
forall a. Info_Error -&gt; TCM a -&gt; ExceptT Info_Error TCM a
</span><a href="#local-6989586621681668901"><span class="hs-identifier hs-var">try</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; Info_Error
forall tcErr tcWarning.
InteractionId -&gt; Info_Error_boot tcErr tcWarning
</span><a href="Agda.Interaction.Response.Base.html#Info_HighlightingParseError"><span class="hs-identifier hs-var">Info_HighlightingParseError</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668894"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; ExceptT Info_Error TCM Expr)
-&gt; TCM Expr -&gt; ExceptT Info_Error TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-663"></span><span>             </span><span class="annot"><span class="annottext">Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExpr"><span class="hs-identifier hs-var">B.parseExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668895"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668896"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-664"></span><span>      </span><span id="local-6989586621681668904"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668904"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Info_Error -&gt; TCM Expr -&gt; ExceptT Info_Error TCM Expr
forall a. Info_Error -&gt; TCM a -&gt; ExceptT Info_Error TCM a
</span><a href="#local-6989586621681668901"><span class="hs-identifier hs-var">try</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; Info_Error
forall tcErr tcWarning.
InteractionId -&gt; Info_Error_boot tcErr tcWarning
</span><a href="Agda.Interaction.Response.Base.html#Info_HighlightingScopeCheckError"><span class="hs-identifier hs-var">Info_HighlightingScopeCheckError</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668894"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; ExceptT Info_Error TCM Expr)
-&gt; TCM Expr -&gt; ExceptT Info_Error TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-665"></span><span>             </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Expr -&gt; ScopeM (AbsOfCon Expr)
forall c. ToAbstract c =&gt; ScopeInfo -&gt; c -&gt; ScopeM (AbsOfCon c)
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract"><span class="hs-identifier hs-var">concreteToAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668898"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668900"><span class="hs-identifier hs-var">parsed</span></a></span><span>
</span><span id="line-666"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT Info_Error TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT Info_Error m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT Info_Error TCM ())
-&gt; TCM () -&gt; ExceptT Info_Error TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; TCM ()) -&gt; TCMT IO HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span>
</span><span id="line-667"></span><span>               </span><span class="annot"><span class="annottext">Range -&gt; String -&gt; TCMT IO HighlightingInfo
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromString"><span class="hs-identifier hs-var">generateTokenInfoFromString</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668895"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668896"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT Info_Error TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT Info_Error m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT Info_Error TCM ())
-&gt; TCM () -&gt; ExceptT Info_Error TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-var">highlightExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681668904"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><a href="#local-6989586621681668899"><span class="hs-identifier hs-type">handle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>    </span><span id="local-6989586621681668899"><span class="annot"><span class="annottext">handle :: ExceptT Info_Error TCM () -&gt; StateT CommandState TCM ()
</span><a href="#local-6989586621681668899"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621681668909"><span class="annot"><span class="annottext">ExceptT Info_Error TCM ()
</span><a href="#local-6989586621681668909"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>      </span><span id="local-6989586621681668910"><span class="annot"><span class="annottext">Either Info_Error ()
</span><a href="#local-6989586621681668910"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error ())
-&gt; StateT CommandState TCM (Either Info_Error ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Either Info_Error ())
 -&gt; StateT CommandState TCM (Either Info_Error ()))
-&gt; TCM (Either Info_Error ())
-&gt; StateT CommandState TCM (Either Info_Error ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Info_Error TCM () -&gt; TCM (Either Info_Error ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Info_Error TCM ()
</span><a href="#local-6989586621681668909"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Info_Error ()
</span><a href="#local-6989586621681668910"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681668911"><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621681668911"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Info_Error_boot tcErr tcWarning
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-var">Info_Error</span></a></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621681668911"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621681667365"><span class="annot"><a href="#local-6989586621681668901"><span class="hs-identifier hs-type">try</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667365"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667365"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-677"></span><span>    </span><span id="local-6989586621681668901"><span class="annot"><span class="annottext">try :: forall a. Info_Error -&gt; TCM a -&gt; ExceptT Info_Error TCM a
</span><a href="#local-6989586621681668901"><span class="hs-identifier hs-var hs-var">try</span></a></span></span><span> </span><span id="local-6989586621681668915"><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621681668915"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621681668916"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681668916"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a)
-&gt; TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCErr -&gt; Info_Error) -&gt; Either TCErr a -&gt; Either Info_Error a
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><a href="Agda.Utils.Either.html#mapLeft"><span class="hs-identifier hs-var">mapLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info_Error -&gt; TCErr -&gt; Info_Error
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621681668915"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either TCErr a -&gt; Either Info_Error a)
-&gt; TCMT IO (Either TCErr a) -&gt; TCM (Either Info_Error a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCMT IO (Either TCErr a)
forall a. TCM a -&gt; TCM (Either TCErr a)
</span><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-var">freshTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681668916"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error a)
-&gt; (TCErr -&gt; TCM (Either Info_Error a))
-&gt; TCM (Either Info_Error a)
forall a. TCM a -&gt; (TCErr -&gt; TCM a) -&gt; TCM a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Info_Error a -&gt; TCM (Either Info_Error a)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info_Error -&gt; Either Info_Error a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621681668915"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-comment">-- freshTCM to avoid scope checking creating new interaction points</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_give"><span class="hs-identifier hs-type">Cmd_give</span></a></span><span>   </span><span id="local-6989586621681668921"><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621681668921"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621681668922"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668922"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668923"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668923"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681668924"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668924"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UseForce
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; GiveRefine
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var">give_gen</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621681668921"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668922"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668923"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668924"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span><span>
</span><span id="line-682"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-type">Cmd_refine</span></a></span><span> </span><span id="local-6989586621681668927"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668927"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668928"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668928"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681668929"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668929"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UseForce
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; GiveRefine
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var">give_gen</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-var">WithoutForce</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668927"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668928"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668929"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-type">Cmd_intro</span></a></span><span> </span><span id="local-6989586621681668932"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668932"><span class="hs-identifier hs-var">pmLambda</span></a></span></span><span> </span><span id="local-6989586621681668933"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668933"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668934"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668934"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621681668935"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668935"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [String] -&gt; StateT CommandState TCM [String]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [String] -&gt; StateT CommandState TCM [String])
-&gt; TCMT IO [String] -&gt; StateT CommandState TCM [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; InteractionId -&gt; TCMT IO [String]
</span><a href="Agda.Interaction.BasicOps.html#introTactic"><span class="hs-identifier hs-var">B.introTactic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668932"><span class="hs-identifier hs-var">pmLambda</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668933"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a)
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668933"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668935"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Intro_NotFound"><span class="hs-identifier hs-var">Info_Intro_NotFound</span></a></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621681668945"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668945"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; GiveRefine
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var">give_gen</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-var">WithoutForce</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668933"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668934"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668945"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[String]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Intro_ConstructorUnknown"><span class="hs-identifier hs-var">Info_Intro_ConstructorUnknown</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681668935"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine_or_intro"><span class="hs-identifier hs-type">Cmd_refine_or_intro</span></a></span><span> </span><span id="local-6989586621681668948"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668948"><span class="hs-identifier hs-var">pmLambda</span></a></span></span><span> </span><span id="local-6989586621681668949"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668949"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668950"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668950"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681668951"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668951"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range -&gt; StateT CommandState TCM ())
-&gt; Interaction' Range -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668952"><span class="annot"><span class="annottext">s' :: String
</span><a href="#local-6989586621681668952"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668951"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668952"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; InteractionId -&gt; Range -&gt; String -&gt; Interaction' Range
forall range.
Bool -&gt; InteractionId -&gt; range -&gt; String -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-var">Cmd_intro</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681668948"><span class="hs-identifier hs-var">pmLambda</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; Interaction' Range
forall range.
InteractionId -&gt; range -&gt; String -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-var">Cmd_refine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668949"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668950"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668952"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoOne"><span class="hs-identifier hs-type">Cmd_autoOne</span></a></span><span> </span><span id="local-6989586621681668954"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681668955"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668955"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681668956"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668956"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>  </span><span id="local-6989586621681668957"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668957"><span class="hs-identifier hs-var">iscope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
forall (m :: * -&gt; *).
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m) =&gt;
InteractionId -&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-var">getInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681668959"><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668959"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668960"><span class="annot"><span class="annottext">MimerResult
</span><a href="#local-6989586621681668960"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandM MimerResult -&gt; CommandM (Maybe CPUTime, MimerResult)
forall a. CommandM a -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-var">maybeTimed</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM MimerResult -&gt; CommandM (Maybe CPUTime, MimerResult))
-&gt; CommandM MimerResult -&gt; CommandM (Maybe CPUTime, MimerResult)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; CommandM MimerResult
forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
InteractionId -&gt; Range -&gt; String -&gt; tcm MimerResult
</span><a href="Agda.Mimer.Mimer.html#mimer"><span class="hs-identifier hs-var">Mimer.mimer</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668955"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668956"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MimerResult
</span><a href="#local-6989586621681668960"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><span class="annottext">MimerResult
</span><a href="Agda.Mimer.Mimer.html#MimerNoResult"><span class="hs-identifier hs-var">MimerNoResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-var">Info_Auto</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No solution found&quot;</span></span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerExpr"><span class="hs-identifier hs-type">MimerExpr</span></a></span><span> </span><span id="local-6989586621681668966"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668966"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-703"></span><span>      </span><span class="annot"><span class="annottext">InteractionId -&gt; ScopeInfo -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681668957"><span class="hs-identifier hs-var">iscope</span></a></span><span>
</span><span id="line-704"></span><span>      </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; GiveResult -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GiveResult
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-var">Resp_GiveAction</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(GiveResult -&gt; Response) -&gt; GiveResult -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-var">Give_String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668966"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><span class="annottext">([InteractionId] -&gt; [InteractionId]) -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; [InteractionId] -&gt; [InteractionId]
forall a. Eq a =&gt; a -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.delete</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668954"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
-&gt; (CPUTime -&gt; StateT CommandState TCM ())
-&gt; Maybe CPUTime
-&gt; StateT CommandState TCM ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; (CPUTime
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; CPUTime
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CPUTime
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CPUTime
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Time"><span class="hs-identifier hs-var">Info_Time</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681668959"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerList"><span class="hs-identifier hs-type">MimerList</span></a></span><span> </span><span id="local-6989586621681668973"><span class="annot"><span class="annottext">[(Int, String)]
</span><a href="#local-6989586621681668973"><span class="hs-identifier hs-var">sols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-708"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-var">Info_Auto</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Solutions:&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681668975"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;. &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668976"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681668975"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681668975"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681668976"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668976"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Int, String)]
</span><a href="#local-6989586621681668973"><span class="hs-identifier hs-var">sols</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-711"></span><span>    </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerClauses"><span class="hs-identifier hs-type">MimerClauses</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>    </span><span class="hs-comment">-- Mimer can't do case splitting yet</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_autoAll"><span class="hs-identifier hs-var">Cmd_autoAll</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-714"></span><span>  </span><span id="local-6989586621681668978"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668978"><span class="hs-identifier hs-var">iis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [InteractionId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-var">getInteractionPoints</span></a></span><span>
</span><span id="line-715"></span><span>  </span><span id="local-6989586621681668980"><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
</span><a href="#local-6989586621681668980"><span class="hs-identifier hs-var">getOldScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621681668981"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668981"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><span class="annottext">(InteractionId -&gt; CommandM ScopeInfo)
-&gt; StateT CommandState TCM (InteractionId -&gt; CommandM ScopeInfo)
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((InteractionId -&gt; CommandM ScopeInfo)
 -&gt; StateT CommandState TCM (InteractionId -&gt; CommandM ScopeInfo))
-&gt; (InteractionId -&gt; CommandM ScopeInfo)
-&gt; StateT CommandState TCM (InteractionId -&gt; CommandM ScopeInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668982"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668982"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ScopeInfo -&gt; CommandM ScopeInfo
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ScopeInfo -&gt; CommandM ScopeInfo)
-&gt; TCM ScopeInfo -&gt; CommandM ScopeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668981"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ScopeInfo -&gt; TCM ScopeInfo
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM ScopeInfo
forall (m :: * -&gt; *).
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m) =&gt;
InteractionId -&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-var">getInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668982"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InteractionId] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668978"><span class="hs-identifier hs-var">iis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681668983"><span class="annot"><span class="annottext">time :: Int
</span><a href="#local-6989586621681668983"><span class="hs-identifier hs-var hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668978"><span class="hs-identifier hs-var">iis</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span id="local-6989586621681668986"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681668986"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-721"></span><span>    </span><span id="local-6989586621681668987"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668987"><span class="hs-identifier hs-var">solved</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[InteractionId]] -&gt; [InteractionId])
-&gt; StateT CommandState TCM [[InteractionId]]
-&gt; StateT CommandState TCM [InteractionId]
forall a b.
(a -&gt; b) -&gt; StateT CommandState TCM a -&gt; StateT CommandState TCM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[InteractionId]] -&gt; [InteractionId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM [[InteractionId]]
 -&gt; StateT CommandState TCM [InteractionId])
-&gt; StateT CommandState TCM [[InteractionId]]
-&gt; StateT CommandState TCM [InteractionId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
-&gt; (InteractionId -&gt; StateT CommandState TCM [InteractionId])
-&gt; StateT CommandState TCM [[InteractionId]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668978"><span class="hs-identifier hs-var">iis</span></a></span><span> </span><span class="annot"><span class="annottext">((InteractionId -&gt; StateT CommandState TCM [InteractionId])
 -&gt; StateT CommandState TCM [[InteractionId]])
-&gt; (InteractionId -&gt; StateT CommandState TCM [InteractionId])
-&gt; StateT CommandState TCM [[InteractionId]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681668990"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-722"></span><span>      </span><span id="local-6989586621681668991"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668991"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadFail m, MonadError TCErr m) =&gt;
InteractionId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionRange"><span class="hs-identifier hs-var">getInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-723"></span><span>      </span><span id="local-6989586621681668993"><span class="annot"><span class="annottext">MimerResult
</span><a href="#local-6989586621681668993"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; CommandM MimerResult
forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
InteractionId -&gt; Range -&gt; String -&gt; tcm MimerResult
</span><a href="Agda.Mimer.Mimer.html#mimer"><span class="hs-identifier hs-var">Mimer.mimer</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681668991"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-t &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681668983"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ms&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MimerResult
</span><a href="#local-6989586621681668993"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-725"></span><span>        </span><span class="annot"><span class="annottext">MimerResult
</span><a href="Agda.Mimer.Mimer.html#MimerNoResult"><span class="hs-identifier hs-var">MimerNoResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-726"></span><span>        </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerExpr"><span class="hs-identifier hs-type">MimerExpr</span></a></span><span> </span><span id="local-6989586621681668994"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668994"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-727"></span><span>          </span><span class="annot"><span class="annottext">InteractionId -&gt; ScopeInfo -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; StateT CommandState TCM ())
-&gt; CommandM ScopeInfo -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
</span><a href="#local-6989586621681668980"><span class="hs-identifier hs-var">getOldScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-728"></span><span>          </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; GiveResult -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GiveResult
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-var">Resp_GiveAction</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(GiveResult -&gt; Response) -&gt; GiveResult -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-var">Give_String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681668994"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-729"></span><span>          </span><span class="annot"><span class="annottext">[InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668990"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-730"></span><span>        </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerList"><span class="hs-identifier hs-type">MimerList</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Don't list solutions in autoAll</span><span>
</span><span id="line-731"></span><span>        </span><span class="annot"><a href="Agda.Mimer.Mimer.html#MimerClauses"><span class="hs-identifier hs-type">MimerClauses</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [InteractionId]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- Mimer can't do case splitting yet</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><span class="annottext">([InteractionId] -&gt; [InteractionId]) -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InteractionId] -&gt; [InteractionId] -&gt; [InteractionId]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">List.\\</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681668987"><span class="hs-identifier hs-var">solved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_context"><span class="hs-identifier hs-type">Cmd_context</span></a></span><span> </span><span id="local-6989586621681668996"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668996"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681668997"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668997"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; ([ResponseContextEntry]
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; [ResponseContextEntry]
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; [ResponseContextEntry]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; [ResponseContextEntry]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Context"><span class="hs-identifier hs-var">Info_Context</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668997"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">([ResponseContextEntry] -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; InteractionId -&gt; TCM [ResponseContextEntry]
</span><a href="Agda.Interaction.BasicOps.html#getResponseContext"><span class="hs-identifier hs-var">B.getResponseContext</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681668996"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681668997"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_helper_function"><span class="hs-identifier hs-type">Cmd_helper_function</span></a></span><span> </span><span id="local-6989586621681669000"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669000"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669001"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669001"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669002"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669002"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669003"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669003"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-comment">-- Create type of application of new helper function that would solve the goal.</span><span>
</span><span id="line-739"></span><span>  </span><span id="local-6989586621681669004"><span class="annot"><span class="annottext">OutputConstraint' Expr Expr
</span><a href="#local-6989586621681669004"><span class="hs-identifier hs-var">helperType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (OutputConstraint' Expr Expr)
-&gt; CommandM (OutputConstraint' Expr Expr)
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (OutputConstraint' Expr Expr)
 -&gt; CommandM (OutputConstraint' Expr Expr))
-&gt; TCM (OutputConstraint' Expr Expr)
-&gt; CommandM (OutputConstraint' Expr Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; TCM (OutputConstraint' Expr Expr)
-&gt; TCM (OutputConstraint' Expr Expr)
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669001"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (OutputConstraint' Expr Expr)
 -&gt; TCM (OutputConstraint' Expr Expr))
-&gt; TCM (OutputConstraint' Expr Expr)
-&gt; TCM (OutputConstraint' Expr Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM (OutputConstraint' Expr Expr)
-&gt; TCM (OutputConstraint' Expr Expr)
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (OutputConstraint' Expr Expr)
 -&gt; TCM (OutputConstraint' Expr Expr))
-&gt; TCM (OutputConstraint' Expr Expr)
-&gt; TCM (OutputConstraint' Expr Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; TCM (OutputConstraint' Expr Expr)
</span><a href="Agda.Interaction.BasicOps.html#metaHelperType"><span class="hs-identifier hs-var">B.metaHelperType</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669000"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669001"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669002"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669003"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669001"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputConstraint' Expr Expr -&gt; GoalDisplayInfo_boot TCErr
forall tcErr.
OutputConstraint' Expr Expr -&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_HelperFunction"><span class="hs-identifier hs-var">Goal_HelperFunction</span></a></span><span> </span><span class="annot"><span class="annottext">OutputConstraint' Expr Expr
</span><a href="#local-6989586621681669004"><span class="hs-identifier hs-var">helperType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer"><span class="hs-identifier hs-type">Cmd_infer</span></a></span><span> </span><span id="local-6989586621681669009"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669009"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669010"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669010"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669011"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669011"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669012"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669012"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621681669013"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669013"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; CommandM Expr
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; CommandM Expr) -&gt; TCM Expr -&gt; CommandM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669010"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; TCM Expr) -&gt; TCM Expr -&gt; TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Rewrite -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#typeInMeta"><span class="hs-identifier hs-var">B.typeInMeta</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669010"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669009"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM Expr) -&gt; TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-var">B.parseExprIn</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669010"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669011"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669012"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669010"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; GoalDisplayInfo_boot TCErr
forall tcErr. Expr -&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_InferredType"><span class="hs-identifier hs-var">Goal_InferredType</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669013"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type"><span class="hs-identifier hs-type">Cmd_goal_type</span></a></span><span> </span><span id="local-6989586621681669017"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669017"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669018"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669018"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-747"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669018"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; GoalDisplayInfo_boot TCErr
forall tcErr. Rewrite -&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_CurrentGoal"><span class="hs-identifier hs-var">Goal_CurrentGoal</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669017"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_elaborate_give"><span class="hs-identifier hs-type">Cmd_elaborate_give</span></a></span><span> </span><span id="local-6989586621681669020"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669020"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669021"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669021"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669022"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669022"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669023"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669023"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-750"></span><span>  </span><span class="annot"><span class="annottext">UseForce
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; GiveRefine
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var">give_gen</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-var">WithoutForce</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669021"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669022"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669023"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(GiveRefine -&gt; StateT CommandState TCM ())
-&gt; GiveRefine -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-var">ElaborateGive</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669020"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context"><span class="hs-identifier hs-type">Cmd_goal_type_context</span></a></span><span> </span><span id="local-6989586621681669025"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669025"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669026"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669026"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669027"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669027"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669028"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669028"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><span class="annottext">GoalTypeAux
-&gt; Rewrite
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-var">cmd_goal_type_context_and</span></a></span><span> </span><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="Agda.Interaction.Response.Base.html#GoalOnly"><span class="hs-identifier hs-var">GoalOnly</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669025"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669026"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669027"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669028"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_infer"><span class="hs-identifier hs-type">Cmd_goal_type_context_infer</span></a></span><span> </span><span id="local-6989586621681669031"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669031"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669032"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669032"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669033"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669033"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669034"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669034"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-comment">-- In case of the empty expression to type, don't fail with</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-comment">-- a stupid parse error, but just fall back to</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-comment">-- Cmd_goal_type_context.</span><span>
</span><span id="line-759"></span><span>  </span><span id="local-6989586621681669035"><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="#local-6989586621681669035"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">Char.isSpace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669034"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-760"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">GoalTypeAux -&gt; StateT CommandState TCM GoalTypeAux
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="Agda.Interaction.Response.Base.html#GoalOnly"><span class="hs-identifier hs-var">GoalOnly</span></a></span><span>
</span><span id="line-761"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>              </span><span class="annot"><span class="annottext">TCM GoalTypeAux -&gt; StateT CommandState TCM GoalTypeAux
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM GoalTypeAux -&gt; StateT CommandState TCM GoalTypeAux)
-&gt; TCM GoalTypeAux -&gt; StateT CommandState TCM GoalTypeAux
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM GoalTypeAux -&gt; TCM GoalTypeAux
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669032"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM GoalTypeAux -&gt; TCM GoalTypeAux)
-&gt; TCM GoalTypeAux -&gt; TCM GoalTypeAux
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>                </span><span id="local-6989586621681669038"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669038"><span class="hs-identifier hs-var">parsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-var">B.parseExprIn</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669032"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669033"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669034"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-764"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681669039"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669039"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669040"><span class="annot"><span class="annottext">[IPFace' Expr]
</span><a href="#local-6989586621681669040"><span class="hs-identifier hs-var">faces</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Rewrite -&gt; Expr -&gt; TCM (Expr, [IPFace' Expr])
</span><a href="Agda.Interaction.BasicOps.html#typeAndFacesInMeta"><span class="hs-identifier hs-var">B.typeAndFacesInMeta</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669032"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669031"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669038"><span class="hs-identifier hs-var">parsed</span></a></span><span>
</span><span id="line-765"></span><span>                </span><span class="annot"><span class="annottext">GoalTypeAux -&gt; TCM GoalTypeAux
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; [IPFace' Expr] -&gt; GoalTypeAux
</span><a href="Agda.Interaction.Response.Base.html#GoalAndHave"><span class="hs-identifier hs-var">GoalAndHave</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669039"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[IPFace' Expr]
</span><a href="#local-6989586621681669040"><span class="hs-identifier hs-var">faces</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>  </span><span class="annot"><span class="annottext">GoalTypeAux
-&gt; Rewrite
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-var">cmd_goal_type_context_and</span></a></span><span> </span><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="#local-6989586621681669035"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669031"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669032"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669033"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669034"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_check"><span class="hs-identifier hs-type">Cmd_goal_type_context_check</span></a></span><span> </span><span id="local-6989586621681669043"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669043"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669044"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669044"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669045"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669045"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669046"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669046"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-769"></span><span>  </span><span id="local-6989586621681669047"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681669047"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; CommandM Term
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; CommandM Term) -&gt; TCM Term -&gt; CommandM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669044"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-770"></span><span>    </span><span id="local-6989586621681669048"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669048"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-var">B.parseExprIn</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669044"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669045"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669046"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-771"></span><span>    </span><span id="local-6989586621681669049"><span class="annot"><span class="annottext">OutputConstraint Expr InteractionId
</span><a href="#local-6989586621681669049"><span class="hs-identifier hs-var">goal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Rewrite
-&gt; InteractionId -&gt; TCM (OutputConstraint Expr InteractionId)
</span><a href="Agda.Interaction.BasicOps.html#typeOfMeta"><span class="hs-identifier hs-var">B.typeOfMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669044"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span id="local-6989586621681669051"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681669051"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputConstraint Expr InteractionId
</span><a href="#local-6989586621681669049"><span class="hs-identifier hs-var">goal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-773"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Base.html#OfType"><span class="hs-identifier hs-type">OfType</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681669053"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669053"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669048"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Term) -&gt; TCMT IO Type -&gt; TCM Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669053"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><span class="annottext">OutputConstraint Expr InteractionId
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-775"></span><span>    </span><span class="annot"><span class="annottext">Rewrite -&gt; Term -&gt; TCM Term
forall t.
(Reduce t, Simplify t, Instantiate t, Normalise t) =&gt;
Rewrite -&gt; t -&gt; TCM t
</span><a href="Agda.Interaction.BasicOps.html#normalForm"><span class="hs-identifier hs-var">B.normalForm</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669043"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681669051"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><span class="annottext">GoalTypeAux
-&gt; Rewrite
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-var">cmd_goal_type_context_and</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; GoalTypeAux
</span><a href="Agda.Interaction.Response.Base.html#GoalAndElaboration"><span class="hs-identifier hs-var">GoalAndElaboration</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681669047"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669043"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669044"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669045"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669046"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents"><span class="hs-identifier hs-type">Cmd_show_module_contents</span></a></span><span> </span><span id="local-6989586621681669056"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669056"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669057"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669057"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669058"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669058"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669059"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669059"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a)
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669057"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-var">showModuleContents</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669056"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669058"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669059"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope_toplevel"><span class="hs-identifier hs-type">Cmd_why_in_scope_toplevel</span></a></span><span> </span><span id="local-6989586621681669066"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669066"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-782"></span><span>  </span><span class="annot"><span class="annottext">StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var">whyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669066"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope"><span class="hs-identifier hs-type">Cmd_why_in_scope</span></a></span><span> </span><span id="local-6989586621681669068"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669068"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669069"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669069"><span class="hs-identifier hs-var">_range</span></a></span></span><span> </span><span id="local-6989586621681669070"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669070"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a)
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669068"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var">whyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669070"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_make_case"><span class="hs-identifier hs-type">Cmd_make_case</span></a></span><span> </span><span id="local-6989586621681669077"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669077"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669078"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669078"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669079"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669079"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681669080"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681669080"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669081"><span class="annot"><span class="annottext">CaseContext
</span><a href="#local-6989586621681669081"><span class="hs-identifier hs-var">casectxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669082"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681669082"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (QName, CaseContext, [Clause])
-&gt; StateT CommandState TCM (QName, CaseContext, [Clause])
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (QName, CaseContext, [Clause])
 -&gt; StateT CommandState TCM (QName, CaseContext, [Clause]))
-&gt; TCMT IO (QName, CaseContext, [Clause])
-&gt; StateT CommandState TCM (QName, CaseContext, [Clause])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; Range -&gt; String -&gt; TCMT IO (QName, CaseContext, [Clause])
</span><a href="Agda.Interaction.MakeCase.html#makeCase"><span class="hs-identifier hs-var">makeCase</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669077"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669078"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669079"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a)
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669077"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-790"></span><span>    </span><span id="local-6989586621681669090"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621681669090"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Telescope -&gt; StateT CommandState TCM Telescope
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM Telescope -&gt; StateT CommandState TCM Telescope)
-&gt; TCM Telescope -&gt; StateT CommandState TCM Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCM Telescope
forall (m :: * -&gt; *).
(Functor m, ReadTCState m) =&gt;
ModuleName -&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Signature.html#lookupSection"><span class="hs-identifier hs-var">lookupSection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var">qnameModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681669080"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- don't shadow the names in this telescope</span><span>
</span><span id="line-791"></span><span>    </span><span id="local-6989586621681669093"><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621681669093"><span class="hs-identifier hs-var">unicode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; UnicodeOrAscii)
-&gt; StateT CommandState TCM UnicodeOrAscii
forall (m :: * -&gt; *) a. ReadTCState m =&gt; (TCState -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-var">getsTC</span></a></span><span> </span><span class="annot"><span class="annottext">((TCState -&gt; UnicodeOrAscii)
 -&gt; StateT CommandState TCM UnicodeOrAscii)
-&gt; (TCState -&gt; UnicodeOrAscii)
-&gt; StateT CommandState TCM UnicodeOrAscii
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; UnicodeOrAscii
</span><a href="Agda.Interaction.Options.Base.html#optUseUnicode"><span class="hs-identifier hs-var">optUseUnicode</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; UnicodeOrAscii)
-&gt; (TCState -&gt; PragmaOptions) -&gt; TCState -&gt; UnicodeOrAscii
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PragmaOptions
forall a. LensPragmaOptions a =&gt; a -&gt; PragmaOptions
</span><a href="Agda.Interaction.Options.Lenses.html#getPragmaOptions"><span class="hs-identifier hs-var">getPragmaOptions</span></a></span><span>
</span><span id="line-792"></span><span>    </span><span id="local-6989586621681669097"><span class="annot"><span class="annottext">[Doc]
</span><a href="#local-6989586621681669097"><span class="hs-identifier hs-var">pcs</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [Doc] -&gt; StateT CommandState TCM [Doc]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [Doc] -&gt; StateT CommandState TCM [Doc])
-&gt; TCM [Doc] -&gt; StateT CommandState TCM [Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM [Doc] -&gt; TCM [Doc]
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM [Doc] -&gt; TCM [Doc]) -&gt; TCM [Doc] -&gt; TCM [Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM [Doc] -&gt; TCM [Doc]
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621681669090"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM [Doc] -&gt; TCM [Doc]) -&gt; TCM [Doc] -&gt; TCM [Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO Doc) -&gt; [Clause] -&gt; TCM [Doc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.Syntax.Abstract.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681669082"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669101"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669101"><span class="hs-identifier hs-var">pcs'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; String) -&gt; [Doc] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">List.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnicodeOrAscii -&gt; CaseContext -&gt; String -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-var">extlam_dropName</span></a></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621681669093"><span class="hs-identifier hs-var">unicode</span></a></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><a href="#local-6989586621681669081"><span class="hs-identifier hs-var">casectxt</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (Doc -&gt; String) -&gt; Doc -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-var">decorate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Doc]
</span><a href="#local-6989586621681669097"><span class="hs-identifier hs-var">pcs</span></a></span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.case&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;InteractionTop.Cmd_make_case&quot;</span></span><span>
</span><span id="line-796"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">TCP.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span>
</span><span id="line-797"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;cs   = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO Doc) -&gt; [Clause] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.Syntax.Abstract.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681669082"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;pcs  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Doc -&gt; TCMT IO Doc) -&gt; [Doc] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Doc]
</span><a href="#local-6989586621681669097"><span class="hs-identifier hs-var">pcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;pcs' = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc) -&gt; [String] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">TCP.text</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669101"><span class="hs-identifier hs-var">pcs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.case&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;InteractionTop.Cmd_make_case&quot;</span></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">TCP.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">TCP.vcat</span></a></span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;cs   = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">TCP.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Clause] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681669082"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-807"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-808"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; MakeCaseVariant -&gt; [String] -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; MakeCaseVariant
-&gt; [String]
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_MakeCase"><span class="hs-identifier hs-var">Resp_MakeCase</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669077"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CaseContext -&gt; MakeCaseVariant
</span><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-var">makeCaseVariant</span></a></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><a href="#local-6989586621681669081"><span class="hs-identifier hs-var">casectxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669101"><span class="hs-identifier hs-var">pcs'</span></a></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute"><span class="hs-identifier hs-type">Cmd_compute</span></a></span><span> </span><span id="local-6989586621681669111"><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681669111"><span class="hs-identifier hs-var">cmode</span></a></span></span><span> </span><span id="local-6989586621681669112"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669112"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669113"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669113"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669114"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669114"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-812"></span><span>  </span><span id="local-6989586621681669115"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669115"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; CommandM Expr
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; CommandM Expr) -&gt; TCM Expr -&gt; CommandM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>    </span><span id="local-6989586621681669116"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669116"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-var">B.parseExprIn</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669112"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669113"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM Expr) -&gt; String -&gt; TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ComputeMode -&gt; String -&gt; String
</span><a href="Agda.Interaction.BasicOps.html#computeWrapInput"><span class="hs-identifier hs-var">B.computeWrapInput</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681669111"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669114"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-814"></span><span>    </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a.
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m, MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669112"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; TCM Expr) -&gt; TCM Expr -&gt; TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (TCM Expr -&gt; TCM Expr) -&gt; TCM Expr -&gt; TCM Expr
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeMode -&gt; Bool
</span><a href="Agda.Interaction.BasicOps.html#computeIgnoreAbstract"><span class="hs-identifier hs-var">B.computeIgnoreAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681669111"><span class="hs-identifier hs-var">cmode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; TCM Expr
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#ignoreAbstractMode"><span class="hs-identifier hs-var">ignoreAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; TCM Expr) -&gt; TCM Expr -&gt; TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ComputeMode -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#evalInCurrent"><span class="hs-identifier hs-var">B.evalInCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681669111"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669116"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669112"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeMode -&gt; Expr -&gt; GoalDisplayInfo_boot TCErr
forall tcErr. ComputeMode -&gt; Expr -&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_NormalForm"><span class="hs-identifier hs-var">Goal_NormalForm</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621681669111"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669115"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-var">Cmd_show_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Version"><span class="hs-identifier hs-var">Info_Version</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-var">Cmd_abort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-var">Cmd_exit</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT CommandState TCM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-type">decorate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-824"></span><span id="decorate"><span class="annot"><span class="annottext">decorate :: Doc -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-var hs-var">decorate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Style -&gt; Doc -&gt; String
forall a. Style -&gt; Doc a -&gt; String
</span><span class="hs-identifier hs-var">renderStyle</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Style
</span><span class="hs-identifier hs-var">style</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">mode</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OneLineMode</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-type">makeCaseVariant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html#CaseContext"><span class="hs-identifier hs-type">CaseContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#MakeCaseVariant"><span class="hs-identifier hs-type">MakeCaseVariant</span></a></span><span>
</span><span id="line-827"></span><span id="makeCaseVariant"><span class="annot"><span class="annottext">makeCaseVariant :: CaseContext -&gt; MakeCaseVariant
</span><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-var hs-var">makeCaseVariant</span></a></span></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MakeCaseVariant
</span><a href="Agda.Interaction.Response.Base.html#Function"><span class="hs-identifier hs-var">R.Function</span></a></span><span>
</span><span id="line-828"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-var">makeCaseVariant</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MakeCaseVariant
</span><a href="Agda.Interaction.Response.Base.html#ExtendedLambda"><span class="hs-identifier hs-var">R.ExtendedLambda</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-comment">-- very dirty hack, string manipulation by dropping the function name</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- and replacing the last &quot; = &quot; with &quot; -&gt; &quot;. It's important not to replace</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- the equal sign in named implicit with an arrow!</span><span>
</span><span id="line-833"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-type">extlam_dropName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Glyph.html#UnicodeOrAscii"><span class="hs-identifier hs-type">UnicodeOrAscii</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html#CaseContext"><span class="hs-identifier hs-type">CaseContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-834"></span><span id="extlam_dropName"><span class="annot"><span class="annottext">extlam_dropName :: UnicodeOrAscii -&gt; CaseContext -&gt; String -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-var hs-var">extlam_dropName</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621681669124"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669124"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669124"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-835"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-var">extlam_dropName</span></a></span><span> </span><span id="local-6989586621681669125"><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621681669125"><span class="hs-identifier hs-var">glyphMode</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span id="local-6989586621681669126"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669126"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="#local-6989586621681669129"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [String] -&gt; [String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669126"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621681669132"><span class="annot"><span class="annottext">arrow :: String
</span><a href="#local-6989586621681669132"><span class="hs-identifier hs-var hs-var">arrow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Doc a -&gt; String
</span><span class="hs-identifier hs-var">render</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; String) -&gt; Doc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecialCharacters -&gt; Doc
</span><a href="Agda.Syntax.Concrete.Glyph.html#_arrow"><span class="hs-identifier hs-var">_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">(SpecialCharacters -&gt; Doc) -&gt; SpecialCharacters -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii -&gt; SpecialCharacters
</span><a href="Agda.Syntax.Concrete.Glyph.html#specialCharactersForGlyphs"><span class="hs-identifier hs-var">specialCharactersForGlyphs</span></a></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621681669125"><span class="hs-identifier hs-var">glyphMode</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621681669129"><span class="annot"><span class="annottext">replEquals :: [String] -&gt; [String]
</span><a href="#local-6989586621681669129"><span class="hs-identifier hs-var hs-var">replEquals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681669136"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669136"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669132"><span class="hs-identifier hs-var">arrow</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669136"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><a href="#local-6989586621681669129"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669137"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669137"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681669138"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669138"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669137"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="#local-6989586621681669129"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669138"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-841"></span><span>    </span><span class="annot"><a href="#local-6989586621681669129"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="hs-comment">-- | Solved goals already instantiated internally</span><span>
</span><span id="line-844"></span><span class="hs-comment">-- The second argument potentially limits it to one specific goal.</span><span>
</span><span id="line-845"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-type">solveInstantiatedGoals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span id="solveInstantiatedGoals"><span class="annot"><span class="annottext">solveInstantiatedGoals :: Rewrite -&gt; Maybe InteractionId -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var hs-var">solveInstantiatedGoals</span></a></span></span><span> </span><span id="local-6989586621681669139"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669139"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669140"><span class="annot"><span class="annottext">Maybe InteractionId
</span><a href="#local-6989586621681669140"><span class="hs-identifier hs-var">mii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-comment">-- Andreas, 2016-10-23 issue #2280: throw away meta elims.</span><span>
</span><span id="line-848"></span><span>  </span><span id="local-6989586621681669141"><span class="annot"><span class="annottext">[(InteractionId, Expr)]
</span><a href="#local-6989586621681669141"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [(InteractionId, Expr)]
-&gt; StateT CommandState TCM [(InteractionId, Expr)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [(InteractionId, Expr)]
 -&gt; StateT CommandState TCM [(InteractionId, Expr)])
-&gt; TCM [(InteractionId, Expr)]
-&gt; StateT CommandState TCM [(InteractionId, Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv)
-&gt; TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)]
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669143"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669143"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669143"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envPrintMetasBare"><span class="hs-identifier hs-var">envPrintMetasBare</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)])
-&gt; TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621681669145"><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)]
</span><a href="#local-6989586621681669145"><span class="hs-identifier hs-var">sip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Rewrite -&gt; TCM [(InteractionId, MetaId, Expr)]
</span><a href="Agda.Interaction.BasicOps.html#getSolvedInteractionPoints"><span class="hs-identifier hs-var">B.getSolvedInteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669139"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-850"></span><span>           </span><span class="hs-comment">-- only solve metas which have a proper instantiation, i.e., not another meta</span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669147"><span class="annot"><span class="annottext">sip' :: [(InteractionId, MetaId, Expr)]
</span><a href="#local-6989586621681669147"><span class="hs-identifier hs-var hs-var">sip'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(InteractionId, MetaId, Expr)]
 -&gt; [(InteractionId, MetaId, Expr)])
-&gt; (InteractionId
    -&gt; [(InteractionId, MetaId, Expr)]
    -&gt; [(InteractionId, MetaId, Expr)])
-&gt; Maybe InteractionId
-&gt; [(InteractionId, MetaId, Expr)]
-&gt; [(InteractionId, MetaId, Expr)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)] -&gt; [(InteractionId, MetaId, Expr)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669148"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669148"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((InteractionId, MetaId, Expr) -&gt; Bool)
-&gt; [(InteractionId, MetaId, Expr)]
-&gt; [(InteractionId, MetaId, Expr)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669148"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; InteractionId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InteractionId -&gt; Bool)
-&gt; ((InteractionId, MetaId, Expr) -&gt; InteractionId)
-&gt; (InteractionId, MetaId, Expr)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, MetaId, Expr) -&gt; InteractionId
forall a b c. (a, b, c) -&gt; a
</span><a href="Agda.Utils.Tuple.html#fst3"><span class="hs-identifier hs-var">fst3</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe InteractionId
</span><a href="#local-6989586621681669140"><span class="hs-identifier hs-var">mii</span></a></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)]
</span><a href="#local-6989586621681669145"><span class="hs-identifier hs-var">sip</span></a></span><span>
</span><span id="line-852"></span><span>    </span><span class="annot"><span class="annottext">((InteractionId, MetaId, Expr) -&gt; TCMT IO (InteractionId, Expr))
-&gt; [(InteractionId, MetaId, Expr)] -&gt; TCM [(InteractionId, Expr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, MetaId, Expr) -&gt; TCMT IO (InteractionId, Expr)
(InteractionId, MetaId, Expr)
-&gt; TCMT IO (InteractionId, ConOfAbs Expr)
forall {m :: * -&gt; *} {a} {a}.
(MonadTrace m, ToConcrete a, MonadFresh NameId m,
 MonadInteractionPoints m, MonadStConcreteNames m, PureTCM m,
 IsString (m Doc), Null (m Doc), Semigroup (m Doc)) =&gt;
(a, MetaId, a) -&gt; m (a, ConOfAbs a)
</span><a href="#local-6989586621681669150"><span class="hs-identifier hs-var">prt</span></a></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)]
</span><a href="#local-6989586621681669147"><span class="hs-identifier hs-var">sip'</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, Expr)] -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
[(InteractionId, Expr)]
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_SolveAll"><span class="hs-identifier hs-var">Resp_SolveAll</span></a></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, Expr)]
</span><a href="#local-6989586621681669141"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>      </span><span id="local-6989586621681669150"><span class="annot"><span class="annottext">prt :: (a, MetaId, a) -&gt; m (a, ConOfAbs a)
</span><a href="#local-6989586621681669150"><span class="hs-identifier hs-var hs-var">prt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669319"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669319"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669320"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681669320"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669321"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669321"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-856"></span><span>        </span><span id="local-6989586621681669322"><span class="annot"><span class="annottext">Closure Range
</span><a href="#local-6989586621681669322"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Closure Range
</span><a href="Agda.TypeChecking.Monad.Base.html#getMetaInfo"><span class="hs-identifier hs-var">getMetaInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; Closure Range)
-&gt; m MetaVariable -&gt; m (Closure Range)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; m MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681669320"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-857"></span><span>        </span><span id="local-6989586621681669325"><span class="annot"><span class="annottext">ConOfAbs a
</span><a href="#local-6989586621681669325"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Closure Range -&gt; m (ConOfAbs a) -&gt; m (ConOfAbs a)
forall (m :: * -&gt; *) a.
(MonadTCEnv m, ReadTCState m, MonadTrace m) =&gt;
Closure Range -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withMetaInfo"><span class="hs-identifier hs-var">withMetaInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Closure Range
</span><a href="#local-6989586621681669322"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ConOfAbs a) -&gt; m (ConOfAbs a))
-&gt; m (ConOfAbs a) -&gt; m (ConOfAbs a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Precedence -&gt; a -&gt; m (ConOfAbs a)
forall a (m :: * -&gt; *).
(ToConcrete a, MonadAbsToCon m) =&gt;
Precedence -&gt; a -&gt; m (ConOfAbs a)
</span><a href="Agda.Syntax.Translation.AbstractToConcrete.html#abstractToConcreteCtx"><span class="hs-identifier hs-var">abstractToConcreteCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Precedence
</span><a href="Agda.Syntax.Fixity.html#TopCtx"><span class="hs-identifier hs-var">TopCtx</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669321"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-858"></span><span>        </span><span class="annot"><span class="annottext">(a, ConOfAbs a) -&gt; m (a, ConOfAbs a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669319"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConOfAbs a
</span><a href="#local-6989586621681669325"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="hs-comment">-- | @cmd_load' file argv unsolvedOk cmd@</span><span>
</span><span id="line-861"></span><span class="hs-comment">--   loads the module in file @file@,</span><span>
</span><span id="line-862"></span><span class="hs-comment">--   using @argv@ as the command-line options.</span><span>
</span><span id="line-863"></span><span class="hs-comment">--</span><span>
</span><span id="line-864"></span><span class="hs-comment">-- If type checking completes without any exceptions having been</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- encountered then the command @cmd r@ is executed, where @r@ is the</span><span>
</span><span id="line-866"></span><span class="hs-comment">-- result of 'Imp.typeCheckMain'.</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span id="local-6989586621681667269"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-type">cmd_load'</span></a></span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ File to load into interaction.</span></span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Arguments to Agda for loading this file</span></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Allow unsolved meta-variables?</span></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Full type-checking, or only scope-checking?</span></span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667269"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Continuation after successful loading.</span></span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667269"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-876"></span><span id="cmd_load%27"><span class="annot"><span class="annottext">cmd_load' :: forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var hs-var">cmd_load'</span></a></span></span><span> </span><span id="local-6989586621681669401"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669401"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681669402"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669402"><span class="hs-identifier hs-var">argv</span></a></span></span><span> </span><span id="local-6989586621681669403"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669403"><span class="hs-identifier hs-var">unsolvedOK</span></a></span></span><span> </span><span id="local-6989586621681669404"><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681669404"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621681669405"><span class="annot"><span class="annottext">CheckResult -&gt; CommandM a
</span><a href="#local-6989586621681669405"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-877"></span><span>    </span><span id="local-6989586621681669406"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681669406"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath)
-&gt; IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669401"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-878"></span><span>    </span><span id="local-6989586621681669407"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669407"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; StateT CommandState TCM Bool
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Bool) -&gt; String -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681669406"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669407"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; StateT CommandState TCM ())
-&gt; TypeError -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#GenericError"><span class="hs-identifier hs-var">GenericError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TypeError) -&gt; String -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-880"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The file &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669401"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; was not found.&quot;</span></span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span>    </span><span class="hs-comment">-- Forget the previous &quot;current file&quot; and interaction points.</span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ())
-&gt; (CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669409"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681669409"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681669409"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-884"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-885"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span>    </span><span id="local-6989586621681669410"><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669410"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ClockTime -&gt; StateT CommandState TCM ClockTime
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ClockTime -&gt; StateT CommandState TCM ClockTime)
-&gt; IO ClockTime -&gt; StateT CommandState TCM ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ClockTime
</span><span class="hs-identifier hs-var">getModificationTime</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669401"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-comment">-- Update the status. Because the &quot;current file&quot; is not set the</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- status is not &quot;Checked&quot;.</span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-comment">-- Reset the state, preserving options and decoded modules. Note</span><span>
</span><span id="line-894"></span><span>    </span><span class="hs-comment">-- that if the include directories have changed, then the decoded</span><span>
</span><span id="line-895"></span><span>    </span><span class="hs-comment">-- modules are reset by TCM.setCommandLineOptions' below.</span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#resetState"><span class="hs-identifier hs-var">resetState</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-comment">-- Clear the info buffer to make room for information about which</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">-- module is currently being type-checked.</span><span>
</span><span id="line-900"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_ClearRunningInfo"><span class="hs-identifier hs-var">Resp_ClearRunningInfo</span></a></span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span>    </span><span class="hs-comment">-- Remove any prior syntax highlighting.</span><span>
</span><span id="line-903"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBased -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
TokenBased
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_ClearHighlighting"><span class="hs-identifier hs-var">Resp_ClearHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBased
</span><a href="Agda.Syntax.Common.Aspect.html#NotOnlyTokenBased"><span class="hs-identifier hs-var">NotOnlyTokenBased</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-comment">-- Parse the file.</span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-907"></span><span>    </span><span class="hs-comment">-- Note that options are set below.</span><span>
</span><span id="line-908"></span><span>    </span><span id="local-6989586621681669416"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681669416"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Source -&gt; StateT CommandState TCM Source
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM Source -&gt; StateT CommandState TCM Source)
-&gt; TCM Source -&gt; StateT CommandState TCM Source
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var">Imp.parseSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; SourceFile
</span><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-var">SourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681669406"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span>    </span><span class="hs-comment">-- Store the warnings.</span><span>
</span><span id="line-911"></span><span>    </span><span id="local-6989586621681669417"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681669417"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState [TCWarning] -&gt; StateT CommandState TCM [TCWarning]
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; f [TCWarning]) -&gt; TCState -&gt; f TCState
Lens' TCState [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-var">stTCWarnings</span></a></span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>    </span><span class="hs-comment">-- All options are reset when a file is reloaded, including the</span><span>
</span><span id="line-914"></span><span>    </span><span class="hs-comment">-- choice of whether or not to display implicit arguments.</span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621681669421"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669421"><span class="hs-identifier hs-var">opts0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandLineOptions)
-&gt; StateT CommandState TCM CommandLineOptions
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; CommandLineOptions
</span><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span>
</span><span id="line-916"></span><span>    </span><span id="local-6989586621681669422"><span class="annot"><span class="annottext">[Backend]
</span><a href="#local-6989586621681669422"><span class="hs-identifier hs-var">backends</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState [Backend] -&gt; StateT CommandState TCM [Backend]
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">([Backend] -&gt; f [Backend]) -&gt; TCState -&gt; f TCState
Lens' TCState [Backend]
</span><a href="Agda.TypeChecking.Monad.Base.html#stBackends"><span class="hs-identifier hs-var">stBackends</span></a></span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669426"><span class="annot"><span class="annottext">Either String ([Backend], CommandLineOptions)
</span><a href="#local-6989586621681669426"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669427"><span class="annot"><span class="annottext">OptionWarnings
</span><a href="#local-6989586621681669427"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptM ([Backend], CommandLineOptions)
-&gt; (Either String ([Backend], CommandLineOptions), OptionWarnings)
forall opts. OptM opts -&gt; (Either String opts, OptionWarnings)
</span><a href="Agda.Interaction.Options.Base.html#runOptM"><span class="hs-identifier hs-var">runOptM</span></a></span><span> </span><span class="annot"><span class="annottext">(OptM ([Backend], CommandLineOptions)
 -&gt; (Either String ([Backend], CommandLineOptions), OptionWarnings))
-&gt; OptM ([Backend], CommandLineOptions)
-&gt; (Either String ([Backend], CommandLineOptions), OptionWarnings)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Backend]
-&gt; [String]
-&gt; CommandLineOptions
-&gt; OptM ([Backend], CommandLineOptions)
</span><a href="Agda.Compiler.Backend.html#parseBackendOptions"><span class="hs-identifier hs-var">parseBackendOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Backend]
</span><a href="#local-6989586621681669422"><span class="hs-identifier hs-var">backends</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681669402"><span class="hs-identifier hs-var">argv</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669421"><span class="hs-identifier hs-var">opts0</span></a></span><span>
</span><span id="line-918"></span><span>    </span><span class="annot"><span class="annottext">(OptionWarning -&gt; StateT CommandState TCM ())
-&gt; OptionWarnings -&gt; StateT CommandState TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; (OptionWarning -&gt; TCM ())
-&gt; OptionWarning
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ())
-&gt; (OptionWarning -&gt; Warning) -&gt; OptionWarning -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OptionWarning -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#OptionWarning"><span class="hs-identifier hs-var">OptionWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OptionWarnings
</span><a href="#local-6989586621681669427"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either String ([Backend], CommandLineOptions)
</span><a href="#local-6989586621681669426"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-920"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681669431"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669431"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#GenericError"><span class="hs-identifier hs-var">GenericError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669431"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-921"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Backend]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669432"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669432"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-922"></span><span>        </span><span id="local-6989586621681669433"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669433"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM CommandLineOptions
 -&gt; StateT CommandState TCM CommandLineOptions)
-&gt; TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Options.html#addTrustedExecutables"><span class="hs-identifier hs-var">addTrustedExecutables</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669432"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669435"><span class="annot"><span class="annottext">update :: PragmaOptions -&gt; PragmaOptions
</span><a href="#local-6989586621681669435"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' PragmaOptions Bool -&gt; LensMap PragmaOptions Bool
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptAllowUnsolved"><span class="hs-identifier hs-var">lensOptAllowUnsolved</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, Eq a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-var">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669403"><span class="hs-identifier hs-var">unsolvedOK</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span class="hs-special">)</span><span>
</span><span id="line-924"></span><span>            </span><span id="local-6989586621681669443"><span class="annot"><span class="annottext">root :: AbsolutePath
</span><a href="#local-6989586621681669443"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TopLevelModuleName -&gt; AbsolutePath
</span><a href="Agda.Syntax.TopLevelModuleName.html#projectRoot"><span class="hs-identifier hs-var">projectRoot</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681669406"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; AbsolutePath)
-&gt; TopLevelModuleName -&gt; AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681669416"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-925"></span><span>        </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions%27"><span class="hs-identifier hs-var">TCM.setCommandLineOptions'</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681669443"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; TCM ()) -&gt; CommandLineOptions -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; PragmaOptions)
-&gt; CommandLineOptions -&gt; CommandLineOptions
forall a.
LensPragmaOptions a =&gt;
(PragmaOptions -&gt; PragmaOptions) -&gt; a -&gt; a
</span><a href="Agda.Interaction.Options.Lenses.html#mapPragmaOptions"><span class="hs-identifier hs-var">mapPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; PragmaOptions
</span><a href="#local-6989586621681669435"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669433"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-comment">-- Restore the warnings that were saved above.</span><span>
</span><span id="line-928"></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState [TCWarning]
-&gt; ([TCWarning] -&gt; [TCWarning]) -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-identifier hs-var">modifyTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; f [TCWarning]) -&gt; TCState -&gt; f TCState
Lens' TCState [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-var">stTCWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; [TCWarning] -&gt; [TCWarning]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681669417"><span class="hs-identifier hs-var">warnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span>    </span><span id="local-6989586621681669450"><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681669450"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO CheckResult -&gt; StateT CommandState TCM CheckResult
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO CheckResult -&gt; StateT CommandState TCM CheckResult)
-&gt; TCMT IO CheckResult -&gt; StateT CommandState TCM CheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Mode -&gt; Source -&gt; TCMT IO CheckResult
</span><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-var">Imp.typeCheckMain</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681669404"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681669416"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-comment">-- The module type checked. If the file was not changed while the</span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">-- type checker was running then the interaction points and the</span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-comment">-- &quot;current file&quot; are stored.</span><span>
</span><span id="line-935"></span><span>    </span><span id="local-6989586621681669451"><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669451"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ClockTime -&gt; StateT CommandState TCM ClockTime
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ClockTime -&gt; StateT CommandState TCM ClockTime)
-&gt; IO ClockTime -&gt; StateT CommandState TCM ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ClockTime
</span><span class="hs-identifier hs-var">getModificationTime</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669401"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669410"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ClockTime -&gt; ClockTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669451"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-937"></span><span>      </span><span id="local-6989586621681669452"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669452"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [InteractionId] -&gt; StateT CommandState TCM [InteractionId])
-&gt; TCM [InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; TCM [InteractionId]
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadError TCErr m, MonadFail m) =&gt;
[InteractionId] -&gt; m [InteractionId]
</span><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-var">sortInteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([InteractionId] -&gt; TCM [InteractionId])
-&gt; TCM [InteractionId] -&gt; TCM [InteractionId]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM [InteractionId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [InteractionId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-var">getInteractionPoints</span></a></span><span>
</span><span id="line-938"></span><span>      </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ())
-&gt; (CommandState -&gt; CommandState) -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681669454"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681669454"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621681669454"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681669452"><span class="hs-identifier hs-type">is</span></a></span><span>
</span><span id="line-939"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CurrentFile"><span class="hs-identifier hs-type">CurrentFile</span></a></span><span>
</span><span id="line-940"></span><span>                             </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681669406"><span class="hs-identifier hs-type">fp</span></a></span><span>
</span><span id="line-941"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681669416"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-942"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileArgs"><span class="hs-identifier hs-var">currentFileArgs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681669402"><span class="hs-identifier hs-type">argv</span></a></span><span>
</span><span id="line-943"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileStamp"><span class="hs-identifier hs-var">currentFileStamp</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681669410"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-944"></span><span>                             </span><span class="hs-special">}</span><span>
</span><span id="line-945"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span>    </span><span class="annot"><span class="annottext">CheckResult -&gt; CommandM a
</span><a href="#local-6989586621681669405"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621681669450"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="annot"><span class="hs-comment">-- | Set 'envCurrentPath' to 'theCurrentFile', if any.</span></span><span>
</span><span id="line-950"></span><span id="local-6989586621681669459"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-type">withCurrentFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681669459"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681669459"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-951"></span><span id="withCurrentFile"><span class="annot"><span class="annottext">withCurrentFile :: forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-var hs-var">withCurrentFile</span></a></span></span><span> </span><span id="local-6989586621681669464"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669464"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-952"></span><span>  </span><span id="local-6989586621681669465"><span class="annot"><span class="annottext">Maybe AbsolutePath
</span><a href="#local-6989586621681669465"><span class="hs-identifier hs-var">mfile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe AbsolutePath)
-&gt; StateT CommandState TCM (Maybe AbsolutePath)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; Maybe AbsolutePath)
 -&gt; StateT CommandState TCM (Maybe AbsolutePath))
-&gt; (CommandState -&gt; Maybe AbsolutePath)
-&gt; StateT CommandState TCM (Maybe AbsolutePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CurrentFile -&gt; AbsolutePath)
-&gt; Maybe CurrentFile -&gt; Maybe AbsolutePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CurrentFile -&gt; Maybe AbsolutePath)
-&gt; (CommandState -&gt; Maybe CurrentFile)
-&gt; CommandState
-&gt; Maybe AbsolutePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-953"></span><span>  </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv) -&gt; CommandM a -&gt; CommandM a
forall a.
(TCEnv -&gt; TCEnv)
-&gt; StateT CommandState TCM a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669466"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669466"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669466"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentPath"><span class="hs-identifier hs-var">envCurrentPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681669465"><span class="hs-identifier hs-type">mfile</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669464"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span id="local-6989586621681669467"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-type">atTopLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681669467"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681669467"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-956"></span><span id="atTopLevel"><span class="annot"><span class="annottext">atTopLevel :: forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var hs-var">atTopLevel</span></a></span></span><span> </span><span id="local-6989586621681669468"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669468"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
forall a. (forall a. TCM a -&gt; TCM a) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall a. TCM a -&gt; TCM a
</span><a href="Agda.Interaction.BasicOps.html#atTopLevel"><span class="hs-identifier hs-var">B.atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669468"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-959"></span><span class="hs-comment">-- Giving, refining.</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="hs-keyword">data</span><span> </span><span id="GiveRefine"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#GiveRefine"><span class="hs-identifier hs-var">GiveRefine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Give"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Refine"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Intro"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ElaborateGive"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-var">ElaborateGive</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669471"><span id="local-6989586621681669475"><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
(GiveRefine -&gt; GiveRefine -&gt; Bool)
-&gt; (GiveRefine -&gt; GiveRefine -&gt; Bool) -&gt; Eq GiveRefine
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: GiveRefine -&gt; GiveRefine -&gt; Bool
== :: GiveRefine -&gt; GiveRefine -&gt; Bool
$c/= :: GiveRefine -&gt; GiveRefine -&gt; Bool
/= :: GiveRefine -&gt; GiveRefine -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669479"><span id="local-6989586621681669485"><span id="local-6989586621681669489"><span class="annot"><span class="annottext">Int -&gt; GiveRefine -&gt; String -&gt; String
[GiveRefine] -&gt; String -&gt; String
GiveRefine -&gt; String
(Int -&gt; GiveRefine -&gt; String -&gt; String)
-&gt; (GiveRefine -&gt; String)
-&gt; ([GiveRefine] -&gt; String -&gt; String)
-&gt; Show GiveRefine
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; GiveRefine -&gt; String -&gt; String
showsPrec :: Int -&gt; GiveRefine -&gt; String -&gt; String
$cshow :: GiveRefine -&gt; String
show :: GiveRefine -&gt; String
$cshowList :: [GiveRefine] -&gt; String -&gt; String
showList :: [GiveRefine] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span class="hs-comment">-- | A &quot;give&quot;-like action (give, refine, etc).</span><span>
</span><span id="line-965"></span><span class="hs-comment">--</span><span>
</span><span id="line-966"></span><span class="hs-comment">--   @give_gen force ii rng s give_ref mk_newtxt@</span><span>
</span><span id="line-967"></span><span class="hs-comment">--   acts on interaction point @ii@</span><span>
</span><span id="line-968"></span><span class="hs-comment">--   occupying range @rng@,</span><span>
</span><span id="line-969"></span><span class="hs-comment">--   placing the new content given by string @s@,</span><span>
</span><span id="line-970"></span><span class="hs-comment">--   and replacing @ii@ by the newly created interaction points</span><span>
</span><span id="line-971"></span><span class="hs-comment">--   in the state if safety checks pass (unless @force@ is applied).</span><span>
</span><span id="line-972"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-type">give_gen</span></a></span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#UseForce"><span class="hs-identifier hs-type">UseForce</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Should safety checks be skipped?</span></span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>
</span><span id="line-976"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#GiveRefine"><span class="hs-identifier hs-type">GiveRefine</span></a></span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span id="give_gen"><span class="annot"><span class="annottext">give_gen :: UseForce
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; GiveRefine
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var hs-var">give_gen</span></a></span></span><span> </span><span id="local-6989586621681669492"><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621681669492"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621681669493"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621681669494"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669494"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669495"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669495"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621681669496"><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621681669496"><span class="hs-identifier hs-var">giveRefine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669497"><span class="annot"><span class="annottext">s :: String
</span><a href="#local-6989586621681669497"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669495"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-981"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT CommandState TCM ())
-&gt; String -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;give_gen  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669497"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-comment">-- Andreas, 2015-02-26 if string is empty do nothing rather</span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-comment">-- than giving a parse error.</span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669497"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-985"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669498"><span class="annot"><span class="annottext">give_ref :: UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="#local-6989586621681669498"><span class="hs-identifier hs-var hs-var">give_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-986"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621681669496"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-987"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#give"><span class="hs-identifier hs-var">B.give</span></a></span><span>
</span><span id="line-988"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#refine"><span class="hs-identifier hs-var">B.refine</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#refine"><span class="hs-identifier hs-var">B.refine</span></a></span><span>
</span><span id="line-990"></span><span>            </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-type">ElaborateGive</span></a></span><span> </span><span id="local-6989586621681669501"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669501"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
-&gt; UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#elaborate_give"><span class="hs-identifier hs-var">B.elaborate_give</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669501"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-comment">-- save scope of the interaction point (for printing the given expr. later)</span><span>
</span><span id="line-992"></span><span>    </span><span id="local-6989586621681669503"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681669503"><span class="hs-identifier hs-var">scope</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
forall (m :: * -&gt; *).
(MonadDebug m, MonadFail m, ReadTCState m, MonadError TCErr m,
 MonadTCEnv m) =&gt;
InteractionId -&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-var">getInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-comment">-- parse string and &quot;give&quot;, obtaining an abstract expression</span><span>
</span><span id="line-994"></span><span>    </span><span class="hs-comment">-- and newly created interaction points</span><span>
</span><span id="line-995"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681669504"><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681669504"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669505"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669505"><span class="hs-identifier hs-var">ae</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669506"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669506"><span class="hs-identifier hs-var">ae0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669507"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669507"><span class="hs-identifier hs-var">iis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandM (Expr, Expr, [InteractionId])
-&gt; CommandM (Maybe CPUTime, (Expr, Expr, [InteractionId]))
forall a. CommandM a -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-var">maybeTimed</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM (Expr, Expr, [InteractionId])
 -&gt; CommandM (Maybe CPUTime, (Expr, Expr, [InteractionId])))
-&gt; CommandM (Expr, Expr, [InteractionId])
-&gt; CommandM (Maybe CPUTime, (Expr, Expr, [InteractionId]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-996"></span><span>        </span><span class="hs-comment">-- Issue 3000: mark the current hole as solved before giving, to avoid confusing it with potential</span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-comment">-- new interaction points introduced by the give.</span><span>
</span><span id="line-998"></span><span>        </span><span class="annot"><span class="annottext">InteractionId -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadInteractionPoints m =&gt;
InteractionId -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#removeInteractionPoint"><span class="hs-identifier hs-var">removeInteractionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-999"></span><span>        </span><span id="local-6989586621681669509"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669509"><span class="hs-identifier hs-var">mis</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [InteractionId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-var">getInteractionPoints</span></a></span><span>
</span><span id="line-1000"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT CommandState TCM ())
-&gt; String -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction points before = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669509"><span class="hs-identifier hs-var">mis</span></a></span><span>
</span><span id="line-1001"></span><span>        </span><span id="local-6989586621681669510"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669510"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; CommandM Expr
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; CommandM Expr) -&gt; TCM Expr -&gt; CommandM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-var">B.parseExprIn</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669494"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669497"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1002"></span><span>        </span><span id="local-6989586621681669511"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669511"><span class="hs-identifier hs-var">ae</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; CommandM Expr
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; CommandM Expr) -&gt; TCM Expr -&gt; CommandM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Maybe Range -&gt; Expr -&gt; TCM Expr
</span><a href="#local-6989586621681669498"><span class="hs-identifier hs-var">give_ref</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621681669492"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669510"><span class="hs-identifier hs-var">given</span></a></span><span>
</span><span id="line-1003"></span><span>        </span><span id="local-6989586621681669512"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669512"><span class="hs-identifier hs-var">mis'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [InteractionId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-var">getInteractionPoints</span></a></span><span>
</span><span id="line-1004"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT CommandState TCM ())
-&gt; String -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction points after = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669512"><span class="hs-identifier hs-var">mis'</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><span class="annottext">(Expr, Expr, [InteractionId])
-&gt; CommandM (Expr, Expr, [InteractionId])
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669511"><span class="hs-identifier hs-var">ae</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669510"><span class="hs-identifier hs-var">given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669512"><span class="hs-identifier hs-var">mis'</span></a></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; [InteractionId] -&gt; [InteractionId]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">List.\\</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669509"><span class="hs-identifier hs-var">mis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>    </span><span class="hs-comment">-- favonia: backup the old scope for highlighting</span><span>
</span><span id="line-1007"></span><span>    </span><span class="annot"><span class="annottext">InteractionId -&gt; ScopeInfo -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681669503"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-comment">-- sort the new interaction points and put them into the state</span><span>
</span><span id="line-1009"></span><span>    </span><span class="hs-comment">-- in replacement of the old interaction point</span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621681669513"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669513"><span class="hs-identifier hs-var">iis'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadError TCErr m, MonadFail m) =&gt;
[InteractionId] -&gt; m [InteractionId]
</span><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-var">sortInteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669507"><span class="hs-identifier hs-var">iis</span></a></span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><span class="annottext">([InteractionId] -&gt; [InteractionId]) -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var">modifyTheInteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">(([InteractionId] -&gt; [InteractionId])
 -&gt; StateT CommandState TCM ())
-&gt; ([InteractionId] -&gt; [InteractionId])
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; [InteractionId] -&gt; [InteractionId] -&gt; [InteractionId]
forall {t :: * -&gt; *} {b}.
(Foldable t, Eq b) =&gt;
b -&gt; [b] -&gt; t b -&gt; [b]
</span><a href="#local-6989586621681669514"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669513"><span class="hs-identifier hs-var">iis'</span></a></span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-comment">-- print abstract expr</span><span>
</span><span id="line-1013"></span><span>    </span><span id="local-6989586621681669515"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669515"><span class="hs-identifier hs-var">ce</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Expr -&gt; StateT CommandState TCM (ConOfAbs Expr)
forall a (m :: * -&gt; *).
(ToConcrete a, MonadAbsToCon m) =&gt;
ScopeInfo -&gt; a -&gt; m (ConOfAbs a)
</span><a href="Agda.Syntax.Translation.AbstractToConcrete.html#abstractToConcreteScope"><span class="hs-identifier hs-var">abstractToConcreteScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681669503"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669505"><span class="hs-identifier hs-var">ae</span></a></span><span>
</span><span id="line-1014"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; [String] -&gt; StateT CommandState TCM ()
forall a (m :: * -&gt; *).
(ReportS a, MonadDebug m) =&gt;
String -&gt; Int -&gt; a -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; [String] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-var">reportS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span>
</span><span id="line-1015"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ce = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669515"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scopePrecedence = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PrecedenceStack -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681669503"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Lens' ScopeInfo PrecedenceStack -&gt; PrecedenceStack
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PrecedenceStack -&gt; f PrecedenceStack) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo PrecedenceStack
</span><a href="Agda.Syntax.Scope.Base.html#scopePrecedence"><span class="hs-identifier hs-var">scopePrecedence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-comment">-- if the command was @Give@, use the literal user input;</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-comment">-- Andreas, 2014-01-15, see issue 1020:</span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-comment">-- Refine could solve a goal by introducing the sole constructor</span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-comment">-- without arguments.  Then there are no interaction metas, but</span><span>
</span><span id="line-1022"></span><span>    </span><span class="hs-comment">-- we still cannot just `give' the user string (which may be empty).</span><span>
</span><span id="line-1023"></span><span>    </span><span class="hs-comment">-- WRONG: also, if no interaction metas were created by @Refine@</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-comment">-- WRONG: let literally = (giveRefine == Give || null iis) &amp;&amp; rng /= noRange</span><span>
</span><span id="line-1025"></span><span>    </span><span class="hs-comment">-- Ulf, 2015-03-30, if we're doing intro we can't do literal give since</span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-comment">-- there is nothing in the hole (issue 1892).</span><span>
</span><span id="line-1027"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669522"><span class="annot"><span class="annottext">literally :: Bool
</span><a href="#local-6989586621681669522"><span class="hs-identifier hs-var hs-var">literally</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621681669496"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621681669496"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669505"><span class="hs-identifier hs-var">ae</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669506"><span class="hs-identifier hs-var">ae0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669494"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">Range -&gt; Range -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-1028"></span><span>    </span><span class="hs-comment">-- Ulf, 2014-01-24: This works for give since we're highlighting the string</span><span>
</span><span id="line-1029"></span><span>    </span><span class="hs-comment">-- that's already in the buffer. Doing it before the give action means that</span><span>
</span><span id="line-1030"></span><span>    </span><span class="hs-comment">-- the highlighting is moved together with the text when the hole goes away.</span><span>
</span><span id="line-1031"></span><span>    </span><span class="hs-comment">-- To make it work for refine we'd have to adjust the ranges.</span><span>
</span><span id="line-1032"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669522"><span class="hs-identifier hs-var">literally</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1033"></span><span>      </span><span id="local-6989586621681669524"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681669524"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681669524"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; HighlightingLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#None"><span class="hs-identifier hs-var">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM () -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1035"></span><span>        </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; TCM ()) -&gt; TCMT IO HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span>
</span><span id="line-1036"></span><span>          </span><span class="annot"><span class="annottext">Range -&gt; String -&gt; TCMT IO HighlightingInfo
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromString"><span class="hs-identifier hs-var">generateTokenInfoFromString</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669494"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669497"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1037"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-var">highlightExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669505"><span class="hs-identifier hs-var">ae</span></a></span><span>
</span><span id="line-1038"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; GiveResult -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GiveResult
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-var">Resp_GiveAction</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669493"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(GiveResult -&gt; Response) -&gt; GiveResult -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Expr -&gt; GiveResult
</span><a href="#local-6989586621681669525"><span class="hs-identifier hs-var">mkNewTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669522"><span class="hs-identifier hs-var">literally</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669515"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-1039"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT CommandState TCM ())
-&gt; String -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;putResponse GiveAction passed&quot;</span></span><span>
</span><span id="line-1040"></span><span>    </span><span class="hs-comment">-- display new goal set (if not measuring time)</span><span>
</span><span id="line-1041"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
-&gt; (CPUTime -&gt; StateT CommandState TCM ())
-&gt; Maybe CPUTime
-&gt; StateT CommandState TCM ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interaction' Range -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range -&gt; StateT CommandState TCM ())
-&gt; Interaction' Range -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Interaction' Range
forall range. Rewrite -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-var">Cmd_metas</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; (CPUTime
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; CPUTime
-&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CPUTime
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CPUTime
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Time"><span class="hs-identifier hs-var">Info_Time</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe CPUTime
</span><a href="#local-6989586621681669504"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-1042"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT CommandState TCM ())
-&gt; String -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interpret Cmd_metas passed&quot;</span></span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1044"></span><span>    </span><span class="hs-comment">-- Substitutes xs for x in ys.</span><span>
</span><span id="line-1045"></span><span>    </span><span id="local-6989586621681669514"><span class="annot"><span class="annottext">replace :: b -&gt; [b] -&gt; t b -&gt; [b]
</span><a href="#local-6989586621681669514"><span class="hs-identifier hs-var hs-var">replace</span></a></span></span><span> </span><span id="local-6989586621681669530"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681669530"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681669531"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621681669531"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621681669532"><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621681669532"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; [b]) -&gt; t b -&gt; [b]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669534"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681669534"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681669534"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681669530"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621681669531"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681669534"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621681669532"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-1046"></span><span>    </span><span class="hs-comment">-- For @Give@ we can replace the ii by the user given input.</span><span>
</span><span id="line-1047"></span><span>    </span><span id="local-6989586621681669525"><span class="annot"><span class="annottext">mkNewTxt :: Bool -&gt; Expr -&gt; GiveResult
</span><a href="#local-6989586621681669525"><span class="hs-identifier hs-var hs-var">mkNewTxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Paren"><span class="hs-identifier hs-type">C.Paren</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_Paren"><span class="hs-identifier hs-var">Give_Paren</span></a></span><span>
</span><span id="line-1048"></span><span>    </span><span class="annot"><a href="#local-6989586621681669525"><span class="hs-identifier hs-var">mkNewTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_NoParen"><span class="hs-identifier hs-var">Give_NoParen</span></a></span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-comment">-- Otherwise, we replace it by the reified value Agda computed.</span><span>
</span><span id="line-1050"></span><span>    </span><span class="annot"><a href="#local-6989586621681669525"><span class="hs-identifier hs-var">mkNewTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621681669540"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669540"><span class="hs-identifier hs-var">ce</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-var">Give_String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; GiveResult) -&gt; String -&gt; GiveResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669540"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-type">highlightExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1053"></span><span id="highlightExpr"><span class="annot"><span class="annottext">highlightExpr :: Expr -&gt; TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-var hs-var">highlightExpr</span></a></span></span><span> </span><span id="local-6989586621681669542"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669542"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>  </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv) -&gt; TCM () -&gt; TCM ()
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681669543"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669543"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681669543"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envImportPath"><span class="hs-identifier hs-var">envImportPath</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1055"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span>
</span><span id="line-1056"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingMethod"><span class="hs-identifier hs-var">envHighlightingMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Direct"><span class="hs-identifier hs-type">Direct</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1057"></span><span>    </span><span class="annot"><span class="annottext">Declaration -&gt; Level -&gt; Bool -&gt; TCM ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateAndPrintSyntaxInfo"><span class="hs-identifier hs-var">generateAndPrintSyntaxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621681669547"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="Agda.Interaction.Highlighting.Generate.html#Full"><span class="hs-identifier hs-var">Full</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1059"></span><span>    </span><span id="local-6989586621681669553"><span class="annot"><span class="annottext">dummy :: Name
</span><a href="#local-6989586621681669553"><span class="hs-identifier hs-var hs-var">dummy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameId -&gt; String -&gt; Name
forall a. MkName a =&gt; NameId -&gt; a -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#mkName_"><span class="hs-identifier hs-var">mkName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ModuleNameHash -&gt; NameId
</span><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-var">NameId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#noModuleNameHash"><span class="hs-identifier hs-var">noModuleNameHash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dummy&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621681669557"><span class="annot"><span class="annottext">info :: DefInfo' Expr
</span><a href="#local-6989586621681669557"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo' Expr
forall t.
Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo' t
</span><a href="Agda.Syntax.Info.html#mkDefInfo"><span class="hs-identifier hs-var">mkDefInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681669553"><span class="hs-identifier hs-var">dummy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="Agda.Syntax.Common.html#noFixity%27"><span class="hs-identifier hs-var">noFixity'</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="Agda.Syntax.Common.html#PublicAccess"><span class="hs-identifier hs-var">PublicAccess</span></a></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669542"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621681669547"><span class="annot"><span class="annottext">decl :: Declaration
</span><a href="#local-6989586621681669547"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindOfName
-&gt; DefInfo' Expr
-&gt; ArgInfo
-&gt; Maybe [Occurrence]
-&gt; QName
-&gt; Expr
-&gt; Declaration
</span><a href="Agda.Syntax.Abstract.html#Axiom"><span class="hs-identifier hs-var">A.Axiom</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#OtherDefName"><span class="hs-identifier hs-var">OtherDefName</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo' Expr
</span><a href="#local-6989586621681669557"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Occurrence]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameFromList"><span class="hs-identifier hs-var">qnameFromList</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 Name -&gt; QName) -&gt; List1 Name -&gt; QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; List1 Name
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681669553"><span class="hs-identifier hs-var">dummy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669542"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span class="annot"><span class="hs-comment">-- | Sorts interaction points based on their ranges.</span></span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span id="local-6989586621681667500"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-type">sortInteractionPoints</span></a></span><span>
</span><span id="line-1066"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadInteractionPoints"><span class="hs-identifier hs-type">MonadInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667500"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667500"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621681667500"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1067"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681667500"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1068"></span><span id="sortInteractionPoints"><span class="annot"><span class="annottext">sortInteractionPoints :: forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadError TCErr m, MonadFail m) =&gt;
[InteractionId] -&gt; m [InteractionId]
</span><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-var hs-var">sortInteractionPoints</span></a></span></span><span> </span><span id="local-6989586621681669587"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669587"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1069"></span><span>  </span><span class="annot"><span class="annottext">((InteractionId, Range) -&gt; InteractionId)
-&gt; [(InteractionId, Range)] -&gt; [InteractionId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, Range) -&gt; InteractionId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(InteractionId, Range)] -&gt; [InteractionId])
-&gt; ([(InteractionId, Range)] -&gt; [(InteractionId, Range)])
-&gt; [(InteractionId, Range)]
-&gt; [InteractionId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((InteractionId, Range) -&gt; (InteractionId, Range) -&gt; Ordering)
-&gt; [(InteractionId, Range)] -&gt; [(InteractionId, Range)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Range -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Range -&gt; Ordering)
-&gt; ((InteractionId, Range) -&gt; Range)
-&gt; (InteractionId, Range)
-&gt; (InteractionId, Range)
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, Range) -&gt; Range
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(InteractionId, Range)] -&gt; [InteractionId])
-&gt; m [(InteractionId, Range)] -&gt; m [InteractionId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>    </span><span class="annot"><span class="annottext">[InteractionId]
-&gt; (InteractionId -&gt; m (InteractionId, Range))
-&gt; m [(InteractionId, Range)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621681669587"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">((InteractionId -&gt; m (InteractionId, Range))
 -&gt; m [(InteractionId, Range)])
-&gt; (InteractionId -&gt; m (InteractionId, Range))
-&gt; m [(InteractionId, Range)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669591"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669591"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669591"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Range -&gt; (InteractionId, Range))
-&gt; m Range -&gt; m (InteractionId, Range)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; m Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadFail m, MonadError TCErr m) =&gt;
InteractionId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionRange"><span class="hs-identifier hs-var">getInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669591"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span class="hs-comment">-- | Displays the current goal, the given document, and the current</span><span>
</span><span id="line-1074"></span><span class="hs-comment">--   context.</span><span>
</span><span id="line-1075"></span><span class="hs-comment">--</span><span>
</span><span id="line-1076"></span><span class="hs-comment">--   Should not modify the state.</span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-type">cmd_goal_type_context_and</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalTypeAux"><span class="hs-identifier hs-type">GoalTypeAux</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1079"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span id="cmd_goal_type_context_and"><span class="annot"><span class="annottext">cmd_goal_type_context_and :: GoalTypeAux
-&gt; Rewrite
-&gt; InteractionId
-&gt; Range
-&gt; String
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-var hs-var">cmd_goal_type_context_and</span></a></span></span><span> </span><span id="local-6989586621681669592"><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="#local-6989586621681669592"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621681669593"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669593"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669594"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669594"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1081"></span><span>  </span><span id="local-6989586621681669595"><span class="annot"><span class="annottext">[ResponseContextEntry]
</span><a href="#local-6989586621681669595"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [ResponseContextEntry]
 -&gt; StateT CommandState TCM [ResponseContextEntry])
-&gt; TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; InteractionId -&gt; TCM [ResponseContextEntry]
</span><a href="Agda.Interaction.BasicOps.html#getResponseContext"><span class="hs-identifier hs-var">B.getResponseContext</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669593"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669594"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1082"></span><span>  </span><span id="local-6989586621681669596"><span class="annot"><span class="annottext">[OutputForm_boot TCErr Expr Expr]
</span><a href="#local-6989586621681669596"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [OutputForm_boot TCErr Expr Expr]
 -&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr])
-&gt; TCM [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO MetaId
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
InteractionId -&gt; m MetaId
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupInteractionId"><span class="hs-identifier hs-var">lookupInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669594"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO MetaId
-&gt; (MetaId -&gt; TCM [OutputForm_boot TCErr Expr Expr])
-&gt; TCM [OutputForm_boot TCErr Expr Expr]
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; MetaId -&gt; TCM [OutputForm_boot TCErr Expr Expr]
</span><a href="Agda.Interaction.BasicOps.html#getConstraintsMentioning"><span class="hs-identifier hs-var">B.getConstraintsMentioning</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669593"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-1083"></span><span>  </span><span id="local-6989586621681669599"><span class="annot"><span class="annottext">[IPFace' Expr]
</span><a href="#local-6989586621681669599"><span class="hs-identifier hs-var">boundary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [IPFace' Expr] -&gt; StateT CommandState TCM [IPFace' Expr]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [IPFace' Expr] -&gt; StateT CommandState TCM [IPFace' Expr])
-&gt; TCMT IO [IPFace' Expr] -&gt; StateT CommandState TCM [IPFace' Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; InteractionId -&gt; TCMT IO [IPFace' Expr]
</span><a href="Agda.Interaction.BasicOps.html#getIPBoundary"><span class="hs-identifier hs-var">B.getIPBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669593"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669594"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1084"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621681669594"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite
-&gt; GoalTypeAux
-&gt; [ResponseContextEntry]
-&gt; [IPFace' Expr]
-&gt; [OutputForm_boot TCErr Expr Expr]
-&gt; GoalDisplayInfo_boot TCErr
forall tcErr.
Rewrite
-&gt; GoalTypeAux
-&gt; [ResponseContextEntry]
-&gt; [IPFace' Expr]
-&gt; [OutputForm_boot tcErr Expr Expr]
-&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_GoalType"><span class="hs-identifier hs-var">Goal_GoalType</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669593"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="#local-6989586621681669592"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">[ResponseContextEntry]
</span><a href="#local-6989586621681669595"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">[IPFace' Expr]
</span><a href="#local-6989586621681669599"><span class="hs-identifier hs-var">boundary</span></a></span><span> </span><span class="annot"><span class="annottext">[OutputForm_boot TCErr Expr Expr]
</span><a href="#local-6989586621681669596"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span class="hs-comment">-- | Shows all the top-level names in the given module, along with</span><span>
</span><span id="line-1087"></span><span class="hs-comment">-- their types.</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-type">showModuleContents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span id="showModuleContents"><span class="annot"><span class="annottext">showModuleContents :: Rewrite -&gt; Range -&gt; String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-var hs-var">showModuleContents</span></a></span></span><span> </span><span id="local-6989586621681669602"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669602"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669603"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669603"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621681669604"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669604"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681669605"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681669605"><span class="hs-identifier hs-var">modules</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669606"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621681669606"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669607"><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621681669607"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ([Name], Telescope, [(Name, Type)])
-&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)])
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO ([Name], Telescope, [(Name, Type)])
 -&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)]))
-&gt; TCMT IO ([Name], Telescope, [(Name, Type)])
-&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
-&gt; Range -&gt; String -&gt; TCMT IO ([Name], Telescope, [(Name, Type)])
</span><a href="Agda.Interaction.BasicOps.html#moduleContents"><span class="hs-identifier hs-var">B.moduleContents</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669602"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669603"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669604"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1092"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; Telescope
-&gt; [(Name, Type)]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[Name]
-&gt; Telescope
-&gt; [(Name, Type)]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_ModuleContents"><span class="hs-identifier hs-var">Info_ModuleContents</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681669605"><span class="hs-identifier hs-var">modules</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621681669606"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621681669607"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- | Shows all the top-level names in scope which mention all the given</span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- identifiers in their type.</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-type">searchAbout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1098"></span><span id="searchAbout"><span class="annot"><span class="annottext">searchAbout :: Rewrite -&gt; Range -&gt; String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-var hs-var">searchAbout</span></a></span></span><span> </span><span id="local-6989586621681669610"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669610"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621681669611"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669611"><span class="hs-identifier hs-var">rg</span></a></span></span><span> </span><span id="local-6989586621681669612"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669612"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; (String -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669612"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((String -&gt; StateT CommandState TCM ())
 -&gt; StateT CommandState TCM ())
-&gt; (String -&gt; StateT CommandState TCM ())
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681669614"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669614"><span class="hs-identifier hs-var">trimmedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1100"></span><span>    </span><span id="local-6989586621681669615"><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621681669615"><span class="hs-identifier hs-var">hits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)])
-&gt; TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; TCMT IO [(Name, Type)]
</span><a href="Agda.Interaction.SearchAbout.html#findMentions"><span class="hs-identifier hs-var">findMentions</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621681669610"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669611"><span class="hs-identifier hs-var">rg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669614"><span class="hs-identifier hs-var">trimmedNames</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
-&gt; String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[(Name, Type)]
-&gt; String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_SearchAbout"><span class="hs-identifier hs-var">Info_SearchAbout</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621681669615"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669614"><span class="hs-identifier hs-var">trimmedNames</span></a></span><span>
</span><span id="line-1102"></span><span>
</span><span id="line-1103"></span><span class="annot"><span class="hs-comment">-- | Explain why something is in scope.</span></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-type">whyInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span id="whyInScope"><span class="annot"><span class="annottext">whyInScope :: String -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var hs-var">whyInScope</span></a></span></span><span> </span><span id="local-6989586621681669618"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669618"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1107"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681669619"><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669619"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681669620"><span class="annot"><span class="annottext">cwd :: String
</span><a href="#local-6989586621681669620"><span class="hs-identifier hs-var hs-var">cwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; String) -&gt; AbsolutePath -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669619"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span>  </span><span id="local-6989586621681669622"><span class="annot"><span class="annottext">WhyInScopeData
</span><a href="#local-6989586621681669622"><span class="hs-identifier hs-var">why</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM WhyInScopeData -&gt; CommandM WhyInScopeData
forall a. TCM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM WhyInScopeData -&gt; CommandM WhyInScopeData)
-&gt; TCM WhyInScopeData -&gt; CommandM WhyInScopeData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; TCM WhyInScopeData
</span><a href="Agda.Interaction.BasicOps.html#whyInScope"><span class="hs-identifier hs-var">B.whyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669620"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669618"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1110"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; StateT CommandState TCM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WhyInScopeData
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
WhyInScopeData
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_WhyInScope"><span class="hs-identifier hs-var">Info_WhyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">WhyInScopeData
</span><a href="#local-6989586621681669622"><span class="hs-identifier hs-var">why</span></a></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span class="annot"><span class="hs-comment">-- | Sets the command line options and updates the status information.</span></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#CommandLineOptions"><span class="hs-identifier hs-type">CommandLineOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span id="setCommandLineOpts"><span class="annot"><span class="annottext">setCommandLineOpts :: CommandLineOptions -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var hs-var">setCommandLineOpts</span></a></span></span><span> </span><span id="local-6989586621681669625"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669625"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1116"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">TCM.setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681669625"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-1117"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span class="hs-comment">-- | Computes some status information.</span><span>
</span><span id="line-1121"></span><span class="hs-comment">--</span><span>
</span><span id="line-1122"></span><span class="hs-comment">--   Does not change the state.</span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span>
</span><span id="line-1125"></span><span id="status"><span class="annot"><span class="annottext">status :: CommandM Status
</span><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1126"></span><span>  </span><span id="local-6989586621681669627"><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681669627"><span class="hs-identifier hs-var">cf</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-1127"></span><span>  </span><span id="local-6989586621681669628"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669628"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#showImplicitArguments"><span class="hs-identifier hs-var">showImplicitArguments</span></a></span><span>
</span><span id="line-1128"></span><span>  </span><span id="local-6989586621681669630"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669630"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#showIrrelevantArguments"><span class="hs-identifier hs-var">showIrrelevantArguments</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span>  </span><span class="hs-comment">-- Check if the file was successfully type checked, and has not</span><span>
</span><span id="line-1131"></span><span>  </span><span class="hs-comment">-- changed since. Note: This code does not check if any dependencies</span><span>
</span><span id="line-1132"></span><span>  </span><span class="hs-comment">-- have changed, and uses a time stamp to check for changes.</span><span>
</span><span id="line-1133"></span><span>  </span><span id="local-6989586621681669632"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669632"><span class="hs-identifier hs-var">checked</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CurrentFile
</span><a href="#local-6989586621681669627"><span class="hs-identifier hs-var">cf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1134"></span><span>    </span><span class="annot"><span class="annottext">Maybe CurrentFile
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681669633"><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669633"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1136"></span><span>      </span><span id="local-6989586621681669634"><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669634"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ClockTime -&gt; TCMT IO ClockTime
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ClockTime -&gt; TCMT IO ClockTime)
-&gt; IO ClockTime -&gt; TCMT IO ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ClockTime
</span><span class="hs-identifier hs-var">getModificationTime</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ClockTime) -&gt; String -&gt; IO ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669633"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; ClockTime
</span><a href="Agda.Interaction.Base.html#currentFileStamp"><span class="hs-identifier hs-var">currentFileStamp</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669633"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ClockTime -&gt; ClockTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ClockTime
</span><a href="#local-6989586621681669634"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1138"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-1139"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; (ModuleInfo -&gt; Bool) -&gt; Maybe ModuleInfo -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; Bool)
-&gt; (ModuleInfo -&gt; [TCWarning]) -&gt; ModuleInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ModuleInfo -&gt; Bool)
-&gt; TCMT IO (Maybe ModuleInfo) -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1140"></span><span>          </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO (Maybe ModuleInfo)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
TopLevelModuleName -&gt; m (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-var">getVisitedModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621681669633"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1142"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>  </span><span class="annot"><span class="annottext">Status -&gt; CommandM Status
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; CommandM Status) -&gt; Status -&gt; CommandM Status
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sShowImplicitArguments :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sShowImplicitArguments"><span class="hs-identifier hs-var">sShowImplicitArguments</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669628"><span class="hs-identifier hs-var">showImpl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1145"></span><span>                    </span><span class="annot"><span class="annottext">sShowIrrelevantArguments :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sShowIrrelevantArguments"><span class="hs-identifier hs-var">sShowIrrelevantArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669630"><span class="hs-identifier hs-var">showIrr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1146"></span><span>                    </span><span class="annot"><span class="annottext">sChecked :: Bool
</span><a href="Agda.Interaction.Response.Base.html#sChecked"><span class="hs-identifier hs-var">sChecked</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669632"><span class="hs-identifier hs-var">checked</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="hs-comment">-- | Displays or updates status information.</span><span>
</span><span id="line-1149"></span><span class="hs-comment">--</span><span>
</span><span id="line-1150"></span><span class="hs-comment">--   Does not change the state.</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-type">displayStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span id="displayStatus"><span class="annot"><span class="annottext">displayStatus :: StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var hs-var">displayStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1154"></span><span>  </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; (Status -&gt; Response) -&gt; Status -&gt; StateT CommandState TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Status -&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_Status"><span class="hs-identifier hs-var">Resp_Status</span></a></span><span>  </span><span class="annot"><span class="annottext">(Status -&gt; StateT CommandState TCM ())
-&gt; CommandM Status -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CommandM Status
</span><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span class="hs-comment">-- | @display_info@ does what @'display_info'' False@ does, but</span><span>
</span><span id="line-1157"></span><span class="hs-comment">--   additionally displays some status information (see 'status' and</span><span>
</span><span id="line-1158"></span><span class="hs-comment">--   'displayStatus').</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#DisplayInfo"><span class="hs-identifier hs-type">DisplayInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span id="display_info"><span class="annot"><span class="annottext">display_info :: DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var hs-var">display_info</span></a></span></span><span> </span><span id="local-6989586621681669637"><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621681669637"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>  </span><span class="annot"><span class="annottext">StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-1163"></span><span>  </span><span class="annot"><span class="annottext">Response -&gt; StateT CommandState TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; StateT CommandState TCM ())
-&gt; Response -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DisplayInfo"><span class="hs-identifier hs-var">Resp_DisplayInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621681669637"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span class="hs-comment">-- | Parses and scope checks an expression (using the \&quot;inside scope\&quot;</span><span>
</span><span id="line-1166"></span><span class="hs-comment">-- as the scope), performs the given command with the expression as</span><span>
</span><span id="line-1167"></span><span class="hs-comment">-- input, and returns the result and the time it takes.</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span id="local-6989586621681667323"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-type">parseAndDoAtToplevel</span></a></span><span>
</span><span id="line-1170"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667323"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1171"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The command to perform.</span></span><span>
</span><span id="line-1172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1173"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The expression to parse.</span></span><span>
</span><span id="line-1174"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Time.html#CPUTime"><span class="hs-identifier hs-type">CPUTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681667323"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1175"></span><span id="parseAndDoAtToplevel"><span class="annot"><span class="annottext">parseAndDoAtToplevel :: forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var hs-var">parseAndDoAtToplevel</span></a></span></span><span> </span><span id="local-6989586621681669648"><span class="annot"><span class="annottext">Expr -&gt; TCM a
</span><a href="#local-6989586621681669648"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621681669649"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669649"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1176"></span><span>  </span><span class="annot"><span class="annottext">CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a)
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#localStateCommandM"><span class="hs-identifier hs-var">localStateCommandM</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a))
-&gt; CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1177"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681669650"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669650"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669651"><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681669651"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Expr, Attributes)
-&gt; StateT CommandState TCM (Expr, Attributes)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Expr, Attributes)
 -&gt; StateT CommandState TCM (Expr, Attributes))
-&gt; TCM (Expr, Attributes)
-&gt; StateT CommandState TCM (Expr, Attributes)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PM (Expr, Attributes) -&gt; TCM (Expr, Attributes)
forall a. PM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Warnings.html#runPM"><span class="hs-identifier hs-var">runPM</span></a></span><span> </span><span class="annot"><span class="annottext">(PM (Expr, Attributes) -&gt; TCM (Expr, Attributes))
-&gt; PM (Expr, Attributes) -&gt; TCM (Expr, Attributes)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser Expr -&gt; String -&gt; PM (Expr, Attributes)
forall a. Parser a -&gt; String -&gt; PM (a, Attributes)
</span><a href="Agda.Syntax.Parser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Expr
</span><a href="Agda.Syntax.Parser.html#exprParser"><span class="hs-identifier hs-var">exprParser</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681669649"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1178"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; StateT CommandState TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; StateT CommandState TCM ())
-&gt; TCM () -&gt; StateT CommandState TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attributes -&gt; TCM ()
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#checkAttributes"><span class="hs-identifier hs-var">checkAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681669651"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-1179"></span><span>    </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM (Maybe CPUTime, a)
forall a. CommandM a -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-var">maybeTimed</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; CommandM (Maybe CPUTime, a))
-&gt; CommandM a -&gt; CommandM (Maybe CPUTime, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; CommandM a) -&gt; CommandM a -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; CommandM a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; CommandM a) -&gt; TCM a -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1180"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; TCM a
</span><a href="#local-6989586621681669648"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM a) -&gt; TCM Expr -&gt; TCM a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeM (AbsOfCon Expr)
forall c. ToAbstract c =&gt; c -&gt; ScopeM (AbsOfCon c)
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier hs-var">concreteToAbstract_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621681669650"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span id="local-6989586621681667388"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-type">maybeTimed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681667388"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Time.html#CPUTime"><span class="hs-identifier hs-type">CPUTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681667388"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1183"></span><span id="maybeTimed"><span class="annot"><span class="annottext">maybeTimed :: forall a. CommandM a -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-var hs-var">maybeTimed</span></a></span></span><span> </span><span id="local-6989586621681669664"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669664"><span class="hs-identifier hs-var">work</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1184"></span><span>  </span><span id="local-6989586621681669665"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669665"><span class="hs-identifier hs-var">doTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Debug.html#hasProfileOption"><span class="hs-identifier hs-var">hasProfileOption</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Utils.ProfileOptions.html#Interactive"><span class="hs-identifier hs-var">Profile.Interactive</span></a></span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681669665"><span class="hs-identifier hs-var">doTime</span></a></span><span>
</span><span id="line-1186"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CPUTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (Maybe CPUTime, a))
-&gt; CommandM a -&gt; CommandM (Maybe CPUTime, a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669664"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-1187"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1188"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681669668"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669668"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669669"><span class="annot"><span class="annottext">CPUTime
</span><a href="#local-6989586621681669669"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; StateT CommandState TCM (a, CPUTime)
forall (m :: * -&gt; *) a. MonadIO m =&gt; m a -&gt; m (a, CPUTime)
</span><a href="Agda.Utils.Time.html#measureTime"><span class="hs-identifier hs-var">measureTime</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621681669664"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-1189"></span><span>      </span><span class="annot"><span class="annottext">(Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a)
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CPUTime -&gt; Maybe CPUTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CPUTime
</span><a href="#local-6989586621681669669"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681669668"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span class="hs-comment">-- | Tell to highlight the code using the given highlighting</span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- info (unless it is @Nothing@).</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-type">tellToUpdateHighlighting</span></a></span><span>
</span><span id="line-1195"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html#HighlightingInfo"><span class="hs-identifier hs-type">HighlightingInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HighlightingMethod"><span class="hs-identifier hs-type">HighlightingMethod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleToSource"><span class="hs-identifier hs-type">ModuleToSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1196"></span><span id="tellToUpdateHighlighting"><span class="annot"><span class="annottext">tellToUpdateHighlighting :: Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; IO [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-var hs-var">tellToUpdateHighlighting</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response] -&gt; IO [Response]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1197"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-var">tellToUpdateHighlighting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681669671"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681669671"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669672"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681669672"><span class="hs-identifier hs-var">method</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681669673"><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681669673"><span class="hs-identifier hs-var">modFile</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1198"></span><span>  </span><span class="annot"><span class="annottext">[Response] -&gt; IO [Response]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_HighlightingInfo"><span class="hs-identifier hs-var">Resp_HighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681669671"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621681669672"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621681669673"><span class="hs-identifier hs-var">modFile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span class="annot"><span class="hs-comment">-- | Tells the Emacs mode to go to the first error position (if any).</span></span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-type">tellEmacsToJumpToError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1203"></span><span id="tellEmacsToJumpToError"><span class="annot"><span class="annottext">tellEmacsToJumpToError :: Range -&gt; [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-var hs-var">tellEmacsToJumpToError</span></a></span></span><span> </span><span id="local-6989586621681669674"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669674"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1204"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Maybe (Position' (Maybe RangeFile))
forall a. Range' a -&gt; Maybe (Position' a)
</span><a href="Agda.Syntax.Position.html#rStart"><span class="hs-identifier hs-var">rStart</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681669674"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1205"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Position' (Maybe RangeFile))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1206"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#Pn"><span class="hs-identifier hs-type">Pn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">srcFile :: forall a. Position' a -&gt; a
</span><a href="Agda.Syntax.Position.html#srcFile"><span class="hs-identifier hs-var">srcFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RangeFile
</span><span class="hs-identifier hs-var">Strict.Nothing</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1207"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#Pn"><span class="hs-identifier hs-type">Pn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">srcFile :: forall a. Position' a -&gt; a
</span><a href="Agda.Syntax.Position.html#srcFile"><span class="hs-identifier hs-var">srcFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.Just</span></span><span> </span><span id="local-6989586621681669680"><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621681669680"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">posPos :: forall a. Position' a -&gt; Int32
</span><a href="Agda.Syntax.Position.html#posPos"><span class="hs-identifier hs-var">posPos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681669682"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621681669682"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1208"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int32 -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; Int32 -&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_JumpToError"><span class="hs-identifier hs-var">Resp_JumpToError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RangeFile -&gt; AbsolutePath
</span><a href="Agda.Syntax.Position.html#rangeFilePath"><span class="hs-identifier hs-var">rangeFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621681669680"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621681669682"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1209"></span></pre></body></html>