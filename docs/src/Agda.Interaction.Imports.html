<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecursiveDo #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{-| This module deals with finding imported modules and loading their
    interface files.
-}</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.Interaction.Imports</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier">Mode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier">ScopeCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier">TypeCheck</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier">CheckResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier">CheckResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier">crModuleInfo</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crInterface"><span class="hs-identifier">crInterface</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier">crWarnings</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crMode"><span class="hs-identifier">crMode</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crSource"><span class="hs-identifier">crSource</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier">Source</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#scopeCheckImport"><span class="hs-identifier">scopeCheckImport</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier">parseSource</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier">typeCheckMain</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-comment">-- Currently only used by test/api/Issue1168.hs:</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier">readInterface</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>               </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">void</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 808
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MonadFail</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">removeFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Attribute.html"><span class="hs-identifier">Agda.Syntax.Concrete.Attribute</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html"><span class="hs-identifier">Agda.Syntax.Parser</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.ConcreteToAbstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CToA</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Errors.html"><span class="hs-identifier">Agda.TypeChecking.Errors</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warnings"><span class="hs-identifier">warnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.Confluence</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier">checkConfluenceOfRules</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#openMetasToPostulates"><span class="hs-identifier">openMetasToPostulates</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html"><span class="hs-identifier">Agda.TypeChecking.Serialise</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html"><span class="hs-identifier">Agda.TypeChecking.DeadCode</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TheTypeChecker.html"><span class="hs-identifier">Agda.TheTypeChecker</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html"><span class="hs-identifier">Agda.Interaction.BasicOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getGoals"><span class="hs-identifier">getGoals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#showGoals"><span class="hs-identifier">showGoals</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html"><span class="hs-identifier">Agda.Interaction.FindFile</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Precise</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier">convert</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Vim.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Vim</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.html"><span class="hs-identifier">Agda.Interaction.Library</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html"><span class="hs-identifier">Agda.Interaction.Options.Lenses</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Warnings.html"><span class="hs-identifier">Agda.Interaction.Options.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Warnings.html#unsolvedWarnings"><span class="hs-identifier">unsolvedWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#RemoveTokenBasedHighlighting"><span class="hs-identifier">RemoveTokenBasedHighlighting</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier">KeepHighlighting</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html"><span class="hs-identifier">Agda.Utils.FileName</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.Strict.html"><span class="hs-identifier">Agda.Utils.Maybe.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IO.Binary.html"><span class="hs-identifier">Agda.Utils.IO.Binary</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Mode</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.ProfileOptions.html"><span class="hs-identifier">Agda.Utils.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html"><span class="hs-identifier">Agda.Utils.Hash</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Trie.html"><span class="hs-identifier">Agda.Utils.Trie</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trie</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-comment">-- | Whether to ignore interfaces (@.agdai@) other than built-in modules</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621681653184"><span class="annot"><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-type">ignoreInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681653184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681653184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-111"></span><span id="ignoreInterfaces"><span class="annot"><span class="annottext">ignoreInterfaces :: forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-var hs-var">ignoreInterfaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optIgnoreInterfaces"><span class="hs-identifier hs-var">optIgnoreInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool) -&gt; m CommandLineOptions -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><span class="hs-comment">-- | Whether to ignore all interface files (@.agdai@)</span></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span id="local-6989586621681654750"><span class="annot"><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-type">ignoreAllInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681654750"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681654750"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-116"></span><span id="ignoreAllInterfaces"><span class="annot"><span class="annottext">ignoreAllInterfaces :: forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-var hs-var">ignoreAllInterfaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optIgnoreAllInterfaces"><span class="hs-identifier hs-var">optIgnoreAllInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool) -&gt; m CommandLineOptions -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><span class="hs-comment">-- | The decorated source code.</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">data</span><span> </span><span id="Source"><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-var">Source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Source"><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-var">Source</span></a></span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="srcText"><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var hs-var">srcText</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TL.Text</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Source code.</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcFileType"><span class="annot"><span class="annottext">Source -&gt; FileType
</span><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var hs-var">srcFileType</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#FileType"><span class="hs-identifier hs-type">FileType</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Source file type</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcOrigin"><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var hs-var">srcOrigin</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Source location at the time of its parsing</span></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcModule"><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var hs-var">srcModule</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Module"><span class="hs-identifier hs-type">C.Module</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ The parsed module.</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcModuleName"><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var hs-var">srcModuleName</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The top-level module name.</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcProjectLibs"><span class="annot"><span class="annottext">Source -&gt; [AgdaLibFile]
</span><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var hs-var">srcProjectLibs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#AgdaLibFile"><span class="hs-identifier hs-type">AgdaLibFile</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ The .agda-lib file(s) of the project this file belongs to.</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcAttributes"><span class="annot"><span class="annottext">Source -&gt; Attributes
</span><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var hs-var">srcAttributes</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.Syntax.Concrete.Attribute.html#Attributes"><span class="hs-identifier hs-type">Attributes</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Every encountered attribute.</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><span class="hs-comment">-- | Parses a source file and prepares the 'Source' record.</span></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">parseSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-134"></span><span id="parseSource"><span class="annot"><span class="annottext">parseSource :: SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var hs-var">parseSource</span></a></span></span><span> </span><span id="local-6989586621681654765"><span class="annot"><span class="annottext">sourceFile :: SourceFile
</span><a href="#local-6989586621681654765"><span class="hs-identifier hs-var">sourceFile</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span id="local-6989586621681654767"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681654767"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM Source -&gt; TCM Source
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Parsing"><span class="hs-identifier hs-var">Bench.Parsing</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM Source -&gt; TCM Source) -&gt; TCM Source -&gt; TCM Source
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681654770"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681654770"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654771"><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621681654771"><span class="hs-identifier hs-var">fileType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654772"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681654772"><span class="hs-identifier hs-var">parsedMod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654773"><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681654773"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654774"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654774"><span class="hs-identifier hs-var">parsedModName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- This piece of code uses mdo because the top-level module name</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- (parsedModName) is obtained from the parser's result, but it is</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- also used by the parser.</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681654775"><span class="annot"><span class="annottext">rf :: RangeFile
</span><a href="#local-6989586621681654775"><span class="hs-identifier hs-var hs-var">rf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe TopLevelModuleName -&gt; RangeFile
</span><a href="Agda.Syntax.Position.html#mkRangeFile"><span class="hs-identifier hs-var">mkRangeFile</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681654767"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654777"><span class="hs-identifier hs-var">parsedModName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621681654778"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681654778"><span class="hs-identifier hs-var">source</span></a></span></span><span>                         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PM Text -&gt; TCM Text
forall a. PM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Warnings.html#runPM"><span class="hs-identifier hs-var">runPM</span></a></span><span> </span><span class="annot"><span class="annottext">(PM Text -&gt; TCM Text) -&gt; PM Text -&gt; TCM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RangeFile -&gt; PM Text
</span><a href="Agda.Syntax.Parser.html#readFilePM"><span class="hs-identifier hs-var">readFilePM</span></a></span><span> </span><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621681654775"><span class="hs-identifier hs-var">rf</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681654781"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681654781"><span class="hs-identifier hs-var">parsedMod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654782"><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681654782"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654783"><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621681654783"><span class="hs-identifier hs-var">fileType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PM ((Module, Attributes), FileType)
-&gt; TCM ((Module, Attributes), FileType)
forall a. PM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Warnings.html#runPM"><span class="hs-identifier hs-var">runPM</span></a></span><span> </span><span class="annot"><span class="annottext">(PM ((Module, Attributes), FileType)
 -&gt; TCM ((Module, Attributes), FileType))
-&gt; PM ((Module, Attributes), FileType)
-&gt; TCM ((Module, Attributes), FileType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-142"></span><span>                                      </span><span class="annot"><span class="annottext">Parser Module
-&gt; RangeFile -&gt; [Char] -&gt; PM ((Module, Attributes), FileType)
forall a.
Show a =&gt;
Parser a -&gt; RangeFile -&gt; [Char] -&gt; PM ((a, Attributes), FileType)
</span><a href="Agda.Syntax.Parser.html#parseFile"><span class="hs-identifier hs-var">parseFile</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Module
</span><a href="Agda.Syntax.Parser.html#moduleParser"><span class="hs-identifier hs-var">moduleParser</span></a></span><span> </span><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621681654775"><span class="hs-identifier hs-var">rf</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PM ((Module, Attributes), FileType))
-&gt; [Char] -&gt; PM ((Module, Attributes), FileType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-143"></span><span>                                      </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">TL.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681654778"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621681654777"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654777"><span class="hs-identifier hs-var">parsedModName</span></a></span></span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Module -&gt; TCM TopLevelModuleName
</span><a href="Agda.Interaction.FindFile.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681654767"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681654781"><span class="hs-identifier hs-var">parsedMod</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">(Text, FileType, Module, Attributes, TopLevelModuleName)
-&gt; TCMT IO (Text, FileType, Module, Attributes, TopLevelModuleName)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681654778"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621681654783"><span class="hs-identifier hs-var">fileType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681654781"><span class="hs-identifier hs-var">parsedMod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681654782"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654777"><span class="hs-identifier hs-var">parsedModName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621681654788"><span class="annot"><span class="annottext">[AgdaLibFile]
</span><a href="#local-6989586621681654788"><span class="hs-identifier hs-var">libs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TopLevelModuleName -&gt; TCM [AgdaLibFile]
</span><a href="Agda.TypeChecking.Monad.Options.html#getAgdaLibFiles"><span class="hs-identifier hs-var">getAgdaLibFiles</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681654767"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654774"><span class="hs-identifier hs-var">parsedModName</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="annottext">Source -&gt; TCM Source
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">srcText :: Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681654770"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcFileType :: FileType
</span><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var">srcFileType</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621681654771"><span class="hs-identifier hs-var">fileType</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcOrigin :: SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681654765"><span class="hs-identifier hs-var">sourceFile</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcModule :: Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681654772"><span class="hs-identifier hs-var">parsedMod</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcModuleName :: TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681654774"><span class="hs-identifier hs-var">parsedModName</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcProjectLibs :: [AgdaLibFile]
</span><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var">srcProjectLibs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AgdaLibFile]
</span><a href="#local-6989586621681654788"><span class="hs-identifier hs-var">libs</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">srcAttributes :: Attributes
</span><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var">srcAttributes</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621681654773"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-type">srcDefaultPragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span id="srcDefaultPragmas"><span class="annot"><span class="annottext">srcDefaultPragmas :: Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var hs-var">srcDefaultPragmas</span></a></span></span><span> </span><span id="local-6989586621681654791"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654791"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AgdaLibFile -&gt; OptionsPragma) -&gt; [AgdaLibFile] -&gt; [OptionsPragma]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AgdaLibFile -&gt; OptionsPragma
</span><a href="Agda.Interaction.Library.Base.html#_libPragmas"><span class="hs-identifier hs-var">_libPragmas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [AgdaLibFile]
</span><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var">srcProjectLibs</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654791"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-type">srcFilePragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span id="srcFilePragmas"><span class="annot"><span class="annottext">srcFilePragmas :: Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var hs-var">srcFilePragmas</span></a></span></span><span> </span><span id="local-6989586621681654794"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654794"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621681654795"><span class="hs-identifier hs-var">pragmas</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621681654796"><span class="annot"><span class="annottext">cpragmas :: [Pragma]
</span><a href="#local-6989586621681654796"><span class="hs-identifier hs-var hs-var">cpragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Pragma]
</span><a href="Agda.Syntax.Concrete.html#modPragmas"><span class="hs-identifier hs-var">C.modPragmas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654794"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621681654795"><span class="annot"><span class="annottext">pragmas :: [OptionsPragma]
</span><a href="#local-6989586621681654795"><span class="hs-identifier hs-var hs-var">pragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span>
</span><span id="line-165"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pragmaStrings :: [[Char]]
</span><a href="Agda.Interaction.Library.Base.html#pragmaStrings"><span class="hs-identifier hs-var">pragmaStrings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621681654800"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-166"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pragmaRange :: Range
</span><a href="Agda.Interaction.Library.Base.html#pragmaRange"><span class="hs-identifier hs-var">pragmaRange</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681654802"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-167"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#OptionsPragma"><span class="hs-identifier hs-type">C.OptionsPragma</span></a></span><span> </span><span id="local-6989586621681654802"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681654802"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681654800"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621681654800"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Pragma]
</span><a href="#local-6989586621681654796"><span class="hs-identifier hs-var">cpragmas</span></a></span><span>
</span><span id="line-169"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Set options from a 'Source' pragma, using the source</span><span>
</span><span id="line-172"></span><span class="hs-comment">--   ranges of the pragmas for error reporting.</span><span>
</span><span id="line-173"></span><span class="annot"><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-type">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span id="setOptionsFromSourcePragmas"><span class="annot"><span class="annottext">setOptionsFromSourcePragmas :: Source -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-var hs-var">setOptionsFromSourcePragmas</span></a></span></span><span> </span><span id="local-6989586621681654805"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654805"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="annottext">(OptionsPragma -&gt; TCM ()) -&gt; [OptionsPragma] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setOptionsFromPragma"><span class="hs-identifier hs-var">setOptionsFromPragma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var">srcDefaultPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654805"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">(OptionsPragma -&gt; TCM ()) -&gt; [OptionsPragma] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setOptionsFromPragma"><span class="hs-identifier hs-var">setOptionsFromPragma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var">srcFilePragmas</span></a></span><span>    </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681654805"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Is the aim to type-check the top-level module, or only to</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- scope-check it?</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-keyword">data</span><span> </span><span id="Mode"><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-var">Mode</span></a></span></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ScopeCheck"><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TypeCheck"><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681654809"><span id="local-6989586621681654811"><span class="annot"><span class="annottext">Mode -&gt; Mode -&gt; Bool
(Mode -&gt; Mode -&gt; Bool) -&gt; (Mode -&gt; Mode -&gt; Bool) -&gt; Eq Mode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Mode -&gt; Mode -&gt; Bool
== :: Mode -&gt; Mode -&gt; Bool
$c/= :: Mode -&gt; Mode -&gt; Bool
/= :: Mode -&gt; Mode -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654816"><span id="local-6989586621681654818"><span id="local-6989586621681654822"><span class="annot"><span class="annottext">Int -&gt; Mode -&gt; ShowS
[Mode] -&gt; ShowS
Mode -&gt; [Char]
(Int -&gt; Mode -&gt; ShowS)
-&gt; (Mode -&gt; [Char]) -&gt; ([Mode] -&gt; ShowS) -&gt; Show Mode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Mode -&gt; ShowS
showsPrec :: Int -&gt; Mode -&gt; ShowS
$cshow :: Mode -&gt; [Char]
show :: Mode -&gt; [Char]
$cshowList :: [Mode] -&gt; ShowS
showList :: [Mode] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Are we loading the interface for the user-loaded file</span><span>
</span><span id="line-187"></span><span class="hs-comment">--   or for an import?</span><span>
</span><span id="line-188"></span><span class="hs-keyword">data</span><span> </span><span id="MainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span> </span><span class="hs-comment">-- ^ For the main file.</span><span>
</span><span id="line-190"></span><span>                       </span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span>                       </span><span class="hs-comment">--   In this case state changes inflicted by</span><span>
</span><span id="line-192"></span><span>                       </span><span class="hs-comment">--   'createInterface' are preserved.</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotMainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span></span><span>   </span><span class="hs-comment">-- ^ For an imported file.</span><span>
</span><span id="line-194"></span><span>                       </span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span>                       </span><span class="hs-comment">--   In this case state changes inflicted by</span><span>
</span><span id="line-196"></span><span>                       </span><span class="hs-comment">--   'createInterface' are not preserved.</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681654829"><span id="local-6989586621681654832"><span class="annot"><span class="annottext">MainInterface -&gt; MainInterface -&gt; Bool
(MainInterface -&gt; MainInterface -&gt; Bool)
-&gt; (MainInterface -&gt; MainInterface -&gt; Bool) -&gt; Eq MainInterface
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MainInterface -&gt; MainInterface -&gt; Bool
== :: MainInterface -&gt; MainInterface -&gt; Bool
$c/= :: MainInterface -&gt; MainInterface -&gt; Bool
/= :: MainInterface -&gt; MainInterface -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654835"><span id="local-6989586621681654840"><span id="local-6989586621681654844"><span class="annot"><span class="annottext">Int -&gt; MainInterface -&gt; ShowS
[MainInterface] -&gt; ShowS
MainInterface -&gt; [Char]
(Int -&gt; MainInterface -&gt; ShowS)
-&gt; (MainInterface -&gt; [Char])
-&gt; ([MainInterface] -&gt; ShowS)
-&gt; Show MainInterface
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MainInterface -&gt; ShowS
showsPrec :: Int -&gt; MainInterface -&gt; ShowS
$cshow :: MainInterface -&gt; [Char]
show :: MainInterface -&gt; [Char]
$cshowList :: [MainInterface] -&gt; ShowS
showList :: [MainInterface] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><span class="hs-comment">-- | Should state changes inflicted by 'createInterface' be preserved?</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-type">includeStateChanges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-202"></span><span id="includeStateChanges"><span class="annot"><span class="annottext">includeStateChanges :: MainInterface -&gt; Bool
</span><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-var hs-var">includeStateChanges</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-var">includeStateChanges</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><span class="hs-comment">-- | The kind of interface produced by 'createInterface'</span></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-type">moduleCheckMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span>
</span><span id="line-207"></span><span id="moduleCheckMode"><span class="annot"><span class="annottext">moduleCheckMode :: MainInterface -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-var hs-var">moduleCheckMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleScopeChecked"><span class="hs-identifier hs-var">ModuleScopeChecked</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><span class="hs-comment">-- | Merge an interface into the current proof state.</span></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-type">mergeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span id="mergeInterface"><span class="annot"><span class="annottext">mergeInterface :: Interface -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-var hs-var">mergeInterface</span></a></span></span><span> </span><span id="local-6989586621681654851"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681654852"><span class="annot"><span class="annottext">sig :: Signature
</span><a href="#local-6989586621681654852"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621681654854"><span class="annot"><span class="annottext">builtin :: [(SomeBuiltin, Builtin (PrimitiveId, QName))]
</span><a href="#local-6989586621681654854"><span class="hs-identifier hs-var hs-var">builtin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin (PrimitiveId, QName))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin (PrimitiveId, QName))
 -&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))])
-&gt; Map SomeBuiltin (Builtin (PrimitiveId, QName))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="Agda.TypeChecking.Monad.Base.html#iBuiltin"><span class="hs-identifier hs-var">iBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621681654857"><span class="annot"><span class="annottext">primOrBi :: (a, Builtin a) -&gt; Either a (a, Builtin pf)
</span><a href="#local-6989586621681654857"><span class="hs-identifier hs-var hs-var">primOrBi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621681654859"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654859"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a (a, Builtin pf)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654859"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-219"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681654860"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654860"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621681654862"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654862"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Builtin pf) -&gt; Either a (a, Builtin pf)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654860"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Builtin pf
forall pf. Term -&gt; Builtin pf
</span><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654862"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681654863"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654863"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621681654865"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654865"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Builtin pf) -&gt; Either a (a, Builtin pf)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681654863"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Builtin pf
forall pf. Set QName -&gt; Builtin pf
</span><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-var">BuiltinRewriteRelations</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654865"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681654866"><span class="annot"><span class="annottext">[(PrimitiveId, QName)]
</span><a href="#local-6989586621681654866"><span class="hs-keyword hs-var">prim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654867"><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
</span><a href="#local-6989586621681654867"><span class="hs-identifier hs-var">bi'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
-&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
 -&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)]))
-&gt; [Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
-&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SomeBuiltin, Builtin (PrimitiveId, QName))
 -&gt; Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
-&gt; [Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SomeBuiltin, Builtin (PrimitiveId, QName))
-&gt; Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)
forall {a} {a} {pf}. (a, Builtin a) -&gt; Either a (a, Builtin pf)
</span><a href="#local-6989586621681654857"><span class="hs-identifier hs-var">primOrBi</span></a></span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin (PrimitiveId, QName))]
</span><a href="#local-6989586621681654854"><span class="hs-identifier hs-var">builtin</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621681654869"><span class="annot"><span class="annottext">bi :: Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654869"><span class="hs-identifier hs-var hs-var">bi</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
-&gt; Map SomeBuiltin (Builtin PrimFun)
forall k a. [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
</span><a href="#local-6989586621681654867"><span class="hs-identifier hs-var">bi'</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621681654871"><span class="annot"><span class="annottext">warns :: [TCWarning]
</span><a href="#local-6989586621681654871"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621681654873"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654873"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; Map SomeBuiltin (Builtin PrimFun))
-&gt; TCMT IO (Map SomeBuiltin (Builtin PrimFun))
forall (m :: * -&gt; *) a. ReadTCState m =&gt; (TCState -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-var">getsTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Map SomeBuiltin (Builtin PrimFun)
</span><a href="Agda.TypeChecking.Monad.Base.html#stBuiltinThings"><span class="hs-identifier hs-var">stBuiltinThings</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Merging interface&quot;</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Current builtins &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SomeBuiltin] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun) -&gt; [SomeBuiltin]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654873"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  New builtins     &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SomeBuiltin] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun) -&gt; [SomeBuiltin]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654869"><span class="hs-identifier hs-var">bi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681654911"><span class="annot"><span class="annottext">check :: SomeBuiltin -&gt; Builtin pf -&gt; Builtin pf -&gt; m ()
</span><a href="#local-6989586621681654911"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#BuiltinName"><span class="hs-identifier hs-type">BuiltinName</span></a></span><span> </span><span id="local-6989586621681654913"><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621681654913"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621681654914"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654914"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621681654915"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654915"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654914"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654915"><span class="hs-identifier hs-var">y</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; TypeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Term -&gt; Term -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateBuiltinBinding"><span class="hs-identifier hs-var">DuplicateBuiltinBinding</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621681654913"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654914"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681654915"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><a href="#local-6989586621681654911"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621681654918"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654918"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621681654919"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654919"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><a href="#local-6989586621681654911"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Builtin pf
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Builtin pf
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">Map SomeBuiltin (TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span> </span><span class="annot"><span class="annottext">(Map SomeBuiltin (TCM ()) -&gt; TCM ())
-&gt; Map SomeBuiltin (TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SomeBuiltin -&gt; Builtin PrimFun -&gt; Builtin PrimFun -&gt; TCM ())
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (TCM ())
forall k a b c.
Ord k =&gt;
(k -&gt; a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">Map.intersectionWithKey</span></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin -&gt; Builtin PrimFun -&gt; Builtin PrimFun -&gt; TCM ()
forall {m :: * -&gt; *} {pf} {pf}.
(MonadTCEnv m, ReadTCState m, MonadError TCErr m) =&gt;
SomeBuiltin -&gt; Builtin pf -&gt; Builtin pf -&gt; m ()
</span><a href="#local-6989586621681654911"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654873"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654869"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">Signature
-&gt; RemoteMetaStore
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; PatternSynDefns
-&gt; DisplayForms
-&gt; Map QName Text
-&gt; Set QName
-&gt; [TCWarning]
-&gt; Map OpaqueId OpaqueBlock
-&gt; Map QName OpaqueId
-&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-var">addImportedThings</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654852"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#iMetaBindings"><span class="hs-identifier hs-var">iMetaBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654869"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#iPatternSyns"><span class="hs-identifier hs-var">iPatternSyns</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#iDisplayForms"><span class="hs-identifier hs-var">iDisplayForms</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Map QName Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iUserWarnings"><span class="hs-identifier hs-var">iUserWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Set QName
</span><a href="Agda.TypeChecking.Monad.Base.html#iPartialDefs"><span class="hs-identifier hs-var">iPartialDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681654871"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Map OpaqueId OpaqueBlock
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueBlocks"><span class="hs-identifier hs-var">iOpaqueBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Map QName OpaqueId
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueNames"><span class="hs-identifier hs-var">iOpaqueNames</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681654851"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Rebinding primitives &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(PrimitiveId, QName)] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[(PrimitiveId, QName)]
</span><a href="#local-6989586621681654866"><span class="hs-keyword hs-var">prim</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">((PrimitiveId, QName) -&gt; TCM ())
-&gt; [(PrimitiveId, QName)] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(PrimitiveId, QName) -&gt; TCM ()
</span><a href="#local-6989586621681654931"><span class="hs-identifier hs-var">rebind</span></a></span><span> </span><span class="annot"><span class="annottext">[(PrimitiveId, QName)]
</span><a href="#local-6989586621681654866"><span class="hs-keyword hs-var">prim</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO (Maybe ConfluenceCheck)
-&gt; (ConfluenceCheck -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; TCMT IO PragmaOptions -&gt; TCMT IO (Maybe ConfluenceCheck)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ConfluenceCheck -&gt; TCM ()) -&gt; TCM ())
-&gt; (ConfluenceCheck -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681654935"><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621681654935"><span class="hs-identifier hs-var">confChk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.confluence&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Checking confluence of imported rewrite rules&quot;</span></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; [RewriteRule] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier hs-var">checkConfluenceOfRules</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621681654935"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">([RewriteRule] -&gt; TCM ()) -&gt; [RewriteRule] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[RewriteRule]] -&gt; [RewriteRule]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[RewriteRule]] -&gt; [RewriteRule])
-&gt; [[RewriteRule]] -&gt; [RewriteRule]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName [RewriteRule] -&gt; [[RewriteRule]]
forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">HMap.elems</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName [RewriteRule] -&gt; [[RewriteRule]])
-&gt; HashMap QName [RewriteRule] -&gt; [[RewriteRule]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654852"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' Signature (HashMap QName [RewriteRule])
-&gt; HashMap QName [RewriteRule]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName [RewriteRule] -&gt; f (HashMap QName [RewriteRule]))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName [RewriteRule])
</span><a href="Agda.TypeChecking.Monad.Base.html#sigRewriteRules"><span class="hs-identifier hs-var">sigRewriteRules</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621681654931"><span class="annot"><span class="annottext">rebind :: (PrimitiveId, QName) -&gt; TCM ()
</span><a href="#local-6989586621681654931"><span class="hs-identifier hs-var hs-var">rebind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681654949"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621681654949"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681654950"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681654950"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimImpl"><span class="hs-identifier hs-type">PrimImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681654952"><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621681654952"><span class="hs-identifier hs-var">pf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; TCM PrimitiveImpl
</span><a href="Agda.TypeChecking.Primitive.Base.html#lookupPrimitiveFunction"><span class="hs-identifier hs-var">lookupPrimitiveFunction</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621681654949"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-255"></span><span>            </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin PrimFun)
 -&gt; f (Map SomeBuiltin (Builtin PrimFun)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-var">stImportedBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
-&gt; (Map SomeBuiltin (Builtin PrimFun)
    -&gt; Map SomeBuiltin (Builtin PrimFun))
-&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
-&gt; Builtin PrimFun
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveId -&gt; SomeBuiltin
forall a. IsBuiltin a =&gt; a -&gt; SomeBuiltin
</span><a href="Agda.Syntax.Builtin.html#someBuiltin"><span class="hs-identifier hs-var">someBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621681654949"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimFun -&gt; Builtin PrimFun
forall pf. pf -&gt; Builtin pf
</span><a href="Agda.TypeChecking.Monad.Base.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621681654952"><span class="hs-identifier hs-var">pf</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#primFunName"><span class="hs-identifier hs-var">primFunName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681654950"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-type">addImportedThings</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RemoteMetaStore"><span class="hs-identifier hs-type">RemoteMetaStore</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinThings"><span class="hs-identifier hs-type">BuiltinThings</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimFun"><span class="hs-identifier hs-type">PrimFun</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">A.PatternSynDefns</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Imported user warnings</span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of imported definitions which are partial</span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OpaqueBlock"><span class="hs-identifier hs-type">OpaqueBlock</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span id="addImportedThings"><span class="annot"><span class="annottext">addImportedThings :: Signature
-&gt; RemoteMetaStore
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; PatternSynDefns
-&gt; DisplayForms
-&gt; Map QName Text
-&gt; Set QName
-&gt; [TCWarning]
-&gt; Map OpaqueId OpaqueBlock
-&gt; Map QName OpaqueId
-&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-var hs-var">addImportedThings</span></a></span></span><span> </span><span id="local-6989586621681654962"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654962"><span class="hs-identifier hs-var">isig</span></a></span></span><span> </span><span id="local-6989586621681654963"><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681654963"><span class="hs-identifier hs-var">metas</span></a></span></span><span> </span><span id="local-6989586621681654964"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654964"><span class="hs-identifier hs-var">ibuiltin</span></a></span></span><span> </span><span id="local-6989586621681654965"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681654965"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span> </span><span id="local-6989586621681654966"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681654966"><span class="hs-identifier hs-var">display</span></a></span></span><span> </span><span id="local-6989586621681654967"><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681654967"><span class="hs-identifier hs-var">userwarn</span></a></span></span><span>
</span><span id="line-270"></span><span>                  </span><span id="local-6989586621681654968"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654968"><span class="hs-identifier hs-var">partialdefs</span></a></span></span><span> </span><span id="local-6989586621681654969"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681654969"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span id="local-6989586621681654970"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681654970"><span class="hs-identifier hs-var">oblock</span></a></span></span><span> </span><span id="local-6989586621681654971"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681654971"><span class="hs-identifier hs-var">oid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-var">stImports</span></a></span><span>              </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681654975"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654975"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Signature] -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.Signature.html#unionSignatures"><span class="hs-identifier hs-var">unionSignatures</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654975"><span class="hs-identifier hs-var">imp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681654962"><span class="hs-identifier hs-var">isig</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">(RemoteMetaStore -&gt; f RemoteMetaStore) -&gt; TCState -&gt; f TCState
Lens' TCState RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedMetaStore"><span class="hs-identifier hs-var">stImportedMetaStore</span></a></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState RemoteMetaStore
-&gt; (RemoteMetaStore -&gt; RemoteMetaStore) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore -&gt; RemoteMetaStore -&gt; RemoteMetaStore
forall k v. Eq k =&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.union</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681654963"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin PrimFun)
 -&gt; f (Map SomeBuiltin (Builtin PrimFun)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-var">stImportedBuiltins</span></a></span><span>     </span><span class="annot"><span class="annottext">Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
-&gt; (Map SomeBuiltin (Builtin PrimFun)
    -&gt; Map SomeBuiltin (Builtin PrimFun))
-&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681654983"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654983"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654983"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681654964"><span class="hs-identifier hs-var">ibuiltin</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">(Map QName Text -&gt; f (Map QName Text)) -&gt; TCState -&gt; f TCState
Lens' TCState (Map QName Text)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedUserWarnings"><span class="hs-identifier hs-var">stImportedUserWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map QName Text)
-&gt; (Map QName Text -&gt; Map QName Text) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681654988"><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681654988"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map QName Text -&gt; Map QName Text -&gt; Map QName Text
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681654988"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681654967"><span class="hs-identifier hs-var">userwarn</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedPartialDefs"><span class="hs-identifier hs-var">stImportedPartialDefs</span></a></span><span>  </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; (Set QName -&gt; Set QName) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681654992"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654992"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654992"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681654968"><span class="hs-identifier hs-var">partialdefs</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; f PatternSynDefns) -&gt; TCState -&gt; f TCState
Lens' TCState PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#stPatternSynImports"><span class="hs-identifier hs-var">stPatternSynImports</span></a></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState PatternSynDefns
-&gt; (PatternSynDefns -&gt; PatternSynDefns) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681654997"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681654997"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns -&gt; PatternSynDefns
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681654997"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681654965"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">(DisplayForms -&gt; f DisplayForms) -&gt; TCState -&gt; f TCState
Lens' TCState DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedDisplayForms"><span class="hs-identifier hs-var">stImportedDisplayForms</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState DisplayForms
-&gt; (DisplayForms -&gt; DisplayForms) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655001"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655001"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Open DisplayForm] -&gt; [Open DisplayForm] -&gt; [Open DisplayForm])
-&gt; DisplayForms -&gt; DisplayForms -&gt; DisplayForms
forall k v.
Eq k =&gt;
(v -&gt; v -&gt; v) -&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.unionWith</span></span><span> </span><span class="annot"><span class="annottext">[Open DisplayForm] -&gt; [Open DisplayForm] -&gt; [Open DisplayForm]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655001"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681654966"><span class="hs-identifier hs-var">display</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="annottext">([TCWarning] -&gt; f [TCWarning]) -&gt; TCState -&gt; f TCState
Lens' TCState [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-var">stTCWarnings</span></a></span><span>           </span><span class="annot"><span class="annottext">Lens' TCState [TCWarning] -&gt; ([TCWarning] -&gt; [TCWarning]) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655006"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655006"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655006"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; [TCWarning] -&gt; [TCWarning]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`List.union`</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681654969"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="annottext">(Map OpaqueId OpaqueBlock -&gt; f (Map OpaqueId OpaqueBlock))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map OpaqueId OpaqueBlock)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-var">stOpaqueBlocks</span></a></span><span>         </span><span class="annot"><span class="annottext">Lens' TCState (Map OpaqueId OpaqueBlock)
-&gt; (Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655011"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655011"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655011"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
-&gt; Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681654970"><span class="hs-identifier hs-var">oblock</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">(Map QName OpaqueId -&gt; f (Map QName OpaqueId))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map QName OpaqueId)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-var">stOpaqueIds</span></a></span><span>            </span><span class="annot"><span class="annottext">Lens' TCState (Map QName OpaqueId)
-&gt; (Map QName OpaqueId -&gt; Map QName OpaqueId) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655015"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655015"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655015"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId -&gt; Map QName OpaqueId -&gt; Map QName OpaqueId
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681654971"><span class="hs-identifier hs-var">oid</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Scope checks the given module. A proper version of the module</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- name (with correct definition sites) is returned.</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Agda.Interaction.Imports.html#scopeCheckImport"><span class="hs-identifier hs-type">scopeCheckImport</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span id="scopeCheckImport"><span class="annot"><span class="annottext">scopeCheckImport :: TopLevelModuleName
-&gt; ModuleName -&gt; TCM (ModuleName, Map ModuleName Scope)
</span><a href="Agda.Interaction.Imports.html#scopeCheckImport"><span class="hs-identifier hs-var hs-var">scopeCheckImport</span></a></span></span><span> </span><span id="local-6989586621681655016"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655016"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621681655017"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681655017"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Scope checking &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681655017"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>      </span><span id="local-6989586621681655020"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655020"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; [Char]) -&gt; TCMT IO Doc -&gt; TCMT IO [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). ReadTCState m =&gt; m Doc
</span><a href="Agda.TypeChecking.Monad.Imports.html#getPrettyVisitedModules"><span class="hs-identifier hs-var">getPrettyVisitedModules</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  visited: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655020"><span class="hs-identifier hs-var">visited</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- Since scopeCheckImport is called from the scope checker,</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">-- we need to reimburse her account.</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621681655022"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655022"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCMT IO Interface)
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var">getNonMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655016"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#addImport"><span class="hs-identifier hs-var">addImport</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655016"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-comment">-- If that interface was supposed to raise a warning on import, do so.</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text -&gt; (Text -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Maybe Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655022"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text -&gt; TCM ()) -&gt; TCM ()) -&gt; (Text -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; (Text -&gt; Warning) -&gt; Text -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#UserWarning"><span class="hs-identifier hs-var">UserWarning</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- let s = publicModules $ iInsideScope i</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655030"><span class="annot"><span class="annottext">s :: Map ModuleName Scope
</span><a href="#local-6989586621681655030"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Map ModuleName Scope
</span><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655022"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">(ModuleName, Map ModuleName Scope)
-&gt; TCM (ModuleName, Map ModuleName Scope)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; ModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655022"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; QName -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#withRangesOfQ"><span class="hs-operator hs-var">`withRangesOfQ`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#mnameToConcrete"><span class="hs-identifier hs-var">mnameToConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681655017"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map ModuleName Scope
</span><a href="#local-6989586621681655030"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- | If the module has already been visited (without warnings), then</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- its interface is returned directly. Otherwise the computation is</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- used to find the interface and the computed interface is stored for</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- potential later use.</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="annot"><a href="Agda.Interaction.Imports.html#alreadyVisited"><span class="hs-identifier hs-type">alreadyVisited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-311"></span><span>                  </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-312"></span><span>                  </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>                  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>                  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-315"></span><span id="alreadyVisited"><span class="annot"><span class="annottext">alreadyVisited :: TopLevelModuleName
-&gt; MainInterface
-&gt; PragmaOptions
-&gt; TCM ModuleInfo
-&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#alreadyVisited"><span class="hs-identifier hs-var hs-var">alreadyVisited</span></a></span></span><span> </span><span id="local-6989586621681655036"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655037"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655037"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621681655038"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655038"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span> </span><span id="local-6989586621681655039"><span class="annot"><span class="annottext">TCM ModuleInfo
</span><a href="#local-6989586621681655039"><span class="hs-identifier hs-var">getModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655037"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655040"><span class="hs-identifier hs-var">useExistingOrLoadAndRecordVisited</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655040"><span class="hs-identifier hs-var">useExistingOrLoadAndRecordVisited</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655040"><span class="hs-identifier hs-var">useExistingOrLoadAndRecordVisited</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleScopeChecked"><span class="hs-identifier hs-var">ModuleScopeChecked</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><a href="#local-6989586621681655040"><span class="hs-identifier hs-type">useExistingOrLoadAndRecordVisited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621681655040"><span class="annot"><span class="annottext">useExistingOrLoadAndRecordVisited :: ModuleCheckMode -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655040"><span class="hs-identifier hs-var hs-var">useExistingOrLoadAndRecordVisited</span></a></span></span><span> </span><span id="local-6989586621681655041"><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="#local-6989586621681655041"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM ModuleInfo -&gt; TCMT IO (Maybe ModuleInfo) -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><a href="Agda.Utils.Maybe.html#fromMaybeM"><span class="hs-identifier hs-var">fromMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ModuleInfo
</span><a href="#local-6989586621681655043"><span class="hs-identifier hs-var">loadAndRecordVisited</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; TCMT IO (Maybe ModuleInfo)
</span><a href="#local-6989586621681655044"><span class="hs-identifier hs-var">existingWithoutWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="#local-6989586621681655041"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-comment">-- Case: already visited.</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-comment">-- A module with warnings should never be allowed to be</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-comment">-- imported from another module.</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="#local-6989586621681655044"><span class="hs-identifier hs-type">existingWithoutWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621681655044"><span class="annot"><span class="annottext">existingWithoutWarnings :: ModuleCheckMode -&gt; TCMT IO (Maybe ModuleInfo)
</span><a href="#local-6989586621681655044"><span class="hs-identifier hs-var hs-var">existingWithoutWarnings</span></a></span></span><span> </span><span id="local-6989586621681655045"><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="#local-6989586621681655045"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ModuleInfo -&gt; TCMT IO (Maybe ModuleInfo)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) ModuleInfo -&gt; TCMT IO (Maybe ModuleInfo))
-&gt; MaybeT (TCMT IO) ModuleInfo -&gt; TCMT IO (Maybe ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) ModuleInfo -&gt; MaybeT (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) e a. Functor m =&gt; ExceptT e m a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">exceptToMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; MaybeT (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; MaybeT (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621681655048"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655048"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;interface has not been visited in this context&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; MaybeT (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe ModuleInfo) -&gt; MaybeT (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe ModuleInfo) -&gt; MaybeT (TCMT IO) ModuleInfo)
-&gt; TCMT IO (Maybe ModuleInfo) -&gt; MaybeT (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO (Maybe ModuleInfo)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
TopLevelModuleName -&gt; m (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-var">getVisitedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655048"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; ModuleCheckMode -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="#local-6989586621681655045"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;previously-visited interface was not sufficiently checked&quot;</span></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; Bool) -&gt; [TCWarning] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655048"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;previously-visited interface had warnings&quot;</span></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Already visited &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">TCM ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; TCM ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655060"><span class="hs-identifier hs-var">processResultingModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655048"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><a href="#local-6989586621681655060"><span class="hs-identifier hs-type">processResultingModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621681655060"><span class="annot"><span class="annottext">processResultingModule :: ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655060"><span class="hs-identifier hs-var hs-var">processResultingModule</span></a></span></span><span> </span><span id="local-6989586621681655061"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655061"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miInterface :: ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655064"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655064"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miPrimitive :: ModuleInfo -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655066"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655066"><span class="hs-identifier hs-var">isPrim</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miWarnings :: ModuleInfo -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655067"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655067"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655061"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- Check that imported options are compatible with current ones (issue #2487),</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- but give primitive modules a pass</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- compute updated warnings if needed</span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621681655068"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655068"><span class="hs-identifier hs-var">wt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; Maybe [TCWarning] -&gt; [TCWarning]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655067"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [TCWarning] -&gt; [TCWarning])
-&gt; TCMT IO (Maybe [TCWarning]) -&gt; TCMT IO [TCWarning]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MainInterface
-&gt; Bool
-&gt; PragmaOptions
-&gt; Interface
-&gt; TCMT IO (Maybe [TCWarning])
</span><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-var">getOptionsCompatibilityWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655037"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655066"><span class="hs-identifier hs-var">isPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655038"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655064"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655061"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681655068"><span class="hs-identifier hs-type">wt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><a href="#local-6989586621681655043"><span class="hs-identifier hs-type">loadAndRecordVisited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621681655043"><span class="annot"><span class="annottext">loadAndRecordVisited :: TCM ModuleInfo
</span><a href="#local-6989586621681655043"><span class="hs-identifier hs-var hs-var">loadAndRecordVisited</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Getting interface for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621681655071"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655060"><span class="hs-identifier hs-var">processResultingModule</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; TCM ModuleInfo) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM ModuleInfo
</span><a href="#local-6989586621681655039"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Now we've looked at &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- Interfaces are not stored if we are only scope-checking, or</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-comment">-- if any warnings were encountered.</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655037"><span class="hs-identifier hs-var">isMain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCWarning
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCWarning]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">(MainInterface, [TCWarning])
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#storeDecodedModule"><span class="hs-identifier hs-var">storeDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [[Char]] -&gt; TCM ()
forall a (m :: * -&gt; *).
(ReportS a, MonadDebug m) =&gt;
[Char] -&gt; Int -&gt; a -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [[Char]] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-var">reportS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;warning.import&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;module: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleNameParts -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TopLevelModuleNameParts
forall range. TopLevelModuleName' range -&gt; TopLevelModuleNameParts
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameParts"><span class="hs-identifier hs-var">moduleNameParts</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655036"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WarningOnImport: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Maybe Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#visitModule"><span class="hs-identifier hs-var">visitModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655071"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- | The result and associated parameters of a type-checked file,</span><span>
</span><span id="line-377"></span><span class="hs-comment">--   when invoked directly via interaction or a backend.</span><span>
</span><span id="line-378"></span><span class="hs-comment">--   Note that the constructor is not exported.</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-keyword">data</span><span> </span><span id="CheckResult"><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-var">CheckResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CheckResult%27"><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-var">CheckResult'</span></a></span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="crModuleInfo"><span class="annot"><span class="annottext">CheckResult -&gt; ModuleInfo
</span><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier hs-var hs-var">crModuleInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="crSource%27"><span class="annot"><span class="annottext">CheckResult -&gt; Source
</span><a href="Agda.Interaction.Imports.html#crSource%27"><span class="hs-identifier hs-var hs-var">crSource'</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Flattened unidirectional pattern for 'CheckResult' for destructuring inside</span><span>
</span><span id="line-386"></span><span class="hs-comment">--   the 'ModuleInfo' field.</span><span>
</span><span id="line-387"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span>
</span><span id="line-388"></span><span class="hs-keyword">pattern</span><span> </span><span id="CheckResult"><span id="%24mCheckResult"><span class="annot"><span class="annottext">$mCheckResult :: forall {r}.
CheckResult
-&gt; (Interface -&gt; [TCWarning] -&gt; ModuleCheckMode -&gt; Source -&gt; r)
-&gt; ((# #) -&gt; r)
-&gt; r
</span><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-var hs-var">CheckResult</span></a></span></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="crInterface"><span class="annot"><span class="annottext">CheckResult -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#crInterface"><span class="hs-identifier hs-var hs-var hs-var">crInterface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crWarnings"><span class="annot"><span class="annottext">CheckResult -&gt; [TCWarning]
</span><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier hs-var hs-var hs-var">crWarnings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crMode"><span class="annot"><span class="annottext">CheckResult -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#crMode"><span class="hs-identifier hs-var hs-var hs-var">crMode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crSource"><span class="annot"><span class="annottext">CheckResult -&gt; Source
</span><a href="Agda.Interaction.Imports.html#crSource"><span class="hs-identifier hs-var hs-var hs-var">crSource</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-type">CheckResult'</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier hs-var">crModuleInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655080"><span class="annot"><a href="#local-6989586621681655080"><span class="hs-identifier hs-var">crInterface</span></a></span></span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655081"><span class="annot"><a href="#local-6989586621681655081"><span class="hs-identifier hs-var">crWarnings</span></a></span></span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655082"><span class="annot"><a href="#local-6989586621681655082"><span class="hs-identifier hs-var">crMode</span></a></span></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crSource%27"><span class="hs-identifier hs-var">crSource'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655083"><span class="annot"><a href="#local-6989586621681655083"><span class="hs-identifier hs-var">crSource</span></a></span></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">-- | Type checks the main file of the interaction.</span><span>
</span><span id="line-398"></span><span class="hs-comment">--   This could be the file loaded in the interacting editor (emacs),</span><span>
</span><span id="line-399"></span><span class="hs-comment">--   or the file passed on the command line.</span><span>
</span><span id="line-400"></span><span class="hs-comment">--</span><span>
</span><span id="line-401"></span><span class="hs-comment">--   First, the primitive modules are imported.</span><span>
</span><span id="line-402"></span><span class="hs-comment">--   Then, @getInterface@ is called to do the main work.</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">--   If the 'Mode' is 'ScopeCheck', then type-checking is not</span><span>
</span><span id="line-405"></span><span class="hs-comment">--   performed, only scope-checking. (This may include type-checking</span><span>
</span><span id="line-406"></span><span class="hs-comment">--   of imported modules.) In this case the generated, partial</span><span>
</span><span id="line-407"></span><span class="hs-comment">--   interface is not stored in the state ('stDecodedModules'). Note,</span><span>
</span><span id="line-408"></span><span class="hs-comment">--   however, that if the file has already been type-checked, then a</span><span>
</span><span id="line-409"></span><span class="hs-comment">--   complete interface is returned.</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-type">typeCheckMain</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span>
</span><span id="line-413"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Should the file be type-checked, or only scope-checked?</span></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-415"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The decorated source code.</span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span>
</span><span id="line-417"></span><span id="typeCheckMain"><span class="annot"><span class="annottext">typeCheckMain :: Mode -&gt; Source -&gt; TCM CheckResult
</span><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-var hs-var">typeCheckMain</span></a></span></span><span> </span><span id="local-6989586621681655085"><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681655085"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621681655086"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-comment">-- liftIO $ putStrLn $ &quot;This is typeCheckMain &quot; ++ prettyShow f</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-comment">-- liftIO . putStrLn . show =&lt;&lt; getVerbosity</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-comment">-- For the main interface, we also remember the pragmas from the file</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><span class="annottext">Source -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-var">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621681655087"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655087"><span class="hs-identifier hs-var">loadPrims</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optLoadPrimitives"><span class="hs-identifier hs-var">optLoadPrimitives</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655087"><span class="hs-identifier hs-var">loadPrims</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Importing the primitive modules.&quot;</span></span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621681655089"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655089"><span class="hs-identifier hs-var">libdirPrim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Char] -&gt; TCMT IO [Char]
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO [Char]
</span><a href="Agda.Interaction.Library.html#getPrimitiveLibDir"><span class="hs-identifier hs-var">getPrimitiveLibDir</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Library primitive dir = &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655089"><span class="hs-identifier hs-var">libdirPrim</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-comment">-- Turn off import-chasing messages.</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-comment">-- We have to modify the persistent verbosity setting, since</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- getInterface resets the current verbosity settings to the persistent ones.</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO PersistentVerbosity
-&gt; (PersistentVerbosity -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCState -&gt; PersistentVerbosity) -&gt; TCMT IO PersistentVerbosity
forall (m :: * -&gt; *) a. ReadTCState m =&gt; (TCState -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-var">getsTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentVerbosity
forall a. LensPersistentVerbosity a =&gt; a -&gt; PersistentVerbosity
</span><a href="Agda.Interaction.Options.Lenses.html#getPersistentVerbosity"><span class="hs-identifier hs-var">Lens.getPersistentVerbosity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PersistentVerbosity -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; PersistentVerbosity -&gt; m ()
</span><a href="Agda.Interaction.Options.Lenses.html#putPersistentVerbosity"><span class="hs-identifier hs-var">Lens.putPersistentVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>      </span><span class="annot"><span class="annottext">(PersistentVerbosity -&gt; PersistentVerbosity) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(PersistentVerbosity -&gt; PersistentVerbosity) -&gt; m ()
</span><a href="Agda.Interaction.Options.Lenses.html#modifyPersistentVerbosity"><span class="hs-identifier hs-var">Lens.modifyPersistentVerbosity</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Trie VerboseKeyItem Int -&gt; PersistentVerbosity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Strict.Just</span></span><span> </span><span class="annot"><span class="annottext">(Trie VerboseKeyItem Int -&gt; PersistentVerbosity)
-&gt; (PersistentVerbosity -&gt; Trie VerboseKeyItem Int)
-&gt; PersistentVerbosity
-&gt; PersistentVerbosity
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VerboseKeyItem]
-&gt; Int -&gt; Trie VerboseKeyItem Int -&gt; Trie VerboseKeyItem Int
forall k v. Ord k =&gt; [k] -&gt; v -&gt; Trie k v -&gt; Trie k v
</span><a href="Agda.Utils.Trie.html#insert"><span class="hs-identifier hs-var">Trie.insert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Trie VerboseKeyItem Int -&gt; Trie VerboseKeyItem Int)
-&gt; (PersistentVerbosity -&gt; Trie VerboseKeyItem Int)
-&gt; PersistentVerbosity
-&gt; Trie VerboseKeyItem Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Trie VerboseKeyItem Int
-&gt; PersistentVerbosity -&gt; Trie VerboseKeyItem Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">Strict.fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Trie VerboseKeyItem Int
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">Trie.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-comment">-- set root verbosity to 0</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-comment">-- We don't want to generate highlighting information for Agda.Primitive.</span><span>
</span><span id="line-439"></span><span>      </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; TCM () -&gt; TCM ()
forall a. HighlightingLevel -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Env.html#withHighlightingLevel"><span class="hs-identifier hs-var">withHighlightingLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#None"><span class="hs-identifier hs-var">None</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">Set [Char] -&gt; ([Char] -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS -&gt; Set [Char] -&gt; Set [Char]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655089"><span class="hs-identifier hs-var">libdirPrim</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="Agda.Interaction.Options.Lenses.html#primitiveModules"><span class="hs-identifier hs-var">Lens.primitiveModules</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Char] -&gt; TCM ()) -&gt; TCM ()) -&gt; ([Char] -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655104"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655104"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>          </span><span id="local-6989586621681655105"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655105"><span class="hs-identifier hs-var">primSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var">parseSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; SourceFile
</span><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-var">SourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; SourceFile) -&gt; AbsolutePath -&gt; SourceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; AbsolutePath
</span><a href="Agda.Utils.FileName.html#mkAbsolute"><span class="hs-identifier hs-var">mkAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655104"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; TCM ()
</span><a href="#local-6989586621681655107"><span class="hs-identifier hs-var">checkModuleName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655105"><span class="hs-identifier hs-var">primSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655105"><span class="hs-identifier hs-var">primSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Interface -&gt; TCM ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCM ()) -&gt; TCMT IO Interface -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var">getNonMainInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655105"><span class="hs-identifier hs-var">primSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Maybe Source
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655105"><span class="hs-identifier hs-var">primSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Done importing the primitive modules.&quot;</span></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- Now do the type checking via getInterface.</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; TCM ()
</span><a href="#local-6989586621681655107"><span class="hs-identifier hs-var">checkModuleName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621681655108"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655108"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var">getInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; MainInterface
</span><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621681655085"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Maybe Source
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="annottext">(Maybe (ModuleName, TopLevelModuleName)
 -&gt; f (Maybe (ModuleName, TopLevelModuleName)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Maybe (ModuleName, TopLevelModuleName))
</span><a href="Agda.TypeChecking.Monad.Base.html#stCurrentModule"><span class="hs-identifier hs-var">stCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Maybe (ModuleName, TopLevelModuleName))
-&gt; Maybe (ModuleName, TopLevelModuleName) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-operator hs-var">`setTCLens'`</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><span class="annottext">(ModuleName, TopLevelModuleName)
-&gt; Maybe (ModuleName, TopLevelModuleName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; ModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655108"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655108"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><span class="annottext">CheckResult -&gt; TCM CheckResult
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CheckResult -&gt; TCM CheckResult) -&gt; CheckResult -&gt; TCM CheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Source -&gt; CheckResult
</span><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-var">CheckResult'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655108"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655086"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621681655107"><span class="annot"><span class="annottext">checkModuleName' :: TopLevelModuleName -&gt; SourceFile -&gt; TCM ()
</span><a href="#local-6989586621681655107"><span class="hs-identifier hs-var hs-var">checkModuleName'</span></a></span></span><span> </span><span id="local-6989586621681655117"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655117"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681655118"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655118"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-07-11, issue 2092</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-comment">-- The error range should be set to the file with the wrong module name</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-comment">-- not the importing one (which would be the default).</span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655117"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; Maybe TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.Interaction.FindFile.html#checkModuleName"><span class="hs-identifier hs-var">checkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655117"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655118"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="hs-comment">-- | Tries to return the interface associated to the given (imported) module.</span><span>
</span><span id="line-466"></span><span class="hs-comment">--   The time stamp of the relevant interface file is also returned.</span><span>
</span><span id="line-467"></span><span class="hs-comment">--   Calls itself recursively for the imports of the given module.</span><span>
</span><span id="line-468"></span><span class="hs-comment">--   May type check the module.</span><span>
</span><span id="line-469"></span><span class="hs-comment">--   An error is raised if a warning is encountered.</span><span>
</span><span id="line-470"></span><span class="hs-comment">--</span><span>
</span><span id="line-471"></span><span class="hs-comment">--   Do not use this for the main file, use 'typeCheckMain' instead.</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-type">getNonMainInterface</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-476"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-478"></span><span id="getNonMainInterface"><span class="annot"><span class="annottext">getNonMainInterface :: TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var hs-var">getNonMainInterface</span></a></span></span><span> </span><span id="local-6989586621681655121"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655121"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655122"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655122"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-comment">-- Preserve/restore the current pragma options, which will be mutated when loading</span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-comment">-- and checking the interface.</span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621681655123"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655123"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
-&gt; (PragmaOptions -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; PragmaOptions -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var">getInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655121"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655122"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><span class="annottext">[TCWarning] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Pretty.Warning.html#tcWarningsToError"><span class="hs-identifier hs-var">tcWarningsToError</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; TCM ()) -&gt; [TCWarning] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655123"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655123"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="hs-comment">-- | A more precise variant of 'getNonMainInterface'. If warnings are</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- encountered then they are returned instead of being turned into</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- errors.</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-type">getInterface</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-494"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-496"></span><span id="getInterface"><span class="annot"><span class="annottext">getInterface :: TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var hs-var">getInterface</span></a></span></span><span> </span><span id="local-6989586621681655132"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655133"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655133"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621681655134"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a. TopLevelModuleName -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Imports.html#addImportCycleCheck"><span class="hs-identifier hs-var">addImportCycleCheck</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>     </span><span class="hs-comment">-- We remember but reset the pragma options locally</span><span>
</span><span id="line-499"></span><span>     </span><span class="hs-comment">-- Issue #3644 (Abel 2020-05-08): Set approximate range for errors in options</span><span>
</span><span id="line-500"></span><span>     </span><span id="local-6989586621681655136"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655136"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-501"></span><span>     </span><span class="annot"><span class="annottext">Maybe [Pragma] -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; [Pragma]
</span><a href="Agda.Syntax.Concrete.html#modPragmas"><span class="hs-identifier hs-var">C.modPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; [Pragma]) -&gt; (Source -&gt; Module) -&gt; Source -&gt; [Pragma]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Source -&gt; [Pragma]) -&gt; Maybe Source -&gt; Maybe [Pragma]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-502"></span><span>       </span><span class="hs-comment">-- Now reset the options</span><span>
</span><span id="line-503"></span><span>       </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; TCM ())
-&gt; (TCState -&gt; CommandLineOptions) -&gt; TCState -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; CommandLineOptions)
-&gt; (TCState -&gt; PersistentTCState) -&gt; TCState -&gt; CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCM ()) -&gt; TCMT IO TCState -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>     </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MainInterface
-&gt; PragmaOptions
-&gt; TCM ModuleInfo
-&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#alreadyVisited"><span class="hs-identifier hs-var">alreadyVisited</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655133"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655136"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>      </span><span id="local-6989586621681655143"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-507"></span><span>        </span><span class="annot"><span class="annottext">Maybe Source
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO SourceFile
</span><a href="Agda.Interaction.FindFile.html#findFile"><span class="hs-identifier hs-var">findFile</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681655145"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655145"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>          </span><span class="hs-comment">-- Andreas, 2021-08-17, issue #5508.</span><span>
</span><span id="line-510"></span><span>          </span><span class="hs-comment">-- So it happened with @msrc == Just{}@ that the file was not added to @ModuleToSource@,</span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-comment">-- only with @msrc == Nothing@ (then @findFile@ does it).</span><span>
</span><span id="line-512"></span><span>          </span><span class="hs-comment">-- As a consequence, the file was added later, but with a file name constructed</span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-comment">-- from a module name.  As #5508 shows, this can be fatal in case-insensitive file systems.</span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-comment">-- The file name (with case variant) then no longer maps to the module name.</span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-comment">-- To prevent this, we register the connection in @ModuleToSource@ here,</span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-comment">-- where we have the correct spelling of the file name.</span><span>
</span><span id="line-517"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655146"><span class="annot"><span class="annottext">file :: SourceFile
</span><a href="#local-6989586621681655146"><span class="hs-identifier hs-var hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655145"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-518"></span><span>          </span><span class="annot"><span class="annottext">Lens' TCState (Map TopLevelModuleName AbsolutePath)
-&gt; (Map TopLevelModuleName AbsolutePath
    -&gt; Map TopLevelModuleName AbsolutePath)
-&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-identifier hs-var">modifyTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TopLevelModuleName AbsolutePath
 -&gt; f (Map TopLevelModuleName AbsolutePath))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map TopLevelModuleName AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span> </span><span class="annot"><span class="annottext">((Map TopLevelModuleName AbsolutePath
  -&gt; Map TopLevelModuleName AbsolutePath)
 -&gt; TCM ())
-&gt; (Map TopLevelModuleName AbsolutePath
    -&gt; Map TopLevelModuleName AbsolutePath)
-&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; AbsolutePath
-&gt; Map TopLevelModuleName AbsolutePath
-&gt; Map TopLevelModuleName AbsolutePath
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655146"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>          </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO SourceFile
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655146"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [Char]
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">List.intercalate</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [Char]) -&gt; [[Char]] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;module: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;file:   &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Check for cycle&quot;</span></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#checkForImportCycle"><span class="hs-identifier hs-var">checkForImportCycle</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>      </span><span class="hs-comment">-- -- Andreas, 2014-10-20 AIM XX:</span><span>
</span><span id="line-529"></span><span>      </span><span class="hs-comment">-- -- Always retype-check the main file to get the iInsideScope</span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-comment">-- -- which is no longer serialized.</span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-comment">-- let maySkip = isMain == NotMainInterface</span><span>
</span><span id="line-532"></span><span>      </span><span class="hs-comment">-- Andreas, 2015-07-13: Serialize iInsideScope again.</span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-comment">-- Andreas, 2020-05-13 issue #4647: don't skip if reload because of top-level command</span><span>
</span><span id="line-534"></span><span>      </span><span id="local-6989586621681655153"><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655153"><span class="hs-identifier hs-var">stored</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; TCMT IO (Either [Char] ModuleInfo)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; TCMT IO (Either [Char] ModuleInfo))
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; TCMT IO (Either [Char] ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (ExceptT [Char] (TCMT IO)))
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (ExceptT [Char] (TCMT IO))
Phase
</span><a href="Agda.Benchmarking.html#Import"><span class="hs-identifier hs-var">Bench.Import</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile
-&gt; Maybe Source
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-var">getStoredInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655157"><span class="annot"><span class="annottext">recheck :: [Char] -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655157"><span class="hs-identifier hs-var hs-var">recheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655158"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655158"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not up-to-date because &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655158"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-539"></span><span>            </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; TCM ())
-&gt; (TCState -&gt; CommandLineOptions) -&gt; TCState -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; CommandLineOptions)
-&gt; (TCState -&gt; PersistentTCState) -&gt; TCState -&gt; CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCM ()) -&gt; TCMT IO TCState -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-540"></span><span>            </span><span id="local-6989586621681655159"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655159"><span class="hs-identifier hs-var">modl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655133"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-541"></span><span>              </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-var">createInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655133"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-542"></span><span>              </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var">createInterfaceIsolated</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655134"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-comment">-- Ensure that the given module name matches the one in the file.</span><span>
</span><span id="line-545"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655161"><span class="annot"><span class="annottext">topLevelName :: TopLevelModuleName
</span><a href="#local-6989586621681655161"><span class="hs-identifier hs-var hs-var">topLevelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655159"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655161"><span class="hs-identifier hs-var">topLevelName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TopLevelModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-547"></span><span>              </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
-&gt; TopLevelModuleName -&gt; TopLevelModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#OverlappingProjects"><span class="hs-identifier hs-var">OverlappingProjects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655143"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655161"><span class="hs-identifier hs-var">topLevelName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655132"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>            </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655159"><span class="hs-identifier hs-var">modl</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>      </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ModuleInfo)
-&gt; (ModuleInfo -&gt; TCM ModuleInfo)
-&gt; Either [Char] ModuleInfo
-&gt; TCM ModuleInfo
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655157"><span class="hs-identifier hs-var">recheck</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655153"><span class="hs-identifier hs-var">stored</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-comment">-- | Check if the options used for checking an imported module are</span><span>
</span><span id="line-554"></span><span class="hs-comment">--   compatible with the current options. Raises Non-fatal errors if</span><span>
</span><span id="line-555"></span><span class="hs-comment">--   not.</span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-type">checkOptionsCompatible</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-558"></span><span id="checkOptionsCompatible"><span class="annot"><span class="annottext">checkOptionsCompatible :: PragmaOptions
-&gt; PragmaOptions -&gt; TopLevelModuleName -&gt; TCMT IO Bool
</span><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-var hs-var">checkOptionsCompatible</span></a></span></span><span> </span><span id="local-6989586621681655165"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655165"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span id="local-6989586621681655166"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655166"><span class="hs-identifier hs-var">imported</span></a></span></span><span> </span><span id="local-6989586621681655167"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655167"><span class="hs-identifier hs-var">importedModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; Bool -&gt; TCMT IO Bool)
-&gt; Bool -&gt; StateT Bool (TCMT IO) () -&gt; TCMT IO Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT Bool (TCMT IO) () -&gt; Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; TCMT IO Bool)
-&gt; StateT Bool (TCMT IO) () -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.options&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; StateT Bool (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">P.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;current options  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">P.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; TCMT IO Doc
forall {m :: * -&gt; *}.
(Applicative m, Semigroup (m Doc), IsString (m Doc)) =&gt;
PragmaOptions -&gt; m Doc
</span><a href="#local-6989586621681655173"><span class="hs-identifier hs-var">showOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655165"><span class="hs-identifier hs-var">current</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.options&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; StateT Bool (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">P.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;imported options =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">P.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; TCMT IO Doc
forall {m :: * -&gt; *}.
(Applicative m, Semigroup (m Doc), IsString (m Doc)) =&gt;
PragmaOptions -&gt; m Doc
</span><a href="#local-6989586621681655173"><span class="hs-identifier hs-var">showOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655166"><span class="hs-identifier hs-var">imported</span></a></span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><span class="annottext">[InfectiveCoinfectiveOption]
-&gt; (InfectiveCoinfectiveOption -&gt; StateT Bool (TCMT IO) ())
-&gt; StateT Bool (TCMT IO) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[InfectiveCoinfectiveOption]
</span><a href="Agda.Interaction.Options.Base.html#infectiveCoinfectiveOptions"><span class="hs-identifier hs-var">infectiveCoinfectiveOptions</span></a></span><span> </span><span class="annot"><span class="annottext">((InfectiveCoinfectiveOption -&gt; StateT Bool (TCMT IO) ())
 -&gt; StateT Bool (TCMT IO) ())
-&gt; (InfectiveCoinfectiveOption -&gt; StateT Bool (TCMT IO) ())
-&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655175"><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655175"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
-&gt; PragmaOptions -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionOK"><span class="hs-identifier hs-var">icOptionOK</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655175"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655165"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655166"><span class="hs-identifier hs-var">imported</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ())
-&gt; StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; StateT Bool (TCMT IO) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-564"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; StateT Bool (TCMT IO) ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; StateT Bool (TCMT IO) ())
-&gt; Warning -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Base.html#icOptionKind"><span class="hs-identifier hs-var">icOptionKind</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655175"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-566"></span><span>           </span><span class="annot"><span class="annottext">InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Base.html#Infective"><span class="hs-identifier hs-var">Infective</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#InfectiveImport"><span class="hs-identifier hs-var">InfectiveImport</span></a></span><span>
</span><span id="line-567"></span><span>           </span><span class="annot"><span class="annottext">InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Base.html#Coinfective"><span class="hs-identifier hs-var">Coinfective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#CoInfectiveImport"><span class="hs-identifier hs-var">CoInfectiveImport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; TopLevelModuleName -&gt; Doc
</span><a href="Agda.Interaction.Options.Base.html#icOptionWarning"><span class="hs-identifier hs-var">icOptionWarning</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655175"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655167"><span class="hs-identifier hs-var">importedModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621681655173"><span class="annot"><span class="annottext">showOptions :: PragmaOptions -&gt; m Doc
</span><a href="#local-6989586621681655173"><span class="hs-identifier hs-var hs-var">showOptions</span></a></span></span><span> </span><span id="local-6989586621681655199"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655199"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="annottext">[m Doc] -&gt; m Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">P.prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">([m Doc] -&gt; m Doc) -&gt; [m Doc] -&gt; m Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><span class="annottext">(InfectiveCoinfectiveOption -&gt; m Doc)
-&gt; [InfectiveCoinfectiveOption] -&gt; [m Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655201"><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655201"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">P.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; [Char]
</span><a href="Agda.Interaction.Options.Base.html#icOptionDescription"><span class="hs-identifier hs-var">icOptionDescription</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655201"><span class="hs-identifier hs-var">opt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Doc
</span><span class="hs-string">&quot;: &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">P.&lt;+&gt;</span></a></span><span>
</span><span id="line-573"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; m Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionActive"><span class="hs-identifier hs-var">icOptionActive</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621681655201"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655199"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><span class="annottext">[InfectiveCoinfectiveOption]
</span><a href="Agda.Interaction.Options.Base.html#infectiveCoinfectiveOptions"><span class="hs-identifier hs-var">infectiveCoinfectiveOptions</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- | Compare options and return collected warnings.</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- | Returns `Nothing` if warning collection was skipped.</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-type">getOptionsCompatibilityWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span id="getOptionsCompatibilityWarnings"><span class="annot"><span class="annottext">getOptionsCompatibilityWarnings :: MainInterface
-&gt; Bool
-&gt; PragmaOptions
-&gt; Interface
-&gt; TCMT IO (Maybe [TCWarning])
</span><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-var hs-var">getOptionsCompatibilityWarnings</span></a></span></span><span> </span><span id="local-6989586621681655206"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655206"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621681655207"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655207"><span class="hs-identifier hs-var">isPrim</span></a></span></span><span> </span><span id="local-6989586621681655208"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655208"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span> </span><span id="local-6989586621681655209"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655209"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) [TCWarning] -&gt; TCMT IO (Maybe [TCWarning])
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) [TCWarning] -&gt; TCMT IO (Maybe [TCWarning]))
-&gt; MaybeT (TCMT IO) [TCWarning] -&gt; TCMT IO (Maybe [TCWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) [TCWarning]
-&gt; MaybeT (TCMT IO) [TCWarning]
forall (m :: * -&gt; *) e a. Functor m =&gt; ExceptT e m a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">exceptToMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) [TCWarning]
 -&gt; MaybeT (TCMT IO) [TCWarning])
-&gt; ExceptT [Char] (TCMT IO) [TCWarning]
-&gt; MaybeT (TCMT IO) [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-comment">-- We're just dropping these reasons-for-skipping messages for now.</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-comment">-- They weren't logged before, but they're nice for documenting the early returns.</span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655207"><span class="hs-identifier hs-var">isPrim</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Options consistency checking disabled for always-available primitive module&quot;</span></span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool)
-&gt; TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
-&gt; PragmaOptions -&gt; TopLevelModuleName -&gt; TCMT IO Bool
</span><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-var">checkOptionsCompatible</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655208"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#iOptionsUsed"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655209"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655209"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No warnings to collect because options were compatible&quot;</span></span><span>
</span><span id="line-588"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO [TCWarning] -&gt; ExceptT [Char] (TCMT IO) [TCWarning]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [TCWarning] -&gt; ExceptT [Char] (TCMT IO) [TCWarning])
-&gt; TCMT IO [TCWarning] -&gt; ExceptT [Char] (TCMT IO) [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; WhichWarnings -&gt; TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
MainInterface -&gt; WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var">getAllWarnings'</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655206"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#ErrorWarnings"><span class="hs-identifier hs-var">ErrorWarnings</span></a></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="annot"><span class="hs-comment">-- | Try to get the interface from interface file or cache.</span></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-type">getStoredInterface</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-594"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Module name of file we process.</span></span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-596"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-599"></span><span id="getStoredInterface"><span class="annot"><span class="annottext">getStoredInterface :: TopLevelModuleName
-&gt; SourceFile
-&gt; Maybe Source
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-var hs-var">getStoredInterface</span></a></span></span><span> </span><span id="local-6989586621681655214"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655215"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681655216"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655216"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-comment">-- Check whether interface file exists and is in cache</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-comment">--  in the correct version (as testified by the interface file hash).</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-comment">-- This is a lazy action which may be skipped if there is no cached interface</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-comment">-- and we're ignoring interface files for some reason.</span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655217"><span class="annot"><span class="annottext">getIFileHashesET :: ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621681655217"><span class="hs-identifier hs-var hs-var">getIFileHashesET</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-comment">-- Check that the interface file exists and return its hash.</span><span>
</span><span id="line-607"></span><span>        </span><span id="local-6989586621681655218"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655218"><span class="hs-identifier hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (TCMT IO) InterfaceFile
-&gt; ExceptT [Char] (TCMT IO) InterfaceFile
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the interface file could not be found&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) InterfaceFile
 -&gt; ExceptT [Char] (TCMT IO) InterfaceFile)
-&gt; MaybeT (TCMT IO) InterfaceFile
-&gt; ExceptT [Char] (TCMT IO) InterfaceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile)
-&gt; TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-608"></span><span>          </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO (Maybe InterfaceFile)
</span><a href="Agda.Interaction.FindFile.html#findInterfaceFile%27"><span class="hs-identifier hs-var">findInterfaceFile'</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-comment">-- Check that the interface file exists and return its hash.</span><span>
</span><span id="line-611"></span><span>        </span><span id="local-6989586621681655220"><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655220"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (TCMT IO) (Hash, Hash)
-&gt; ExceptT [Char] (TCMT IO) (Hash, Hash)
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the interface file hash could not be read&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) (Hash, Hash)
 -&gt; ExceptT [Char] (TCMT IO) (Hash, Hash))
-&gt; MaybeT (TCMT IO) (Hash, Hash)
-&gt; ExceptT [Char] (TCMT IO) (Hash, Hash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe (Hash, Hash)) -&gt; MaybeT (TCMT IO) (Hash, Hash)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe (Hash, Hash)) -&gt; MaybeT (TCMT IO) (Hash, Hash))
-&gt; TCMT IO (Maybe (Hash, Hash)) -&gt; MaybeT (TCMT IO) (Hash, Hash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Hash, Hash)) -&gt; TCMT IO (Maybe (Hash, Hash))
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Hash, Hash)) -&gt; TCMT IO (Maybe (Hash, Hash)))
-&gt; IO (Maybe (Hash, Hash)) -&gt; TCMT IO (Maybe (Hash, Hash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><span class="annottext">InterfaceFile -&gt; IO (Maybe (Hash, Hash))
</span><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-var">getInterfaceFileHashes</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655218"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="annottext">(InterfaceFile, (Hash, Hash))
-&gt; ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
forall a. a -&gt; ExceptT [Char] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655218"><span class="hs-identifier hs-var">ifile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655220"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-comment">-- Examine the hash of the interface file. If it is different from the</span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-comment">-- stored version (in stDecodedModules), or if there is no stored version,</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-comment">-- read and decode it. Otherwise use the stored version.</span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-comment">-- This is a lazy action which may be skipped if the cached or on-disk interface</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-comment">-- is invalid, missing, or skipped for some other reason.</span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655222"><span class="annot"><span class="annottext">checkSourceHashET :: Hash -&gt; ExceptT [Char] (TCMT IO) ()
</span><a href="#local-6989586621681655222"><span class="hs-identifier hs-var hs-var">checkSourceHashET</span></a></span></span><span> </span><span id="local-6989586621681655223"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655223"><span class="hs-identifier hs-var">ifaceH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-623"></span><span>        </span><span id="local-6989586621681655224"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655224"><span class="hs-identifier hs-var">sourceH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655216"><span class="hs-identifier hs-var">msrc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-624"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Source
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a. IO a -&gt; ExceptT [Char] (TCMT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash)
-&gt; IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; IO Hash
</span><a href="Agda.Utils.Hash.html#hashTextFile"><span class="hs-identifier hs-var">hashTextFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681655226"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655226"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a. a -&gt; ExceptT [Char] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; ExceptT [Char] (TCMT IO) Hash)
-&gt; Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655226"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655224"><span class="hs-identifier hs-var">sourceH</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655223"><span class="hs-identifier hs-var">ifaceH</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-628"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-629"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the source hash (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655224"><span class="hs-identifier hs-var">sourceH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-630"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; does not match the source hash for the interface (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655223"><span class="hs-identifier hs-var">ifaceH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-631"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is up-to-date.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-comment">-- Check if we have cached the module.</span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621681655228"><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655228"><span class="hs-identifier hs-var">cachedE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo))
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the interface has not been decoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
 -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
 -&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-637"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO (Maybe ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe ModuleInfo)
 -&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo))
-&gt; TCMT IO (Maybe ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModule"><span class="hs-identifier hs-var">getDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655228"><span class="hs-identifier hs-var">cachedE</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-comment">-- If it's cached ignoreInterfaces has no effect;</span><span>
</span><span id="line-641"></span><span>    </span><span class="hs-comment">-- to avoid typechecking a file more than once.</span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681655230"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655230"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681655231"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655231"><span class="hs-identifier hs-var">ifile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655232"><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655232"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621681655217"><span class="hs-identifier hs-var">getIFileHashesET</span></a></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655233"><span class="annot"><span class="annottext">ifp :: [Char]
</span><a href="#local-6989586621681655233"><span class="hs-identifier hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655231"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655236"><span class="annot"><span class="annottext">i :: Interface
</span><a href="#local-6989586621681655236"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655230"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-comment">-- Make sure the hashes match.</span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655237"><span class="annot"><span class="annottext">cachedIfaceHash :: Hash
</span><a href="#local-6989586621681655237"><span class="hs-identifier hs-var hs-var">cachedIfaceHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655236"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655239"><span class="annot"><span class="annottext">fileIfaceHash :: Hash
</span><a href="#local-6989586621681655239"><span class="hs-identifier hs-var hs-var">fileIfaceHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Hash, Hash) -&gt; Hash
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655232"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-651"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655237"><span class="hs-identifier hs-var">cachedIfaceHash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655239"><span class="hs-identifier hs-var">fileIfaceHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-652"></span><span>        </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#dropDecodedModule"><span class="hs-identifier hs-var">dropDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-653"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  cached hash = &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655237"><span class="hs-identifier hs-var">cachedIfaceHash</span></a></span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  stored hash = &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655239"><span class="hs-identifier hs-var">fileIfaceHash</span></a></span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  file is newer, re-reading &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655233"><span class="hs-identifier hs-var">ifp</span></a></span><span>
</span><span id="line-656"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-657"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the cached interface hash (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655237"><span class="hs-identifier hs-var">cachedIfaceHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-658"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; does not match interface file (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655239"><span class="hs-identifier hs-var">fileIfaceHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-659"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>      </span><span class="annot"><span class="annottext">Account (BenchPhase (ExceptT [Char] (TCMT IO)))
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (ExceptT [Char] (TCMT IO))
Phase
</span><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-var">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>        </span><span class="annot"><span class="annottext">Hash -&gt; ExceptT [Char] (TCMT IO) ()
</span><a href="#local-6989586621681655222"><span class="hs-identifier hs-var">checkSourceHashET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655236"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  using stored version of &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655231"><span class="hs-identifier hs-var">ifile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><span class="annottext">SourceFile -&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-var">loadDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655230"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681655245"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655245"><span class="hs-identifier hs-var">whyNotCached</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShowS
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655247"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655247"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655245"><span class="hs-identifier hs-var">whyNotCached</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; and &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655247"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>      </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-var">ignoreAllInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-669"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;we're ignoring all interface files&quot;</span></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>      </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-var">ignoreInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-672"></span><span>        </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool)
-&gt; TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadIO m =&gt; [Char] -&gt; m Bool
</span><a href="Agda.Interaction.Options.Lenses.html#isBuiltinModule"><span class="hs-identifier hs-var">Lens.isBuiltinModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-673"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;we're ignoring non-builtin interface files&quot;</span></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681655250"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655250"><span class="hs-identifier hs-var">ifile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655251"><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655251"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621681655217"><span class="hs-identifier hs-var">getIFileHashesET</span></a></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655252"><span class="annot"><span class="annottext">ifp :: [Char]
</span><a href="#local-6989586621681655252"><span class="hs-identifier hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char])
-&gt; (InterfaceFile -&gt; AbsolutePath) -&gt; InterfaceFile -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(InterfaceFile -&gt; [Char]) -&gt; InterfaceFile -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655250"><span class="hs-identifier hs-var">ifile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">Account (BenchPhase (ExceptT [Char] (TCMT IO)))
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (ExceptT [Char] (TCMT IO))
Phase
</span><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-var">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-680"></span><span>        </span><span class="annot"><span class="annottext">Hash -&gt; ExceptT [Char] (TCMT IO) ()
</span><a href="#local-6989586621681655222"><span class="hs-identifier hs-var">checkSourceHashET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Hash, Hash) -&gt; Hash
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621681655251"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  no stored version, reading &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655252"><span class="hs-identifier hs-var">ifp</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>        </span><span id="local-6989586621681655254"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655254"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (TCMT IO) Interface -&gt; ExceptT [Char] (TCMT IO) Interface
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;bad interface, re-type checking&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) Interface -&gt; ExceptT [Char] (TCMT IO) Interface)
-&gt; MaybeT (TCMT IO) Interface -&gt; ExceptT [Char] (TCMT IO) Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Interface) -&gt; MaybeT (TCMT IO) Interface
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe Interface) -&gt; MaybeT (TCMT IO) Interface)
-&gt; TCMT IO (Maybe Interface) -&gt; MaybeT (TCMT IO) Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-685"></span><span>          </span><span class="annot"><span class="annottext">InterfaceFile -&gt; TCMT IO (Maybe Interface)
</span><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-var">readInterface</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655250"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-comment">-- Ensure that the given module name matches the one in the file.</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655255"><span class="annot"><span class="annottext">topLevelName :: TopLevelModuleName
</span><a href="#local-6989586621681655255"><span class="hs-identifier hs-var hs-var">topLevelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655254"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-689"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655255"><span class="hs-identifier hs-var">topLevelName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TopLevelModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-690"></span><span>          </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
-&gt; TopLevelModuleName -&gt; TopLevelModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#OverlappingProjects"><span class="hs-identifier hs-var">OverlappingProjects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655255"><span class="hs-identifier hs-var">topLevelName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>        </span><span id="local-6989586621681655256"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655256"><span class="hs-identifier hs-var">isPrimitiveModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool)
-&gt; TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadIO m =&gt; [Char] -&gt; m Bool
</span><a href="Agda.Interaction.Options.Lenses.html#isPrimitiveModule"><span class="hs-identifier hs-var">Lens.isPrimitiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>        </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var">chaseMsg</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Loading &quot;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Char] -&gt; TCM ()) -&gt; Maybe [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655252"><span class="hs-identifier hs-var">ifp</span></a></span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-comment">-- print imported warnings</span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655259"><span class="annot"><span class="annottext">ws :: [TCWarning]
</span><a href="#local-6989586621681655259"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; Bool) -&gt; [TCWarning] -&gt; [TCWarning]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TopLevelModuleName -&gt; Maybe (Maybe TopLevelModuleName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Strict.Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655214"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe TopLevelModuleName)
-&gt; Maybe (Maybe TopLevelModuleName) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Maybe TopLevelModuleName) -&gt; Bool)
-&gt; (TCWarning -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; TCWarning
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-697"></span><span>                         </span><span class="annot"><span class="annottext">(RangeFile -&gt; Maybe TopLevelModuleName)
-&gt; Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RangeFile -&gt; Maybe TopLevelModuleName
</span><a href="Agda.Syntax.Position.html#rangeFileName"><span class="hs-identifier hs-var">rangeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; (TCWarning -&gt; Maybe RangeFile)
-&gt; TCWarning
-&gt; Maybe (Maybe TopLevelModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; Maybe RangeFile
</span><a href="Agda.TypeChecking.Monad.Base.html#tcWarningOrigin"><span class="hs-identifier hs-var">tcWarningOrigin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; [TCWarning]) -&gt; [TCWarning] -&gt; [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-698"></span><span>                 </span><span class="annot"><span class="annottext">Interface -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655254"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-699"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655259"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSDoc"><span class="hs-identifier hs-var">alwaysReportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;warning&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">P.vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; TCWarning -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">P.prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; TCMT IO Doc) -&gt; [TCWarning] -&gt; [TCMT IO Doc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655259"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>        </span><span class="annot"><span class="annottext">SourceFile -&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-var">loadDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655215"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-702"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miInterface :: Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655254"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-703"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miWarnings :: [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-704"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miPrimitive :: Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655256"><span class="hs-identifier hs-var">isPrimitiveModule</span></a></span><span>
</span><span id="line-705"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miMode :: ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-706"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-type">loadDecodedModule</span></a></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-711"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-714"></span><span id="loadDecodedModule"><span class="annot"><span class="annottext">loadDecodedModule :: SourceFile -&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-var hs-var">loadDecodedModule</span></a></span></span><span> </span><span id="local-6989586621681655265"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655265"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681655266"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655266"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655267"><span class="annot"><span class="annottext">fp :: [Char]
</span><a href="#local-6989586621681655267"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655265"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655268"><span class="annot"><span class="annottext">i :: Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655266"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-comment">-- Check that it's the right version</span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  imports: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(TopLevelModuleName, Hash)] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; [(TopLevelModuleName, Hash)]
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-comment">-- We set the pragma options of the skipped file here, so that</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-comment">-- we can check that they are compatible with those of the</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-comment">-- imported modules. Also, if the top-level file is skipped we</span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-comment">-- want the pragmas to apply to interactive commands in the UI.</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-comment">-- Jesper, 2021-04-18: Check for changed options in library files!</span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-comment">-- (see #5250)</span><span>
</span><span id="line-727"></span><span>  </span><span id="local-6989586621681655270"><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621681655270"><span class="hs-identifier hs-var">libOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [OptionsPragma] -&gt; ExceptT [Char] (TCMT IO) [OptionsPragma]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [OptionsPragma]
 -&gt; ExceptT [Char] (TCMT IO) [OptionsPragma])
-&gt; TCMT IO [OptionsPragma]
-&gt; ExceptT [Char] (TCMT IO) [OptionsPragma]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TopLevelModuleName -&gt; TCMT IO [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Options.html#getLibraryOptions"><span class="hs-identifier hs-var">getLibraryOptions</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655265"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OptionsPragma -&gt; TCM ()) -&gt; [OptionsPragma] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setOptionsFromPragma"><span class="hs-identifier hs-var">setOptionsFromPragma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621681655270"><span class="hs-identifier hs-var">libOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[OptionsPragma] -&gt; [OptionsPragma] -&gt; [OptionsPragma]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#iFilePragmaOptions"><span class="hs-identifier hs-var">iFilePragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-comment">-- Check that options that matter haven't changed compared to</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-comment">-- current options (issue #2487)</span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool)
-&gt; TCMT IO Bool -&gt; ExceptT [Char] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadIO m =&gt; [Char] -&gt; m Bool
</span><a href="Agda.Interaction.Options.Lenses.html#isBuiltinModule"><span class="hs-identifier hs-var">Lens.isBuiltinModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655267"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>    </span><span id="local-6989586621681655273"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655273"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions
-&gt; ExceptT [Char] (TCMT IO) PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-736"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#recheckBecausePragmaOptionsChanged"><span class="hs-identifier hs-var">recheckBecausePragmaOptionsChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#iOptionsUsed"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655273"><span class="hs-identifier hs-var">current</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-737"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;options changed&quot;</span></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-comment">-- If any of the imports are newer we need to retype check</span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621681655277"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621681655277"><span class="hs-identifier hs-var">badHashMessages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Either [Char] ()] -&gt; [[Char]])
-&gt; ExceptT [Char] (TCMT IO) [Either [Char] ()]
-&gt; ExceptT [Char] (TCMT IO) [[Char]]
forall a b.
(a -&gt; b)
-&gt; ExceptT [Char] (TCMT IO) a -&gt; ExceptT [Char] (TCMT IO) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Either [Char] ()] -&gt; [[Char]]
forall a b. [Either a b] -&gt; [a]
</span><span class="hs-identifier hs-var">lefts</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) [Either [Char] ()]
 -&gt; ExceptT [Char] (TCMT IO) [[Char]])
-&gt; ExceptT [Char] (TCMT IO) [Either [Char] ()]
-&gt; ExceptT [Char] (TCMT IO) [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(TopLevelModuleName, Hash)]
-&gt; ((TopLevelModuleName, Hash)
    -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ()))
-&gt; ExceptT [Char] (TCMT IO) [Either [Char] ()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; [(TopLevelModuleName, Hash)]
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((TopLevelModuleName, Hash)
  -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ()))
 -&gt; ExceptT [Char] (TCMT IO) [Either [Char] ()])
-&gt; ((TopLevelModuleName, Hash)
    -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ()))
-&gt; ExceptT [Char] (TCMT IO) [Either [Char] ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681655279"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655280"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655280"><span class="hs-identifier hs-var">impHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
 -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ()))
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><span class="annottext">[Char]
-&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ())
-&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking that module hash of import &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; matches &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655280"><span class="hs-identifier hs-var">impHash</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-742"></span><span>    </span><span id="local-6989586621681655281"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655281"><span class="hs-identifier hs-var">latestImpHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Hash
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) Hash
 -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash)
-&gt; ExceptT [Char] (TCMT IO) Hash
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM Hash -&gt; ExceptT [Char] (TCMT IO) Hash)
-&gt; TCM Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM Hash -&gt; TCM Hash
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Hash -&gt; TCM Hash) -&gt; TCM Hash -&gt; TCM Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var">moduleHash</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><span class="annottext">[Char]
-&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ())
-&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Done checking module hash of import &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655280"><span class="hs-identifier hs-var">impHash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655281"><span class="hs-identifier hs-var">latestImpHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
 -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ())
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a. [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ())
-&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-746"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;module hash for imported module &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655279"><span class="hs-identifier hs-var">impName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is out of date&quot;</span></span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; (import cached=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655280"><span class="hs-identifier hs-var">impHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, latest=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621681655281"><span class="hs-identifier hs-var">latestImpHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-748"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>  </span><span class="annot"><span class="annottext">[[Char]]
-&gt; ([[Char]] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621681655277"><span class="hs-identifier hs-var">badHashMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ([[Char]] -&gt; [Char]) -&gt; [[Char]] -&gt; ExceptT [Char] (TCMT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  New module. Let's check it out.&quot;</span></span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-var">mergeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-754"></span><span>  </span><span class="annot"><span class="annottext">Account (BenchPhase (ExceptT [Char] (TCMT IO)))
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (ExceptT [Char] (TCMT IO))
Phase
</span><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-var">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-755"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; TCM () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
HighlightingLevel -&gt; tcm () -&gt; tcm ()
</span><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-var">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-var">NonInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-756"></span><span>      </span><span class="annot"><span class="annottext">Interface -&gt; SourceFile -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-var">highlightFromInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655268"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655265"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>  </span><span class="annot"><span class="annottext">ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a. a -&gt; ExceptT [Char] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655266"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span class="hs-comment">-- | Run the type checker on a file and create an interface.</span><span>
</span><span id="line-761"></span><span class="hs-comment">--</span><span>
</span><span id="line-762"></span><span class="hs-comment">--   Mostly, this function calls 'createInterface'.</span><span>
</span><span id="line-763"></span><span class="hs-comment">--   But if it is not the main module we check,</span><span>
</span><span id="line-764"></span><span class="hs-comment">--   we do it in a fresh state, suitably initialize,</span><span>
</span><span id="line-765"></span><span class="hs-comment">--   in order to forget some state changes after successful type checking.</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-type">createInterfaceIsolated</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-769"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Module name of file we process.</span></span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-771"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-773"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-775"></span><span id="createInterfaceIsolated"><span class="annot"><span class="annottext">createInterfaceIsolated :: TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var hs-var">createInterfaceIsolated</span></a></span></span><span> </span><span id="local-6989586621681655290"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655290"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655291"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655291"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681655292"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655292"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>      </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cleanCachedLog"><span class="hs-identifier hs-var">cleanCachedLog</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>      </span><span id="local-6989586621681655294"><span class="annot"><span class="annottext">[TopLevelModuleName]
</span><a href="#local-6989586621681655294"><span class="hs-identifier hs-var">ms</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Imports.html#getImportPath"><span class="hs-identifier hs-var">getImportPath</span></a></span><span>
</span><span id="line-779"></span><span>      </span><span id="local-6989586621681655296"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681655296"><span class="hs-identifier hs-var">range</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Range) -&gt; TCMT IO Range
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Range
</span><a href="Agda.TypeChecking.Monad.Base.html#envRange"><span class="hs-identifier hs-var">envRange</span></a></span><span>
</span><span id="line-780"></span><span>      </span><span id="local-6989586621681655299"><span class="annot"><span class="annottext">Maybe (Closure Call)
</span><a href="#local-6989586621681655299"><span class="hs-identifier hs-var">call</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Maybe (Closure Call)) -&gt; TCMT IO (Maybe (Closure Call))
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Maybe (Closure Call)
</span><a href="Agda.TypeChecking.Monad.Base.html#envCall"><span class="hs-identifier hs-var">envCall</span></a></span><span>
</span><span id="line-781"></span><span>      </span><span id="local-6989586621681655301"><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655301"><span class="hs-identifier hs-var">mf</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map TopLevelModuleName AbsolutePath)
-&gt; TCMT IO (Map TopLevelModuleName AbsolutePath)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TopLevelModuleName AbsolutePath
 -&gt; f (Map TopLevelModuleName AbsolutePath))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map TopLevelModuleName AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-782"></span><span>      </span><span id="local-6989586621681655304"><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655304"><span class="hs-identifier hs-var">vs</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO VisitedModules
forall (m :: * -&gt; *). ReadTCState m =&gt; m VisitedModules
</span><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModules"><span class="hs-identifier hs-var">getVisitedModules</span></a></span><span>
</span><span id="line-783"></span><span>      </span><span id="local-6989586621681655306"><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655306"><span class="hs-identifier hs-var">ds</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO VisitedModules
</span><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModules"><span class="hs-identifier hs-var">getDecodedModules</span></a></span><span>
</span><span id="line-784"></span><span>      </span><span id="local-6989586621681655308"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681655308"><span class="hs-identifier hs-var">opts</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; CommandLineOptions)
-&gt; (TCState -&gt; PersistentTCState) -&gt; TCState -&gt; CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; CommandLineOptions)
-&gt; TCMT IO TCState -&gt; TCMT IO CommandLineOptions
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-785"></span><span>      </span><span id="local-6989586621681655309"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681655309"><span class="hs-identifier hs-var">isig</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; TCMT IO Signature
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-var">stImports</span></a></span><span>
</span><span id="line-786"></span><span>      </span><span id="local-6989586621681655312"><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681655312"><span class="hs-identifier hs-var">metas</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState RemoteMetaStore -&gt; TCMT IO RemoteMetaStore
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteMetaStore -&gt; f RemoteMetaStore) -&gt; TCState -&gt; f TCState
Lens' TCState RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedMetaStore"><span class="hs-identifier hs-var">stImportedMetaStore</span></a></span><span>
</span><span id="line-787"></span><span>      </span><span id="local-6989586621681655315"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681655315"><span class="hs-identifier hs-var">ibuiltin</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
-&gt; TCMT IO (Map SomeBuiltin (Builtin PrimFun))
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin PrimFun)
 -&gt; f (Map SomeBuiltin (Builtin PrimFun)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-var">stImportedBuiltins</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span id="local-6989586621681655318"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655318"><span class="hs-identifier hs-var">display</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState DisplayForms -&gt; TCMT IO DisplayForms
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayForms -&gt; f DisplayForms) -&gt; TCState -&gt; f TCState
Lens' TCState DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportsDisplayForms"><span class="hs-identifier hs-var">stImportsDisplayForms</span></a></span><span>
</span><span id="line-789"></span><span>      </span><span id="local-6989586621681655322"><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681655322"><span class="hs-identifier hs-var">userwarn</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map QName Text) -&gt; TCMT IO (Map QName Text)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map QName Text -&gt; f (Map QName Text)) -&gt; TCState -&gt; f TCState
Lens' TCState (Map QName Text)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedUserWarnings"><span class="hs-identifier hs-var">stImportedUserWarnings</span></a></span><span>
</span><span id="line-790"></span><span>      </span><span id="local-6989586621681655325"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681655325"><span class="hs-identifier hs-var">partialdefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; TCMT IO (Set QName)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedPartialDefs"><span class="hs-identifier hs-var">stImportedPartialDefs</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span id="local-6989586621681655328"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655328"><span class="hs-identifier hs-var">opaqueblk</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map OpaqueId OpaqueBlock)
-&gt; TCMT IO (Map OpaqueId OpaqueBlock)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map OpaqueId OpaqueBlock -&gt; f (Map OpaqueId OpaqueBlock))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map OpaqueId OpaqueBlock)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-var">stOpaqueBlocks</span></a></span><span>
</span><span id="line-792"></span><span>      </span><span id="local-6989586621681655331"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655331"><span class="hs-identifier hs-var">opaqueid</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map QName OpaqueId) -&gt; TCMT IO (Map QName OpaqueId)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map QName OpaqueId -&gt; f (Map QName OpaqueId))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map QName OpaqueId)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-var">stOpaqueIds</span></a></span><span>
</span><span id="line-793"></span><span>      </span><span id="local-6989586621681655334"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681655334"><span class="hs-identifier hs-var">ipatsyns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-var">getPatternSynImports</span></a></span><span>
</span><span id="line-794"></span><span>      </span><span id="local-6989586621681655336"><span class="annot"><span class="annottext">InteractionOutputCallback
</span><a href="#local-6989586621681655336"><span class="hs-identifier hs-var">ho</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO InteractionOutputCallback
forall (m :: * -&gt; *). ReadTCState m =&gt; m InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-identifier hs-var">getInteractionOutputCallback</span></a></span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-comment">-- Every interface is treated in isolation. Note: Some changes to</span><span>
</span><span id="line-796"></span><span>      </span><span class="hs-comment">-- the persistent state may not be preserved if an error other</span><span>
</span><span id="line-797"></span><span>      </span><span class="hs-comment">-- than a type error or an IO exception is encountered in an</span><span>
</span><span id="line-798"></span><span>      </span><span class="hs-comment">-- imported module.</span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681655338"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655338"><span class="hs-identifier hs-var">mi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655339"><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655339"><span class="hs-identifier hs-var">newModToSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655340"><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655340"><span class="hs-identifier hs-var">newDecodedModules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCErr
 -&gt; TCMT
      IO
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; ((ModuleInfo, Map TopLevelModuleName AbsolutePath,
     VisitedModules)
    -&gt; TCMT
         IO
         (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; Either
     TCErr
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">TCErr
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either
   TCErr
   (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
 -&gt; TCMT
      IO
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT
   IO
   (Either
      TCErr
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
 -&gt; TCMT
      IO
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-800"></span><span>           </span><span class="annot"><span class="annottext">TCMT
  IO
  (Either
     TCErr
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
forall (m :: * -&gt; *) a.
(MonadTCState m, ReadTCState m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Caching.html#withoutCache"><span class="hs-identifier hs-var">withoutCache</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT
   IO
   (Either
      TCErr
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
 -&gt; TCMT
      IO
      (Either
         TCErr
         (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)))
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-801"></span><span>           </span><span class="hs-comment">-- The cache should not be used for an imported module, and it</span><span>
</span><span id="line-802"></span><span>           </span><span class="hs-comment">-- should be restored after the module has been type-checked</span><span>
</span><span id="line-803"></span><span>           </span><span class="annot"><span class="annottext">TCMT
  IO
  (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
forall a. TCM a -&gt; TCM (Either TCErr a)
</span><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-var">freshTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT
   IO
   (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
 -&gt; TCMT
      IO
      (Either
         TCErr
         (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)))
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (Either
        TCErr
        (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-804"></span><span>             </span><span class="annot"><span class="annottext">[TopLevelModuleName]
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a. [TopLevelModuleName] -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Imports.html#withImportPath"><span class="hs-identifier hs-var">withImportPath</span></a></span><span> </span><span class="annot"><span class="annottext">[TopLevelModuleName]
</span><a href="#local-6989586621681655294"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT
   IO
   (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
 -&gt; TCMT
      IO
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-805"></span><span>             </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655345"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655345"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655345"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-806"></span><span>                              </span><span class="hs-comment">-- Andreas, 2014-08-18:</span><span>
</span><span id="line-807"></span><span>                              </span><span class="hs-comment">-- Preserve the range of import statement</span><span>
</span><span id="line-808"></span><span>                              </span><span class="hs-comment">-- for reporting termination errors in</span><span>
</span><span id="line-809"></span><span>                              </span><span class="hs-comment">-- imported modules:</span><span>
</span><span id="line-810"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envRange"><span class="hs-identifier hs-var">envRange</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681655296"><span class="hs-identifier hs-type">range</span></a></span><span>
</span><span id="line-811"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCall"><span class="hs-identifier hs-var">envCall</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681655299"><span class="hs-identifier hs-type">call</span></a></span><span>
</span><span id="line-812"></span><span>                            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT
   IO
   (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
 -&gt; TCMT
      IO
      (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules))
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>               </span><span class="annot"><span class="annottext">VisitedModules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#setDecodedModules"><span class="hs-identifier hs-var">setDecodedModules</span></a></span><span> </span><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655306"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-814"></span><span>               </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621681655308"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-815"></span><span>               </span><span class="annot"><span class="annottext">InteractionOutputCallback -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setInteractionOutputCallback"><span class="hs-identifier hs-var">setInteractionOutputCallback</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionOutputCallback
</span><a href="#local-6989586621681655336"><span class="hs-identifier hs-var">ho</span></a></span><span>
</span><span id="line-816"></span><span>               </span><span class="annot"><span class="annottext">(Map TopLevelModuleName AbsolutePath
 -&gt; f (Map TopLevelModuleName AbsolutePath))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map TopLevelModuleName AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map TopLevelModuleName AbsolutePath)
-&gt; Map TopLevelModuleName AbsolutePath -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655301"><span class="hs-identifier hs-var">mf</span></a></span><span>
</span><span id="line-817"></span><span>               </span><span class="annot"><span class="annottext">VisitedModules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#setVisitedModules"><span class="hs-identifier hs-var">setVisitedModules</span></a></span><span> </span><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655304"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-818"></span><span>               </span><span class="annot"><span class="annottext">Signature
-&gt; RemoteMetaStore
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; PatternSynDefns
-&gt; DisplayForms
-&gt; Map QName Text
-&gt; Set QName
-&gt; [TCWarning]
-&gt; Map OpaqueId OpaqueBlock
-&gt; Map QName OpaqueId
-&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-var">addImportedThings</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681655309"><span class="hs-identifier hs-var">isig</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681655312"><span class="hs-identifier hs-var">metas</span></a></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681655315"><span class="hs-identifier hs-var">ibuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681655334"><span class="hs-identifier hs-var">ipatsyns</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655318"><span class="hs-identifier hs-var">display</span></a></span><span>
</span><span id="line-819"></span><span>                 </span><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681655322"><span class="hs-identifier hs-var">userwarn</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681655325"><span class="hs-identifier hs-var">partialdefs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655328"><span class="hs-identifier hs-var">opaqueblk</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655331"><span class="hs-identifier hs-var">opaqueid</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>               </span><span id="local-6989586621681655351"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655351"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-var">createInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655290"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655291"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655292"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-822"></span><span>               </span><span id="local-6989586621681655352"><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655352"><span class="hs-identifier hs-var">mf'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map TopLevelModuleName AbsolutePath)
-&gt; TCMT IO (Map TopLevelModuleName AbsolutePath)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TopLevelModuleName AbsolutePath
 -&gt; f (Map TopLevelModuleName AbsolutePath))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map TopLevelModuleName AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-823"></span><span>               </span><span id="local-6989586621681655355"><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655355"><span class="hs-identifier hs-var">ds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO VisitedModules
</span><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModules"><span class="hs-identifier hs-var">getDecodedModules</span></a></span><span>
</span><span id="line-824"></span><span>               </span><span class="annot"><span class="annottext">(ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
-&gt; TCMT
     IO
     (ModuleInfo, Map TopLevelModuleName AbsolutePath, VisitedModules)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655351"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655352"><span class="hs-identifier hs-var">mf'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655355"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">(Map TopLevelModuleName AbsolutePath
 -&gt; f (Map TopLevelModuleName AbsolutePath))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map TopLevelModuleName AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map TopLevelModuleName AbsolutePath)
-&gt; Map TopLevelModuleName AbsolutePath -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">Map TopLevelModuleName AbsolutePath
</span><a href="#local-6989586621681655339"><span class="hs-identifier hs-var">newModToSource</span></a></span><span>
</span><span id="line-827"></span><span>      </span><span class="annot"><span class="annottext">VisitedModules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#setDecodedModules"><span class="hs-identifier hs-var">setDecodedModules</span></a></span><span> </span><span class="annot"><span class="annottext">VisitedModules
</span><a href="#local-6989586621681655340"><span class="hs-identifier hs-var">newDecodedModules</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-comment">-- We skip the file which has just been type-checked to</span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-comment">-- be able to forget some of the local state from</span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-comment">-- checking the module.</span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-comment">-- Note that this doesn't actually read the interface</span><span>
</span><span id="line-833"></span><span>      </span><span class="hs-comment">-- file, only the cached interface. (This comment is not</span><span>
</span><span id="line-834"></span><span>      </span><span class="hs-comment">-- correct, see</span><span>
</span><span id="line-835"></span><span>      </span><span class="hs-comment">-- test/Fail/customised/NestedProjectRoots.err.)</span><span>
</span><span id="line-836"></span><span>      </span><span id="local-6989586621681655358"><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655358"><span class="hs-identifier hs-var">validated</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; TCMT IO (Either [Char] ModuleInfo)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; TCMT IO (Either [Char] ModuleInfo))
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; TCMT IO (Either [Char] ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-var">loadDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655291"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621681655338"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>      </span><span class="hs-comment">-- NOTE: This attempts to type-check FOREVER if for some</span><span>
</span><span id="line-839"></span><span>      </span><span class="hs-comment">-- reason it continually fails to validate interface.</span><span>
</span><span id="line-840"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655359"><span class="annot"><span class="annottext">recheckOnError :: [Char] -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655359"><span class="hs-identifier hs-var hs-var">recheckOnError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655360"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655360"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-841"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to validate just-loaded interface: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655360"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-842"></span><span>            </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var">createInterfaceIsolated</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655290"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655291"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655292"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ModuleInfo)
-&gt; (ModuleInfo -&gt; TCM ModuleInfo)
-&gt; Either [Char] ModuleInfo
-&gt; TCM ModuleInfo
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655359"><span class="hs-identifier hs-var">recheckOnError</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Either [Char] ModuleInfo
</span><a href="#local-6989586621681655358"><span class="hs-identifier hs-var">validated</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span class="annot"><span class="hs-comment">-- | Formats and outputs the &quot;Checking&quot;, &quot;Finished&quot; and &quot;Loading &quot; messages.</span></span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-type">chaseMsg</span></a></span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ The prefix, like @Checking@, @Finished@, @Loading @.</span></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ The module name.</span></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Optionally: the file name.</span></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span id="chaseMsg"><span class="annot"><span class="annottext">chaseMsg :: [Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var hs-var">chaseMsg</span></a></span></span><span> </span><span id="local-6989586621681655362"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655362"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681655363"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655363"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655364"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681655364"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621681655365"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655365"><span class="hs-identifier hs-var">indentation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; [Char]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-operator hs-var">`replicate`</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Char]) -&gt; TCMT IO Int -&gt; TCMT IO [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Int) -&gt; TCMT IO Int
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (TCEnv -&gt; Int) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TopLevelModuleName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; Int)
-&gt; (TCEnv -&gt; [TopLevelModuleName]) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#envImportPath"><span class="hs-identifier hs-var">envImportPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>  </span><span id="local-6989586621681655370"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681655370"><span class="hs-identifier hs-var">traceImports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Integer
</span><a href="Agda.Interaction.Options.Base.html#optTraceImports"><span class="hs-identifier hs-var">optTraceImports</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Integer)
-&gt; TCMT IO CommandLineOptions -&gt; TCMT IO Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655372"><span class="annot"><span class="annottext">maybeFile :: [Char]
</span><a href="#local-6989586621681655372"><span class="hs-identifier hs-var hs-var">maybeFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; ShowS -&gt; [Char]
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681655364"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; [Char]) -&gt; ShowS -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655374"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655374"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655374"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;).&quot;</span></span><span>
</span><span id="line-858"></span><span>      </span><span id="local-6989586621681655375"><span class="annot"><span class="annottext">vLvl :: Int
</span><a href="#local-6989586621681655375"><span class="hs-identifier hs-var hs-var">vLvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655362"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking&quot;</span></span><span>
</span><span id="line-859"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681655370"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-860"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655362"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished&quot;</span></span><span>
</span><span id="line-861"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681655370"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-862"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">List.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Loading&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655362"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-863"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681655370"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-864"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-865"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.chase&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681655375"><span class="hs-identifier hs-var">vLvl</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655365"><span class="hs-identifier hs-var">indentation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655362"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655363"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655372"><span class="hs-identifier hs-var">maybeFile</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span class="annot"><span class="hs-comment">-- | Print the highlighting information contained in the given interface.</span></span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span class="annot"><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-type">highlightFromInterface</span></a></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-873"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The corresponding file.</span></span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span id="highlightFromInterface"><span class="annot"><span class="annottext">highlightFromInterface :: Interface -&gt; SourceFile -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-var hs-var">highlightFromInterface</span></a></span></span><span> </span><span id="local-6989586621681655379"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655379"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681655380"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655380"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-876"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Generating syntax info for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655380"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-878"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; (read from interface).&quot;</span></span><span>
</span><span id="line-879"></span><span>  </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655379"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="annot"><span class="hs-comment">-- | Read interface file corresponding to a module.</span></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="annot"><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-type">readInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#InterfaceFile"><span class="hs-identifier hs-type">InterfaceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span id="readInterface"><span class="annot"><span class="annottext">readInterface :: InterfaceFile -&gt; TCMT IO (Maybe Interface)
</span><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-var hs-var">readInterface</span></a></span></span><span> </span><span id="local-6989586621681655383"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655383"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655384"><span class="annot"><span class="annottext">ifp :: [Char]
</span><a href="#local-6989586621681655384"><span class="hs-identifier hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655383"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-comment">-- Decode the interface file</span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681655385"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655385"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655386"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681655386"><span class="hs-identifier hs-var">close</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ByteString, IO ()) -&gt; TCMT IO (ByteString, IO ())
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ByteString, IO ()) -&gt; TCMT IO (ByteString, IO ()))
-&gt; IO (ByteString, IO ()) -&gt; TCMT IO (ByteString, IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO (ByteString, IO ())
</span><a href="Agda.Utils.IO.Binary.html#readBinaryFile%27"><span class="hs-identifier hs-var">readBinaryFile'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655384"><span class="hs-identifier hs-var">ifp</span></a></span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span id="local-6989586621681655388"><span class="annot"><span class="annottext">Maybe Interface
</span><a href="#local-6989586621681655388"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Interface) -&gt; TCMT IO (Maybe Interface)
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Interface) -&gt; TCMT IO (Maybe Interface))
-&gt; (Maybe Interface -&gt; IO (Maybe Interface))
-&gt; Maybe Interface
-&gt; TCMT IO (Maybe Interface)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Interface -&gt; IO (Maybe Interface)
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">E.evaluate</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Interface -&gt; TCMT IO (Maybe Interface))
-&gt; TCMT IO (Maybe Interface) -&gt; TCMT IO (Maybe Interface)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TCMT IO (Maybe Interface)
</span><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier hs-var">decodeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655385"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-comment">-- Close the file. Note</span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-comment">-- &#9332; that evaluate ensures that i is evaluated to WHNF (before</span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-comment">--   the next IO operation is executed), and</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-comment">-- &#9333; that decode returns Nothing if an error is encountered,</span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-comment">-- so it is safe to close the file here.</span><span>
</span><span id="line-895"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681655386"><span class="hs-identifier hs-var">close</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>        </span><span class="annot"><span class="annottext">Maybe Interface -&gt; TCMT IO (Maybe Interface)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Interface -&gt; TCMT IO (Maybe Interface))
-&gt; Maybe Interface -&gt; TCMT IO (Maybe Interface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-var">constructIScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Interface) -&gt; Maybe Interface -&gt; Maybe Interface
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Interface
</span><a href="#local-6989586621681655388"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-comment">-- Catch exceptions and close</span><span>
</span><span id="line-899"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO (Maybe Interface)
-&gt; (TCErr -&gt; TCMT IO (Maybe Interface))
-&gt; TCMT IO (Maybe Interface)
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655393"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655393"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681655386"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCMT IO (Maybe Interface) -&gt; TCMT IO (Maybe Interface)
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO (Maybe Interface)
forall {a}. TCErr -&gt; TCMT IO (Maybe a)
</span><a href="#local-6989586621681655394"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655393"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-comment">-- Catch exceptions</span><span>
</span><span id="line-901"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe Interface)
-&gt; (TCErr -&gt; TCMT IO (Maybe Interface))
-&gt; TCMT IO (Maybe Interface)
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO (Maybe Interface)
forall {a}. TCErr -&gt; TCMT IO (Maybe a)
</span><a href="#local-6989586621681655394"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-903"></span><span>    </span><span id="local-6989586621681655394"><span class="annot"><span class="annottext">handler :: TCErr -&gt; TCMT IO (Maybe a)
</span><a href="#local-6989586621681655394"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-904"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681655415"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681655415"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;IO exception: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681655415"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-906"></span><span>        </span><span class="annot"><span class="annottext">Maybe a -&gt; TCMT IO (Maybe a)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-comment">-- Work-around for file locking bug.</span><span>
</span><span id="line-907"></span><span>                         </span><span class="hs-comment">-- TODO: What does this refer to? Please</span><span>
</span><span id="line-908"></span><span>                         </span><span class="hs-comment">-- document.</span><span>
</span><span id="line-909"></span><span>      </span><span id="local-6989586621681655416"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655416"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO (Maybe a)
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655416"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span class="hs-comment">-- | Writes the given interface to the given file.</span><span>
</span><span id="line-912"></span><span class="hs-comment">--</span><span>
</span><span id="line-913"></span><span class="hs-comment">-- The written interface is decoded and returned.</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span class="annot"><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-type">writeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#AbsolutePath"><span class="hs-identifier hs-type">AbsolutePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-916"></span><span id="writeInterface"><span class="annot"><span class="annottext">writeInterface :: AbsolutePath -&gt; Interface -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-var hs-var">writeInterface</span></a></span></span><span> </span><span id="local-6989586621681655418"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655418"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681655419"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655419"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655420"><span class="annot"><span class="annottext">fp :: [Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655418"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-917"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>  </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Writing interface file &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-07-13</span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-comment">-- After QName memoization (AIM XXI), scope serialization might be cheap enough.</span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-comment">-- -- Andreas, Makoto, 2014-10-18 AIM XX:</span><span>
</span><span id="line-922"></span><span>    </span><span class="hs-comment">-- -- iInsideScope is bloating the interface files, so we do not serialize it?</span><span>
</span><span id="line-923"></span><span>    </span><span class="hs-comment">-- i &lt;- return $</span><span>
</span><span id="line-924"></span><span>    </span><span class="hs-comment">--   i { iInsideScope  = emptyScopeInfo</span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">--     }</span><span>
</span><span id="line-926"></span><span>    </span><span class="hs-comment">-- [Old: Andreas, 2016-02-02 this causes issue #1804, so don't do it:]</span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-comment">-- Andreas, 2020-05-13, #1804, #4647: removed private declarations</span><span>
</span><span id="line-928"></span><span>    </span><span class="hs-comment">-- only when we actually write the interface.</span><span>
</span><span id="line-929"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-930"></span><span>      </span><span id="local-6989586621681655421"><span class="annot"><span class="annottext">filteredIface :: Interface
</span><a href="#local-6989586621681655421"><span class="hs-identifier hs-var hs-var">filteredIface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655419"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#withoutPrivates"><span class="hs-identifier hs-type">withoutPrivates</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681655419"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-931"></span><span>    </span><span id="local-6989586621681655424"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655424"><span class="hs-identifier hs-var">filteredIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
</span><a href="Agda.TypeChecking.InstanceArguments.html#pruneTemporaryInstances"><span class="hs-identifier hs-var">pruneTemporaryInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655421"><span class="hs-identifier hs-var">filteredIface</span></a></span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-933"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Writing interface file with hash &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655424"><span class="hs-identifier hs-var">filteredIface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-934"></span><span>    </span><span id="local-6989586621681655426"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655426"><span class="hs-identifier hs-var">encodedIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Interface -&gt; TCM ByteString
</span><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier hs-var">encodeFile</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655424"><span class="hs-identifier hs-var">filteredIface</span></a></span><span>
</span><span id="line-935"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Wrote interface file.&quot;</span></span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><span class="annottext">Interface -&gt; Maybe Interface -&gt; Interface
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Interface
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Interface -&gt; Interface)
-&gt; TCMT IO (Maybe Interface) -&gt; TCMT IO Interface
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO (Maybe Interface) -&gt; TCMT IO (Maybe Interface)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-var">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; TCMT IO (Maybe Interface)
forall a. EmbPrj a =&gt; ByteString -&gt; TCM (Maybe a)
</span><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655426"><span class="hs-identifier hs-var">encodedIface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Interface
-&gt; (TCErr -&gt; TCMT IO Interface) -&gt; TCMT IO Interface
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655429"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655429"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-939"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to write interface &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-940"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TCM ()) -&gt; IO () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-941"></span><span>      </span><span class="annot"><span class="annottext">IO Bool -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">removeFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655420"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-942"></span><span>    </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO Interface
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681655429"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span class="hs-comment">-- | Tries to type check a module and write out its interface. The</span><span>
</span><span id="line-945"></span><span class="hs-comment">-- function only writes out an interface file if it does not encounter</span><span>
</span><span id="line-946"></span><span class="hs-comment">-- any warnings.</span><span>
</span><span id="line-947"></span><span class="hs-comment">--</span><span>
</span><span id="line-948"></span><span class="hs-comment">-- If appropriate this function writes out syntax highlighting</span><span>
</span><span id="line-949"></span><span class="hs-comment">-- information.</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="annot"><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-type">createInterface</span></a></span><span>
</span><span id="line-952"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The expected module name.</span></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ The file to type check.</span></span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Are we dealing with the main module?</span></span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Optional information about the source code.</span></span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-957"></span><span id="createInterface"><span class="annot"><span class="annottext">createInterface :: TopLevelModuleName
-&gt; SourceFile -&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-var hs-var">createInterface</span></a></span></span><span> </span><span id="local-6989586621681655430"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span></span><span> </span><span id="local-6989586621681655431"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655431"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681655432"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621681655433"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655433"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655434"><span class="annot"><span class="annottext">x :: TopLevelModuleName
</span><a href="#local-6989586621681655434"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655435"><span class="annot"><span class="annottext">fp :: [Char]
</span><a href="#local-6989586621681655435"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655431"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655436"><span class="annot"><span class="annottext">checkMsg :: [Char]
</span><a href="#local-6989586621681655436"><span class="hs-identifier hs-var hs-var">checkMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-961"></span><span>                   </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reading &quot;</span></span><span>
</span><span id="line-962"></span><span>                   </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking&quot;</span></span><span>
</span><span id="line-963"></span><span>      </span><span id="local-6989586621681655437"><span class="annot"><span class="annottext">withMsgs :: TCM ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655437"><span class="hs-identifier hs-var hs-var">withMsgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; (() -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span>
</span><span id="line-964"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var">chaseMsg</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655436"><span class="hs-identifier hs-var">checkMsg</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655434"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Char] -&gt; TCM ()) -&gt; Maybe [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655435"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM () -&gt; () -&gt; TCM ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; () -&gt; TCM ()) -&gt; TCM () -&gt; () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681655439"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655439"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichWarnings -&gt; TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-var">getAllWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-var">AllWarnings</span></a></span><span>
</span><span id="line-966"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655442"><span class="annot"><span class="annottext">classified :: WarningsAndNonFatalErrors
</span><a href="#local-6989586621681655442"><span class="hs-identifier hs-var hs-var">classified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; WarningsAndNonFatalErrors
</span><a href="Agda.TypeChecking.Warnings.html#classifyWarnings"><span class="hs-identifier hs-var">classifyWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655439"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-967"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655444"><span class="annot"><span class="annottext">wa' :: [TCWarning]
</span><a href="#local-6989586621681655444"><span class="hs-identifier hs-var hs-var">wa'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; Bool) -&gt; [TCWarning] -&gt; [TCWarning]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TopLevelModuleName -&gt; Maybe (Maybe TopLevelModuleName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Strict.Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe TopLevelModuleName)
-&gt; Maybe (Maybe TopLevelModuleName) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Maybe TopLevelModuleName) -&gt; Bool)
-&gt; (TCWarning -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; TCWarning
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-968"></span><span>                                     </span><span class="annot"><span class="annottext">(RangeFile -&gt; Maybe TopLevelModuleName)
-&gt; Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RangeFile -&gt; Maybe TopLevelModuleName
</span><a href="Agda.Syntax.Position.html#rangeFileName"><span class="hs-identifier hs-var">rangeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; (TCWarning -&gt; Maybe RangeFile)
-&gt; TCWarning
-&gt; Maybe (Maybe TopLevelModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; Maybe RangeFile
</span><a href="Agda.TypeChecking.Monad.Base.html#tcWarningOrigin"><span class="hs-identifier hs-var">tcWarningOrigin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; [TCWarning]) -&gt; [TCWarning] -&gt; [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-969"></span><span>                             </span><span class="annot"><span class="annottext">WarningsAndNonFatalErrors -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#tcWarnings"><span class="hs-identifier hs-var">tcWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningsAndNonFatalErrors
</span><a href="#local-6989586621681655442"><span class="hs-identifier hs-var">classified</span></a></span><span>
</span><span id="line-970"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655444"><span class="hs-identifier hs-var">wa'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-971"></span><span>                     </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSDoc"><span class="hs-identifier hs-var">alwaysReportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;warning&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">P.vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; TCWarning -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">P.prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; TCMT IO Doc) -&gt; [TCWarning] -&gt; [TCMT IO Doc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655444"><span class="hs-identifier hs-var">wa'</span></a></span><span>
</span><span id="line-972"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningsAndNonFatalErrors -&gt; [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#nonFatalErrors"><span class="hs-identifier hs-var">nonFatalErrors</span></a></span><span> </span><span class="annot"><span class="annottext">WarningsAndNonFatalErrors
</span><a href="#local-6989586621681655442"><span class="hs-identifier hs-var">classified</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var">chaseMsg</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655434"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span>  </span><span class="annot"><span class="annottext">TCM ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621681655437"><span class="hs-identifier hs-var">withMsgs</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-975"></span><span>    </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Phase
</span><a href="Agda.Benchmarking.html#TopModule"><span class="hs-identifier hs-var">Bench.TopModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-976"></span><span>    </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655448"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655448"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655448"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentPath"><span class="hs-identifier hs-var">envCurrentPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681655431"><span class="hs-identifier hs-type">file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655450"><span class="annot"><span class="annottext">onlyScope :: Bool
</span><a href="#local-6989586621681655450"><span class="hs-identifier hs-var hs-var">onlyScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; MainInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Mode -&gt; MainInterface
</span><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-981"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Creating interface for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-982"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-983"></span><span>      </span><span id="local-6989586621681655451"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655451"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; [Char]) -&gt; TCMT IO Doc -&gt; TCMT IO [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). ReadTCState m =&gt; m Doc
</span><a href="Agda.TypeChecking.Monad.Imports.html#getPrettyVisitedModules"><span class="hs-identifier hs-var">getPrettyVisitedModules</span></a></span><span>
</span><span id="line-984"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  visited: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655451"><span class="hs-identifier hs-var">visited</span></a></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span>    </span><span id="local-6989586621681655452"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Source -&gt; (Source -&gt; TCM Source) -&gt; Maybe Source -&gt; TCM Source
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var">parseSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655431"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TCM Source
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621681655433"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655454"><span class="annot"><span class="annottext">srcPath :: AbsolutePath
</span><a href="#local-6989586621681655454"><span class="hs-identifier hs-var hs-var">srcPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceFile -&gt; AbsolutePath) -&gt; SourceFile -&gt; AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span>    </span><span id="local-6989586621681655455"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655455"><span class="hs-identifier hs-var">fileTokenInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO HighlightingInfo -&gt; TCMT IO HighlightingInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-var">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO HighlightingInfo -&gt; TCMT IO HighlightingInfo)
-&gt; TCMT IO HighlightingInfo -&gt; TCMT IO HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-991"></span><span>      </span><span class="annot"><span class="annottext">RangeFile -&gt; [Char] -&gt; TCMT IO HighlightingInfo
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromSource"><span class="hs-identifier hs-var">generateTokenInfoFromSource</span></a></span><span>
</span><span id="line-992"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681655457"><span class="annot"><span class="annottext">top :: TopLevelModuleName
</span><a href="#local-6989586621681655457"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-993"></span><span>         </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe TopLevelModuleName -&gt; RangeFile
</span><a href="Agda.Syntax.Position.html#mkRangeFile"><span class="hs-identifier hs-var">mkRangeFile</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655454"><span class="hs-identifier hs-var">srcPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655457"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">TL.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; Text -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; f HighlightingInfo) -&gt; TCState -&gt; f TCState
Lens' TCState HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-var">stTokens</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState HighlightingInfo
-&gt; (HighlightingInfo -&gt; HighlightingInfo) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655455"><span class="hs-identifier hs-var">fileTokenInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo -&gt; HighlightingInfo -&gt; HighlightingInfo
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>    </span><span class="annot"><span class="annottext">Source -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-var">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-998"></span><span>    </span><span class="annot"><span class="annottext">Attributes -&gt; TCM ()
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#checkAttributes"><span class="hs-identifier hs-var">checkAttributes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Attributes
</span><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var">srcAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>    </span><span id="local-6989586621681655462"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621681655462"><span class="hs-identifier hs-var">syntactic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe Int
</span><a href="Agda.Interaction.Options.Base.html#optSyntacticEquality"><span class="hs-identifier hs-var">optSyntacticEquality</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Maybe Int)
-&gt; TCMT IO PragmaOptions -&gt; TCMT IO (Maybe Int)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-1000"></span><span>    </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655464"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655464"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621681655464"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envSyntacticEqualityFuel"><span class="hs-identifier hs-var">envSyntacticEqualityFuel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681655462"><span class="hs-identifier hs-type">syntactic</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1003"></span><span>      </span><span id="local-6989586621681655466"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681655466"><span class="hs-identifier hs-var">nestingLevel</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Int) -&gt; TCMT IO Int
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (TCEnv -&gt; Int) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TopLevelModuleName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; Int)
-&gt; (TCEnv -&gt; [TopLevelModuleName]) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#envImportPath"><span class="hs-identifier hs-var">envImportPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>      </span><span id="local-6989586621681655467"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681655467"><span class="hs-identifier hs-var">highlightingLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel) -&gt; TCMT IO HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-1005"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-1006"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  nesting      level: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681655466"><span class="hs-identifier hs-var">nestingLevel</span></a></span><span>
</span><span id="line-1007"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  highlighting level: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621681655467"><span class="hs-identifier hs-var">highlightingLevel</span></a></span><span>
</span><span id="line-1008"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>    </span><span class="hs-comment">-- Scope checking.</span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Starting scope checking.&quot;</span></span><span>
</span><span id="line-1012"></span><span>    </span><span id="local-6989586621681655469"><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655469"><span class="hs-identifier hs-var">topLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO TopLevelInfo -&gt; TCMT IO TopLevelInfo
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Scoping"><span class="hs-identifier hs-var">Bench.Scoping</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO TopLevelInfo -&gt; TCMT IO TopLevelInfo)
-&gt; TCMT IO TopLevelInfo -&gt; TCMT IO TopLevelInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1013"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655471"><span class="annot"><span class="annottext">topDecls :: [Declaration]
</span><a href="#local-6989586621681655471"><span class="hs-identifier hs-var hs-var">topDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Declaration]
</span><a href="Agda.Syntax.Concrete.html#modDecls"><span class="hs-identifier hs-var">C.modDecls</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; [Declaration]) -&gt; Module -&gt; [Declaration]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1014"></span><span>      </span><span class="annot"><span class="annottext">TopLevel [Declaration]
-&gt; ScopeM (AbsOfCon (TopLevel [Declaration]))
forall c. ToAbstract c =&gt; c -&gt; ScopeM (AbsOfCon c)
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier hs-var">concreteToAbstract_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath
-&gt; TopLevelModuleName -&gt; [Declaration] -&gt; TopLevel [Declaration]
forall a. AbsolutePath -&gt; TopLevelModuleName -&gt; a -&gt; TopLevel a
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655454"><span class="hs-identifier hs-var">srcPath</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621681655471"><span class="hs-identifier hs-var">topDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished scope checking.&quot;</span></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655475"><span class="annot"><span class="annottext">ds :: [Declaration]
</span><a href="#local-6989586621681655475"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; [Declaration]
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelDecls"><span class="hs-identifier hs-var">topLevelDecls</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655469"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1018"></span><span>        </span><span id="local-6989586621681655477"><span class="annot"><span class="annottext">scope :: ScopeInfo
</span><a href="#local-6989586621681655477"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelScope"><span class="hs-identifier hs-var">topLevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655469"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-comment">-- Highlighting from scope checker.</span><span>
</span><span id="line-1021"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Starting highlighting from scope.&quot;</span></span><span>
</span><span id="line-1022"></span><span>    </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-var">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-comment">-- Generate and print approximate syntax highlighting info.</span><span>
</span><span id="line-1024"></span><span>      </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
HighlightingLevel -&gt; tcm () -&gt; tcm ()
</span><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-var">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-var">NonInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1025"></span><span>        </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655455"><span class="hs-identifier hs-var">fileTokenInfo</span></a></span><span>
</span><span id="line-1026"></span><span>      </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; Bool -&gt; TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
HighlightingLevel -&gt; Bool -&gt; tcm () -&gt; tcm ()
</span><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIsOr"><span class="hs-identifier hs-var">ifTopLevelAndHighlightingLevelIsOr</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-var">NonInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655450"><span class="hs-identifier hs-var">onlyScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1027"></span><span>        </span><span class="annot"><span class="annottext">(Declaration -&gt; TCM ()) -&gt; [Declaration] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655480"><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621681655480"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Declaration -&gt; Level -&gt; Bool -&gt; TCM ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateAndPrintSyntaxInfo"><span class="hs-identifier hs-var">generateAndPrintSyntaxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621681655480"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="Agda.Interaction.Highlighting.Generate.html#Partial"><span class="hs-identifier hs-var">Partial</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655450"><span class="hs-identifier hs-var">onlyScope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621681655475"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1028"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished highlighting from scope.&quot;</span></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span>    </span><span class="hs-comment">-- Type checking.</span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span>    </span><span class="hs-comment">-- Now that all the options are in we can check if caching should</span><span>
</span><span id="line-1034"></span><span>    </span><span class="hs-comment">-- be on.</span><span>
</span><span id="line-1035"></span><span>    </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *).
(HasOptions m, MonadDebug m, MonadTCState m) =&gt;
m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#activateLoadedFileCache"><span class="hs-identifier hs-var">activateLoadedFileCache</span></a></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span>    </span><span class="hs-comment">-- invalidate cache if pragmas change, TODO move</span><span>
</span><span id="line-1038"></span><span>    </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *).
(MonadDebug m, MonadTCState m, ReadTCState m) =&gt;
m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cachingStarts"><span class="hs-identifier hs-var">cachingStarts</span></a></span><span>
</span><span id="line-1039"></span><span>    </span><span id="local-6989586621681655485"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655485"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-1040"></span><span>    </span><span id="local-6989586621681655488"><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><a href="#local-6989586621681655488"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe (TypeCheckAction, PostScopeState))
forall (m :: * -&gt; *).
(MonadDebug m, MonadTCState m, ReadTCState m) =&gt;
m (Maybe (TypeCheckAction, PostScopeState))
</span><a href="Agda.TypeChecking.Monad.Caching.html#readFromCachedLog"><span class="hs-identifier hs-var">readFromCachedLog</span></a></span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><a href="#local-6989586621681655488"><span class="hs-identifier hs-var">me</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1042"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Pragmas"><span class="hs-identifier hs-type">Pragmas</span></a></span><span> </span><span id="local-6989586621681655491"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655491"><span class="hs-identifier hs-var">opts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PostScopeState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655485"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; PragmaOptions -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655491"><span class="hs-identifier hs-var">opts'</span></a></span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1045"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cache&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;pragma changed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><a href="#local-6989586621681655488"><span class="hs-identifier hs-var">me</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>        </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cleanCachedLog"><span class="hs-identifier hs-var">cleanCachedLog</span></a></span><span>
</span><span id="line-1047"></span><span>    </span><span class="annot"><span class="annottext">TypeCheckAction -&gt; TCM ()
forall (m :: * -&gt; *).
(MonadDebug m, MonadTCState m, ReadTCState m) =&gt;
TypeCheckAction -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#writeToCurrentLog"><span class="hs-identifier hs-var">writeToCurrentLog</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckAction -&gt; TCM ()) -&gt; TypeCheckAction -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; TypeCheckAction
</span><a href="Agda.TypeChecking.Monad.Base.html#Pragmas"><span class="hs-identifier hs-var">Pragmas</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655485"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655450"><span class="hs-identifier hs-var">onlyScope</span></a></span><span>
</span><span id="line-1050"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1051"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Skipping type checking.&quot;</span></span><span>
</span><span id="line-1052"></span><span>        </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cacheCurrentLog"><span class="hs-identifier hs-var">cacheCurrentLog</span></a></span><span>
</span><span id="line-1053"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1054"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Starting type checking.&quot;</span></span><span>
</span><span id="line-1055"></span><span>        </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Bench.Typing</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Declaration -&gt; TCM ()) -&gt; [Declaration] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Declaration -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Decl.html#checkDeclCached"><span class="hs-identifier hs-var">checkDeclCached</span></a></span><span> </span><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621681655475"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; TCM ()
forall a b. TCM a -&gt; TCM b -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Base.html#finally_"><span class="hs-operator hs-var">`finally_`</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cacheCurrentLog"><span class="hs-identifier hs-var">cacheCurrentLog</span></a></span><span>
</span><span id="line-1056"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished type checking.&quot;</span></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-comment">-- Ulf, 2013-11-09: Since we're rethrowing the error, leave it up to the</span><span>
</span><span id="line-1059"></span><span>    </span><span class="hs-comment">-- code that handles that error to reset the state.</span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-comment">-- Ulf, 2013-11-13: Errors are now caught and highlighted in InteractionTop.</span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-comment">-- catchError_ (checkDecls ds) $ \e -&gt; do</span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-comment">--   ifTopLevelAndHighlightingLevelIs NonInteractive $</span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-comment">--     printErrorInfo e</span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-comment">--   throwError e</span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span>    </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#unfreezeMetas"><span class="hs-identifier hs-var">unfreezeMetas</span></a></span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>    </span><span class="hs-comment">-- Profiling: Count number of metas.</span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-var">whenProfile</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Utils.ProfileOptions.html#Metas"><span class="hs-identifier hs-var">Profile.Metas</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>      </span><span id="local-6989586621681655501"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681655501"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO MetaId
forall i (m :: * -&gt; *). MonadFresh i m =&gt; m i
</span><a href="Agda.TypeChecking.Monad.Base.html#fresh"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-1071"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Integer -&gt; TCM ()
forall (m :: * -&gt; *).
MonadStatistics m =&gt;
[Char] -&gt; Integer -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#tickN"><span class="hs-identifier hs-var">tickN</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;metas&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Hash
</span><a href="Agda.Syntax.Common.html#metaId"><span class="hs-identifier hs-var">metaId</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681655501"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span>    </span><span class="hs-comment">-- Highlighting from type checker.</span><span>
</span><span id="line-1074"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Starting highlighting from type info.&quot;</span></span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-var">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1076"></span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-comment">-- Move any remaining token highlighting to stSyntaxInfo.</span><span>
</span><span id="line-1078"></span><span>      </span><span id="local-6989586621681655505"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655505"><span class="hs-identifier hs-var">toks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState HighlightingInfo -&gt; TCMT IO HighlightingInfo
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; f HighlightingInfo) -&gt; TCState -&gt; f TCState
Lens' TCState HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-var">stTokens</span></a></span><span>
</span><span id="line-1079"></span><span>      </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
HighlightingLevel -&gt; tcm () -&gt; tcm ()
</span><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-var">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-var">NonInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1080"></span><span>        </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655505"><span class="hs-identifier hs-var">toks</span></a></span><span>
</span><span id="line-1081"></span><span>      </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; f HighlightingInfo) -&gt; TCState -&gt; f TCState
Lens' TCState HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-var">stTokens</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState HighlightingInfo -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>      </span><span class="hs-comment">-- Grabbing warnings and unsolved metas to highlight them</span><span>
</span><span id="line-1084"></span><span>      </span><span id="local-6989586621681655510"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655510"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichWarnings -&gt; TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-var">getAllWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-var">AllWarnings</span></a></span><span>
</span><span id="line-1085"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655510"><span class="hs-identifier hs-var">warnings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1086"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;collected warnings: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; [TCWarning] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655510"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-1087"></span><span>      </span><span id="local-6989586621681655511"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655511"><span class="hs-identifier hs-var">unsolved</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllUnsolvedWarnings"><span class="hs-identifier hs-var">getAllUnsolvedWarnings</span></a></span><span>
</span><span id="line-1088"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655511"><span class="hs-identifier hs-var">unsolved</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1089"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;collected unsolved: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; [TCWarning] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655511"><span class="hs-identifier hs-var">unsolved</span></a></span><span>
</span><span id="line-1090"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655513"><span class="annot"><span class="annottext">warningInfo :: HighlightingInfo
</span><a href="#local-6989586621681655513"><span class="hs-identifier hs-var hs-var">warningInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1091"></span><span>            </span><span class="annot"><span class="annottext">HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. Convert a b =&gt; a -&gt; b
</span><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfoBuilder -&gt; HighlightingInfo)
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; HighlightingInfoBuilder)
-&gt; [TCWarning] -&gt; HighlightingInfoBuilder
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; HighlightingInfoBuilder
</span><a href="Agda.Interaction.Highlighting.Generate.html#warningHighlighting"><span class="hs-identifier hs-var">warningHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; HighlightingInfoBuilder)
-&gt; [TCWarning] -&gt; HighlightingInfoBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655511"><span class="hs-identifier hs-var">unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; [TCWarning] -&gt; [TCWarning]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655510"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>      </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; f HighlightingInfo) -&gt; TCState -&gt; f TCState
Lens' TCState HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stSyntaxInfo"><span class="hs-identifier hs-var">stSyntaxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState HighlightingInfo
-&gt; (HighlightingInfo -&gt; HighlightingInfo) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681655519"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655519"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655519"><span class="hs-identifier hs-var">inf</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo -&gt; HighlightingInfo -&gt; HighlightingInfo
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655505"><span class="hs-identifier hs-var">toks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HighlightingInfo -&gt; HighlightingInfo -&gt; HighlightingInfo
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655513"><span class="hs-identifier hs-var">warningInfo</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optGenerateVimFile"><span class="hs-identifier hs-var">optGenerateVimFile</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool)
-&gt; TCMT IO CommandLineOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-comment">-- Generate Vim file.</span><span>
</span><span id="line-1097"></span><span>        </span><span class="annot"><span class="annottext">ScopeInfo -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a. ReadTCState m =&gt; ScopeInfo -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#withScope_"><span class="hs-identifier hs-var">withScope_</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655477"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Highlighting.Vim.html#generateVimFile"><span class="hs-identifier hs-var">generateVimFile</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655454"><span class="hs-identifier hs-var">srcPath</span></a></span><span>
</span><span id="line-1098"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished highlighting from type info.&quot;</span></span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><span class="annottext">ScopeInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-var">setScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655477"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;scope.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;SCOPE &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655477"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-1102"></span><span>
</span><span id="line-1103"></span><span>    </span><span class="hs-comment">-- TODO: It would be nice if unsolved things were highlighted</span><span>
</span><span id="line-1104"></span><span>    </span><span class="hs-comment">-- after every mutual block.</span><span>
</span><span id="line-1105"></span><span>
</span><span id="line-1106"></span><span>    </span><span id="local-6989586621681655524"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621681655524"><span class="hs-identifier hs-var">openMetas</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [MetaId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [MetaId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getOpenMetas"><span class="hs-identifier hs-var">getOpenMetas</span></a></span><span>
</span><span id="line-1107"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621681655524"><span class="hs-identifier hs-var">openMetas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1108"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.metas&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;We have unsolved metas.&quot;</span></span><span>
</span><span id="line-1109"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.metas&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; TCMT IO [Char] -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Goals -&gt; TCMT IO [Char]
</span><a href="Agda.Interaction.BasicOps.html#showGoals"><span class="hs-identifier hs-var">showGoals</span></a></span><span> </span><span class="annot"><span class="annottext">(Goals -&gt; TCMT IO [Char]) -&gt; TCMT IO Goals -&gt; TCMT IO [Char]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Goals
</span><a href="Agda.Interaction.BasicOps.html#getGoals"><span class="hs-identifier hs-var">getGoals</span></a></span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span>    </span><span class="annot"><span class="annottext">HighlightingLevel -&gt; TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
HighlightingLevel -&gt; tcm () -&gt; tcm ()
</span><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-var">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#NonInteractive"><span class="hs-identifier hs-var">NonInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#printUnsolvedInfo"><span class="hs-identifier hs-var">printUnsolvedInfo</span></a></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-08-03, issue #964</span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-comment">-- When open metas are allowed,</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-comment">-- permanently freeze them now by turning them into postulates.</span><span>
</span><span id="line-1116"></span><span>    </span><span class="hs-comment">-- This will enable serialization.</span><span>
</span><span id="line-1117"></span><span>    </span><span class="hs-comment">-- savedMetaStore &lt;- useTC stMetaStore</span><span>
</span><span id="line-1118"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MainInterface -&gt; Bool
</span><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-var">includeStateChanges</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1119"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-11-15, re issue #3393:</span><span>
</span><span id="line-1120"></span><span>      </span><span class="hs-comment">-- We do not get here when checking the main module</span><span>
</span><span id="line-1121"></span><span>      </span><span class="hs-comment">-- (then includeStateChanges is True).</span><span>
</span><span id="line-1122"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optAllowUnsolved"><span class="hs-identifier hs-var">optAllowUnsolved</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1123"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Turning unsolved metas (if any) into postulates.&quot;</span></span><span>
</span><span id="line-1124"></span><span>        </span><span class="annot"><span class="annottext">ModuleName -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; ModuleName -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#withCurrentModule"><span class="hs-identifier hs-var">withCurrentModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655477"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Lens' ScopeInfo ModuleName -&gt; ModuleName
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; f ModuleName) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-var">scopeCurrent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.MetaVars.html#openMetasToPostulates"><span class="hs-identifier hs-var">openMetasToPostulates</span></a></span><span>
</span><span id="line-1125"></span><span>        </span><span class="hs-comment">-- Clear constraints as they might refer to what</span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-comment">-- they think are open metas.</span><span>
</span><span id="line-1127"></span><span>        </span><span class="annot"><span class="annottext">(Constraints -&gt; f Constraints) -&gt; TCState -&gt; f TCState
Lens' TCState Constraints
</span><a href="Agda.TypeChecking.Monad.Base.html#stAwakeConstraints"><span class="hs-identifier hs-var">stAwakeConstraints</span></a></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState Constraints -&gt; Constraints -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1128"></span><span>        </span><span class="annot"><span class="annottext">(Constraints -&gt; f Constraints) -&gt; TCState -&gt; f TCState
Lens' TCState Constraints
</span><a href="Agda.TypeChecking.Monad.Base.html#stSleepingConstraints"><span class="hs-identifier hs-var">stSleepingConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState Constraints -&gt; Constraints -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-comment">-- Serialization.</span><span>
</span><span id="line-1131"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Starting serialization.&quot;</span></span><span>
</span><span id="line-1132"></span><span>    </span><span id="local-6989586621681655538"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655538"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-var">Bench.Serialization</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#BuildInterface"><span class="hs-identifier hs-var">Bench.BuildInterface</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCMT IO Interface)
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1133"></span><span>      </span><span class="annot"><span class="annottext">Source -&gt; TopLevelInfo -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-var">buildInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655452"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655469"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [[Char]] -&gt; TCM ()
forall a (m :: * -&gt; *).
(ReportS a, MonadDebug m) =&gt;
[Char] -&gt; Int -&gt; a -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [[Char]] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-var">reportS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">101</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; TCM ()) -&gt; [[Char]] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1136"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Signature:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [[Char]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-1138"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655542"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-1139"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681655544"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  def:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621681655545"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-1141"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1142"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681655542"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655542"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655544"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681655544"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [(QName, Definition)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; [(QName, Definition)])
-&gt; HashMap QName Definition -&gt; [(QName, Definition)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655538"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' Signature (HashMap QName Definition)
-&gt; HashMap QName Definition
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; f (HashMap QName Definition))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName Definition)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1143"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funCompiled :: Defn -&gt; Maybe CompiledClauses
</span><a href="Agda.TypeChecking.Monad.Base.html#funCompiled"><span class="hs-identifier hs-var">funCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681655545"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621681655545"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681655544"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1144"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1145"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished serialization.&quot;</span></span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>    </span><span id="local-6989586621681655553"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655553"><span class="hs-identifier hs-var">mallWarnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; WhichWarnings -&gt; TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
MainInterface -&gt; WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var">getAllWarnings'</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#ErrorWarnings"><span class="hs-identifier hs-var">ErrorWarnings</span></a></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Considering writing to interface file.&quot;</span></span><span>
</span><span id="line-1150"></span><span>    </span><span id="local-6989586621681655554"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655554"><span class="hs-identifier hs-var">finalIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-var">constructIScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Interface) -&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655553"><span class="hs-identifier hs-var">mallWarnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1151"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCWarning
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCWarning]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-11-15, re issue #3393</span><span>
</span><span id="line-1153"></span><span>        </span><span class="hs-comment">-- The following is not sufficient to fix #3393</span><span>
</span><span id="line-1154"></span><span>        </span><span class="hs-comment">-- since the replacement of metas by postulates did not happen.</span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-comment">-- -- | not (allowUnsolved &amp;&amp; all (isUnsolvedWarning . tcWarning) allWarnings) -&gt; do</span><span>
</span><span id="line-1156"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;We have warnings, skipping writing interface file.&quot;</span></span><span>
</span><span id="line-1157"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655538"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1158"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1159"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;We are just scope-checking, skipping writing interface file.&quot;</span></span><span>
</span><span id="line-1160"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655538"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1161"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-var">Bench.Serialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCMT IO Interface)
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Actually calling writeInterface.&quot;</span></span><span>
</span><span id="line-1163"></span><span>        </span><span class="hs-comment">-- The file was successfully type-checked (and no warnings were</span><span>
</span><span id="line-1164"></span><span>        </span><span class="hs-comment">-- encountered), so the interface should be written out.</span><span>
</span><span id="line-1165"></span><span>        </span><span id="local-6989586621681655555"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655555"><span class="hs-identifier hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCM AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#toIFile"><span class="hs-identifier hs-var">toIFile</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621681655431"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1166"></span><span>        </span><span id="local-6989586621681655557"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655557"><span class="hs-identifier hs-var">serializedIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Interface -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-var">writeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655555"><span class="hs-identifier hs-var">ifile</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655538"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1167"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished writing to interface file.&quot;</span></span><span>
</span><span id="line-1168"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655557"><span class="hs-identifier hs-var">serializedIface</span></a></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-comment">-- -- Restore the open metas, as we might continue in interaction mode.</span><span>
</span><span id="line-1171"></span><span>    </span><span class="hs-comment">-- Actually, we do not serialize the metas if checking the MainInterface</span><span>
</span><span id="line-1172"></span><span>    </span><span class="hs-comment">-- stMetaStore `setTCLens` savedMetaStore</span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span>    </span><span class="hs-comment">-- Profiling: Print statistics.</span><span>
</span><span id="line-1175"></span><span>    </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName -&gt; Statistics -&gt; TCM ()
forall (m :: * -&gt; *).
(MonadDebug m, MonadTCEnv m, HasOptions m) =&gt;
Maybe TopLevelModuleName -&gt; Statistics -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#printStatistics"><span class="hs-identifier hs-var">printStatistics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655430"><span class="hs-identifier hs-var">mname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Statistics -&gt; TCM ()) -&gt; TCMT IO Statistics -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Statistics
forall (m :: * -&gt; *). ReadTCState m =&gt; m Statistics
</span><a href="Agda.TypeChecking.Monad.Statistics.html#getStatistics"><span class="hs-identifier hs-var">getStatistics</span></a></span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>    </span><span class="hs-comment">-- Get the statistics of the current module</span><span>
</span><span id="line-1178"></span><span>    </span><span class="hs-comment">-- and add it to the accumulated statistics.</span><span>
</span><span id="line-1179"></span><span>    </span><span id="local-6989586621681655560"><span class="annot"><span class="annottext">Statistics
</span><a href="#local-6989586621681655560"><span class="hs-identifier hs-var">localStatistics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Statistics
forall (m :: * -&gt; *). ReadTCState m =&gt; m Statistics
</span><a href="Agda.TypeChecking.Monad.Statistics.html#getStatistics"><span class="hs-identifier hs-var">getStatistics</span></a></span><span>
</span><span id="line-1180"></span><span>    </span><span class="annot"><span class="annottext">(Statistics -&gt; f Statistics) -&gt; TCState -&gt; f TCState
Lens' TCState Statistics
</span><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatistics"><span class="hs-identifier hs-var">lensAccumStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState Statistics -&gt; (Statistics -&gt; Statistics) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; Statistics -&gt; Statistics -&gt; Statistics
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">Statistics
</span><a href="#local-6989586621681655560"><span class="hs-identifier hs-var">localStatistics</span></a></span><span>
</span><span id="line-1181"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Accumulated statistics.&quot;</span></span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>    </span><span id="local-6989586621681655566"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655566"><span class="hs-identifier hs-var">isPrimitiveModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadIO m =&gt; [Char] -&gt; m Bool
</span><a href="Agda.Interaction.Options.Lenses.html#isPrimitiveModule"><span class="hs-identifier hs-var">Lens.isPrimitiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621681655454"><span class="hs-identifier hs-var">srcPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>
</span><span id="line-1185"></span><span>    </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1186"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miInterface :: Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655554"><span class="hs-identifier hs-var">finalIface</span></a></span><span>
</span><span id="line-1187"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miWarnings :: [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655553"><span class="hs-identifier hs-var">mallWarnings</span></a></span><span>
</span><span id="line-1188"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miPrimitive :: Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681655566"><span class="hs-identifier hs-var">isPrimitiveModule</span></a></span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miMode :: ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-var">moduleCheckMode</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621681655432"><span class="hs-identifier hs-var">isMain</span></a></span><span>
</span><span id="line-1190"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- | Expert version of 'getAllWarnings'; if 'isMain' is a</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- 'MainInterface', the warnings definitely include also unsolved</span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- warnings.</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span id="local-6989586621681653418"><span class="annot"><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-type">getAllWarnings'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621681653418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681653418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681653418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681653418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#WhichWarnings"><span class="hs-identifier hs-type">WhichWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681653418"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1197"></span><span id="getAllWarnings%27"><span class="annot"><span class="annottext">getAllWarnings' :: forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
MainInterface -&gt; WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var hs-var">getAllWarnings'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set WarningName -&gt; WhichWarnings -&gt; m [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
Set WarningName -&gt; WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarningsPreserving"><span class="hs-identifier hs-var">getAllWarningsPreserving</span></a></span><span> </span><span class="annot"><span class="annottext">Set WarningName
</span><a href="Agda.Interaction.Options.Warnings.html#unsolvedWarnings"><span class="hs-identifier hs-var">unsolvedWarnings</span></a></span><span>
</span><span id="line-1198"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var">getAllWarnings'</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set WarningName -&gt; WhichWarnings -&gt; m [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
Set WarningName -&gt; WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarningsPreserving"><span class="hs-identifier hs-var">getAllWarningsPreserving</span></a></span><span> </span><span class="annot"><span class="annottext">Set WarningName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span class="hs-comment">-- Andreas, issue 964: not checking null interactionPoints</span><span>
</span><span id="line-1201"></span><span class="hs-comment">-- anymore; we want to serialize with open interaction points now!</span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- | Reconstruct the 'iScope' (not serialized)</span><span>
</span><span id="line-1204"></span><span class="hs-comment">--   from the 'iInsideScope' (serialized).</span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span class="annot"><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-type">constructIScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1207"></span><span id="constructIScope"><span class="annot"><span class="annottext">constructIScope :: Interface -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-var hs-var">constructIScope</span></a></span></span><span> </span><span id="local-6989586621681655581"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655581"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Phase] -&gt; Interface -&gt; Interface
forall a. [Phase] -&gt; a -&gt; a
</span><a href="Agda.Benchmarking.html#billToPure"><span class="hs-identifier hs-var">billToPure</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-var">Deserialization</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Interface) -&gt; Interface -&gt; Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1208"></span><span>  </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655581"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#publicModules"><span class="hs-identifier hs-type">publicModules</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681655581"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span class="hs-comment">-- | Builds an interface for the current module, which should already</span><span>
</span><span id="line-1211"></span><span class="hs-comment">-- have been successfully type checked.</span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span class="annot"><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-type">buildInterface</span></a></span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-1215"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ 'Source' for the current module.</span></span><span>
</span><span id="line-1216"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevelInfo"><span class="hs-identifier hs-type">TopLevelInfo</span></a></span><span>
</span><span id="line-1217"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ 'TopLevelInfo' scope information for the current module.</span></span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1219"></span><span id="buildInterface"><span class="annot"><span class="annottext">buildInterface :: Source -&gt; TopLevelInfo -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-var hs-var">buildInterface</span></a></span></span><span> </span><span id="local-6989586621681655585"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621681655586"><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655586"><span class="hs-identifier hs-var">topLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1220"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Building interface...&quot;</span></span><span>
</span><span id="line-1221"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655587"><span class="annot"><span class="annottext">mname :: ModuleName
</span><a href="#local-6989586621681655587"><span class="hs-identifier hs-var hs-var">mname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ModuleName
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelModuleName"><span class="hs-identifier hs-var">CToA.topLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655586"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1222"></span><span>        </span><span id="local-6989586621681655589"><span class="annot"><span class="annottext">source :: Text
</span><a href="#local-6989586621681655589"><span class="hs-identifier hs-var hs-var">source</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1223"></span><span>        </span><span id="local-6989586621681655590"><span class="annot"><span class="annottext">fileType :: FileType
</span><a href="#local-6989586621681655590"><span class="hs-identifier hs-var hs-var">fileType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; FileType
</span><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var">srcFileType</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1224"></span><span>        </span><span id="local-6989586621681655591"><span class="annot"><span class="annottext">defPragmas :: [OptionsPragma]
</span><a href="#local-6989586621681655591"><span class="hs-identifier hs-var hs-var">defPragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var">srcDefaultPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1225"></span><span>        </span><span id="local-6989586621681655592"><span class="annot"><span class="annottext">filePragmas :: [OptionsPragma]
</span><a href="#local-6989586621681655592"><span class="hs-identifier hs-var hs-var">filePragmas</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var">srcFilePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-comment">-- Andreas, 2014-05-03: killRange did not result in significant reduction</span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-comment">-- of .agdai file size, and lost a few seconds performance on library-test.</span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-comment">-- Andreas, Makoto, 2014-10-18 AIM XX: repeating the experiment</span><span>
</span><span id="line-1229"></span><span>    </span><span class="hs-comment">-- with discarding also the nameBindingSite in QName:</span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-comment">-- Saves 10% on serialization time (and file size)!</span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1232"></span><span>    </span><span class="hs-comment">-- NOTE: We no longer discard all nameBindingSites (but the commit</span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-comment">-- that introduced this change seems to have made Agda a bit</span><span>
</span><span id="line-1234"></span><span>    </span><span class="hs-comment">-- faster and interface file sizes a bit smaller, at least for the</span><span>
</span><span id="line-1235"></span><span>    </span><span class="hs-comment">-- standard library).</span><span>
</span><span id="line-1236"></span><span>    </span><span id="local-6989586621681655593"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681655593"><span class="hs-identifier hs-var">builtin</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
-&gt; TCMT IO (Map SomeBuiltin (Builtin PrimFun))
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin PrimFun)
 -&gt; f (Map SomeBuiltin (Builtin PrimFun)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
</span><a href="Agda.TypeChecking.Monad.Base.html#stLocalBuiltins"><span class="hs-identifier hs-var">stLocalBuiltins</span></a></span><span>
</span><span id="line-1237"></span><span>    </span><span id="local-6989586621681655597"><span class="annot"><span class="annottext">[(TopLevelModuleName, Hash)]
</span><a href="#local-6989586621681655597"><span class="hs-identifier hs-var">mhs</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; TCMT IO (TopLevelModuleName, Hash))
-&gt; [TopLevelModuleName] -&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655599"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655599"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655599"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; (TopLevelModuleName, Hash))
-&gt; TCM Hash -&gt; TCMT IO (TopLevelModuleName, Hash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var">moduleHash</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655599"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; TCMT IO [(TopLevelModuleName, Hash)])
-&gt; (Set TopLevelModuleName -&gt; [TopLevelModuleName])
-&gt; Set TopLevelModuleName
-&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-1238"></span><span>                   </span><span class="annot"><span class="annottext">Set TopLevelModuleName -&gt; [TopLevelModuleName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Set TopLevelModuleName -&gt; TCMT IO [(TopLevelModuleName, Hash)])
-&gt; TCMT IO (Set TopLevelModuleName)
-&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span>
</span><span id="line-1239"></span><span>                   </span><span class="annot"><span class="annottext">Lens' TCState (Set TopLevelModuleName)
-&gt; TCMT IO (Set TopLevelModuleName)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TopLevelModuleName -&gt; f (Set TopLevelModuleName))
-&gt; TCState -&gt; f TCState
Lens' TCState (Set TopLevelModuleName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedModules"><span class="hs-identifier hs-var">stImportedModules</span></a></span><span>
</span><span id="line-1240"></span><span>    </span><span id="local-6989586621681655605"><span class="annot"><span class="annottext">Map [Char] ForeignCodeStack
</span><a href="#local-6989586621681655605"><span class="hs-identifier hs-var">foreignCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map [Char] ForeignCodeStack)
-&gt; TCMT IO (Map [Char] ForeignCodeStack)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map [Char] ForeignCodeStack -&gt; f (Map [Char] ForeignCodeStack))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map [Char] ForeignCodeStack)
</span><a href="Agda.TypeChecking.Monad.Base.html#stForeignCode"><span class="hs-identifier hs-var">stForeignCode</span></a></span><span>
</span><span id="line-1241"></span><span>    </span><span class="hs-comment">-- Ulf, 2016-04-12:</span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-comment">-- Non-closed display forms are not applicable outside the module anyway,</span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-comment">-- and should be dead-code eliminated (#1928).</span><span>
</span><span id="line-1244"></span><span>    </span><span id="local-6989586621681655609"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655609"><span class="hs-identifier hs-var">origDisplayForms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Open DisplayForm] -&gt; Bool) -&gt; DisplayForms -&gt; DisplayForms
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([Open DisplayForm] -&gt; Bool) -&gt; [Open DisplayForm] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Open DisplayForm] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayForms -&gt; DisplayForms)
-&gt; (DisplayForms -&gt; DisplayForms) -&gt; DisplayForms -&gt; DisplayForms
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Open DisplayForm] -&gt; [Open DisplayForm])
-&gt; DisplayForms -&gt; DisplayForms
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Open DisplayForm -&gt; Bool)
-&gt; [Open DisplayForm] -&gt; [Open DisplayForm]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Open DisplayForm -&gt; Bool
forall a. Open a -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Open.html#isClosed"><span class="hs-identifier hs-var">isClosed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayForms -&gt; DisplayForms)
-&gt; TCMT IO DisplayForms -&gt; TCMT IO DisplayForms
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState DisplayForms -&gt; TCMT IO DisplayForms
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayForms -&gt; f DisplayForms) -&gt; TCState -&gt; f TCState
Lens' TCState DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportsDisplayForms"><span class="hs-identifier hs-var">stImportsDisplayForms</span></a></span><span>
</span><span id="line-1245"></span><span>    </span><span class="hs-comment">-- TODO: Kill some ranges?</span><span>
</span><span id="line-1246"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655616"><span class="annot"><span class="annottext">scope :: ScopeInfo
</span><a href="#local-6989586621681655616"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelScope"><span class="hs-identifier hs-var">topLevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621681655586"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-comment">-- Andreas, Oskar, 2023-10-19, issue #6931:</span><span>
</span><span id="line-1248"></span><span>    </span><span class="hs-comment">-- To not delete module telescopes of empty public modules,</span><span>
</span><span id="line-1249"></span><span>    </span><span class="hs-comment">-- we need to pass the public modules to the dead-code elimination</span><span>
</span><span id="line-1250"></span><span>    </span><span class="hs-comment">-- (to be mined for additional roots for the reachability analysis).</span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681655617"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655617"><span class="hs-identifier hs-var">display</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655618"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681655618"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655619"><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681655619"><span class="hs-identifier hs-var">solvedMetas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1252"></span><span>      </span><span class="annot"><span class="annottext">Map ModuleName Scope
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; DisplayForms
-&gt; Signature
-&gt; LocalMetaStore
-&gt; TCM (DisplayForms, Signature, RemoteMetaStore)
forall a.
Map ModuleName a
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; DisplayForms
-&gt; Signature
-&gt; LocalMetaStore
-&gt; TCM (DisplayForms, Signature, RemoteMetaStore)
</span><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-var">eliminateDeadCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo -&gt; Map ModuleName Scope
</span><a href="Agda.Syntax.Scope.Base.html#publicModules"><span class="hs-identifier hs-var">publicModules</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655616"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681655593"><span class="hs-identifier hs-var">builtin</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655609"><span class="hs-identifier hs-var">origDisplayForms</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature
 -&gt; LocalMetaStore
 -&gt; TCM (DisplayForms, Signature, RemoteMetaStore))
-&gt; (TCMT IO Signature, TCMT IO LocalMetaStore)
-&gt; TCM (DisplayForms, Signature, RemoteMetaStore)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; m c) -&gt; (m a, m b) -&gt; m c
</span><a href="Agda.Utils.Monad.html#%3D%3D%3C%3C"><span class="hs-operator hs-var">==&lt;&lt;</span></a></span><span>
</span><span id="line-1253"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Signature
forall (m :: * -&gt; *). ReadTCState m =&gt; m Signature
</span><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-var">getSignature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Lens' TCState LocalMetaStore -&gt; TCMT IO LocalMetaStore
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalMetaStore -&gt; f LocalMetaStore) -&gt; TCState -&gt; f TCState
Lens' TCState LocalMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#stSolvedMetaStore"><span class="hs-identifier hs-var">stSolvedMetaStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>    </span><span id="local-6989586621681655626"><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681655626"><span class="hs-identifier hs-var">userwarns</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map QName Text) -&gt; TCMT IO (Map QName Text)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map QName Text -&gt; f (Map QName Text)) -&gt; TCState -&gt; f TCState
Lens' TCState (Map QName Text)
</span><a href="Agda.TypeChecking.Monad.Base.html#stLocalUserWarnings"><span class="hs-identifier hs-var">stLocalUserWarnings</span></a></span><span>
</span><span id="line-1255"></span><span>    </span><span id="local-6989586621681655630"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621681655630"><span class="hs-identifier hs-var">importwarn</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Maybe Text) -&gt; TCMT IO (Maybe Text)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; f (Maybe Text)) -&gt; TCState -&gt; f TCState
Lens' TCState (Maybe Text)
</span><a href="Agda.TypeChecking.Monad.Base.html#stWarningOnImport"><span class="hs-identifier hs-var">stWarningOnImport</span></a></span><span>
</span><span id="line-1256"></span><span>    </span><span id="local-6989586621681655634"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655634"><span class="hs-identifier hs-var">syntaxInfo</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState HighlightingInfo -&gt; TCMT IO HighlightingInfo
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfo -&gt; f HighlightingInfo) -&gt; TCState -&gt; f TCState
Lens' TCState HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stSyntaxInfo"><span class="hs-identifier hs-var">stSyntaxInfo</span></a></span><span>
</span><span id="line-1257"></span><span>    </span><span id="local-6989586621681655637"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655637"><span class="hs-identifier hs-var">optionsUsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-1258"></span><span>    </span><span id="local-6989586621681655640"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681655640"><span class="hs-identifier hs-var">partialDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; TCMT IO (Set QName)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stLocalPartialDefs"><span class="hs-identifier hs-var">stLocalPartialDefs</span></a></span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span>    </span><span class="hs-comment">-- Only serialise the opaque blocks actually defined in this</span><span>
</span><span id="line-1261"></span><span>    </span><span class="hs-comment">-- top-level module.</span><span>
</span><span id="line-1262"></span><span>    </span><span id="local-6989586621681655644"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655644"><span class="hs-identifier hs-var">opaqueBlocks'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map OpaqueId OpaqueBlock)
-&gt; TCMT IO (Map OpaqueId OpaqueBlock)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map OpaqueId OpaqueBlock -&gt; f (Map OpaqueId OpaqueBlock))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map OpaqueId OpaqueBlock)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-var">stOpaqueBlocks</span></a></span><span>
</span><span id="line-1263"></span><span>    </span><span id="local-6989586621681655647"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655647"><span class="hs-identifier hs-var">opaqueIds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Map QName OpaqueId) -&gt; TCMT IO (Map QName OpaqueId)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map QName OpaqueId -&gt; f (Map QName OpaqueId))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map QName OpaqueId)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-var">stOpaqueIds</span></a></span><span>
</span><span id="line-1264"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1265"></span><span>      </span><span id="local-6989586621681655650"><span class="annot"><span class="annottext">mh :: ModuleNameHash
</span><a href="#local-6989586621681655650"><span class="hs-identifier hs-var hs-var">mh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; ModuleNameHash
forall range. TopLevelModuleName' range -&gt; ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameId"><span class="hs-identifier hs-var">moduleNameId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>      </span><span id="local-6989586621681655652"><span class="annot"><span class="annottext">opaqueBlocks :: Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655652"><span class="hs-identifier hs-var hs-var">opaqueBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OpaqueId -&gt; OpaqueBlock -&gt; Bool)
-&gt; Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681655655"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655655"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OpaqueBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655655"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655650"><span class="hs-identifier hs-var">mh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655644"><span class="hs-identifier hs-var">opaqueBlocks'</span></a></span><span>
</span><span id="line-1267"></span><span>      </span><span id="local-6989586621681655656"><span class="annot"><span class="annottext">isLocal :: QName -&gt; Bool
</span><a href="#local-6989586621681655656"><span class="hs-identifier hs-var hs-var">isLocal</span></a></span></span><span> </span><span id="local-6989586621681655657"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655657"><span class="hs-identifier hs-var">qnm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655657"><span class="hs-identifier hs-var">qnm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1268"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-type">NameId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681655661"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655661"><span class="hs-identifier hs-var">mh'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655661"><span class="hs-identifier hs-var">mh'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655650"><span class="hs-identifier hs-var">mh</span></a></span><span>
</span><span id="line-1269"></span><span>      </span><span id="local-6989586621681655662"><span class="annot"><span class="annottext">opaqueIds :: Map QName OpaqueId
</span><a href="#local-6989586621681655662"><span class="hs-identifier hs-var hs-var">opaqueIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; OpaqueId -&gt; Bool)
-&gt; Map QName OpaqueId -&gt; Map QName OpaqueId
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681655663"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655663"><span class="hs-identifier hs-var">qnm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681655664"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655664"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Bool
</span><a href="#local-6989586621681655656"><span class="hs-identifier hs-var">isLocal</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681655663"><span class="hs-identifier hs-var">qnm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655664"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681655650"><span class="hs-identifier hs-var">mh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655647"><span class="hs-identifier hs-var">opaqueIds'</span></a></span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-02-09 kill ranges in pattern synonyms before</span><span>
</span><span id="line-1272"></span><span>    </span><span class="hs-comment">-- serialization to avoid error locations pointing to external files</span><span>
</span><span id="line-1273"></span><span>    </span><span class="hs-comment">-- when expanding a pattern synonym.</span><span>
</span><span id="line-1274"></span><span>    </span><span id="local-6989586621681655666"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681655666"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; PatternSynDefns)
-&gt; TCMT IO PatternSynDefns -&gt; TCMT IO PatternSynDefns
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var">getPatternSyns</span></a></span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655669"><span class="annot"><span class="annottext">builtin' :: Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="#local-6989586621681655669"><span class="hs-identifier hs-var hs-var">builtin'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeBuiltin -&gt; Builtin PrimFun -&gt; Builtin (PrimitiveId, QName))
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin (PrimitiveId, QName))
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681655671"><span class="annot"><span class="annottext">SomeBuiltin
</span><a href="#local-6989586621681655671"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681655672"><span class="annot"><span class="annottext">Builtin PrimFun
</span><a href="#local-6989586621681655672"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeBuiltin -&gt; PrimFun -&gt; (PrimitiveId, QName)
</span><a href="#local-6989586621681655673"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><a href="#local-6989586621681655671"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimFun -&gt; (PrimitiveId, QName))
-&gt; Builtin PrimFun -&gt; Builtin (PrimitiveId, QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builtin PrimFun
</span><a href="#local-6989586621681655672"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621681655593"><span class="hs-identifier hs-var">builtin</span></a></span><span>
</span><span id="line-1276"></span><span>    </span><span id="local-6989586621681655674"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655674"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; Bool) -&gt; [TCWarning] -&gt; [TCWarning]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningName -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#isSourceCodeWarning"><span class="hs-identifier hs-var">isSourceCodeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningName -&gt; Bool)
-&gt; (TCWarning -&gt; WarningName) -&gt; TCWarning -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; WarningName
</span><a href="Agda.TypeChecking.Monad.Base.html#warningName"><span class="hs-identifier hs-var">warningName</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; WarningName)
-&gt; (TCWarning -&gt; Warning) -&gt; TCWarning -&gt; WarningName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#tcWarning"><span class="hs-identifier hs-var">tcWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; [TCWarning])
-&gt; TCMT IO [TCWarning] -&gt; TCMT IO [TCWarning]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhichWarnings -&gt; TCMT IO [TCWarning]
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m, MonadWarning m, MonadTCM m) =&gt;
WhichWarnings -&gt; m [TCWarning]
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-var">getAllWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-var">AllWarnings</span></a></span><span>
</span><span id="line-1277"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655678"><span class="annot"><span class="annottext">i :: Interface
</span><a href="#local-6989586621681655678"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1278"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iSourceHash :: Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681655589"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iSource :: Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iSource"><span class="hs-identifier hs-var">iSource</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681655589"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1280"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iFileType :: FileType
</span><a href="Agda.TypeChecking.Monad.Base.html#iFileType"><span class="hs-identifier hs-var">iFileType</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621681655590"><span class="hs-identifier hs-var">fileType</span></a></span><span>
</span><span id="line-1281"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iImportedModules :: [(TopLevelModuleName, Hash)]
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TopLevelModuleName, Hash)]
</span><a href="#local-6989586621681655597"><span class="hs-identifier hs-var">mhs</span></a></span><span>
</span><span id="line-1282"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iModuleName :: ModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681655587"><span class="hs-identifier hs-var">mname</span></a></span><span>
</span><span id="line-1283"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iTopLevelModuleName :: TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621681655585"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1284"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iScope :: Map ModuleName Scope
</span><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName Scope
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-comment">-- publicModules scope</span><span>
</span><span id="line-1285"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iInsideScope :: ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681655616"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-1286"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iSignature :: Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681655618"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1287"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iMetaBindings :: RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#iMetaBindings"><span class="hs-identifier hs-var">iMetaBindings</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681655619"><span class="hs-identifier hs-var">solvedMetas</span></a></span><span>
</span><span id="line-1288"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iDisplayForms :: DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#iDisplayForms"><span class="hs-identifier hs-var">iDisplayForms</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681655617"><span class="hs-identifier hs-var">display</span></a></span><span>
</span><span id="line-1289"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iUserWarnings :: Map QName Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iUserWarnings"><span class="hs-identifier hs-var">iUserWarnings</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map QName Text
</span><a href="#local-6989586621681655626"><span class="hs-identifier hs-var">userwarns</span></a></span><span>
</span><span id="line-1290"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iImportWarning :: Maybe Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621681655630"><span class="hs-identifier hs-var">importwarn</span></a></span><span>
</span><span id="line-1291"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iBuiltin :: Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="Agda.TypeChecking.Monad.Base.html#iBuiltin"><span class="hs-identifier hs-var">iBuiltin</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="#local-6989586621681655669"><span class="hs-identifier hs-var">builtin'</span></a></span><span>
</span><span id="line-1292"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iForeignCode :: Map [Char] ForeignCodeStack
</span><a href="Agda.TypeChecking.Monad.Base.html#iForeignCode"><span class="hs-identifier hs-var">iForeignCode</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] ForeignCodeStack
</span><a href="#local-6989586621681655605"><span class="hs-identifier hs-var">foreignCode</span></a></span><span>
</span><span id="line-1293"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iHighlighting :: HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621681655634"><span class="hs-identifier hs-var">syntaxInfo</span></a></span><span>
</span><span id="line-1294"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iDefaultPragmaOptions :: [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#iDefaultPragmaOptions"><span class="hs-identifier hs-var">iDefaultPragmaOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621681655591"><span class="hs-identifier hs-var">defPragmas</span></a></span><span>
</span><span id="line-1295"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iFilePragmaOptions :: [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#iFilePragmaOptions"><span class="hs-identifier hs-var">iFilePragmaOptions</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621681655592"><span class="hs-identifier hs-var">filePragmas</span></a></span><span>
</span><span id="line-1296"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOptionsUsed :: PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#iOptionsUsed"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621681655637"><span class="hs-identifier hs-var">optionsUsed</span></a></span><span>
</span><span id="line-1297"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iPatternSyns :: PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#iPatternSyns"><span class="hs-identifier hs-var">iPatternSyns</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681655666"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-1298"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iWarnings :: [TCWarning]
</span><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621681655674"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-1299"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iPartialDefs :: Set QName
</span><a href="Agda.TypeChecking.Monad.Base.html#iPartialDefs"><span class="hs-identifier hs-var">iPartialDefs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681655640"><span class="hs-identifier hs-var">partialDefs</span></a></span><span>
</span><span id="line-1300"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOpaqueBlocks :: Map OpaqueId OpaqueBlock
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueBlocks"><span class="hs-identifier hs-var">iOpaqueBlocks</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621681655652"><span class="hs-identifier hs-var">opaqueBlocks</span></a></span><span>
</span><span id="line-1301"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOpaqueNames :: Map QName OpaqueId
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueNames"><span class="hs-identifier hs-var">iOpaqueNames</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621681655662"><span class="hs-identifier hs-var">opaqueIds</span></a></span><span>
</span><span id="line-1302"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1303"></span><span>    </span><span id="local-6989586621681655684"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655684"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1304"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool
-&gt; TCMT IO Interface -&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optSaveMetas"><span class="hs-identifier hs-var">optSaveMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1305"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655678"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span>
</span><span id="line-1307"></span><span>              </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  instantiating all meta variables&quot;</span></span><span>
</span><span id="line-1308"></span><span>            </span><span class="hs-comment">-- Note that the meta-variables in the definitions in</span><span>
</span><span id="line-1309"></span><span>            </span><span class="hs-comment">-- &quot;sig&quot; have already been instantiated (by</span><span>
</span><span id="line-1310"></span><span>            </span><span class="hs-comment">-- eliminateDeadCode).</span><span>
</span><span id="line-1311"></span><span>            </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *). MonadReduce m =&gt; Interface -&gt; m Interface
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFullExceptForDefinitions"><span class="hs-identifier hs-var">instantiateFullExceptForDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655678"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  interface complete&quot;</span></span><span>
</span><span id="line-1313"></span><span>    </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621681655684"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1316"></span><span>      </span><span id="local-6989586621681655673"><span class="annot"><span class="annottext">primName :: SomeBuiltin -&gt; PrimFun -&gt; (PrimitiveId, QName)
</span><a href="#local-6989586621681655673"><span class="hs-identifier hs-var hs-var">primName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#PrimitiveName"><span class="hs-identifier hs-type">PrimitiveName</span></a></span><span> </span><span id="local-6989586621681655691"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621681655691"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681655692"><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621681655692"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621681655691"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimFun -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#primFunName"><span class="hs-identifier hs-var">primFunName</span></a></span><span> </span><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621681655692"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>      </span><span class="annot"><a href="#local-6989586621681655673"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#BuiltinName"><span class="hs-identifier hs-type">BuiltinName</span></a></span><span> </span><span id="local-6989586621681655693"><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621681655693"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621681655694"><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621681655694"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimitiveId, QName)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span class="hs-comment">-- | Returns (iSourceHash, iFullHash)</span><span>
</span><span id="line-1320"></span><span class="hs-comment">--   We do not need to check that the file exist because we only</span><span>
</span><span id="line-1321"></span><span class="hs-comment">--   accept @InterfaceFile@ as an input and not arbitrary @AbsolutePath@!</span><span>
</span><span id="line-1322"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-type">getInterfaceFileHashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#InterfaceFile"><span class="hs-identifier hs-type">InterfaceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span id="getInterfaceFileHashes"><span class="annot"><span class="annottext">getInterfaceFileHashes :: InterfaceFile -&gt; IO (Maybe (Hash, Hash))
</span><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-var hs-var">getInterfaceFileHashes</span></a></span></span><span> </span><span id="local-6989586621681655695"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655695"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1324"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655696"><span class="annot"><span class="annottext">ifile :: [Char]
</span><a href="#local-6989586621681655696"><span class="hs-identifier hs-var hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621681655695"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-1325"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681655697"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655697"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681655698"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681655698"><span class="hs-identifier hs-var">close</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO (ByteString, IO ())
</span><a href="Agda.Utils.IO.Binary.html#readBinaryFile%27"><span class="hs-identifier hs-var">readBinaryFile'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681655696"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-1326"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681655699"><span class="annot"><span class="annottext">hs :: Maybe (Hash, Hash)
</span><a href="#local-6989586621681655699"><span class="hs-identifier hs-var hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Hash, Hash)
</span><a href="Agda.TypeChecking.Serialise.html#decodeHashes"><span class="hs-identifier hs-var">decodeHashes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681655697"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1327"></span><span>  </span><span class="annot"><span class="annottext">Hash -&gt; ((Hash, Hash) -&gt; Hash) -&gt; Maybe (Hash, Hash) -&gt; Hash
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Hash -&gt; Hash -&gt; Hash) -&gt; (Hash, Hash) -&gt; Hash
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Hash
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash, Hash)
</span><a href="#local-6989586621681655699"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; IO () -&gt; IO ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681655698"><span class="hs-identifier hs-var">close</span></a></span><span>
</span><span id="line-1328"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Hash, Hash) -&gt; IO (Maybe (Hash, Hash))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Hash, Hash)
</span><a href="#local-6989586621681655699"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-type">moduleHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span>
</span><span id="line-1331"></span><span id="moduleHash"><span class="annot"><span class="annottext">moduleHash :: TopLevelModuleName -&gt; TCM Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var hs-var">moduleHash</span></a></span></span><span> </span><span id="local-6989586621681655702"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655702"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Hash) -&gt; TCMT IO Interface -&gt; TCM Hash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var">getNonMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681655702"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1332"></span></pre></body></html>