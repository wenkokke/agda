<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Computing the polarity (variance) of function arguments,</span><span>
</span><span id="line-2"></span><span class="hs-comment">--   for the sake of subtyping.</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.Polarity</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Polarity computation</span></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#computePolarity"><span class="hs-identifier">computePolarity</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Auxiliary functions</span></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier">composePol</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#nextPolarity"><span class="hs-identifier">nextPolarity</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#purgeNonvariant"><span class="hs-identifier">purgeNonvariant</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polFromOcc"><span class="hs-identifier">polFromOcc</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWithM</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#getNumberOfParameters"><span class="hs-identifier">getNumberOfParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.html"><span class="hs-identifier">Agda.TypeChecking.SizedTypes</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier">whenNothingM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-43"></span><span class="annot"><span class="hs-comment">-- * Polarity lattice.</span></span><span>
</span><span id="line-44"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">-- | Infimum on the information lattice.</span><span>
</span><span id="line-47"></span><span class="hs-comment">--   'Invariant' is bottom (dominant for inf),</span><span>
</span><span id="line-48"></span><span class="hs-comment">--   'Nonvariant' is top (neutral for inf).</span><span>
</span><span id="line-49"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#%2F%5C"><span class="hs-operator hs-type">(/\)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span>
</span><span id="line-50"></span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span id="%2F%5C"><span class="annot"><span class="annottext">/\ :: Polarity -&gt; Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#%2F%5C"><span class="hs-operator hs-var hs-var">/\</span></a></span></span><span> </span><span id="local-6989586621681525755"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525755"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525755"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-51"></span><span id="local-6989586621681525756"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525756"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525756"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-52"></span><span id="local-6989586621681525757"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525757"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a></span><span> </span><span id="local-6989586621681525758"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525758"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525757"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525758"><span class="hs-identifier hs-var">b</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525757"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-53"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | 'Polarity' negation, swapping monotone and antitone.</span></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-type">neg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span>
</span><span id="line-57"></span><span id="neg"><span class="annot"><span class="annottext">neg :: Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var hs-var">neg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Contravariant"><span class="hs-identifier hs-var">Contravariant</span></a></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Contravariant"><span class="hs-identifier hs-var">Contravariant</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><span class="hs-comment">-- | What is the polarity of a function composition?</span></span><span>
</span><span id="line-63"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-type">composePol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span>
</span><span id="line-64"></span><span id="composePol"><span class="annot"><span class="annottext">composePol :: Polarity -&gt; Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var hs-var">composePol</span></a></span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var">composePol</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>
</span><span id="line-66"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var">composePol</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>
</span><span id="line-67"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var">composePol</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span> </span><span id="local-6989586621681525762"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525762"><span class="hs-identifier hs-var">x</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525762"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var">composePol</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Contravariant"><span class="hs-identifier hs-var">Contravariant</span></a></span><span> </span><span id="local-6989586621681525763"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525763"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525763"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polFromOcc"><span class="hs-identifier hs-type">polFromOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span>
</span><span id="line-71"></span><span id="polFromOcc"><span class="annot"><span class="annottext">polFromOcc :: Occurrence -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#polFromOcc"><span class="hs-identifier hs-var hs-var">polFromOcc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Contravariant"><span class="hs-identifier hs-var">Contravariant</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Unused</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- * Auxiliary functions</span></span><span>
</span><span id="line-81"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><span class="hs-comment">-- | Get the next polarity from a list, 'Invariant' if empty.</span></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#nextPolarity"><span class="hs-identifier hs-type">nextPolarity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="nextPolarity"><span class="annot"><span class="annottext">nextPolarity :: [Polarity] -&gt; (Polarity, [Polarity])
</span><a href="Agda.TypeChecking.Polarity.html#nextPolarity"><span class="hs-identifier hs-var hs-var">nextPolarity</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#nextPolarity"><span class="hs-identifier hs-var">nextPolarity</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681525770"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525770"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681525771"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525771"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525770"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525771"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | Replace 'Nonvariant' by 'Covariant'.</span><span>
</span><span id="line-89"></span><span class="hs-comment">--   (Arbitrary bias, but better than 'Invariant', see issue 1596).</span><span>
</span><span id="line-90"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#purgeNonvariant"><span class="hs-identifier hs-type">purgeNonvariant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span id="purgeNonvariant"><span class="annot"><span class="annottext">purgeNonvariant :: [Polarity] -&gt; [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#purgeNonvariant"><span class="hs-identifier hs-var hs-var">purgeNonvariant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Polarity -&gt; Polarity) -&gt; [Polarity] -&gt; [Polarity]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681525772"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525772"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525772"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681525772"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><span class="hs-comment">-- | A quick transliterations of occurrences to polarities.</span></span><span>
</span><span id="line-95"></span><span id="local-6989586621681525449"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarityFromPositivity"><span class="hs-identifier hs-type">polarityFromPositivity</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525449"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525449"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525449"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525449"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525449"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-98"></span><span id="polarityFromPositivity"><span class="annot"><span class="annottext">polarityFromPositivity :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadTCEnv m, MonadTCState m, MonadDebug m) =&gt;
QName -&gt; m ()
</span><a href="Agda.TypeChecking.Polarity.html#polarityFromPositivity"><span class="hs-identifier hs-var hs-var">polarityFromPositivity</span></a></span></span><span> </span><span id="local-6989586621681525796"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525796"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasConstInfo m) =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525796"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; m ()) -&gt; m ()) -&gt; (Definition -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681525798"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525798"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-comment">-- Get basic polarity from positivity analysis.</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681525799"><span class="annot"><span class="annottext">npars :: Int
</span><a href="#local-6989586621681525799"><span class="hs-identifier hs-var hs-var">npars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Signature.html#droppedPars"><span class="hs-identifier hs-var">droppedPars</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525798"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681525801"><span class="annot"><span class="annottext">pol0 :: [Polarity]
</span><a href="#local-6989586621681525801"><span class="hs-identifier hs-var hs-var">pol0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Polarity]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525799"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; Polarity) -&gt; [Occurrence] -&gt; [Polarity]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#polFromOcc"><span class="hs-identifier hs-var">polFromOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; [Occurrence]
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525798"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ()) -&gt; [Char] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Polarity of &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525796"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; from positivity: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525801"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-comment">-- set the polarity in the signature (not the final polarity, though)</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; [Polarity] -&gt; m ()
forall (m :: * -&gt; *).
(MonadTCState m, MonadDebug m) =&gt;
QName -&gt; [Polarity] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#setPolarity"><span class="hs-identifier hs-var">setPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525796"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([Polarity] -&gt; m ()) -&gt; [Polarity] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity] -&gt; [Polarity]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525799"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525801"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">-- * Computing the polarity of a symbol.</span></span><span>
</span><span id="line-111"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><span class="hs-comment">-- | Main function of this module.</span></span><span>
</span><span id="line-114"></span><span id="local-6989586621681525475"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#computePolarity"><span class="hs-identifier hs-type">computePolarity</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier hs-type">HasBuiltins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-116"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#MonadAddContext"><span class="hs-identifier hs-type">MonadAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-117"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-119"></span><span id="computePolarity"><span class="annot"><span class="annottext">computePolarity :: forall (m :: * -&gt; *).
(HasOptions m, HasConstInfo m, HasBuiltins m, MonadTCEnv m,
 MonadTCState m, MonadReduce m, MonadAddContext m, MonadTCError m,
 MonadDebug m, MonadPretty m) =&gt;
[QName] -&gt; m ()
</span><a href="Agda.TypeChecking.Polarity.html#computePolarity"><span class="hs-identifier hs-var hs-var">computePolarity</span></a></span></span><span> </span><span id="local-6989586621681525919"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681525919"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span> </span><span class="hs-comment">-- Andreas, 2017-04-26, issue #2554</span><span>
</span><span id="line-122"></span><span> </span><span class="hs-comment">-- First, for mutual definitions, obtain a crude polarity from positivity.</span><span>
</span><span id="line-123"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[QName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681525919"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; m ()) -&gt; [QName] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m ()
forall (m :: * -&gt; *).
(HasConstInfo m, MonadTCEnv m, MonadTCState m, MonadDebug m) =&gt;
QName -&gt; m ()
</span><a href="Agda.TypeChecking.Polarity.html#polarityFromPositivity"><span class="hs-identifier hs-var">polarityFromPositivity</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681525919"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span> </span><span class="hs-comment">-- Then, refine it.</span><span>
</span><span id="line-126"></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; (QName -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681525919"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; m ()) -&gt; m ()) -&gt; (QName -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681525923"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasConstInfo m) =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; m ()) -&gt; m ()) -&gt; (Definition -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681525924"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525924"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ()) -&gt; [Char] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Refining polarity of &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-comment">-- Again: get basic polarity from positivity analysis.</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681525925"><span class="annot"><span class="annottext">npars :: Int
</span><a href="#local-6989586621681525925"><span class="hs-identifier hs-var hs-var">npars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Signature.html#droppedPars"><span class="hs-identifier hs-var">droppedPars</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525924"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681525926"><span class="annot"><span class="annottext">pol0 :: [Polarity]
</span><a href="#local-6989586621681525926"><span class="hs-identifier hs-var hs-var">pol0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Polarity]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525925"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; Polarity) -&gt; [Occurrence] -&gt; [Polarity]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#polFromOcc"><span class="hs-identifier hs-var">polFromOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; [Occurrence]
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525924"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ()) -&gt; [Char] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Polarity of &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; from positivity: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525926"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">{-
  -- get basic polarity from shape of def (arguments matched on or not?)
  def      &lt;- getConstInfo x
  let usagePol = usagePolarity $ theDef def
  reportSLn &quot;tc.polarity.set&quot; 15 $ &quot;Polarity of &quot; ++ prettyShow x ++ &quot; from definition form: &quot; ++ prettyShow usagePol
  let n = genericLength usagePol  -- n &lt;- getArity x
  reportSLn &quot;tc.polarity.set&quot; 20 $ &quot;  arity = &quot; ++ show n

  -- refine polarity by positivity information
  pol0 &lt;- zipWith (/\) usagePol &lt;$&gt; mapM getPol [0..n - 1]
  reportSLn &quot;tc.polarity.set&quot; 15 $ &quot;Polarity of &quot; ++ prettyShow x ++ &quot; from positivity: &quot; ++ prettyShow pol0
-}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- compute polarity of sized types</span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621681525927"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525927"><span class="hs-identifier hs-var">pol1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *).
(HasOptions m, HasConstInfo m, HasBuiltins m, ReadTCState m,
 MonadTCEnv m, MonadTCState m, MonadReduce m, MonadAddContext m,
 MonadTCError m, MonadDebug m, MonadPretty m) =&gt;
QName -&gt; [Polarity] -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#sizePolarity"><span class="hs-identifier hs-var">sizePolarity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525926"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-comment">-- refine polarity again by using type information</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681525929"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621681525929"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525924"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-comment">-- Instantiation takes place in Rules.Decl.instantiateDefinitionType</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-comment">-- t &lt;- instantiateFull t -- Andreas, 2014-04-11 Issue 1099: needed for</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">--                        -- variable occurrence test in  dependentPolarity.</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Refining polarity with type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681525929"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Refining polarity with type (raw): &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc) -&gt; (Type -&gt; [Char]) -&gt; Type -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Type -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681525929"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621681525937"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525937"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Polarity] -&gt; [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m, MonadReduce m, MonadAddContext m,
 MonadDebug m) =&gt;
Type -&gt; [Polarity] -&gt; [Polarity] -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-var">dependentPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681525929"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; [Polarity] -&gt; [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#enablePhantomTypes"><span class="hs-identifier hs-var">enablePhantomTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681525924"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525927"><span class="hs-identifier hs-var">pol1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525927"><span class="hs-identifier hs-var">pol1</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.set&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ()) -&gt; [Char] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Polarity of &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525937"><span class="hs-identifier hs-var">pol</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">-- set the polarity in the signature</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; [Polarity] -&gt; m ()
forall (m :: * -&gt; *).
(MonadTCState m, MonadDebug m) =&gt;
QName -&gt; [Polarity] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#setPolarity"><span class="hs-identifier hs-var">setPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681525923"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([Polarity] -&gt; m ()) -&gt; [Polarity] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity] -&gt; [Polarity]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525925"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525937"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="hs-comment">-- purgeNonvariant pol -- temporarily disable non-variance</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Data and record parameters are used as phantom arguments all over</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   the test suite (and possibly in user developments).</span><span>
</span><span id="line-169"></span><span class="hs-comment">--   @enablePhantomTypes@ turns 'Nonvariant' parameters to 'Covariant'</span><span>
</span><span id="line-170"></span><span class="hs-comment">--   to enable phantoms.</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#enablePhantomTypes"><span class="hs-identifier hs-type">enablePhantomTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span id="enablePhantomTypes"><span class="annot"><span class="annottext">enablePhantomTypes :: Defn -&gt; [Polarity] -&gt; [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#enablePhantomTypes"><span class="hs-identifier hs-var hs-var">enablePhantomTypes</span></a></span></span><span> </span><span id="local-6989586621681525941"><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681525941"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621681525942"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525942"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681525941"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dataPars :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#dataPars"><span class="hs-identifier hs-var">dataPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681525945"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525945"><span class="hs-identifier hs-var">np</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity]
</span><a href="#local-6989586621681525946"><span class="hs-identifier hs-var">enable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525945"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recPars :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#recPars"><span class="hs-identifier hs-var">recPars</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681525949"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525949"><span class="hs-identifier hs-var">np</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity]
</span><a href="#local-6989586621681525946"><span class="hs-identifier hs-var">enable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525949"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525942"><span class="hs-identifier hs-var">pol</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681525946"><span class="annot"><span class="annottext">enable :: Int -&gt; [Polarity]
</span><a href="#local-6989586621681525946"><span class="hs-identifier hs-var hs-var">enable</span></a></span></span><span> </span><span id="local-6989586621681525950"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525950"><span class="hs-identifier hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681525951"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525951"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681525952"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525952"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity] -&gt; ([Polarity], [Polarity])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681525950"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525942"><span class="hs-identifier hs-var">pol</span></a></span><span>
</span><span id="line-177"></span><span>                    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#purgeNonvariant"><span class="hs-identifier hs-var">purgeNonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525951"><span class="hs-identifier hs-var">pars</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681525952"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">{- UNUSED
-- | Extract a basic approximate polarity info from the shape of definition.
--   Arguments that are matched against get 'Invariant', others 'Nonvariant'.
--   For data types, parameters get 'Nonvariant', indices 'Invariant'.
usagePolarity :: Defn -&gt; [Polarity]
usagePolarity def = case def of
    Axiom{}                                 -&gt; []
    Function{ funClauses = [] }             -&gt; []
    Function{ funClauses = cs }             -&gt; usage $ map namedClausePats cs
    Datatype{ dataPars = np, dataIxs = ni } -&gt; genericReplicate np Nonvariant
    Record{ recPars = n }                   -&gt; genericReplicate n Nonvariant
    Constructor{}                           -&gt; []
    Primitive{}                             -&gt; []
  where
    usage = foldr1 (zipWith (/\)) . map (map (usagePat . namedArg))
    usagePat VarP{} = Nonvariant
    usagePat DotP{} = Nonvariant
    usagePat ConP{} = Invariant
    usagePat LitP{} = Invariant
-}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | Make arguments 'Invariant' if the type of a not-'Nonvariant'</span><span>
</span><span id="line-201"></span><span class="hs-comment">--   later argument depends on it.</span><span>
</span><span id="line-202"></span><span class="hs-comment">--   Also, enable phantom types by turning 'Nonvariant' into something</span><span>
</span><span id="line-203"></span><span class="hs-comment">--   else if it is a data/record parameter but not a size argument. [See issue 1596]</span><span>
</span><span id="line-204"></span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span class="hs-comment">--   Precondition: the &quot;phantom&quot; polarity list has the same length as the polarity list.</span><span>
</span><span id="line-206"></span><span id="local-6989586621681525536"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-type">dependentPolarity</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier hs-type">HasBuiltins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#MonadAddContext"><span class="hs-identifier hs-type">MonadAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525536"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-209"></span><span id="dependentPolarity"><span class="annot"><span class="annottext">dependentPolarity :: forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m, MonadReduce m, MonadAddContext m,
 MonadDebug m) =&gt;
Type -&gt; [Polarity] -&gt; [Polarity] -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-var hs-var">dependentPolarity</span></a></span></span><span> </span><span id="local-6989586621681526026"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526026"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- all remaining are 'Invariant'</span><span>
</span><span id="line-210"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-var">dependentPolarity</span></a></span><span> </span><span id="local-6989586621681526027"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526027"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [Polarity]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-var">dependentPolarity</span></a></span><span> </span><span id="local-6989586621681526029"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526029"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681526030"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526030"><span class="hs-identifier hs-var">q</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681526031"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526031"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681526032"><span class="annot"><span class="annottext">pols :: [Polarity]
</span><a href="#local-6989586621681526032"><span class="hs-identifier hs-var">pols</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681526033"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526033"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681526034"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526034"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621681526035"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526035"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; Term -&gt; m Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526029"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.dep&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;dependentPolarity t = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526035"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.dep&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;dependentPolarity t = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc) -&gt; (Term -&gt; [Char]) -&gt; Term -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526035"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526035"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621681526039"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526039"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681526040"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526040"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>      </span><span id="local-6989586621681526041"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526041"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; (Type -&gt; m [Polarity]) -&gt; m [Polarity]
forall a (m :: * -&gt; *) b.
(Subst a, MonadAddContext m) =&gt;
Dom Type -&gt; Abs a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Context.html#underAbstraction"><span class="hs-identifier hs-var">underAbstraction</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526039"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526040"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; m [Polarity]) -&gt; m [Polarity])
-&gt; (Type -&gt; m [Polarity]) -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526043"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526043"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Polarity] -&gt; [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m, MonadReduce m, MonadAddContext m,
 MonadDebug m) =&gt;
Type -&gt; [Polarity] -&gt; [Polarity] -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#dependentPolarity"><span class="hs-identifier hs-var">dependentPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526043"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526031"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526034"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526044"><span class="annot"><span class="annottext">fallback :: m Polarity
</span><a href="#local-6989586621681526044"><span class="hs-identifier hs-var hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m Polarity -&gt; m Polarity -&gt; m Polarity
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe BoundedSize -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe BoundedSize -&gt; Bool) -&gt; m (Maybe BoundedSize) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Maybe BoundedSize)
forall a (m :: * -&gt; *).
(IsSizeType a, HasOptions m, HasBuiltins m) =&gt;
a -&gt; m (Maybe BoundedSize)
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m) =&gt;
Type -&gt; m (Maybe BoundedSize)
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#isSizeType"><span class="hs-identifier hs-var">isSizeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526039"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; m Polarity
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526033"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; m Polarity
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526030"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621681526050"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526050"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526040"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526033"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>          </span><span class="hs-comment">-- Andreas, 2014-04-11 see Issue 1099</span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-comment">-- Free variable analysis is not in the monad,</span><span>
</span><span id="line-223"></span><span>          </span><span class="hs-comment">-- hence metas must have been instantiated before!</span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">m Bool -&gt; m Polarity -&gt; m Polarity -&gt; m Polarity
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; [Polarity] -&gt; m Bool
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Int -&gt; Type -&gt; [Polarity] -&gt; m Bool
</span><a href="Agda.TypeChecking.Polarity.html#relevantInIgnoringNonvariant"><span class="hs-identifier hs-var">relevantInIgnoringNonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526040"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526041"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-comment">{- then -}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; m Polarity
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-comment">{- else -}</span><span> </span><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526044"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">Abs Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526044"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([Polarity] -&gt; m [Polarity]) -&gt; [Polarity] -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526050"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; [Polarity] -&gt; [Polarity]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526041"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526032"><span class="hs-identifier hs-var">pols</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- | Check whether a variable is relevant in a type expression,</span><span>
</span><span id="line-232"></span><span class="hs-comment">--   ignoring domains of non-variant arguments.</span><span>
</span><span id="line-233"></span><span id="local-6989586621681525573"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#relevantInIgnoringNonvariant"><span class="hs-identifier hs-type">relevantInIgnoringNonvariant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525573"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525573"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-234"></span><span id="relevantInIgnoringNonvariant"><span class="annot"><span class="annottext">relevantInIgnoringNonvariant :: forall (m :: * -&gt; *).
MonadReduce m =&gt;
Int -&gt; Type -&gt; [Polarity] -&gt; m Bool
</span><a href="Agda.TypeChecking.Polarity.html#relevantInIgnoringNonvariant"><span class="hs-identifier hs-var hs-var">relevantInIgnoringNonvariant</span></a></span></span><span> </span><span id="local-6989586621681526081"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526081"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526082"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526082"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m Bool) -&gt; Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526081"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Bool
forall t. Free t =&gt; Int -&gt; t -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#relevantInIgnoringSortAnn"><span class="hs-operator hs-var">`relevantInIgnoringSortAnn`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526082"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#relevantInIgnoringNonvariant"><span class="hs-identifier hs-var">relevantInIgnoringNonvariant</span></a></span><span> </span><span id="local-6989586621681526084"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526084"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526085"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526085"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681526086"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526086"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681526087"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526087"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; (Type -&gt; m Bool) -&gt; (Dom Type -&gt; Abs Type -&gt; m Bool) -&gt; m Bool
forall (m :: * -&gt; *) a.
MonadReduce m =&gt;
Type -&gt; (Type -&gt; m a) -&gt; (Dom Type -&gt; Abs Type -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Telescope.html#ifNotPiType"><span class="hs-identifier hs-var">ifNotPiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526085"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526089"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526089"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m Bool) -&gt; Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526084"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Bool
forall t. Free t =&gt; Int -&gt; t -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#relevantInIgnoringSortAnn"><span class="hs-operator hs-var">`relevantInIgnoringSortAnn`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526089"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Dom Type -&gt; Abs Type -&gt; m Bool) -&gt; m Bool)
-&gt; (Dom Type -&gt; Abs Type -&gt; m Bool) -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526090"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526090"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681526091"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526091"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526086"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526084"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Dom Type -&gt; Bool
forall t. Free t =&gt; Int -&gt; t -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#relevantInIgnoringSortAnn"><span class="hs-operator hs-var">`relevantInIgnoringSortAnn`</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526090"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; [Polarity] -&gt; m Bool
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Int -&gt; Type -&gt; [Polarity] -&gt; m Bool
</span><a href="Agda.TypeChecking.Polarity.html#relevantInIgnoringNonvariant"><span class="hs-identifier hs-var">relevantInIgnoringNonvariant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526084"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526091"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526087"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-244"></span><span class="annot"><span class="hs-comment">-- * Sized types</span></span><span>
</span><span id="line-245"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Hack for polarity of size indices.</span><span>
</span><span id="line-248"></span><span class="hs-comment">--   As a side effect, this sets the positivity of the size index.</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   See test/succeed/PolaritySizeSucData.agda for a case where this is needed.</span><span>
</span><span id="line-250"></span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#sizePolarity"><span class="hs-identifier hs-type">sizePolarity</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681525526"><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-252"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier hs-type">HasBuiltins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-253"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#MonadAddContext"><span class="hs-identifier hs-type">MonadAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-254"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span id="sizePolarity"><span class="annot"><span class="annottext">sizePolarity :: forall (m :: * -&gt; *).
(HasOptions m, HasConstInfo m, HasBuiltins m, ReadTCState m,
 MonadTCEnv m, MonadTCState m, MonadReduce m, MonadAddContext m,
 MonadTCError m, MonadDebug m, MonadPretty m) =&gt;
QName -&gt; [Polarity] -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Polarity.html#sizePolarity"><span class="hs-identifier hs-var hs-var">sizePolarity</span></a></span></span><span> </span><span id="local-6989586621681526231"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526231"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681526232"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526232"><span class="hs-identifier hs-var">pol0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526233"><span class="annot"><span class="annottext">exit :: m [Polarity]
</span><a href="#local-6989586621681526233"><span class="hs-identifier hs-var hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526232"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">m Bool -&gt; m [Polarity] -&gt; m [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="annot"><span class="annottext">m Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#sizedTypesOption"><span class="hs-identifier hs-var">sizedTypesOption</span></a></span><span> </span><span class="annot"><span class="annottext">m [Polarity]
</span><a href="#local-6989586621681526233"><span class="hs-identifier hs-var">exit</span></a></span><span> </span><span class="annot"><span class="annottext">(m [Polarity] -&gt; m [Polarity]) -&gt; m [Polarity] -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">{- else -}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621681526236"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681526236"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526231"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681526236"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dataPars :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#dataPars"><span class="hs-identifier hs-var">dataPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681526238"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526238"><span class="hs-identifier hs-var">np</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dataCons :: Defn -&gt; [QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681526240"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681526240"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621681526242"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526242"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TelV Type
</span><a href="Agda.TypeChecking.Substitute.html#telView%27"><span class="hs-identifier hs-var">telView'</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TelV Type) -&gt; Type -&gt; TelV Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681526236"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681526244"><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621681526244"><span class="hs-identifier hs-var">parTel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681526245"><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621681526245"><span class="hs-identifier hs-var">ixTel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Dom ([Char], Type)]
-&gt; ([Dom ([Char], Type)], [Dom ([Char], Type)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526238"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom ([Char], Type)]
 -&gt; ([Dom ([Char], Type)], [Dom ([Char], Type)]))
-&gt; [Dom ([Char], Type)]
-&gt; ([Dom ([Char], Type)], [Dom ([Char], Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom ([Char], Type)]
forall t. Tele (Dom t) -&gt; [Dom ([Char], t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526242"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621681526245"><span class="hs-identifier hs-var">ixTel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m [Polarity]
</span><a href="#local-6989586621681526233"><span class="hs-identifier hs-var">exit</span></a></span><span>  </span><span class="hs-comment">-- No size index</span><span>
</span><span id="line-266"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681526248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526248"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m [Polarity] -&gt; m [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe BoundedSize -&gt; Maybe BoundedSize -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">BoundedSize -&gt; Maybe BoundedSize
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BoundedSize
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#BoundedNo"><span class="hs-identifier hs-var">BoundedNo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe BoundedSize -&gt; Bool) -&gt; m (Maybe BoundedSize) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Maybe BoundedSize)
forall a (m :: * -&gt; *).
(IsSizeType a, HasOptions m, HasBuiltins m) =&gt;
a -&gt; m (Maybe BoundedSize)
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m) =&gt;
Type -&gt; m (Maybe BoundedSize)
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#isSizeType"><span class="hs-identifier hs-var">isSizeType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526248"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m [Polarity]
</span><a href="#local-6989586621681526233"><span class="hs-identifier hs-var">exit</span></a></span><span> </span><span class="annot"><span class="annottext">(m [Polarity] -&gt; m [Polarity]) -&gt; m [Polarity] -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-comment">-- we assume the size index to be 'Covariant' ...</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526250"><span class="annot"><span class="annottext">pol :: [Polarity]
</span><a href="#local-6989586621681526250"><span class="hs-identifier hs-var hs-var">pol</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Polarity] -&gt; [Polarity]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526238"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526232"><span class="hs-identifier hs-var">pol0</span></a></span><span>
</span><span id="line-269"></span><span>                </span><span id="local-6989586621681526252"><span class="annot"><span class="annottext">polCo :: [Polarity]
</span><a href="#local-6989586621681526252"><span class="hs-identifier hs-var hs-var">polCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526250"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>                </span><span id="local-6989586621681526253"><span class="annot"><span class="annottext">polIn :: [Polarity]
</span><a href="#local-6989586621681526253"><span class="hs-identifier hs-var hs-var">polIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526250"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>            </span><span class="annot"><span class="annottext">QName -&gt; [Polarity] -&gt; m ()
forall (m :: * -&gt; *).
(MonadTCState m, MonadDebug m) =&gt;
QName -&gt; [Polarity] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#setPolarity"><span class="hs-identifier hs-var">setPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526231"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">([Polarity] -&gt; m ()) -&gt; [Polarity] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526252"><span class="hs-identifier hs-var">polCo</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-comment">-- and seek confirm it by looking at the constructor types</span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681526254"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-274"></span><span>                </span><span id="local-6989586621681526254"><span class="annot"><span class="annottext">check :: QName -&gt; m Bool
</span><a href="#local-6989586621681526254"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621681526255"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526255"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>                  </span><span id="local-6989586621681526256"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526256"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Type) -&gt; m Definition -&gt; m Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526255"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-276"></span><span>                  </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; m Bool -&gt; m Bool
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom ([Char], Type)] -&gt; Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621681526244"><span class="hs-identifier hs-var">parTel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; m Bool) -&gt; m Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526259"><span class="annot"><span class="annottext">pars :: [Arg Term]
</span><a href="#local-6989586621681526259"><span class="hs-identifier hs-var hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Arg Term) -&gt; [Int] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; (Int -&gt; Term) -&gt; Int -&gt; Arg Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Arg Term]) -&gt; [Int] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526238"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-278"></span><span>                    </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621681526263"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526263"><span class="hs-identifier hs-var">conTel</span></a></span></span><span> </span><span id="local-6989586621681526264"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526264"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; m (TelV Type)) -&gt; m Type -&gt; m (TelV Type)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526256"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Arg Term] -&gt; m Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; a -&gt; m Type
forall (m :: * -&gt; *).
(MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; [Arg Term] -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-operator hs-var">`piApplyM`</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681526259"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; Tele (Dom Type) -&gt; m Bool
</span><a href="#local-6989586621681526268"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526264"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526263"><span class="hs-identifier hs-var">conTel</span></a></span><span>
</span><span id="line-280"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>                  </span><span class="annot"><a href="#local-6989586621681526268"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525526"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-282"></span><span>                  </span><span class="hs-comment">-- no suitable size argument</span><span>
</span><span id="line-283"></span><span>                  </span><span id="local-6989586621681526268"><span class="annot"><span class="annottext">loop :: Type -&gt; Tele (Dom Type) -&gt; m Bool
</span><a href="#local-6989586621681526268"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>                    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-285"></span><span>                      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526255"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;fails size polarity check&quot;</span></span><span>
</span><span id="line-286"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>                  </span><span class="hs-comment">-- try argument @dom@</span><span>
</span><span id="line-289"></span><span>                  </span><span class="annot"><a href="#local-6989586621681526268"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621681526271"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526271"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621681526273"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526273"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681526274"><span class="annot"><span class="annottext">Abs (Tele (Dom Type))
</span><a href="#local-6989586621681526274"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>                    </span><span id="local-6989586621681526275"><span class="annot"><span class="annottext">Maybe BoundedSize
</span><a href="#local-6989586621681526275"><span class="hs-identifier hs-var">isSz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; m (Maybe BoundedSize)
forall a (m :: * -&gt; *).
(IsSizeType a, HasOptions m, HasBuiltins m) =&gt;
a -&gt; m (Maybe BoundedSize)
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m) =&gt;
Dom Type -&gt; m (Maybe BoundedSize)
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#isSizeType"><span class="hs-identifier hs-var">isSizeType</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526273"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-291"></span><span>                    </span><span class="annot"><span class="annottext">Dom Type
-&gt; Abs (Tele (Dom Type)) -&gt; (Tele (Dom Type) -&gt; m Bool) -&gt; m Bool
forall a (m :: * -&gt; *) b.
(Subst a, MonadAddContext m) =&gt;
Dom Type -&gt; Abs a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Context.html#underAbstraction"><span class="hs-identifier hs-var">underAbstraction</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526273"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs (Tele (Dom Type))
</span><a href="#local-6989586621681526274"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">((Tele (Dom Type) -&gt; m Bool) -&gt; m Bool)
-&gt; (Tele (Dom Type) -&gt; m Bool) -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526276"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526276"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526277"><span class="annot"><span class="annottext">continue :: m Bool
</span><a href="#local-6989586621681526277"><span class="hs-identifier hs-var hs-var">continue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Tele (Dom Type) -&gt; m Bool
</span><a href="#local-6989586621681526268"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526271"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526276"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>                      </span><span class="hs-comment">-- check that dom == Size</span><span>
</span><span id="line-295"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe BoundedSize
</span><a href="#local-6989586621681526275"><span class="hs-identifier hs-var">isSz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BoundedSize -&gt; Maybe BoundedSize -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">BoundedSize -&gt; Maybe BoundedSize
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BoundedSize
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#BoundedNo"><span class="hs-identifier hs-var">BoundedNo</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621681526277"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>                        </span><span class="hs-comment">-- check that the size argument appears in the</span><span>
</span><span id="line-298"></span><span>                        </span><span class="hs-comment">-- right spot in the target type</span><span>
</span><span id="line-299"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526278"><span class="annot"><span class="annottext">sizeArg :: Int
</span><a href="#local-6989586621681526278"><span class="hs-identifier hs-var hs-var">sizeArg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526276"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-300"></span><span>                        </span><span id="local-6989586621681526280"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681526280"><span class="hs-identifier hs-var">isLin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; m Bool -&gt; m Bool
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526276"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; m Bool) -&gt; m Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Int -&gt; Type -&gt; m Bool
forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadDebug m, MonadPretty m,
 MonadTCError m) =&gt;
QName -&gt; Int -&gt; Type -&gt; m Bool
</span><a href="Agda.TypeChecking.Polarity.html#checkSizeIndex"><span class="hs-identifier hs-var">checkSizeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526231"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526278"><span class="hs-identifier hs-var">sizeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526271"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-301"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681526280"><span class="hs-identifier hs-var">isLin</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621681526277"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>                          </span><span class="hs-comment">-- check that only positive occurences in tel</span><span>
</span><span id="line-304"></span><span>                          </span><span id="local-6989586621681526283"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526283"><span class="hs-identifier hs-var">pols</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Type -&gt; m Polarity) -&gt; [Int] -&gt; [Type] -&gt; m [Polarity]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; m Polarity
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; a -&gt; m Polarity
</span><a href="Agda.TypeChecking.Polarity.html#polarity"><span class="hs-identifier hs-var">polarity</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; m [Polarity]) -&gt; [Type] -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom ([Char], Type) -&gt; Type) -&gt; [Dom ([Char], Type)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char], Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(([Char], Type) -&gt; Type)
-&gt; (Dom ([Char], Type) -&gt; ([Char], Type))
-&gt; Dom ([Char], Type)
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom ([Char], Type) -&gt; ([Char], Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom ([Char], Type)] -&gt; [Type]) -&gt; [Dom ([Char], Type)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom ([Char], Type)]
forall t. Tele (Dom t) -&gt; [Dom ([Char], t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681526276"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-305"></span><span>                          </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-306"></span><span>                            </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc) -&gt; [Char] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;to pass size polarity check, the following polarities need all to be covariant: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526283"><span class="hs-identifier hs-var">pols</span></a></span><span>
</span><span id="line-307"></span><span>                          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Polarity -&gt; Bool) -&gt; [Polarity] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; [Polarity] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526283"><span class="hs-identifier hs-var">pols</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621681526277"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>                            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-309"></span><span>                              </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526255"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;passes size polarity check&quot;</span></span><span>
</span><span id="line-310"></span><span>                            </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><span class="annottext">m Bool -&gt; m [Polarity] -&gt; m [Polarity] -&gt; m [Polarity]
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[m Bool] -&gt; m Bool
forall (f :: * -&gt; *) (m :: * -&gt; *).
(Foldable f, Monad m) =&gt;
f (m Bool) -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#andM"><span class="hs-identifier hs-var">andM</span></a></span><span> </span><span class="annot"><span class="annottext">([m Bool] -&gt; m Bool) -&gt; [m Bool] -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; m Bool) -&gt; [QName] -&gt; [m Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Bool
</span><a href="#local-6989586621681526254"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681526240"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526253"><span class="hs-identifier hs-var">polIn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- no, does not conform to the rules of sized types</span><span>
</span><span id="line-314"></span><span>              </span><span class="annot"><span class="annottext">(m [Polarity] -&gt; m [Polarity]) -&gt; m [Polarity] -&gt; m [Polarity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- yes, we have a sized type here</span><span>
</span><span id="line-315"></span><span>                </span><span class="hs-comment">-- Andreas, 2015-07-01</span><span>
</span><span id="line-316"></span><span>                </span><span class="hs-comment">-- As a side effect, mark the size also covariant for subsequent</span><span>
</span><span id="line-317"></span><span>                </span><span class="hs-comment">-- positivity checking (which feeds back into polarity analysis).</span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="annottext">QName -&gt; ([Occurrence] -&gt; [Occurrence]) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; ([Occurrence] -&gt; [Occurrence]) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#modifyArgOccurrences"><span class="hs-identifier hs-var">modifyArgOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526231"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(([Occurrence] -&gt; [Occurrence]) -&gt; m ())
-&gt; ([Occurrence] -&gt; [Occurrence]) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526290"><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621681526290"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Occurrence] -&gt; [Occurrence]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526238"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621681526290"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Occurrence] -&gt; [Occurrence]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">[Polarity] -&gt; m [Polarity]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526252"><span class="hs-identifier hs-var">polCo</span></a></span><span>
</span><span id="line-320"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m [Polarity]
</span><a href="#local-6989586621681526233"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- | @checkSizeIndex d i a@ checks that constructor target type @a@</span><span>
</span><span id="line-323"></span><span class="hs-comment">--   has form @d ps (&#8593;&#8319; i) idxs@ where @|ps| = np(d)@.</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">--   Precondition: @a@ is reduced and of form @d ps idxs0@.</span><span>
</span><span id="line-326"></span><span id="local-6989586621681525617"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#checkSizeIndex"><span class="hs-identifier hs-type">checkSizeIndex</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-329"></span><span id="checkSizeIndex"><span class="annot"><span class="annottext">checkSizeIndex :: forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadDebug m, MonadPretty m,
 MonadTCError m) =&gt;
QName -&gt; Int -&gt; Type -&gt; m Bool
</span><a href="Agda.TypeChecking.Polarity.html#checkSizeIndex"><span class="hs-identifier hs-var hs-var">checkSizeIndex</span></a></span></span><span> </span><span id="local-6989586621681526354"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526354"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681526355"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526355"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526356"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526356"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.polarity.size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. ReadTCState m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Options.html#withShowAllArguments"><span class="hs-identifier hs-var">withShowAllArguments</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking that constructor target type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526356"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  is data type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526354"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  and has size index (successor(s) of) &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526355"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681526356"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681526360"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526360"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span id="local-6989586621681526361"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526361"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">m (Maybe QName) -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier hs-var">whenNothingM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; m (Maybe QName)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; QName -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Signature.html#sameDef"><span class="hs-identifier hs-var">sameDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526354"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526360"><span class="hs-identifier hs-var">d0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span id="local-6989586621681526363"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526363"><span class="hs-identifier hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; m (Maybe Int) -&gt; m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe Int)
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m (Maybe Int)
</span><a href="Agda.TypeChecking.Datatypes.html#getNumberOfParameters"><span class="hs-identifier hs-var">getNumberOfParameters</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526360"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681526365"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526365"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621681526367"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621681526367"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681526368"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526368"><span class="hs-identifier hs-var">ixs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Elim] -&gt; ([Elim], [Elim])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526363"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526361"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span id="local-6989586621681526369"><span class="annot"><span class="annottext">DeepSizeView
</span><a href="#local-6989586621681526369"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m DeepSizeView
forall (m :: * -&gt; *).
(PureTCM m, MonadTCError m) =&gt;
Term -&gt; m DeepSizeView
</span><a href="Agda.TypeChecking.SizedTypes.html#deepSizeView"><span class="hs-identifier hs-var">deepSizeView</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m DeepSizeView) -&gt; Term -&gt; m DeepSizeView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621681526367"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeepSizeView
</span><a href="#local-6989586621681526369"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.SizedTypes.html#DSizeVar"><span class="hs-identifier hs-type">DSizeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.SizedTypes.html#ProjectedVar"><span class="hs-identifier hs-type">ProjectedVar</span></a></span><span> </span><span id="local-6989586621681526374"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526374"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526355"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526374"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-343"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m Bool) -&gt; Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Elim] -&gt; Bool
forall t. Free t =&gt; Int -&gt; t -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526355"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526365"><span class="hs-identifier hs-var">pars</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim] -&gt; [Elim] -&gt; [Elim]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526368"><span class="hs-identifier hs-var">ixs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><span class="annottext">DeepSizeView
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- | @polarity i a@ computes the least polarity of de Bruijn index @i@</span><span>
</span><span id="line-348"></span><span class="hs-comment">--   in syntactic entity @a@.</span><span>
</span><span id="line-349"></span><span id="local-6989586621681525622"><span id="local-6989586621681525623"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarity"><span class="hs-identifier hs-type">polarity</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525622"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525623"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525623"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525622"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span></span></span><span>
</span><span id="line-352"></span><span id="polarity"><span class="annot"><span class="annottext">polarity :: forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; a -&gt; m Polarity
</span><a href="Agda.TypeChecking.Polarity.html#polarity"><span class="hs-identifier hs-var hs-var">polarity</span></a></span></span><span> </span><span id="local-6989586621681526382"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526382"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526383"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526383"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; m Polarity
forall (m :: * -&gt; *). LeastPolarity m -&gt; m Polarity
</span><a href="Agda.TypeChecking.Polarity.html#getLeastPolarity"><span class="hs-identifier hs-var">getLeastPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(LeastPolarity m -&gt; m Polarity) -&gt; LeastPolarity m -&gt; m Polarity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526382"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Covariant"><span class="hs-identifier hs-var">Covariant</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526383"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- | A monoid for lazily computing the infimum of the polarities of a variable in some object.</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- Allows short-cutting.</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-keyword">newtype</span><span> </span><span id="LeastPolarity"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-var">LeastPolarity</span></a></span></span><span> </span><span id="local-6989586621681525657"><span class="annot"><a href="#local-6989586621681525657"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LeastPolarity"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-var">LeastPolarity</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getLeastPolarity"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). LeastPolarity m -&gt; m Polarity
</span><a href="Agda.TypeChecking.Polarity.html#getLeastPolarity"><span class="hs-identifier hs-var hs-var">getLeastPolarity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681525657"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525665"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621681525665"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#Singleton"><span class="hs-identifier hs-type">Singleton</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525665"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-360"></span><span>  </span><span id="local-6989586621681526392"><span class="annot"><span class="annottext">singleton :: Polarity -&gt; LeastPolarity m
</span><a href="#local-6989586621681526392"><span class="hs-identifier hs-var hs-var hs-var hs-var">singleton</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Polarity -&gt; LeastPolarity m
forall (m :: * -&gt; *). m Polarity -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-var">LeastPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(m Polarity -&gt; LeastPolarity m)
-&gt; (Polarity -&gt; m Polarity) -&gt; Polarity -&gt; LeastPolarity m
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; m Polarity
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525671"><span id="local-6989586621681526397"><span id="local-6989586621681526401"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621681525671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span id="local-6989586621681526413"><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526413"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621681526414"><span class="annot"><span class="annottext">&lt;&gt; :: LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span id="local-6989586621681526415"><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526415"><span class="hs-identifier hs-var">mq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Polarity -&gt; LeastPolarity m
forall (m :: * -&gt; *). m Polarity -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-var">LeastPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(m Polarity -&gt; LeastPolarity m) -&gt; m Polarity -&gt; LeastPolarity m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526413"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">m Polarity -&gt; (Polarity -&gt; m Polarity) -&gt; m Polarity
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; m Polarity
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>  </span><span class="hs-comment">-- Shortcut for the absorbing element.</span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526415"><span class="hs-identifier hs-var">mq</span></a></span><span>                </span><span class="hs-comment">-- The neutral element.</span><span>
</span><span id="line-367"></span><span>      </span><span id="local-6989586621681526416"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526416"><span class="hs-identifier hs-var">p</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526416"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Polarity -&gt; Polarity) -&gt; m Polarity -&gt; m Polarity
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Polarity
</span><a href="#local-6989586621681526415"><span class="hs-identifier hs-var">mq</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525676"><span id="local-6989586621681526423"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621681525676"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525676"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621681526428"><span class="annot"><span class="annottext">mempty :: LeastPolarity m
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; LeastPolarity m
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Nonvariant"><span class="hs-identifier hs-var">Nonvariant</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621681526430"><span class="annot"><span class="annottext">mappend :: LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="annot"><span class="hs-comment">-- | Bind for 'LeastPolarity'.</span></span><span>
</span><span id="line-374"></span><span id="local-6989586621681525677"><span id="local-6989586621681525678"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#%3E%3E%3D%3D"><span class="hs-operator hs-type">(&gt;&gt;==)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621681525677"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525677"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525678"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681525678"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525677"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525677"><span class="hs-identifier hs-type">m</span></a></span></span></span><span>
</span><span id="line-375"></span><span id="local-6989586621681526434"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681526434"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="%3E%3E%3D%3D"><span class="annot"><span class="annottext">&gt;&gt;== :: forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; (a -&gt; LeastPolarity m) -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#%3E%3E%3D%3D"><span class="hs-operator hs-var hs-var">&gt;&gt;==</span></a></span></span><span> </span><span id="local-6989586621681526435"><span class="annot"><span class="annottext">a -&gt; LeastPolarity m
</span><a href="#local-6989586621681526435"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Polarity -&gt; LeastPolarity m
forall (m :: * -&gt; *). m Polarity -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-var">LeastPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(m Polarity -&gt; LeastPolarity m) -&gt; m Polarity -&gt; LeastPolarity m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681526434"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m Polarity) -&gt; m Polarity
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; m Polarity
forall (m :: * -&gt; *). LeastPolarity m -&gt; m Polarity
</span><a href="Agda.TypeChecking.Polarity.html#getLeastPolarity"><span class="hs-identifier hs-var">getLeastPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(LeastPolarity m -&gt; m Polarity)
-&gt; (a -&gt; LeastPolarity m) -&gt; a -&gt; m Polarity
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; LeastPolarity m
</span><a href="#local-6989586621681526435"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">-- | @polarity' i p a@ computes the least polarity of de Bruijn index @i@</span><span>
</span><span id="line-378"></span><span class="hs-comment">--   in syntactic entity @a@, where root occurrences count as @p@.</span><span>
</span><span id="line-379"></span><span class="hs-comment">--</span><span>
</span><span id="line-380"></span><span class="hs-comment">--   Ignores occurrences in sorts.</span><span>
</span><span id="line-381"></span><span class="hs-keyword">class</span><span> </span><span id="HasPolarity"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-var">HasPolarity</span></a></span></span><span> </span><span id="local-6989586621681525658"><span class="annot"><a href="#local-6989586621681525658"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>  </span><span id="polarity%27"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-type">polarity'</span></a></span></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621681525659"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525659"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525659"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525658"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525659"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="polarity%27"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-type">polarity'</span></a></span></span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621681525681"><span id="local-6989586621681525682"><span id="local-6989586621681525683"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525682"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621681525683"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681525683"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525682"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621681525658"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681525658"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#LeastPolarity"><span class="hs-identifier hs-type">LeastPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525681"><span class="hs-identifier hs-type">m</span></a></span></span></span></span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621681526437"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var hs-var">polarity'</span></a></span><span> </span><span id="local-6989586621681526454"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526454"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; LeastPolarity m) -&gt; a -&gt; LeastPolarity m
(b -&gt; LeastPolarity m) -&gt; t b -&gt; LeastPolarity m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">((b -&gt; LeastPolarity m) -&gt; a -&gt; LeastPolarity m)
-&gt; (Polarity -&gt; b -&gt; LeastPolarity m)
-&gt; Polarity
-&gt; a
-&gt; LeastPolarity m
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; b -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; b -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526454"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525692"><span id="local-6989586621681526458"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525692"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681525692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-392"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525695"><span id="local-6989586621681526471"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525695"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525695"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-393"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525699"><span id="local-6989586621681526484"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525699"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525699"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-394"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525702"><span id="local-6989586621681526497"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525702"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525702"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-395"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525706"><span id="local-6989586621681526510"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525706"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Level%27"><span class="hs-identifier hs-type">Level'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525706"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-396"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525710"><span id="local-6989586621681526523"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525710"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#PlusLevel%27"><span class="hs-identifier hs-type">PlusLevel'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525710"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><span class="hs-comment">-- | Does not look into sort.</span></span><span>
</span><span id="line-399"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525599"><span id="local-6989586621681525600"><span id="local-6989586621681526536"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type%27%27"><span class="hs-identifier hs-type">Type''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525600"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525717"><span id="local-6989586621681525718"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525717"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525718"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681525717"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681525718"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621681526561"><span class="annot"><span class="annottext">polarity' :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; (a, b) -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var hs-var hs-var hs-var">polarity'</span></a></span></span><span> </span><span id="local-6989586621681526562"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526562"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526563"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526563"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681526564"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526564"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681526565"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681526565"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526562"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526563"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; b -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; b -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526562"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526563"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681526565"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681525721"><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525721"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681525721"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621681526579"><span class="annot"><span class="annottext">polarity' :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Abs a -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var hs-var hs-var hs-var">polarity'</span></a></span></span><span> </span><span id="local-6989586621681526580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526580"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526581"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526581"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span>   </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681526582"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526582"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526580"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526581"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526582"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span id="local-6989586621681526583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526583"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526584"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526584"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681526586"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526586"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526583"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526584"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681526586"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Polarity.html#HasPolarity"><span class="hs-identifier hs-type">HasPolarity</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621681526639"><span class="annot"><span class="annottext">polarity' :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Term -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var hs-var hs-var hs-var">polarity'</span></a></span></span><span> </span><span id="local-6989586621681526640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681526641"><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681526642"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526642"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526642"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">m Term -&gt; (Term -&gt; LeastPolarity m) -&gt; LeastPolarity m
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; (a -&gt; LeastPolarity m) -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#%3E%3E%3D%3D"><span class="hs-operator hs-var">&gt;&gt;==</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-comment">-- Andreas, 2012-09-06: taking the polarity' of the arguments</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-comment">-- without taking the variance of the function into account seems wrong.</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681526645"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526645"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681526646"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526646"><span class="hs-identifier hs-var">ts</span></a></span></span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526645"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; LeastPolarity m
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526646"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526646"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681526648"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621681526648"><span class="hs-identifier hs-var">t</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Abs Term -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Abs Term -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621681526648"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LeastPolarity m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621681526651"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621681526651"><span class="hs-identifier hs-var">l</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Level -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Level -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621681526651"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681526652"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526652"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681526653"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526653"><span class="hs-identifier hs-var">ts</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m [Polarity]
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Monad.Signature.html#getPolarity"><span class="hs-identifier hs-var">getPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681526652"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m [Polarity] -&gt; ([Polarity] -&gt; LeastPolarity m) -&gt; LeastPolarity m
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; (a -&gt; LeastPolarity m) -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#%3E%3E%3D%3D"><span class="hs-operator hs-var">&gt;&gt;==</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681526655"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526655"><span class="hs-identifier hs-var">pols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681526656"><span class="annot"><span class="annottext">ps :: [Polarity]
</span><a href="#local-6989586621681526656"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Polarity -&gt; Polarity) -&gt; [Polarity] -&gt; [Polarity]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#composePol"><span class="hs-identifier hs-var">composePol</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526655"><span class="hs-identifier hs-var">pols</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity] -&gt; [Polarity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Polarity -&gt; [Polarity]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span>
</span><span id="line-420"></span><span>                       </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">[LeastPolarity m] -&gt; LeastPolarity m
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([LeastPolarity m] -&gt; LeastPolarity m)
-&gt; [LeastPolarity m] -&gt; LeastPolarity m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Polarity -&gt; Elim -&gt; LeastPolarity m)
-&gt; [Polarity] -&gt; [Elim] -&gt; [LeastPolarity m]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Elim -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Elim -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681526656"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526653"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681526660"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526660"><span class="hs-identifier hs-var">ts</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526660"><span class="hs-identifier hs-var">ts</span></a></span><span>   </span><span class="hs-comment">-- Constructors can be seen as monotone in all args.</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621681526661"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526661"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681526662"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526662"><span class="hs-identifier hs-var">b</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Dom Type -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Dom Type -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polarity -&gt; Polarity
</span><a href="Agda.TypeChecking.Polarity.html#neg"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681526661"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">LeastPolarity m -&gt; LeastPolarity m -&gt; LeastPolarity m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Abs Type -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Abs Type -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621681526662"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621681526664"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621681526664"><span class="hs-identifier hs-var">s</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LeastPolarity m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-comment">-- polarity' i p s -- mempty</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681526666"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526666"><span class="hs-identifier hs-var">ts</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; [Elim] -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="Agda.TypeChecking.Monad.Base.html#Invariant"><span class="hs-identifier hs-var">Invariant</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621681526666"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span> </span><span id="local-6989586621681526668"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526668"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Polarity -&gt; Term -&gt; LeastPolarity m
forall a (m :: * -&gt; *).
(HasPolarity a, HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; a -&gt; LeastPolarity m
forall (m :: * -&gt; *).
(HasConstInfo m, MonadReduce m) =&gt;
Int -&gt; Polarity -&gt; Term -&gt; LeastPolarity m
</span><a href="Agda.TypeChecking.Polarity.html#polarity%27"><span class="hs-identifier hs-var">polarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681526640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Polarity
</span><a href="#local-6989586621681526641"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681526668"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- mempty</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LeastPolarity m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-427"></span></pre></body></html>