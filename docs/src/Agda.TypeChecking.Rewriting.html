<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Rewriting with arbitrary rules.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">--   The user specifies a relation symbol by the pragma</span><span>
</span><span id="line-9"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-10"></span><span class="hs-comment">--       {-\# BUILTIN REWRITE rel \#-}</span><span>
</span><span id="line-11"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-12"></span><span class="hs-comment">--   where @rel@ should be of type @&#916; &#8594; (lhs rhs : A) &#8594; Set i@.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">--   Then the user can add rewrite rules by the pragma</span><span>
</span><span id="line-15"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-16"></span><span class="hs-comment">--       {-\# REWRITE q \#-}</span><span>
</span><span id="line-17"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-18"></span><span class="hs-comment">--   where @q@ should be a closed term of type @&#915; &#8594; rel us lhs rhs@.</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">--   We then intend to add a rewrite rule</span><span>
</span><span id="line-21"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-22"></span><span class="hs-comment">--       &#915; &#8866; lhs &#8614; rhs : B</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   to the signature where @B = A[us/&#916;]@.</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">--   To this end, we normalize @lhs@, which should be of the form</span><span>
</span><span id="line-27"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-28"></span><span class="hs-comment">--       f ts</span><span>
</span><span id="line-29"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-30"></span><span class="hs-comment">--   for a @'Def'@-symbol f (postulate, function, data, record, constructor).</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   Further, @FV(ts) = dom(&#915;)@.</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   The rule @q :: &#915; &#8866; f ts &#8614; rhs : B@ is added to the signature</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   to the definition of @f@.</span><span>
</span><span id="line-34"></span><span class="hs-comment">--</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   When reducing a term @&#936; &#8866; f vs@ is stuck, we try the rewrites for @f@,</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   by trying to unify @vs@ with @ts@.</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   This is for now done by substituting fresh metas Xs for the bound</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   variables in @ts@ and checking equality with @vs@</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-40"></span><span class="hs-comment">--       &#936; &#8866; (f ts)[Xs/&#915;] = f vs : B[Xs/&#915;]</span><span>
</span><span id="line-41"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-42"></span><span class="hs-comment">--   If successful (no open metas/constraints), we replace @f vs@ by</span><span>
</span><span id="line-43"></span><span class="hs-comment">--   @rhs[Xs/&#915;]@ and continue reducing.</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.Rewriting</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pos</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.Confluence</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.NonLinMatch</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.NonLinPattern</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html"><span class="hs-identifier">Agda.Utils.SmallSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SmallSet</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-type">requireOptionRewriting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span id="requireOptionRewriting"><span class="annot"><span class="annottext">requireOptionRewriting :: TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var hs-var">requireOptionRewriting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-var">optRewriting</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NeedOptionRewriting"><span class="hs-identifier hs-var">NeedOptionRewriting</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | Check that the name given to the BUILTIN REWRITE is actually</span><span>
</span><span id="line-96"></span><span class="hs-comment">--   a relation symbol.</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   I.e., its type should be of the form @&#916; &#8594; (lhs : A) (rhs : B) &#8594; Set &#8467;@.</span><span>
</span><span id="line-98"></span><span class="hs-comment">--   Note: we do not care about hiding/non-hiding of lhs and rhs.</span><span>
</span><span id="line-99"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#verifyBuiltinRewrite"><span class="hs-identifier hs-type">verifyBuiltinRewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span id="verifyBuiltinRewrite"><span class="annot"><span class="annottext">verifyBuiltinRewrite :: Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#verifyBuiltinRewrite"><span class="hs-identifier hs-var hs-var">verifyBuiltinRewrite</span></a></span></span><span> </span><span id="local-6989586621681562792"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562792"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681562793"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562793"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var">requireOptionRewriting</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe RelView) -&gt; TCM () -&gt; (RelView -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var">relView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562793"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562792"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldAcceptAtLeastTwoArguments"><span class="hs-identifier hs-var">ShouldAcceptAtLeastTwoArguments</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((RelView -&gt; TCM ()) -&gt; TCM ()) -&gt; (RelView -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span> </span><span id="local-6989586621681562799"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562799"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621681562800"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562800"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681562801"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562801"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681562802"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562802"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681562803"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562803"><span class="hs-identifier hs-var">core</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562801"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562802"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562792"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#FinalTwoArgumentsNotVisible"><span class="hs-identifier hs-var">FinalTwoArgumentsNotVisible</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562803"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562792"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Tele (Dom Type) -&gt; IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#TypeDoesNotEndInSort"><span class="hs-identifier hs-var">TypeDoesNotEndInSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562803"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562799"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><span class="hs-comment">-- | Deconstructing a type into @&#916; &#8594; t &#8594; t' &#8594; core@.</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">data</span><span> </span><span id="RelView"><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-var">RelView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RelView"><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-var">RelView</span></a></span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="relViewTel"><span class="annot"><span class="annottext">RelView -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#relViewTel"><span class="hs-identifier hs-var hs-var">relViewTel</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The whole telescope @&#916;, t, t'@.</span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewDelta"><span class="annot"><span class="annottext">RelView -&gt; [Dom (ArgName, Type)]
</span><a href="Agda.TypeChecking.Rewriting.html#relViewDelta"><span class="hs-identifier hs-var hs-var">relViewDelta</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ListTel"><span class="hs-identifier hs-type">ListTel</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ @&#916;@.</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewType"><span class="annot"><span class="annottext">RelView -&gt; Dom Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewType"><span class="hs-identifier hs-var hs-var">relViewType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @t@.</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewType%27"><span class="annot"><span class="annottext">RelView -&gt; Dom Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewType%27"><span class="hs-identifier hs-var hs-var">relViewType'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @t'@.</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewCore"><span class="annot"><span class="annottext">RelView -&gt; Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewCore"><span class="hs-identifier hs-var hs-var">relViewCore</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ @core@.</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | Deconstructing a type into @&#916; &#8594; t &#8594; t' &#8594; core@.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--   Returns @Nothing@ if not enough argument types.</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-type">relView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="relView"><span class="annot"><span class="annottext">relView :: Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var hs-var">relView</span></a></span></span><span> </span><span id="local-6989586621681562823"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562823"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621681562825"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562825"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621681562826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562826"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562823"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562828"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681562828"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562825"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681562830"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562830"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562831"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562831"><span class="hs-identifier hs-var">lastTwo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Dom (ArgName, Type)]
-&gt; ([Dom (ArgName, Type)], [Dom (ArgName, Type)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681562828"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom (ArgName, Type)]
 -&gt; ([Dom (ArgName, Type)], [Dom (ArgName, Type)]))
-&gt; [Dom (ArgName, Type)]
-&gt; ([Dom (ArgName, Type)], [Dom (ArgName, Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562825"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562831"><span class="hs-identifier hs-var">lastTwo</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe RelView -&gt; TCMT IO (Maybe RelView)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe RelView
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681562835"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562835"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562836"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562836"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ArgName, Type) -&gt; Type) -&gt; Dom (ArgName, Type) -&gt; Dom Type
forall a b. (a -&gt; b) -&gt; Dom' Term a -&gt; Dom' Term b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ArgName, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Dom (ArgName, Type) -&gt; Dom Type)
-&gt; [Dom (ArgName, Type)] -&gt; [Dom Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562831"><span class="hs-identifier hs-var">lastTwo</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Maybe RelView -&gt; TCMT IO (Maybe RelView)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe RelView -&gt; TCMT IO (Maybe RelView))
-&gt; Maybe RelView -&gt; TCMT IO (Maybe RelView)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelView -&gt; Maybe RelView
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RelView -&gt; Maybe RelView) -&gt; RelView -&gt; Maybe RelView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
-&gt; [Dom (ArgName, Type)] -&gt; Dom Type -&gt; Dom Type -&gt; Type -&gt; RelView
</span><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-var">RelView</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562825"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562830"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562835"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562836"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562826"><span class="hs-identifier hs-var">core</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><span class="hs-comment">-- | Check the given rewrite rules and add them to the signature.</span></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#addRewriteRules"><span class="hs-identifier hs-type">addRewriteRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span id="addRewriteRules"><span class="annot"><span class="annottext">addRewriteRules :: [QName] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#addRewriteRules"><span class="hs-identifier hs-var hs-var">addRewriteRules</span></a></span></span><span> </span><span id="local-6989586621681562839"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681562839"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-comment">-- Check the rewrite rules</span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621681562840"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681562840"><span class="hs-identifier hs-var">rews</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO RewriteRule) -&gt; [QName] -&gt; TCMT IO RewriteRules
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO RewriteRule
</span><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-var">checkRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681562839"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- Add rewrite rules to the signature</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="annottext">RewriteRules -&gt; (RewriteRule -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681562840"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">((RewriteRule -&gt; TCM ()) -&gt; TCM ())
-&gt; (RewriteRule -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681562844"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681562844"><span class="hs-identifier hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562845"><span class="annot"><span class="annottext">f :: QName
</span><a href="#local-6989586621681562845"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewHead"><span class="hs-identifier hs-var">rewHead</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681562844"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span id="local-6989586621681562847"><span class="annot"><span class="annottext">matchables :: [QName]
</span><a href="#local-6989586621681562847"><span class="hs-identifier hs-var hs-var">matchables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; [QName]
forall a. GetMatchables a =&gt; a -&gt; [QName]
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#getMatchables"><span class="hs-identifier hs-var">getMatchables</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681562844"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;adding rule&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681562844"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;to the definition of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562845"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;matchable symbols: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; [QName] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681562847"><span class="hs-identifier hs-var">matchables</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; TCM ())
-&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; RewriteRules -&gt; [QName] -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#addRewriteRulesFor"><span class="hs-identifier hs-var">addRewriteRulesFor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562845"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681562844"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681562847"><span class="hs-identifier hs-var">matchables</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-comment">-- Run confluence check for the new rules</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-comment">-- (should be done after adding all rules, see #3795)</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe ConfluenceCheck)
-&gt; (ConfluenceCheck -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; TCMT IO PragmaOptions -&gt; TCMT IO (Maybe ConfluenceCheck)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ConfluenceCheck -&gt; TCM ()) -&gt; TCM ())
-&gt; (ConfluenceCheck -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681562857"><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621681562857"><span class="hs-identifier hs-var">confChk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- Warn if --cubical is enabled</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical) -&gt; (Cubical -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe Cubical
</span><a href="Agda.Interaction.Options.Base.html#optCubical"><span class="hs-identifier hs-var">optCubical</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Maybe Cubical)
-&gt; TCMT IO PragmaOptions -&gt; TCMT IO (Maybe Cubical)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Cubical -&gt; TCM ()) -&gt; TCM ()) -&gt; (Cubical -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Cubical
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#ConfluenceForCubicalNotSupported"><span class="hs-identifier hs-var">ConfluenceForCubicalNotSupported</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- Global confluence checker requires rules to be sorted</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- according to the generality of their lhs</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621681562857"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; ConfluenceCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#GlobalConfluenceCheck"><span class="hs-identifier hs-var">GlobalConfluenceCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">[QName] -&gt; (QName -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; QName) -&gt; [QName] -&gt; [QName]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier hs-var">nubOn</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RewriteRule -&gt; QName) -&gt; RewriteRules -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewHead"><span class="hs-identifier hs-var">rewHead</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681562840"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#sortRulesOfSymbol"><span class="hs-identifier hs-var">sortRulesOfSymbol</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; RewriteRules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier hs-var">checkConfluenceOfRules</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621681562857"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681562840"><span class="hs-identifier hs-var">rews</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;done checking confluence of rules&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RewriteRule -&gt; TCMT IO Doc) -&gt; RewriteRules -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; QName) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681562840"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- Auxiliary function for checkRewriteRule.</span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | Get domain of rewrite relation.</span></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-type">rewriteRelationDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ListTel"><span class="hs-identifier hs-type">ListTel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="rewriteRelationDom"><span class="annot"><span class="annottext">rewriteRelationDom :: QName -&gt; TCM ([Dom (ArgName, Type)], Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-var hs-var">rewriteRelationDom</span></a></span></span><span> </span><span id="local-6989586621681562870"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562870"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-comment">-- We know that the type of rel is that of a relation.</span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621681562871"><span class="annot"><span class="annottext">Maybe RelView
</span><a href="#local-6989586621681562871"><span class="hs-identifier hs-var">relV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var">relView</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (Maybe RelView))
-&gt; TCMT IO Type -&gt; TCMT IO (Maybe RelView)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Type) -&gt; TCMT IO Definition -&gt; TCMT IO Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562870"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span> </span><span id="local-6989586621681562875"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562875"><span class="hs-identifier hs-var">_tel</span></a></span></span><span> </span><span id="local-6989586621681562876"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562876"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681562877"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562877"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681562878"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562878"><span class="hs-identifier hs-var">_a'</span></a></span></span><span> </span><span id="local-6989586621681562879"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562879"><span class="hs-identifier hs-var">_core</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelView -&gt; Maybe RelView -&gt; RelView
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">RelView
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RelView
</span><a href="#local-6989586621681562871"><span class="hs-identifier hs-var">relV</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rewrite relation at type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Tele (Dom Type) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (ArgName, Type)] -&gt; Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562876"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; |- &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)] -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
[Dom (ArgName, Type)] -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562876"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562877"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="annottext">([Dom (ArgName, Type)], Dom Type)
-&gt; TCM ([Dom (ArgName, Type)], Dom Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562876"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562877"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Check the validity of @q : &#915; &#8594; rel us lhs rhs@ as rewrite rule</span><span>
</span><span id="line-178"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-179"></span><span class="hs-comment">--       &#915; &#8866; lhs &#8614; rhs : B</span><span>
</span><span id="line-180"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-181"></span><span class="hs-comment">--   where @B = A[us/&#916;]@.</span><span>
</span><span id="line-182"></span><span class="hs-comment">--   Remember that @rel : &#916; &#8594; A &#8594; A &#8594; Set i@, so</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   @rel us : (lhs rhs : A[us/&#916;]) &#8594; Set i@.</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   Returns the checked rewrite rule to be added to the signature.</span><span>
</span><span id="line-185"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-type">checkRewriteRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span>
</span><span id="line-186"></span><span id="checkRewriteRule"><span class="annot"><span class="annottext">checkRewriteRule :: QName -&gt; TCMT IO RewriteRule
</span><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-var hs-var">checkRewriteRule</span></a></span></span><span> </span><span id="local-6989586621681562884"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var">requireOptionRewriting</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562903"><span class="annot"><span class="annottext">failNoBuiltin :: TCMT IO a
</span><a href="#local-6989586621681562903"><span class="hs-identifier hs-var hs-var">failNoBuiltin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#GenericError"><span class="hs-identifier hs-var">GenericError</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TypeError) -&gt; ArgName -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Cannot add rewrite rule without prior BUILTIN REWRITE&quot;</span></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621681562905"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681562905"><span class="hs-identifier hs-var">rels</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Set QName)
-&gt; TCMT IO (Maybe (Set QName)) -&gt; TCMT IO (Set QName)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><a href="Agda.Utils.Maybe.html#fromMaybeM"><span class="hs-identifier hs-var">fromMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Set QName)
forall {a}. TCMT IO a
</span><a href="#local-6989586621681562903"><span class="hs-identifier hs-var">failNoBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe (Set QName))
forall (m :: * -&gt; *). HasBuiltins m =&gt; m (Maybe (Set QName))
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinRewriteRelations"><span class="hs-identifier hs-var">getBuiltinRewriteRelations</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.relations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Rewrite relations:&quot;</span></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [TCMT IO Doc]) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681562905"><span class="hs-identifier hs-var">rels</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621681562910"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681562910"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(Functor m, HasConstInfo m, HasOptions m, ReadTCState m,
 MonadTCEnv m, MonadDebug m) =&gt;
Definition -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#instantiateDef"><span class="hs-identifier hs-var">instantiateDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; TCMT IO Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-comment">-- Issue 1651: Check that we are not adding a rewrite rule</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-comment">-- for a type signature whose body has not been type-checked yet.</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#isEmptyFunction"><span class="hs-identifier hs-var">isEmptyFunction</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Bool) -&gt; Defn -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681562910"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#BeforeFunctionDefinition"><span class="hs-identifier hs-var">BeforeFunctionDefinition</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-comment">-- Get rewrite rule (type of q).</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621681562916"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562916"><span class="hs-identifier hs-var">gamma1</span></a></span></span><span> </span><span id="local-6989586621681562917"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562917"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (TelV Type)) -&gt; Type -&gt; TCMT IO (TelV Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681562910"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;attempting to add rewrite rule of type &quot;</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Tele (Dom Type) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562916"><span class="hs-identifier hs-var">gamma1</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; |- &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562916"><span class="hs-identifier hs-var">gamma1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562917"><span class="hs-identifier hs-var">core</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562059"><span class="annot"><a href="#local-6989586621681562918"><span class="hs-identifier hs-type">failureBlocked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681562059"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-208"></span><span>      </span><span id="local-6989586621681562918"><span class="annot"><span class="annottext">failureBlocked :: forall a. Blocker -&gt; TCM a
</span><a href="#local-6989586621681562918"><span class="hs-identifier hs-var hs-var">failureBlocked</span></a></span></span><span> </span><span id="local-6989586621681562934"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681562934"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set MetaId -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681562937"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set MetaId -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ContainsUnsolvedMetaVariables"><span class="hs-identifier hs-var">ContainsUnsolvedMetaVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681562937"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ProblemId -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621681562939"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ProblemId -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#BlockedOnProblems"><span class="hs-identifier hs-var">BlockedOnProblems</span></a></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621681562939"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681562941"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#RequiresDefinitions"><span class="hs-identifier hs-var">RequiresDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681562941"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>          </span><span id="local-6989586621681562937"><span class="annot"><span class="annottext">ms :: Set MetaId
</span><a href="#local-6989586621681562937"><span class="hs-identifier hs-var hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set MetaId
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingMetas"><span class="hs-identifier hs-var">allBlockingMetas</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681562934"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-215"></span><span>          </span><span id="local-6989586621681562939"><span class="annot"><span class="annottext">ps :: Set ProblemId
</span><a href="#local-6989586621681562939"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set ProblemId
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingProblems"><span class="hs-identifier hs-var">allBlockingProblems</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681562934"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-216"></span><span>          </span><span id="local-6989586621681562941"><span class="annot"><span class="annottext">qs :: Set QName
</span><a href="#local-6989586621681562941"><span class="hs-identifier hs-var hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set QName
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingDefs"><span class="hs-identifier hs-var">allBlockingDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681562934"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562064"><span class="annot"><a href="#local-6989586621681562946"><span class="hs-identifier hs-type">failureFreeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681562064"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621681562946"><span class="annot"><span class="annottext">failureFreeVars :: forall a. IntSet -&gt; TCM a
</span><a href="#local-6989586621681562946"><span class="hs-identifier hs-var hs-var">failureFreeVars</span></a></span></span><span> </span><span id="local-6989586621681562950"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681562950"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#VariablesNotBoundByLHS"><span class="hs-identifier hs-var">VariablesNotBoundByLHS</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681562950"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562952"><span class="annot"><a href="#local-6989586621681562953"><span class="hs-identifier hs-type">failureNonLinearPars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681562952"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-220"></span><span>      </span><span id="local-6989586621681562953"><span class="annot"><span class="annottext">failureNonLinearPars :: forall a. IntSet -&gt; TCM a
</span><a href="#local-6989586621681562953"><span class="hs-identifier hs-var hs-var">failureNonLinearPars</span></a></span></span><span> </span><span id="local-6989586621681562957"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681562957"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#VariablesBoundMoreThanOnce"><span class="hs-identifier hs-var">VariablesBoundMoreThanOnce</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681562957"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562959"><span class="annot"><a href="#local-6989586621681562960"><span class="hs-identifier hs-type">failureIllegalRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681562959"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-comment">-- TODO:: Defined but not used</span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621681562960"><span class="annot"><span class="annottext">failureIllegalRule :: forall {a}. TCMT IO a
</span><a href="#local-6989586621681562960"><span class="hs-identifier hs-var hs-var">failureIllegalRule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#EmptyReason"><span class="hs-identifier hs-var">EmptyReason</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-comment">-- Check that type of q targets rel.</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562917"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681562965"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562965"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span id="local-6989586621681562966"><span class="annot"><span class="annottext">es :: Elims
</span><a href="#local-6989586621681562966"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim' Term
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Elim' Term
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562965"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; Set a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681562905"><span class="hs-identifier hs-var">rels</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681562968"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562968"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562969"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562969"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ([Dom (ArgName, Type)], Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-var">rewriteRelationDom</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562965"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span class="hs-comment">-- Because of the type of rel (&#915; &#8594; sort), all es are applications.</span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562970"><span class="annot"><span class="annottext">vs :: [Term]
</span><a href="#local-6989586621681562970"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg Term] -&gt; [Term]) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Arg Term] -&gt; [Arg Term]) -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681562966"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-comment">-- The last two arguments are lhs and rhs.</span><span>
</span><span id="line-231"></span><span>          </span><span id="local-6989586621681562973"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681562973"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621681562970"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681562974"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621681562974"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681562975"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562975"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562976"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562976"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term] -&gt; ([Term], [Term])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681562973"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621681562970"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (ArgName, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621681562968"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621681562974"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span id="local-6989586621681562977"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562977"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562975"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span id="local-6989586621681562979"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562979"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562976"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621681562980"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562980"><span class="hs-identifier hs-var">b</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TCMT IO (Dom Type)
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; TCMT IO (Dom Type)) -&gt; Dom Type -&gt; TCMT IO (Dom Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg (Dom Type)) -&gt; Dom Type -&gt; Dom Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubstArg (Dom Type)] -&gt; Substitution' (SubstArg (Dom Type))
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="annot"><span class="annottext">([SubstArg (Dom Type)] -&gt; Substitution' (SubstArg (Dom Type)))
-&gt; [SubstArg (Dom Type)] -&gt; Substitution' (SubstArg (Dom Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621681562974"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562969"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621681562984"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562984"><span class="hs-identifier hs-var">gamma0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Tele (Dom Type))
forall (m :: * -&gt; *).
(Applicative m, MonadTCEnv m) =&gt;
m (Tele (Dom Type))
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span id="local-6989586621681562986"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562986"><span class="hs-identifier hs-var">gamma1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO (Tele (Dom Type))
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562916"><span class="hs-identifier hs-var">gamma1</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681562987"><span class="annot"><span class="annottext">gamma :: Tele (Dom Type)
</span><a href="#local-6989586621681562987"><span class="hs-identifier hs-var hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562984"><span class="hs-identifier hs-var">gamma0</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Tele (Dom Type) -&gt; Tele (Dom Type)
forall t. Abstract t =&gt; Tele (Dom Type) -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562986"><span class="hs-identifier hs-var">gamma1</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-comment">-- 2017-06-18, Jesper: Unfold inlined definitions on the LHS.</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-comment">-- This is necessary to replace copies created by imports by their</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-comment">-- original definition.</span><span>
</span><span id="line-245"></span><span>      </span><span id="local-6989586621681562989"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562989"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AllowedReductions -&gt; AllowedReductions)
-&gt; TCMT IO Term -&gt; TCMT IO Term
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(AllowedReductions -&gt; AllowedReductions) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#modifyAllowedReductions"><span class="hs-identifier hs-var">modifyAllowedReductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllowedReductions -&gt; AllowedReductions -&gt; AllowedReductions
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(AllowedReductions -&gt; AllowedReductions -&gt; AllowedReductions)
-&gt; AllowedReductions -&gt; AllowedReductions -&gt; AllowedReductions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a
</span><a href="Agda.Utils.SmallSet.html#singleton"><span class="hs-identifier hs-var">SmallSet.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#InlineReductions"><span class="hs-identifier hs-var">InlineReductions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Term -&gt; TCMT IO Term) -&gt; TCMT IO Term -&gt; TCMT IO Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562977"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-comment">-- Find head symbol f of the lhs, its type, its parameters (in case of a constructor), and its arguments.</span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681562995"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562996"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681562996"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562997"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562997"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562998"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681562998"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681562999"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681562999"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562989"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681563000"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563000"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681563001"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563001"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>          </span><span id="local-6989586621681563002"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563002"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563000"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-251"></span><span>          </span><span class="annot"><span class="annottext">QName -&gt; Definition -&gt; TCM ()
</span><a href="#local-6989586621681563003"><span class="hs-identifier hs-var">checkAxFunOrCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563002"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">(QName, Elims -&gt; Term, Type, [Int], Elims)
-&gt; TCMT IO (QName, Elims -&gt; Term, Type, [Int], Elims)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563002"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563001"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621681563004"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563004"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681563005"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621681563005"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621681563006"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563006"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563007"><span class="annot"><span class="annottext">hd :: Elims -&gt; Term
</span><a href="#local-6989586621681563007"><span class="hs-identifier hs-var hs-var">hd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563004"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621681563005"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681563008"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563008"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681563009"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563009"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; Type -&gt; TCMT IO (Maybe ((QName, Type, [Arg Term]), Type))
forall (m :: * -&gt; *).
PureTCM m =&gt;
ConHead -&gt; Type -&gt; m (Maybe ((QName, Type, [Arg Term]), Type))
</span><a href="Agda.TypeChecking.Datatypes.html#getFullyAppliedConType"><span class="hs-identifier hs-var">getFullyAppliedConType</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563004"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (Maybe ((QName, Type, [Arg Term]), Type)))
-&gt; Type -&gt; TCMT IO (Maybe ((QName, Type, [Arg Term]), Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562980"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span id="local-6989586621681563012"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681563012"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO [Int] -&gt; TCMT IO [Int]
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562986"><span class="hs-identifier hs-var">gamma1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [Int] -&gt; TCMT IO [Int]) -&gt; TCMT IO [Int] -&gt; TCMT IO [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [Arg Term] -&gt; TCMT IO [Int]
</span><a href="#local-6989586621681563013"><span class="hs-identifier hs-var">checkParametersAreGeneral</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563004"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563008"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">(QName, Elims -&gt; Term, Type, [Int], Elims)
-&gt; TCMT IO (QName, Elims -&gt; Term, Type, [Int], Elims)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563004"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563007"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563009"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681563012"><span class="hs-identifier hs-var">pars</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563006"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (QName, Elims -&gt; Term, Type, [Int], Elims)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (QName, Elims -&gt; Term, Type, [Int], Elims))
-&gt; TypeError -&gt; TCMT IO (QName, Elims -&gt; Term, Type, [Int], Elims)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#LHSNotDefOrConstr"><span class="hs-identifier hs-var">LHSNotDefOrConstr</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO RewriteRule -&gt; TCMT IO RewriteRule
</span><a href="#local-6989586621681563016"><span class="hs-identifier hs-var">ifNotAlreadyAdded</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO RewriteRule -&gt; TCMT IO RewriteRule)
-&gt; TCMT IO RewriteRule -&gt; TCMT IO RewriteRule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO RewriteRule -&gt; TCMT IO RewriteRule
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562986"><span class="hs-identifier hs-var">gamma1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO RewriteRule -&gt; TCMT IO RewriteRule)
-&gt; TCMT IO RewriteRule -&gt; TCMT IO RewriteRule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">QName -&gt; (Elims -&gt; Term) -&gt; Elims -&gt; TCM ()
</span><a href="#local-6989586621681563017"><span class="hs-identifier hs-var">checkNoLhsReduction</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681562996"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681562999"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>        </span><span id="local-6989586621681563018"><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563018"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; TCMT IO PElims) -&gt; TCMT IO PElims -&gt; TCMT IO PElims
forall a. (Blocker -&gt; TCMT IO a) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadBlock m =&gt;
(Blocker -&gt; m a) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#catchPatternErr"><span class="hs-identifier hs-var">catchPatternErr</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO PElims
forall a. Blocker -&gt; TCM a
</span><a href="#local-6989586621681562918"><span class="hs-identifier hs-var">failureBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO PElims -&gt; TCMT IO PElims)
-&gt; TCMT IO PElims -&gt; TCMT IO PElims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">Relevance -&gt; Int -&gt; TypeOf Elims -&gt; Elims -&gt; TCMT IO PElims
forall a b.
PatternFrom a b =&gt;
Relevance -&gt; Int -&gt; TypeOf a -&gt; a -&gt; TCM b
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#patternFrom"><span class="hs-identifier hs-var">patternFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#Relevant"><span class="hs-identifier hs-var">Relevant</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681562997"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681562999"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Pattern generated from lhs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NLPat -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; NLPat -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; PElims -&gt; NLPat
</span><a href="Agda.TypeChecking.Monad.Base.html#PDef"><span class="hs-identifier hs-var">PDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563018"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-comment">-- We need to check two properties on the variables used in the rewrite rule</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-comment">-- 1. For actually being able to apply the rewrite rule, we need</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-comment">--    that all variables that occur in the rule (on the left or the right)</span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-comment">--    are bound in a pattern position on the left.</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-comment">-- 2. To preserve soundness, we need that all the variables that are used</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-comment">--    in the *proof* of the rewrite rule are bound in the lhs.</span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-comment">--    For rewrite rules on constructors, we consider parameters to be bound</span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-comment">--    even though they don't appear in the lhs, since they can be reconstructed.</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-comment">--    For postulated or abstract rewrite rules, we consider all arguments</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">--    as 'used' (see #5238).</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563023"><span class="annot"><span class="annottext">boundVars :: IntSet
</span><a href="#local-6989586621681563023"><span class="hs-identifier hs-var hs-var">boundVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PElims -&gt; IntSet
forall a. NLPatVars a =&gt; a -&gt; IntSet
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#nlPatVars"><span class="hs-identifier hs-var">nlPatVars</span></a></span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563018"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span id="local-6989586621681563025"><span class="annot"><span class="annottext">freeVars :: IntSet
</span><a href="#local-6989586621681563025"><span class="hs-identifier hs-var hs-var">freeVars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PElims, Term) -&gt; IntSet
forall t. Free t =&gt; t -&gt; IntSet
</span><a href="Agda.TypeChecking.Free.html#allFreeVars"><span class="hs-identifier hs-var">allFreeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563018"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562979"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>            </span><span id="local-6989586621681563027"><span class="annot"><span class="annottext">allVars :: IntSet
</span><a href="#local-6989586621681563027"><span class="hs-identifier hs-var hs-var">allVars</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; IntSet) -&gt; [Int] -&gt; IntSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562987"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-285"></span><span>            </span><span id="local-6989586621681563030"><span class="annot"><span class="annottext">usedVars :: IntSet
</span><a href="#local-6989586621681563030"><span class="hs-identifier hs-var hs-var">usedVars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681562910"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; IntSet
</span><a href="#local-6989586621681563032"><span class="hs-identifier hs-var">usedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681562910"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563027"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563027"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-289"></span><span>              </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IntSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;variables bound by the pattern: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563023"><span class="hs-identifier hs-var">boundVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-293"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;variables free in the rewrite rule: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563025"><span class="hs-identifier hs-var">freeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;variables used by the rewrite rule: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563030"><span class="hs-identifier hs-var">usedVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="annottext">IntSet -&gt; (IntSet -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563025"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><span class="hs-operator hs-var">IntSet.\\</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563023"><span class="hs-identifier hs-var">boundVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; TCM ()
forall a. IntSet -&gt; TCM a
</span><a href="#local-6989586621681562946"><span class="hs-identifier hs-var">failureFreeVars</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">IntSet -&gt; (IntSet -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563030"><span class="hs-identifier hs-var">usedVars</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><span class="hs-operator hs-var">IntSet.\\</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563023"><span class="hs-identifier hs-var">boundVars</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><span class="hs-operator hs-var">`IntSet.union`</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681562998"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; TCM ()
forall a. IntSet -&gt; TCM a
</span><a href="#local-6989586621681562946"><span class="hs-identifier hs-var">failureFreeVars</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-300"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;variables bound in (erased) parameter position: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681562998"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">IntSet -&gt; (IntSet -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621681563023"><span class="hs-identifier hs-var">boundVars</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><span class="hs-operator hs-var">`IntSet.intersection`</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681562998"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; TCM ()
forall a. IntSet -&gt; TCM a
</span><a href="#local-6989586621681562953"><span class="hs-identifier hs-var">failureNonLinearPars</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563041"><span class="annot"><span class="annottext">rew :: RewriteRule
</span><a href="#local-6989586621681563041"><span class="hs-identifier hs-var hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Tele (Dom Type)
-&gt; QName
-&gt; PElims
-&gt; Term
-&gt; Type
-&gt; Bool
-&gt; RewriteRule
</span><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-var">RewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681562987"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562995"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563018"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681562979"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621681562980"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-306"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checked rewrite rule&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; RewriteRule -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563041"><span class="hs-identifier hs-var">rew</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-308"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checked rewrite rule&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriteRule -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563041"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">RewriteRule -&gt; TCMT IO RewriteRule
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563041"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO RewriteRule
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO RewriteRule)
-&gt; TypeError -&gt; TCMT IO RewriteRule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#DoesNotTargetRewriteRelation"><span class="hs-identifier hs-var">DoesNotTargetRewriteRelation</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="#local-6989586621681563017"><span class="hs-identifier hs-type">checkNoLhsReduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621681563017"><span class="annot"><span class="annottext">checkNoLhsReduction :: QName -&gt; (Elims -&gt; Term) -&gt; Elims -&gt; TCM ()
</span><a href="#local-6989586621681563017"><span class="hs-identifier hs-var hs-var">checkNoLhsReduction</span></a></span></span><span> </span><span id="local-6989586621681563044"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681563045"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563045"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621681563046"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563046"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-comment">-- Skip this check when global confluence check is enabled, as</span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-comment">-- redundant rewrite rules may be required to prove confluence.</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ConfluenceCheck -&gt; Maybe ConfluenceCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; Maybe ConfluenceCheck
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#GlobalConfluenceCheck"><span class="hs-identifier hs-var">GlobalConfluenceCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ConfluenceCheck -&gt; Bool)
-&gt; (PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; PragmaOptions
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563047"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621681563047"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563045"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563046"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span id="local-6989586621681563048"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563048"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563047"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563049"><span class="annot"><a href="#local-6989586621681563050"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681563049"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-323"></span><span>          </span><span id="local-6989586621681563050"><span class="annot"><span class="annottext">fail :: forall {a}. TCMT IO a
</span><a href="#local-6989586621681563050"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;v  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563047"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;v' = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563048"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>            </span><span class="annot"><span class="annottext">TypeError -&gt; TCM a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM a) -&gt; TypeError -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#LHSReducesTo"><span class="hs-identifier hs-var">LHSReducesTo</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563047"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563048"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>      </span><span id="local-6989586621681563067"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563067"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563048"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681563068"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563068"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span id="local-6989586621681563069"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563069"><span class="hs-identifier hs-var">es'</span></a></span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563068"><span class="hs-identifier hs-var">f'</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; TCMT IO Elims
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563069"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621681563070"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563070"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681563071"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563071"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563070"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; TCMT IO Elims
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563071"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Elims
forall {a}. TCMT IO a
</span><a href="#local-6989586621681563050"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563046"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563067"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>        </span><span id="local-6989586621681563072"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563072"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Elims -&gt; TCMT IO Type
forall (m :: * -&gt; *).
MonadConversion m =&gt;
QName -&gt; Elims -&gt; Elims -&gt; m Type
</span><a href="Agda.TypeChecking.Conversion.html#computeElimHeadType"><span class="hs-identifier hs-var">computeElimHeadType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563046"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563067"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621681563074"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681563074"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; QName -&gt; TCMT IO [Polarity]
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
Comparison -&gt; QName -&gt; m [Polarity]
</span><a href="Agda.TypeChecking.Monad.Signature.html#getPolarity%27"><span class="hs-identifier hs-var">getPolarity'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.html#CmpEq"><span class="hs-identifier hs-var">CmpEq</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span id="local-6989586621681563077"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563077"><span class="hs-identifier hs-var">ok</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#dontAssignMetas"><span class="hs-identifier hs-var">dontAssignMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; TCMT IO Bool) -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m () -&gt; m Bool
</span><a href="Agda.TypeChecking.Conversion.html#tryConversion"><span class="hs-identifier hs-var">tryConversion</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCMT IO Bool) -&gt; TCM () -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-335"></span><span>                 </span><span class="annot"><span class="annottext">[Polarity]
-&gt; [IsForced] -&gt; Type -&gt; Term -&gt; Elims -&gt; Elims -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
[Polarity] -&gt; [IsForced] -&gt; Type -&gt; Term -&gt; Elims -&gt; Elims -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareElims"><span class="hs-identifier hs-var">compareElims</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621681563074"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563072"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563046"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563067"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563077"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
forall {a}. TCMT IO a
</span><a href="#local-6989586621681563050"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><a href="#local-6989586621681563003"><span class="hs-identifier hs-type">checkAxFunOrCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621681563003"><span class="annot"><span class="annottext">checkAxFunOrCon :: QName -&gt; Definition -&gt; TCM ()
</span><a href="#local-6989586621681563003"><span class="hs-identifier hs-var hs-var">checkAxFunOrCon</span></a></span></span><span> </span><span id="local-6989586621681563081"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563081"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681563082"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563082"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563082"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>      </span><span id="local-6989586621681563083"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621681563083"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><span class="annottext">Maybe Projection -&gt; (Projection -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ProjectionLikenessMissing Projection -&gt; Maybe Projection
forall a b. Either a b -&gt; Maybe b
</span><a href="Agda.Utils.Either.html#maybeRight"><span class="hs-identifier hs-var">maybeRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; Either ProjectionLikenessMissing Projection
</span><a href="Agda.TypeChecking.Monad.Base.html#funProjection"><span class="hs-identifier hs-var">funProjection</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681563083"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Projection -&gt; TCM ()) -&gt; TCM ())
-&gt; (Projection -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681563087"><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621681563087"><span class="hs-identifier hs-var">proj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621681563087"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolIsProjection"><span class="hs-identifier hs-var">HeadSymbolIsProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563081"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>          </span><span class="annot"><span class="annottext">Maybe QName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolIsProjectionLikeFunction"><span class="hs-identifier hs-var">HeadSymbolIsProjectionLikeFunction</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563081"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ConfluenceCheck -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ConfluenceCheck -&gt; Bool)
-&gt; (PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; PragmaOptions
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563093"><span class="annot"><span class="annottext">simpleClause :: Clause -&gt; (Elims, Maybe Term)
</span><a href="#local-6989586621681563093"><span class="hs-identifier hs-var hs-var">simpleClause</span></a></span></span><span> </span><span id="local-6989586621681563094"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621681563094"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Elims
</span><a href="Agda.Syntax.Internal.Pattern.html#patternsToElims"><span class="hs-identifier hs-var">patternsToElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621681563094"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621681563094"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>          </span><span id="local-6989586621681563098"><span class="annot"><span class="annottext">[(Elims, Maybe Term)]
</span><a href="#local-6989586621681563098"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Elims, Maybe Term)] -&gt; TCMT IO [(Elims, Maybe Term)]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">([(Elims, Maybe Term)] -&gt; TCMT IO [(Elims, Maybe Term)])
-&gt; [(Elims, Maybe Term)] -&gt; TCMT IO [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; (Elims, Maybe Term))
-&gt; [Clause] -&gt; [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; (Elims, Maybe Term)
</span><a href="#local-6989586621681563093"><span class="hs-identifier hs-var">simpleClause</span></a></span><span> </span><span class="annot"><span class="annottext">([Clause] -&gt; [(Elims, Maybe Term)])
-&gt; [Clause] -&gt; [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681563083"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-348"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Elims, Maybe Term)] -&gt; Bool
forall a. AllMetas a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Internal.MetaVars.html#noMetas"><span class="hs-identifier hs-var">noMetas</span></a></span><span> </span><span class="annot"><span class="annottext">[(Elims, Maybe Term)]
</span><a href="#local-6989586621681563098"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolDefContainsMetas"><span class="hs-identifier hs-var">HeadSymbolDefContainsMetas</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563081"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: is this fine?</span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolNotPostulateFunctionConstructor"><span class="hs-identifier hs-var">HeadSymbolNotPostulateFunctionConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563081"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="#local-6989586621681563016"><span class="hs-identifier hs-type">ifNotAlreadyAdded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621681563016"><span class="annot"><span class="annottext">ifNotAlreadyAdded :: QName -&gt; TCMT IO RewriteRule -&gt; TCMT IO RewriteRule
</span><a href="#local-6989586621681563016"><span class="hs-identifier hs-var hs-var">ifNotAlreadyAdded</span></a></span></span><span> </span><span id="local-6989586621681563105"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563105"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681563106"><span class="annot"><span class="annottext">TCMT IO RewriteRule
</span><a href="#local-6989586621681563106"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>      </span><span id="local-6989586621681563107"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563107"><span class="hs-identifier hs-var">rews</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO RewriteRules
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m RewriteRules
</span><a href="Agda.TypeChecking.Monad.Signature.html#getRewriteRulesFor"><span class="hs-identifier hs-var">getRewriteRulesFor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563105"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- check if q is already an added rewrite rule</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(RewriteRule -&gt; Bool) -&gt; RewriteRules -&gt; Maybe RewriteRule
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Bool) -&gt; (RewriteRule -&gt; QName) -&gt; RewriteRule -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563107"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681563110"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563110"><span class="hs-identifier hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563110"><span class="hs-identifier hs-var">rew</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; TCM () -&gt; TCMT IO RewriteRule
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateRewriteRule"><span class="hs-identifier hs-var">DuplicateRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">Maybe RewriteRule
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO RewriteRule
</span><a href="#local-6989586621681563106"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><a href="#local-6989586621681563032"><span class="hs-identifier hs-type">usedArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621681563032"><span class="annot"><span class="annottext">usedArgs :: Definition -&gt; IntSet
</span><a href="#local-6989586621681563032"><span class="hs-identifier hs-var hs-var">usedArgs</span></a></span></span><span> </span><span id="local-6989586621681563113"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563113"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; IntSet) -&gt; [Int] -&gt; IntSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Occurrence, Int) -&gt; Int) -&gt; [(Occurrence, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Occurrence, Int)] -&gt; [Int]) -&gt; [(Occurrence, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Occurrence, Int)]
</span><a href="#local-6989586621681563114"><span class="hs-identifier hs-var">usedIxs</span></a></span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621681563115"><span class="annot"><span class="annottext">occs :: [Occurrence]
</span><a href="#local-6989586621681563115"><span class="hs-identifier hs-var hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; [Occurrence]
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681563113"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span id="local-6989586621681563117"><span class="annot"><span class="annottext">allIxs :: [(Occurrence, Int)]
</span><a href="#local-6989586621681563117"><span class="hs-identifier hs-var hs-var">allIxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Int] -&gt; [(Occurrence, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621681563115"><span class="hs-identifier hs-var">occs</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [(Occurrence, Int)]) -&gt; [Int] -&gt; [(Occurrence, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621681563115"><span class="hs-identifier hs-var">occs</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621681563114"><span class="annot"><span class="annottext">usedIxs :: [(Occurrence, Int)]
</span><a href="#local-6989586621681563114"><span class="hs-identifier hs-var hs-var">usedIxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Occurrence, Int) -&gt; Bool)
-&gt; [(Occurrence, Int)] -&gt; [(Occurrence, Int)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Bool
</span><a href="#local-6989586621681563118"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; Bool)
-&gt; ((Occurrence, Int) -&gt; Occurrence) -&gt; (Occurrence, Int) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence, Int) -&gt; Occurrence
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Occurrence, Int)]
</span><a href="#local-6989586621681563117"><span class="hs-identifier hs-var">allIxs</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span id="local-6989586621681563118"><span class="annot"><span class="annottext">used :: Occurrence -&gt; Bool
</span><a href="#local-6989586621681563118"><span class="hs-identifier hs-var hs-var">used</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Pos.Unused</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><a href="#local-6989586621681563118"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><a href="#local-6989586621681563013"><span class="hs-identifier hs-type">checkParametersAreGeneral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621681563013"><span class="annot"><span class="annottext">checkParametersAreGeneral :: ConHead -&gt; [Arg Term] -&gt; TCMT IO [Int]
</span><a href="#local-6989586621681563013"><span class="hs-identifier hs-var hs-var">checkParametersAreGeneral</span></a></span></span><span> </span><span id="local-6989586621681563122"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563122"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681563123"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563123"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-374"></span><span>        </span><span id="local-6989586621681563124"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681563124"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; TCMT IO [Int]
</span><a href="#local-6989586621681563125"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563123"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; Bool
</span><a href="Agda.Utils.List.html#fastDistinct"><span class="hs-identifier hs-var">fastDistinct</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681563124"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
forall {a}. TCMT IO a
</span><a href="#local-6989586621681563127"><span class="hs-identifier hs-var">errorNotGeneral</span></a></span><span>
</span><span id="line-376"></span><span>        </span><span class="annot"><span class="annottext">[Int] -&gt; TCMT IO [Int]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681563124"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>        </span><span id="local-6989586621681563125"><span class="annot"><span class="annottext">loop :: [Arg Term] -&gt; TCMT IO [Int]
</span><a href="#local-6989586621681563125"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; TCMT IO [Int]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><a href="#local-6989586621681563125"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681563132"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621681563132"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681563133"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563133"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621681563132"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-380"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681563135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681563135"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681563135"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; TCMT IO [Int] -&gt; TCMT IO [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; TCMT IO [Int]
</span><a href="#local-6989586621681563125"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563133"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [Int]
forall {a}. TCMT IO a
</span><a href="#local-6989586621681563127"><span class="hs-identifier hs-var">errorNotGeneral</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>        </span><span id="local-6989586621681563136"><span class="annot"><a href="#local-6989586621681563127"><span class="hs-identifier hs-type">errorNotGeneral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681563136"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-384"></span><span>        </span><span id="local-6989586621681563127"><span class="annot"><span class="annottext">errorNotGeneral :: forall {a}. TCMT IO a
</span><a href="#local-6989586621681563127"><span class="hs-identifier hs-var hs-var">errorNotGeneral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681562884"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; [Arg Term] -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ConstructorParamsNotGeneral"><span class="hs-identifier hs-var">ConstructorParamsNotGeneral</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621681563122"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621681563123"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- | @rewriteWith t f es rew@ where @f : t@</span><span>
</span><span id="line-387"></span><span class="hs-comment">--   tries to rewrite @f es@ with @rew@, returning the reduct if successful.</span><span>
</span><span id="line-388"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-type">rewriteWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-389"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="rewriteWith"><span class="annot"><span class="annottext">rewriteWith :: Type
-&gt; (Elims -&gt; Term)
-&gt; RewriteRule
-&gt; Elims
-&gt; ReduceM (Either (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-var hs-var">rewriteWith</span></a></span></span><span> </span><span id="local-6989586621681563142"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563142"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681563143"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621681563144"><span class="annot"><span class="annottext">rew :: RewriteRule
</span><a href="#local-6989586621681563144"><span class="hs-identifier hs-var">rew</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span id="local-6989586621681563145"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681563145"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681563146"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681563146"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681563147"><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563147"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621681563148"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563148"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621681563149"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563149"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681563150"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563150"><span class="hs-identifier hs-var">isClause</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681563151"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span></span><span>
</span><span id="line-394"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563150"><span class="hs-identifier hs-var">isClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Either (Blocked Term) Term
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Either (Blocked Term) Term)
-&gt; Blocked Term -&gt; Either (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Term -&gt; Blocked Term
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Blocked Term) -&gt; Term -&gt; Blocked Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-395"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;{ attempting to rewrite term &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; having head &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563142"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; with rule &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; RewriteRule -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563144"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;raw: attempting to rewrite term &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Term -&gt; ArgName) -&gt; Term -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; having head &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Term -&gt; ArgName) -&gt; Term -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Type -&gt; ArgName) -&gt; Type -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563142"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; with rule &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; ArgName) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563144"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>  </span><span id="local-6989586621681563156"><span class="annot"><span class="annottext">Either Blocked_ Substitution
</span><a href="#local-6989586621681563156"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
-&gt; TypeOf Elims
-&gt; PElims
-&gt; Elims
-&gt; ReduceM (Either Blocked_ Substitution)
forall (m :: * -&gt; *) a b.
(PureTCM m, Match a b) =&gt;
Tele (Dom Type)
-&gt; TypeOf b -&gt; a -&gt; b -&gt; m (Either Blocked_ Substitution)
</span><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html#nonLinMatch"><span class="hs-identifier hs-var">nonLinMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681563146"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563142"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621681563147"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Blocked_ Substitution
</span><a href="#local-6989586621681563156"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681563158"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563158"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;}&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Either (Blocked Term) Term
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Either (Blocked Term) Term)
-&gt; Blocked Term -&gt; Either (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563158"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Blocked Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- TODO: remember reductions</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681563160"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621681563160"><span class="hs-identifier hs-var">sub</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563161"><span class="annot"><span class="annottext">v' :: Term
</span><a href="#local-6989586621681563161"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Term)
</span><a href="#local-6989586621681563160"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563148"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-412"></span><span>      </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rewrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563143"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563151"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563161"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Either (Blocked Term) Term
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563161"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- | @rewrite b v rules es@ tries to rewrite @v@ applied to @es@ with the</span><span>
</span><span id="line-419"></span><span class="hs-comment">--   rewrite rules @rules@. @b@ is the default blocking tag.</span><span>
</span><span id="line-420"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier hs-type">rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span id="rewrite"><span class="annot"><span class="annottext">rewrite :: Blocked_
-&gt; (Elims -&gt; Term)
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier hs-var hs-var">rewrite</span></a></span></span><span> </span><span id="local-6989586621681563163"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563163"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621681563164"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621681563165"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563165"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621681563166"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563166"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621681563167"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563167"><span class="hs-identifier hs-var">rewritingAllowed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-var">optRewriting</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; ReduceM PragmaOptions -&gt; ReduceM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReduceM PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681563167"><span class="hs-identifier hs-var">rewritingAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriteRules -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563165"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681563168"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563168"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName, Type) -&gt; Maybe (QName, Type) -&gt; (QName, Type)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">(QName, Type)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, Type) -&gt; (QName, Type))
-&gt; ReduceM (Maybe (QName, Type)) -&gt; ReduceM (QName, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReduceM (Maybe (QName, Type))
forall (m :: * -&gt; *). PureTCM m =&gt; Term -&gt; m (Maybe (QName, Type))
</span><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html#getTypedHead"><span class="hs-identifier hs-var">getTypedHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621681563170"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563163"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563168"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563165"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; ReduceM Elims -&gt; ReduceM (Reduced (Blocked Term) Term)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; ReduceM Elims
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563166"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- TODO: remove instantiateFull?</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">else</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="annottext">Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Term) Term
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Reduced (Blocked Term) Term
forall no yes. no -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-var">NoReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563163"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Blocked Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563166"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><a href="#local-6989586621681563170"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621681563170"><span class="annot"><span class="annottext">loop :: Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621681563170"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621681563173"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563173"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621681563174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563174"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681563175"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563175"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Reduced (Blocked Term) Term)
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;failed to rewrite &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563175"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;blocking tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563173"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Term) Term)
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; ReduceM (Reduced (Blocked Term) Term)
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Term) Term
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Reduced (Blocked Term) Term
forall no yes. no -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-var">NoReduction</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Reduced (Blocked Term) Term)
-&gt; Blocked Term -&gt; Reduced (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563173"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Blocked Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563175"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><a href="#local-6989586621681563170"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621681563176"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563176"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621681563177"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563177"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681563178"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563178"><span class="hs-identifier hs-var">rew</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681563179"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563179"><span class="hs-identifier hs-var">rews</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681563180"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span></span><span>
</span><span id="line-437"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681563181"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681563181"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; Int
</span><a href="#local-6989586621681563182"><span class="hs-identifier hs-var">rewArity</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563178"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681563181"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681563184"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563184"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681563185"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563185"><span class="hs-identifier hs-var">es2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall i a. Integral i =&gt; i -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.genericSplitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681563181"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-439"></span><span>          </span><span id="local-6989586621681563187"><span class="annot"><span class="annottext">Either (Blocked Term) Term
</span><a href="#local-6989586621681563187"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Elims -&gt; Term)
-&gt; RewriteRule
-&gt; Elims
-&gt; ReduceM (Either (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-var">rewriteWith</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563177"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621681563164"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681563178"><span class="hs-identifier hs-var">rew</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563184"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-440"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Term) Term
</span><a href="#local-6989586621681563187"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621681563189"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681563189"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681563190"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563190"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621681563170"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563176"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; () -&gt; Blocked_
forall t a. Blocker -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621681563189"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563177"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563179"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621681563170"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563176"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563177"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563179"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-443"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681563191"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563191"><span class="hs-identifier hs-var">w</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Term) Term
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Simplification -&gt; Term -&gt; Reduced (Blocked Term) Term
forall no yes. Simplification -&gt; yes -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-var">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Simplification
</span><a href="Agda.TypeChecking.Monad.Base.html#YesSimplification"><span class="hs-identifier hs-var">YesSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Reduced (Blocked Term) Term)
-&gt; Term -&gt; Reduced (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681563191"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563185"><span class="hs-identifier hs-var">es2</span></a></span><span>
</span><span id="line-444"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621681563170"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681563176"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681563177"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681563179"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681563180"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><a href="#local-6989586621681563182"><span class="hs-identifier hs-type">rewArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621681563182"><span class="annot"><span class="annottext">rewArity :: RewriteRule -&gt; Int
</span><a href="#local-6989586621681563182"><span class="hs-identifier hs-var hs-var">rewArity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PElims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(PElims -&gt; Int) -&gt; (RewriteRule -&gt; PElims) -&gt; RewriteRule -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; PElims
</span><a href="Agda.TypeChecking.Monad.Base.html#rewPats"><span class="hs-identifier hs-var">rewPats</span></a></span><span>
</span><span id="line-448"></span></pre></body></html>