<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="annot"><span class="hs-comment">{-| A constructor argument is forced if it appears as pattern variable
in an index of the target.

For instance @x@ is forced in @sing@ and @n@ is forced in @zero@ and @suc@:

@
  data Sing {a}{A : Set a} : A -&gt; Set where
    sing : (x : A) -&gt; Sing x

  data Fin : Nat -&gt; Set where
    zero : (n : Nat) -&gt; Fin (suc n)
    suc  : (n : Nat) (i : Fin n) -&gt; Fin (suc n)
@

At runtime, forced constructor arguments may be erased as they can be
recovered from dot patterns.  For instance,
@
  unsing : {A : Set} (x : A) -&gt; Sing x -&gt; A
  unsing .x (sing x) = x
@
can become
@
  unsing x sing = x
@
and
@
  proj : (n : Nat) (i : Fin n) -&gt; Nat
  proj .(suc n) (zero n) = n
  proj .(suc n) (suc n i) = n
@
becomes
@
  proj (suc n) zero    = n
  proj (suc n) (suc i) = n
@

This module implements the analysis of which constructor arguments are forced. The process of moving
the binding site of forced arguments is implemented in the unifier (see the Solution step of
Agda.TypeChecking.Rules.LHS.Unify.unifyStep).

Forcing is a concept from pattern matching and thus builds on the
concept of equality (I) used there (closed terms, extensional) which is
different from the equality (II) used in conversion checking and the
constraint solver (open terms, intensional).

Up to issue 1441 (Feb 2015), the forcing analysis here relied on the
wrong equality (II), considering type constructors as injective.  This is
unsound for program extraction, but ok if forcing is only used to decide which
arguments to skip during conversion checking.

From now on, forcing uses equality (I) and does not search for forced
variables under type constructors.  This may lose some savings during
conversion checking.  If this turns out to be a problem, the old
forcing could be brought back, using a new modality @Skip@ to indicate
that this is a relevant argument but still can be skipped during
conversion checking as it is forced by equality (II).

-}</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.Forcing</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#computeForcingAnnotations"><span class="hs-identifier">computeForcingAnnotations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#isForced"><span class="hs-identifier">isForced</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#nextIsForced"><span class="hs-identifier">nextIsForced</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.DList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DList</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.DList</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DL</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-comment">-- for (&lt;&gt;) in GHC 8.0.2</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Given the type of a constructor (excluding the parameters),</span><span>
</span><span id="line-91"></span><span class="hs-comment">--   decide which arguments are forced.</span><span>
</span><span id="line-92"></span><span class="hs-comment">--   Precondition: the type is of the form @&#915; &#8594; D vs@ and the @vs@</span><span>
</span><span id="line-93"></span><span class="hs-comment">--   are in normal form.</span><span>
</span><span id="line-94"></span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#computeForcingAnnotations"><span class="hs-identifier hs-type">computeForcingAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsForced"><span class="hs-identifier hs-type">IsForced</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span id="computeForcingAnnotations"><span class="annot"><span class="annottext">computeForcingAnnotations :: QName -&gt; Type -&gt; TCM [IsForced]
</span><a href="Agda.TypeChecking.Forcing.html#computeForcingAnnotations"><span class="hs-identifier hs-var hs-var">computeForcingAnnotations</span></a></span></span><span> </span><span id="local-6989586621681451572"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681451572"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681451573"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681451573"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM [IsForced] -&gt; TCM [IsForced] -&gt; TCM [IsForced]
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optForcing"><span class="hs-identifier hs-var">optForcing</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span> </span><span class="hs-comment">{-then-}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IsForced] -&gt; TCM [IsForced]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM [IsForced] -&gt; TCM [IsForced])
-&gt; TCM [IsForced] -&gt; TCM [IsForced]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-03-10  Normalization prevents Issue 1454.</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- t &lt;- normalise t</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-03-28  Issue 1469: Normalization too costly.</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- Instantiation also fixes Issue 1454.</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- Note that normalization of s0 below does not help.</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621681451578"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681451578"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Type
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681451573"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- Ulf, 2018-01-28 (#2919): We do need to reduce the target type enough to</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- get to the actual data type.</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- Also #2947: The type might reduce to a pi type.</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621681451581"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681451581"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681451583"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681451583"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *). PureTCM m =&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewPath"><span class="hs-identifier hs-var">telViewPath</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681451578"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- Jesper, 2023-09-20 (#6867): With --erasure, only arguments with @0 can be forced.</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621681451585"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681451585"><span class="hs-identifier hs-var">erasureOn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optErasure"><span class="hs-identifier hs-var">optErasure</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681451587"><span class="annot"><span class="annottext">vs :: Elims
</span><a href="#local-6989586621681451587"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621681451583"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681451589"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681451589"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681451589"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span id="local-6989586621681451591"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681451591"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681451581"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><a href="#local-6989586621681451593"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621681451593"><span class="annot"><span class="annottext">xs :: [(Modality, Int)]
</span><a href="#local-6989586621681451593"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList (Modality, Int) -&gt; [(Modality, Int)]
forall a. DList a -&gt; [a]
</span><span class="hs-identifier hs-var">DL.toList</span></span><span> </span><span class="annot"><span class="annottext">(DList (Modality, Int) -&gt; [(Modality, Int)])
-&gt; DList (Modality, Int) -&gt; [(Modality, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; DList (Modality, Int)
forall a. ForcedVariables a =&gt; a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681451587"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="#local-6989586621681451597"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>        </span><span id="local-6989586621681451597"><span class="annot"><span class="annottext">xs' :: IntMap [Modality]
</span><a href="#local-6989586621681451597"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DList Modality -&gt; [Modality])
-&gt; IntMap (DList Modality) -&gt; IntMap [Modality]
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><span class="hs-identifier hs-var">IntMap.map</span></span><span> </span><span class="annot"><span class="annottext">DList Modality -&gt; [Modality]
forall a. DList a -&gt; [a]
</span><span class="hs-identifier hs-var">DL.toList</span></span><span> </span><span class="annot"><span class="annottext">(IntMap (DList Modality) -&gt; IntMap [Modality])
-&gt; IntMap (DList Modality) -&gt; IntMap [Modality]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DList Modality -&gt; DList Modality -&gt; DList Modality)
-&gt; [(Int, DList Modality)] -&gt; IntMap (DList Modality)
forall a. (a -&gt; a -&gt; a) -&gt; [(Int, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">DList Modality -&gt; DList Modality -&gt; DList Modality
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">([(Int, DList Modality)] -&gt; IntMap (DList Modality))
-&gt; [(Int, DList Modality)] -&gt; IntMap (DList Modality)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>              </span><span class="annot"><span class="annottext">((Modality, Int) -&gt; (Int, DList Modality))
-&gt; [(Modality, Int)] -&gt; [(Int, DList Modality)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681451600"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451600"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681451601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451601"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451601"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; DList Modality
forall a. a -&gt; DList a
</span><span class="hs-identifier hs-var">DL.singleton</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451600"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Modality, Int)]
</span><a href="#local-6989586621681451593"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-comment">-- #2819: We can only mark an argument as forced if it appears in the</span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-comment">-- type with a relevance below (i.e. more relevant) than the one of the</span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-comment">-- constructor argument. Otherwise we can't actually get the value from</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-comment">-- the type. Also the argument shouldn't be irrelevant, since in that</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-comment">-- case it isn't really forced.</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><a href="#local-6989586621681451603"><span class="hs-identifier hs-type">isForced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621681451603"><span class="annot"><span class="annottext">isForced :: Modality -&gt; Int -&gt; Bool
</span><a href="#local-6989586621681451603"><span class="hs-identifier hs-var hs-var">isForced</span></a></span></span><span> </span><span id="local-6989586621681451604"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451604"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681451605"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451605"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Bool
forall a. LensQuantity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#hasQuantity0"><span class="hs-identifier hs-var">hasQuantity0</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451604"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681451585"><span class="hs-identifier hs-var">erasureOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451604"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; Relevance -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#Irrelevant"><span class="hs-identifier hs-var">Irrelevant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap [Modality] -&gt; Maybe [Modality]
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451605"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap [Modality]
</span><a href="#local-6989586621681451597"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-128"></span><span>                 </span><span class="annot"><span class="annottext">Maybe [Modality]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-129"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681451614"><span class="annot"><span class="annottext">[Modality]
</span><a href="#local-6989586621681451614"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Bool) -&gt; [Modality] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
</span><a href="Agda.Syntax.Common.html#moreUsableModality"><span class="hs-operator hs-var">`moreUsableModality`</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451604"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Modality]
</span><a href="#local-6989586621681451614"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span id="local-6989586621681451617"><span class="annot"><span class="annottext">forcedArgs :: [IsForced]
</span><a href="#local-6989586621681451617"><span class="hs-identifier hs-var hs-var">forcedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Int -&gt; Bool
</span><a href="#local-6989586621681451603"><span class="hs-identifier hs-var">isForced</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451618"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451619"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#Forced"><span class="hs-identifier hs-var">Forced</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotForced"><span class="hs-identifier hs-var">NotForced</span></a></span><span>
</span><span id="line-132"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681451619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451619"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681451618"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451618"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Modality] -&gt; [(Int, Modality)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451591"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Modality] -&gt; [(Int, Modality)])
-&gt; [Modality] -&gt; [(Int, Modality)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom (ArgName, Type) -&gt; Modality)
-&gt; [Dom (ArgName, Type)] -&gt; [Modality]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom (ArgName, Type) -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621681451581"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; [ArgName] -&gt; TCMT IO ()
forall a (m :: * -&gt; *).
(ReportS a, MonadDebug m) =&gt;
ArgName -&gt; Int -&gt; a -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; [ArgName] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-var">reportS</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.force&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Forcing analysis for &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681451572"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  xs          = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Modality, Int) -&gt; Int) -&gt; [(Modality, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Modality, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Modality, Int)]
</span><a href="#local-6989586621681451593"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  forcedArgs  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[IsForced] -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621681451617"><span class="hs-identifier hs-var">forcedArgs</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">[IsForced] -&gt; TCM [IsForced]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621681451617"><span class="hs-identifier hs-var">forcedArgs</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-comment">-- | Compute the pattern variables of a term or term-like thing.</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">class</span><span> </span><span id="ForcedVariables"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-var">ForcedVariables</span></a></span></span><span> </span><span id="local-6989586621681451445"><span class="annot"><a href="#local-6989586621681451445"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>  </span><span id="forcedVariables"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-type">forcedVariables</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681451445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="forcedVariables"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-type">forcedVariables</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621681451472"><span id="local-6989586621681451473"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621681451473"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681451445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621681451473"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621681451445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621681451629"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var hs-var">forcedVariables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; DList (Modality, Int)) -&gt; t b -&gt; DList (Modality, Int)
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; DList (Modality, Int)
forall a. ForcedVariables a =&gt; a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681451422"><span id="local-6989586621681451641"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451422"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681451422"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- Note that the 'a' does not include the 'Arg' in 'Apply'.</span><span>
</span><span id="line-153"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681451421"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451421"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621681451653"><span class="annot"><span class="annottext">forcedVariables :: Elim' a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var hs-var hs-var hs-var">forcedVariables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621681451655"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621681451655"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; DList (Modality, Int)
forall a. ForcedVariables a =&gt; a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621681451655"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList (Modality, Int)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>  </span><span class="hs-comment">-- No forced variables in path applications</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList (Modality, Int)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681451483"><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681451483"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621681451667"><span class="annot"><span class="annottext">forcedVariables :: Arg a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var hs-var hs-var hs-var">forcedVariables</span></a></span></span><span> </span><span id="local-6989586621681451668"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621681451668"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">((Modality, Int) -&gt; (Modality, Int))
-&gt; DList (Modality, Int) -&gt; DList (Modality, Int)
forall a b. (a -&gt; b) -&gt; DList a -&gt; DList b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Modality -&gt; Modality) -&gt; (Modality, Int) -&gt; (Modality, Int)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Modality
</span><a href="Agda.Syntax.Common.html#composeModality"><span class="hs-identifier hs-var">composeModality</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621681451671"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; DList (Modality, Int)
forall a. ForcedVariables a =&gt; a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg a -&gt; a
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621681451668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681451671"><span class="annot"><span class="annottext">m :: Modality
</span><a href="#local-6989586621681451671"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621681451668"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><span class="hs-comment">-- | Assumes that the term is in normal form.</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#ForcedVariables"><span class="hs-identifier hs-type">ForcedVariables</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621681451676"><span class="annot"><span class="annottext">forcedVariables :: Term -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var hs-var hs-var hs-var">forcedVariables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681451678"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451678"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Modality, Int) -&gt; DList (Modality, Int)
forall a. a -&gt; DList a
</span><span class="hs-identifier hs-var">DL.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Agda.Syntax.Common.html#unitModality"><span class="hs-identifier hs-var">unitModality</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681451678"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681451681"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681451681"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; DList (Modality, Int)
forall a. ForcedVariables a =&gt; a -&gt; DList (Modality, Int)
</span><a href="Agda.TypeChecking.Forcing.html#forcedVariables"><span class="hs-identifier hs-var">forcedVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621681451681"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DList (Modality, Int)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#isForced"><span class="hs-identifier hs-type">isForced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsForced"><span class="hs-identifier hs-type">IsForced</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-171"></span><span id="isForced"><span class="annot"><span class="annottext">isForced :: IsForced -&gt; Bool
</span><a href="Agda.TypeChecking.Forcing.html#isForced"><span class="hs-identifier hs-var hs-var">isForced</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#Forced"><span class="hs-identifier hs-var">Forced</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#isForced"><span class="hs-identifier hs-var">isForced</span></a></span><span> </span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotForced"><span class="hs-identifier hs-var">NotForced</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#nextIsForced"><span class="hs-identifier hs-type">nextIsForced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsForced"><span class="hs-identifier hs-type">IsForced</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsForced"><span class="hs-identifier hs-type">IsForced</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsForced"><span class="hs-identifier hs-type">IsForced</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span id="nextIsForced"><span class="annot"><span class="annottext">nextIsForced :: [IsForced] -&gt; (IsForced, [IsForced])
</span><a href="Agda.TypeChecking.Forcing.html#nextIsForced"><span class="hs-identifier hs-var hs-var">nextIsForced</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotForced"><span class="hs-identifier hs-var">NotForced</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="annot"><a href="Agda.TypeChecking.Forcing.html#nextIsForced"><span class="hs-identifier hs-var">nextIsForced</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681451682"><span class="annot"><span class="annottext">IsForced
</span><a href="#local-6989586621681451682"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681451683"><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621681451683"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsForced
</span><a href="#local-6989586621681451682"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621681451683"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span></pre></body></html>